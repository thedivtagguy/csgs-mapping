function bi(){}const iT=i=>i;function Rl(i,o){for(const l in o)i[l]=o[l];return i}function nT(i){return i&&typeof i=="object"&&typeof i.then=="function"}function Hv(i){return i()}function Wv(){return Object.create(null)}function kl(i){i.forEach(Hv)}function Lf(i){return typeof i=="function"}function Ff(i,o){return i!=i?o==o:i!==o||i&&typeof i=="object"||typeof i=="function"}let Bf;function iD(i,o){return Bf||(Bf=document.createElement("a")),Bf.href=o,i===Bf.href}function oT(i){return Object.keys(i).length===0}function Xv(i,...o){if(i==null)return bi;const l=i.subscribe(...o);return l.unsubscribe?()=>l.unsubscribe():l}function xa(i){let o;return Xv(i,l=>o=l)(),o}function Dm(i,o,l){i.$$.on_destroy.push(Xv(o,l))}function jf(i,o,l,h){if(i){const _=Qv(i,o,l,h);return i[0](_)}}function Qv(i,o,l,h){return i[1]&&h?Rl(l.ctx.slice(),i[1](h(o))):l.ctx}function Nf(i,o,l,h){if(i[2]&&h){const _=i[2](h(l));if(o.dirty===void 0)return _;if(typeof _=="object"){const x=[],E=Math.max(o.dirty.length,_.length);for(let s=0;s<E;s+=1)x[s]=o.dirty[s]|_[s];return x}return o.dirty|_}return o.dirty}function Uf(i,o,l,h,_,x){if(_){const E=Qv(o,l,h,x);i.p(E,_)}}function Vf(i){if(i.ctx.length>32){const o=[],l=i.ctx.length/32;for(let h=0;h<l;h++)o[h]=-1;return o}return-1}function sT(i){const o={};for(const l in i)l[0]!=="$"&&(o[l]=i[l]);return o}function Yv(i,o){const l={};o=new Set(o);for(const h in i)!o.has(h)&&h[0]!=="$"&&(l[h]=i[h]);return l}function $f(i,o,l){return i.set(l),o}function nD(i){return i&&Lf(i.destroy)?i.destroy:bi}const Kv=typeof window!="undefined";let aT=Kv?()=>window.performance.now():()=>Date.now(),Om=Kv?i=>requestAnimationFrame(i):bi;const Dl=new Set;function Jv(i){Dl.forEach(o=>{o.c(i)||(Dl.delete(o),o.f())}),Dl.size!==0&&Om(Jv)}function lT(i){let o;return Dl.size===0&&Om(Jv),{promise:new Promise(l=>{Dl.add(o={c:i,f:l})}),abort(){Dl.delete(o)}}}let Gf=!1;function cT(){Gf=!0}function uT(){Gf=!1}function hT(i,o,l,h){for(;i<o;){const _=i+(o-i>>1);l(_)<=h?i=_+1:o=_}return i}function fT(i){if(i.hydrate_init)return;i.hydrate_init=!0;let o=i.childNodes;if(i.nodeName==="HEAD"){const A=[];for(let M=0;M<o.length;M++){const z=o[M];z.claim_order!==void 0&&A.push(z)}o=A}const l=new Int32Array(o.length+1),h=new Int32Array(o.length);l[0]=-1;let _=0;for(let A=0;A<o.length;A++){const M=o[A].claim_order,z=(_>0&&o[l[_]].claim_order<=M?_+1:hT(1,_,F=>o[l[F]].claim_order,M))-1;h[A]=l[z]+1;const L=z+1;l[L]=A,_=Math.max(L,_)}const x=[],E=[];let s=o.length-1;for(let A=l[_]+1;A!=0;A=h[A-1]){for(x.push(o[A-1]);s>=A;s--)E.push(o[s]);s--}for(;s>=0;s--)E.push(o[s]);x.reverse(),E.sort((A,M)=>A.claim_order-M.claim_order);for(let A=0,M=0;A<E.length;A++){for(;M<x.length&&E[A].claim_order>=x[M].claim_order;)M++;const z=M<x.length?x[M]:null;i.insertBefore(E[A],z)}}function dT(i,o){i.appendChild(o)}function e0(i){if(!i)return document;const o=i.getRootNode?i.getRootNode():i.ownerDocument;return o&&o.host?o:i.ownerDocument}function pT(i){const o=zu("style");return mT(e0(i),o),o.sheet}function mT(i,o){return dT(i.head||i,o),o.sheet}function Ol(i,o){if(Gf){for(fT(i),(i.actual_end_child===void 0||i.actual_end_child!==null&&i.actual_end_child.parentNode!==i)&&(i.actual_end_child=i.firstChild);i.actual_end_child!==null&&i.actual_end_child.claim_order===void 0;)i.actual_end_child=i.actual_end_child.nextSibling;o!==i.actual_end_child?(o.claim_order!==void 0||o.parentNode!==i)&&i.insertBefore(o,i.actual_end_child):i.actual_end_child=o.nextSibling}else(o.parentNode!==i||o.nextSibling!==null)&&i.appendChild(o)}function ao(i,o,l){Gf&&!l?Ol(i,o):(o.parentNode!==i||o.nextSibling!=l)&&i.insertBefore(o,l||null)}function Ai(i){i.parentNode.removeChild(i)}function oD(i,o){for(let l=0;l<i.length;l+=1)i[l]&&i[l].d(o)}function zu(i){return document.createElement(i)}function Lm(i){return document.createElementNS("http://www.w3.org/2000/svg",i)}function qf(i){return document.createTextNode(i)}function Zf(){return qf(" ")}function lo(){return qf("")}function sD(i,o,l,h){return i.addEventListener(o,l,h),()=>i.removeEventListener(o,l,h)}function rn(i,o,l){l==null?i.removeAttribute(o):i.getAttribute(o)!==l&&i.setAttribute(o,l)}function Ll(i){return Array.from(i.childNodes)}function _T(i){i.claim_info===void 0&&(i.claim_info={last_index:0,total_claimed:0})}function t0(i,o,l,h,_=!1){_T(i);const x=(()=>{for(let E=i.claim_info.last_index;E<i.length;E++){const s=i[E];if(o(s)){const A=l(s);return A===void 0?i.splice(E,1):i[E]=A,_||(i.claim_info.last_index=E),s}}for(let E=i.claim_info.last_index-1;E>=0;E--){const s=i[E];if(o(s)){const A=l(s);return A===void 0?i.splice(E,1):i[E]=A,_?A===void 0&&i.claim_info.last_index--:i.claim_info.last_index=E,s}}return h()})();return x.claim_order=i.claim_info.total_claimed,i.claim_info.total_claimed+=1,x}function r0(i,o,l,h){return t0(i,_=>_.nodeName===o,_=>{const x=[];for(let E=0;E<_.attributes.length;E++){const s=_.attributes[E];l[s.name]||x.push(s.name)}x.forEach(E=>_.removeAttribute(E))},()=>h(o))}function Fm(i,o,l){return r0(i,o,l,zu)}function i0(i,o,l){return r0(i,o,l,Lm)}function n0(i,o){return t0(i,l=>l.nodeType===3,l=>{const h=""+o;if(l.data.startsWith(h)){if(l.data.length!==h.length)return l.splitText(h.length)}else l.data=h},()=>qf(o),!0)}function Hf(i){return n0(i," ")}function gT(i,o){o=""+o,i.wholeText!==o&&(i.data=o)}function aD(i,o){i.value=o==null?"":o}function lD(i,o,l,h){l===null?i.style.removeProperty(o):i.style.setProperty(o,l,h?"important":"")}function cD(i,o){for(let l=0;l<i.options.length;l+=1){const h=i.options[l];if(h.__value===o){h.selected=!0;return}}i.selectedIndex=-1}function uD(i){const o=i.querySelector(":checked")||i.options[0];return o&&o.__value}function Wf(i,o,l){i.classList[l?"add":"remove"](o)}function yT(i,o,{bubbles:l=!1,cancelable:h=!1}={}){const _=document.createEvent("CustomEvent");return _.initCustomEvent(i,l,h,o),_}function hD(i,o){const l=[];let h=0;for(const _ of o.childNodes)if(_.nodeType===8){const x=_.textContent.trim();x===`HEAD_${i}_END`?(h-=1,l.push(_)):x===`HEAD_${i}_START`&&(h+=1,l.push(_))}else h>0&&l.push(_);return l}function Xf(i,o){return new i(o)}const Qf=new Map;let Yf=0;function vT(i){let o=5381,l=i.length;for(;l--;)o=(o<<5)-o^i.charCodeAt(l);return o>>>0}function xT(i,o){const l={stylesheet:pT(o),rules:{}};return Qf.set(i,l),l}function o0(i,o,l,h,_,x,E,s=0){const A=16.666/h;let M=`{
`;for(let he=0;he<=1;he+=A){const ve=o+(l-o)*x(he);M+=he*100+`%{${E(ve,1-ve)}}
`}const z=M+`100% {${E(l,1-l)}}
}`,L=`__svelte_${vT(z)}_${s}`,F=e0(i),{stylesheet:j,rules:H}=Qf.get(F)||xT(F,i);H[L]||(H[L]=!0,j.insertRule(`@keyframes ${L} ${z}`,j.cssRules.length));const W=i.style.animation||"";return i.style.animation=`${W?`${W}, `:""}${L} ${h}ms linear ${_}ms 1 both`,Yf+=1,L}function bT(i,o){const l=(i.style.animation||"").split(", "),h=l.filter(o?x=>x.indexOf(o)<0:x=>x.indexOf("__svelte")===-1),_=l.length-h.length;_&&(i.style.animation=h.join(", "),Yf-=_,Yf||wT())}function wT(){Om(()=>{Yf||(Qf.forEach(i=>{const{ownerNode:o}=i.stylesheet;o&&Ai(o)}),Qf.clear())})}let Ru;function ko(i){Ru=i}function Kf(){if(!Ru)throw new Error("Function called outside component initialization");return Ru}function fD(i){Kf().$$.on_mount.push(i)}function dD(i){Kf().$$.after_update.push(i)}function pD(i,o){return Kf().$$.context.set(i,o),o}function mD(i,o){const l=i.$$.callbacks[o.type];l&&l.slice().forEach(h=>h.call(this,o))}const ku=[],s0=[],Jf=[],a0=[],TT=Promise.resolve();let Bm=!1;function ET(){Bm||(Bm=!0,TT.then(Nm))}function ed(i){Jf.push(i)}const jm=new Set;let td=0;function Nm(){const i=Ru;do{for(;td<ku.length;){const o=ku[td];td++,ko(o),ST(o.$$)}for(ko(null),ku.length=0,td=0;s0.length;)s0.pop()();for(let o=0;o<Jf.length;o+=1){const l=Jf[o];jm.has(l)||(jm.add(l),l())}Jf.length=0}while(ku.length);for(;a0.length;)a0.pop()();Bm=!1,jm.clear(),ko(i)}function ST(i){if(i.fragment!==null){i.update(),kl(i.before_update);const o=i.dirty;i.dirty=[-1],i.fragment&&i.fragment.p(i.ctx,o),i.after_update.forEach(ed)}}let Du;function AT(){return Du||(Du=Promise.resolve(),Du.then(()=>{Du=null})),Du}function Um(i,o,l){i.dispatchEvent(yT(`${o?"intro":"outro"}${l}`))}const rd=new Set;let Do;function Fl(){Do={r:0,c:[],p:Do}}function Bl(){Do.r||kl(Do.c),Do=Do.p}function pi(i,o){i&&i.i&&(rd.delete(i),i.i(o))}function Pi(i,o,l,h){if(i&&i.o){if(rd.has(i))return;rd.add(i),Do.c.push(()=>{rd.delete(i),h&&(l&&i.d(1),h())}),i.o(o)}else h&&h()}const PT={duration:0};function _D(i,o,l,h){let _=o(i,l),x=h?0:1,E=null,s=null,A=null;function M(){A&&bT(i,A)}function z(F,j){const H=F.b-x;return j*=Math.abs(H),{a:x,b:F.b,d:H,duration:j,start:F.start,end:F.start+j,group:F.group}}function L(F){const{delay:j=0,duration:H=300,easing:W=iT,tick:he=bi,css:ve}=_||PT,Ce={start:aT()+j,b:F};F||(Ce.group=Do,Do.r+=1),E||s?s=Ce:(ve&&(M(),A=o0(i,x,F,H,j,W,ve)),F&&he(0,1),E=z(Ce,H),ed(()=>Um(i,F,"start")),lT(De=>{if(s&&De>s.start&&(E=z(s,H),s=null,Um(i,E.b,"start"),ve&&(M(),A=o0(i,x,E.b,E.duration,0,W,_.css))),E){if(De>=E.end)he(x=E.b,1-x),Um(i,E.b,"end"),s||(E.b?M():--E.group.r||kl(E.group.c)),E=null;else if(De>=E.start){const Se=De-E.start;x=E.a+E.d*W(Se/E.duration),he(x,1-x)}}return!!(E||s)}))}return{run(F){Lf(_)?AT().then(()=>{_=_(),L(F)}):L(F)},end(){M(),E=s=null}}}function l0(i,o){const l=o.token={};function h(_,x,E,s){if(o.token!==l)return;o.resolved=s;let A=o.ctx;E!==void 0&&(A=A.slice(),A[E]=s);const M=_&&(o.current=_)(A);let z=!1;o.block&&(o.blocks?o.blocks.forEach((L,F)=>{F!==x&&L&&(Fl(),Pi(L,1,1,()=>{o.blocks[F]===L&&(o.blocks[F]=null)}),Bl())}):o.block.d(1),M.c(),pi(M,1),M.m(o.mount(),o.anchor),z=!0),o.block=M,o.blocks&&(o.blocks[x]=M),z&&Nm()}if(nT(i)){const _=Kf();if(i.then(x=>{ko(_),h(o.then,1,o.value,x),ko(null)},x=>{if(ko(_),h(o.catch,2,o.error,x),ko(null),!o.hasCatch)throw x}),o.current!==o.pending)return h(o.pending,0),!0}else{if(o.current!==o.then)return h(o.then,1,o.value,i),!0;o.resolved=i}}function IT(i,o,l){const h=o.slice(),{resolved:_}=i;i.current===i.then&&(h[i.value]=_),i.current===i.catch&&(h[i.error]=_),i.block.p(h,l)}const gD=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;function MT(i,o){Pi(i,1,1,()=>{o.delete(i.key)})}function CT(i,o,l,h,_,x,E,s,A,M,z,L){let F=i.length,j=x.length,H=F;const W={};for(;H--;)W[i[H].key]=H;const he=[],ve=new Map,Ce=new Map;for(H=j;H--;){const We=L(_,x,H),mt=l(We);let Te=E.get(mt);Te?h&&Te.p(We,o):(Te=M(mt,We),Te.c()),ve.set(mt,he[H]=Te),mt in W&&Ce.set(mt,Math.abs(H-W[mt]))}const De=new Set,Se=new Set;function Ie(We){pi(We,1),We.m(s,z),E.set(We.key,We),z=We.first,j--}for(;F&&j;){const We=he[j-1],mt=i[F-1],Te=We.key,Ue=mt.key;We===mt?(z=We.first,F--,j--):ve.has(Ue)?!E.has(Te)||De.has(Te)?Ie(We):Se.has(Ue)?F--:Ce.get(Te)>Ce.get(Ue)?(Se.add(Te),Ie(We)):(De.add(Ue),F--):(A(mt,E),F--)}for(;F--;){const We=i[F];ve.has(We.key)||A(We,E)}for(;j;)Ie(he[j-1]);return he}function Vm(i,o){const l={},h={},_={$$scope:1};let x=i.length;for(;x--;){const E=i[x],s=o[x];if(s){for(const A in E)A in s||(h[A]=1);for(const A in s)_[A]||(l[A]=s[A],_[A]=1);i[x]=s}else for(const A in E)_[A]=1}for(const E in h)E in l||(l[E]=void 0);return l}function $m(i){return typeof i=="object"&&i!==null?i:{}}function Ou(i){i&&i.c()}function Gm(i,o){i&&i.l(o)}function jl(i,o,l,h){const{fragment:_,after_update:x}=i.$$;_&&_.m(o,l),h||ed(()=>{const E=i.$$.on_mount.map(Hv).filter(Lf);i.$$.on_destroy?i.$$.on_destroy.push(...E):kl(E),i.$$.on_mount=[]}),x.forEach(ed)}function Nl(i,o){const l=i.$$;l.fragment!==null&&(kl(l.on_destroy),l.fragment&&l.fragment.d(o),l.on_destroy=l.fragment=null,l.ctx=[])}function zT(i,o){i.$$.dirty[0]===-1&&(ku.push(i),ET(),i.$$.dirty.fill(0)),i.$$.dirty[o/31|0]|=1<<o%31}function qm(i,o,l,h,_,x,E,s=[-1]){const A=Ru;ko(i);const M=i.$$={fragment:null,ctx:[],props:x,update:bi,not_equal:_,bound:Wv(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(o.context||(A?A.$$.context:[])),callbacks:Wv(),dirty:s,skip_bound:!1,root:o.target||A.$$.root};E&&E(M.root);let z=!1;if(M.ctx=l?l(i,o.props||{},(L,F,...j)=>{const H=j.length?j[0]:F;return M.ctx&&_(M.ctx[L],M.ctx[L]=H)&&(!M.skip_bound&&M.bound[L]&&M.bound[L](H),z&&zT(i,L)),F}):[],M.update(),z=!0,kl(M.before_update),M.fragment=h?h(M.ctx):!1,o.target){if(o.hydrate){cT();const L=Ll(o.target);M.fragment&&M.fragment.l(L),L.forEach(Ai)}else M.fragment&&M.fragment.c();o.intro&&pi(i.$$.fragment),jl(i,o.target,o.anchor,o.customElement),uT(),Nm()}ko(A)}class Zm{$destroy(){Nl(this,1),this.$destroy=bi}$on(o,l){if(!Lf(l))return bi;const h=this.$$.callbacks[o]||(this.$$.callbacks[o]=[]);return h.push(l),()=>{const _=h.indexOf(l);_!==-1&&h.splice(_,1)}}$set(o){this.$$set&&!oT(o)&&(this.$$.skip_bound=!0,this.$$set(o),this.$$.skip_bound=!1)}}const Ul=[];function id(i,o=bi){let l;const h=new Set;function _(s){if(Ff(i,s)&&(i=s,l)){const A=!Ul.length;for(const M of h)M[1](),Ul.push(M,i);if(A){for(let M=0;M<Ul.length;M+=2)Ul[M][0](Ul[M+1]);Ul.length=0}}}function x(s){_(s(i))}function E(s,A=bi){const M=[s,A];return h.add(M),h.size===1&&(l=o(_)||bi),s(i),()=>{h.delete(M),h.size===0&&(l(),l=null)}}return{set:_,update:x,subscribe:E}}function RT(i){let o,l,h,_,x,E,s;const A=i[6].default,M=jf(A,i,i[5],null);return{c(){o=zu("a"),l=zu("div"),h=zu("div"),M&&M.c(),_=Zf(),x=qf(i[1]),this.h()},l(z){o=Fm(z,"A",{class:!0,href:!0,target:!0,rel:!0,"aria-label":!0});var L=Ll(o);l=Fm(L,"DIV",{class:!0});var F=Ll(l);h=Fm(F,"DIV",{"aria-hidden":!0,class:!0});var j=Ll(h);M&&M.l(j),j.forEach(Ai),_=Hf(F),x=n0(F,i[1]),F.forEach(Ai),L.forEach(Ai),this.h()},h(){rn(h,"aria-hidden","true"),rn(h,"class","ssbc-button__icon svelte-p0i8uh"),Wf(h,"ssbc-button__icon--fill",i[2]),Wf(h,"ssbc-button__icon--outline",!i[2]),rn(l,"class",E="ssbc-button "+i[4]+" svelte-p0i8uh"),rn(o,"class","ssbc-button__link svelte-p0i8uh"),rn(o,"href",i[0]),rn(o,"target","_blank"),rn(o,"rel","noopener"),rn(o,"aria-label",i[3])},m(z,L){ao(z,o,L),Ol(o,l),Ol(l,h),M&&M.m(h,null),Ol(l,_),Ol(l,x),s=!0},p(z,[L]){M&&M.p&&(!s||L&32)&&Uf(M,A,z,z[5],s?Nf(A,z[5],L,null):Vf(z[5]),null),(!s||L&4)&&Wf(h,"ssbc-button__icon--fill",z[2]),(!s||L&4)&&Wf(h,"ssbc-button__icon--outline",!z[2]),(!s||L&2)&&gT(x,z[1]),(!s||L&16&&E!==(E="ssbc-button "+z[4]+" svelte-p0i8uh"))&&rn(l,"class",E),(!s||L&1)&&rn(o,"href",z[0]),(!s||L&8)&&rn(o,"aria-label",z[3])},i(z){s||(pi(M,z),s=!0)},o(z){Pi(M,z),s=!1},d(z){z&&Ai(o),M&&M.d(z)}}}function kT(i,o,l){let{$$slots:h={},$$scope:_}=o,{href:x}=o,{label:E=""}=o,{fill:s=!0}=o,{ariaLabel:A=""}=o,{class:M=""}=o;return i.$$set=z=>{"href"in z&&l(0,x=z.href),"label"in z&&l(1,E=z.label),"fill"in z&&l(2,s=z.fill),"ariaLabel"in z&&l(3,A=z.ariaLabel),"class"in z&&l(4,M=z.class),"$$scope"in z&&l(5,_=z.$$scope)},[x,E,s,A,M,_,h]}class DT extends Zm{constructor(o){super();qm(this,o,kT,RT,Ff,{href:0,label:1,fill:2,ariaLabel:3,class:4})}}function OT(i){let o,l;return{c(){o=Lm("svg"),l=Lm("path"),this.h()},l(h){o=i0(h,"svg",{xmlns:!0,viewBox:!0});var _=Ll(o);l=i0(_,"path",{d:!0}),Ll(l).forEach(Ai),_.forEach(Ai),this.h()},h(){rn(l,"d","M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5 0-4.55 2.04-4.55 4.54 0 .36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3 0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35 0 12.92-6.92 12.92-12.93 0-.2 0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"),rn(o,"xmlns","http://www.w3.org/2000/svg"),rn(o,"viewBox","0 0 24 24")},m(h,_){ao(h,o,_),Ol(o,l)},p:bi,d(h){h&&Ai(o)}}}function LT(i){let o,l;const h=[{class:"ssbc-button--twitter "+i[1]},i[3],{ariaLabel:i[0]},{href:i[2]}];let _={$$slots:{default:[OT]},$$scope:{ctx:i}};for(let x=0;x<h.length;x+=1)_=Rl(_,h[x]);return o=new DT({props:_}),{c(){Ou(o.$$.fragment)},l(x){Gm(o.$$.fragment,x)},m(x,E){jl(o,x,E),l=!0},p(x,[E]){const s=E&15?Vm(h,[E&2&&{class:"ssbc-button--twitter "+x[1]},E&8&&$m(x[3]),E&1&&{ariaLabel:x[0]},E&4&&{href:x[2]}]):{};E&512&&(s.$$scope={dirty:E,ctx:x}),o.$set(s)},i(x){l||(pi(o.$$.fragment,x),l=!0)},o(x){Pi(o.$$.fragment,x),l=!1},d(x){Nl(o,x)}}}function FT(i,o,l){const h=["text","url","ariaLabel","hashtags","via","related","class"];let _=Yv(o,h),{text:x}=o,{url:E}=o,{ariaLabel:s="Share on Twitter"}=o,{hashtags:A=""}=o,{via:M=""}=o,{related:z=""}=o,{class:L=""}=o,F;return i.$$set=j=>{o=Rl(Rl({},o),sT(j)),l(3,_=Yv(o,h)),"text"in j&&l(4,x=j.text),"url"in j&&l(5,E=j.url),"ariaLabel"in j&&l(0,s=j.ariaLabel),"hashtags"in j&&l(6,A=j.hashtags),"via"in j&&l(7,M=j.via),"related"in j&&l(8,z=j.related),"class"in j&&l(1,L=j.class)},i.$$.update=()=>{i.$$.dirty&496&&l(2,F=encodeURI(`https://twitter.com/intent/tweet/?text=${x}&hashtags=${A}&via=${M}&related=${z}&url=${E}`))},[s,L,F,_,x,E,A,M,z]}class yD extends Zm{constructor(o){super();qm(this,o,FT,LT,Ff,{text:4,url:5,ariaLabel:0,hashtags:6,via:7,related:8,class:1})}}function Hm(i,o){return i==null||o==null?NaN:i<o?-1:i>o?1:i>=o?0:NaN}function c0(i){let o=i,l=i,h=i;i.length===1&&(o=(s,A)=>i(s)-A,l=Hm,h=(s,A)=>Hm(i(s),A));function _(s,A,M=0,z=s.length){if(M<z){if(l(A,A)!==0)return z;do{const L=M+z>>>1;h(s[L],A)<0?M=L+1:z=L}while(M<z)}return M}function x(s,A,M=0,z=s.length){if(M<z){if(l(A,A)!==0)return z;do{const L=M+z>>>1;h(s[L],A)<=0?M=L+1:z=L}while(M<z)}return M}function E(s,A,M=0,z=s.length){const L=_(s,A,M,z-1);return L>M&&o(s[L-1],A)>-o(s[L],A)?L-1:L}return{left:_,center:E,right:x}}function BT(i){return i===null?NaN:+i}const jT=c0(Hm),NT=jT.right;c0(BT).center;var UT=NT;class u0 extends Map{constructor(o,l=GT){super();if(Object.defineProperties(this,{_intern:{value:new Map},_key:{value:l}}),o!=null)for(const[h,_]of o)this.set(h,_)}get(o){return super.get(h0(this,o))}has(o){return super.has(h0(this,o))}set(o,l){return super.set(VT(this,o),l)}delete(o){return super.delete($T(this,o))}}function h0({_intern:i,_key:o},l){const h=o(l);return i.has(h)?i.get(h):l}function VT({_intern:i,_key:o},l){const h=o(l);return i.has(h)?i.get(h):(i.set(h,l),l)}function $T({_intern:i,_key:o},l){const h=o(l);return i.has(h)&&(l=i.get(l),i.delete(h)),l}function GT(i){return i!==null&&typeof i=="object"?i.valueOf():i}var Wm=Math.sqrt(50),Xm=Math.sqrt(10),Qm=Math.sqrt(2);function qT(i,o,l){var h,_=-1,x,E,s;if(o=+o,i=+i,l=+l,i===o&&l>0)return[i];if((h=o<i)&&(x=i,i=o,o=x),(s=f0(i,o,l))===0||!isFinite(s))return[];if(s>0){let A=Math.round(i/s),M=Math.round(o/s);for(A*s<i&&++A,M*s>o&&--M,E=new Array(x=M-A+1);++_<x;)E[_]=(A+_)*s}else{s=-s;let A=Math.round(i*s),M=Math.round(o*s);for(A/s<i&&++A,M/s>o&&--M,E=new Array(x=M-A+1);++_<x;)E[_]=(A+_)/s}return h&&E.reverse(),E}function f0(i,o,l){var h=(o-i)/Math.max(0,l),_=Math.floor(Math.log(h)/Math.LN10),x=h/Math.pow(10,_);return _>=0?(x>=Wm?10:x>=Xm?5:x>=Qm?2:1)*Math.pow(10,_):-Math.pow(10,-_)/(x>=Wm?10:x>=Xm?5:x>=Qm?2:1)}function ZT(i,o,l){var h=Math.abs(o-i)/Math.max(0,l),_=Math.pow(10,Math.floor(Math.log(h)/Math.LN10)),x=h/_;return x>=Wm?_*=10:x>=Xm?_*=5:x>=Qm&&(_*=2),o<i?-_:_}function d0(i,o){switch(arguments.length){case 0:break;case 1:this.range(i);break;default:this.range(o).domain(i);break}return this}const p0=Symbol("implicit");function HT(){var i=new u0,o=[],l=[],h=p0;function _(x){let E=i.get(x);if(E===void 0){if(h!==p0)return h;i.set(x,E=o.push(x)-1)}return l[E%l.length]}return _.domain=function(x){if(!arguments.length)return o.slice();o=[],i=new u0;for(const E of x)i.has(E)||i.set(E,o.push(E)-1);return _},_.range=function(x){return arguments.length?(l=Array.from(x),_):l.slice()},_.unknown=function(x){return arguments.length?(h=x,_):h},_.copy=function(){return HT(o,l).unknown(h)},d0.apply(_,arguments),_}function Ym(i,o,l){i.prototype=o.prototype=l,l.constructor=i}function m0(i,o){var l=Object.create(i.prototype);for(var h in o)l[h]=o[h];return l}function Lu(){}var Fu=.7,nd=1/Fu,Vl="\\s*([+-]?\\d+)\\s*",Bu="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",co="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",WT=/^#([0-9a-f]{3,8})$/,XT=new RegExp("^rgb\\("+[Vl,Vl,Vl]+"\\)$"),QT=new RegExp("^rgb\\("+[co,co,co]+"\\)$"),YT=new RegExp("^rgba\\("+[Vl,Vl,Vl,Bu]+"\\)$"),KT=new RegExp("^rgba\\("+[co,co,co,Bu]+"\\)$"),JT=new RegExp("^hsl\\("+[Bu,co,co]+"\\)$"),eE=new RegExp("^hsla\\("+[Bu,co,co,Bu]+"\\)$"),_0={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ym(Lu,ba,{copy:function(i){return Object.assign(new this.constructor,this,i)},displayable:function(){return this.rgb().displayable()},hex:g0,formatHex:g0,formatHsl:tE,formatRgb:y0,toString:y0});function g0(){return this.rgb().formatHex()}function tE(){return T0(this).formatHsl()}function y0(){return this.rgb().formatRgb()}function ba(i){var o,l;return i=(i+"").trim().toLowerCase(),(o=WT.exec(i))?(l=o[1].length,o=parseInt(o[1],16),l===6?v0(o):l===3?new mn(o>>8&15|o>>4&240,o>>4&15|o&240,(o&15)<<4|o&15,1):l===8?od(o>>24&255,o>>16&255,o>>8&255,(o&255)/255):l===4?od(o>>12&15|o>>8&240,o>>8&15|o>>4&240,o>>4&15|o&240,((o&15)<<4|o&15)/255):null):(o=XT.exec(i))?new mn(o[1],o[2],o[3],1):(o=QT.exec(i))?new mn(o[1]*255/100,o[2]*255/100,o[3]*255/100,1):(o=YT.exec(i))?od(o[1],o[2],o[3],o[4]):(o=KT.exec(i))?od(o[1]*255/100,o[2]*255/100,o[3]*255/100,o[4]):(o=JT.exec(i))?w0(o[1],o[2]/100,o[3]/100,1):(o=eE.exec(i))?w0(o[1],o[2]/100,o[3]/100,o[4]):_0.hasOwnProperty(i)?v0(_0[i]):i==="transparent"?new mn(NaN,NaN,NaN,0):null}function v0(i){return new mn(i>>16&255,i>>8&255,i&255,1)}function od(i,o,l,h){return h<=0&&(i=o=l=NaN),new mn(i,o,l,h)}function rE(i){return i instanceof Lu||(i=ba(i)),i?(i=i.rgb(),new mn(i.r,i.g,i.b,i.opacity)):new mn}function Km(i,o,l,h){return arguments.length===1?rE(i):new mn(i,o,l,h==null?1:h)}function mn(i,o,l,h){this.r=+i,this.g=+o,this.b=+l,this.opacity=+h}Ym(mn,Km,m0(Lu,{brighter:function(i){return i=i==null?nd:Math.pow(nd,i),new mn(this.r*i,this.g*i,this.b*i,this.opacity)},darker:function(i){return i=i==null?Fu:Math.pow(Fu,i),new mn(this.r*i,this.g*i,this.b*i,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:x0,formatHex:x0,formatRgb:b0,toString:b0}));function x0(){return"#"+Jm(this.r)+Jm(this.g)+Jm(this.b)}function b0(){var i=this.opacity;return i=isNaN(i)?1:Math.max(0,Math.min(1,i)),(i===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(i===1?")":", "+i+")")}function Jm(i){return i=Math.max(0,Math.min(255,Math.round(i)||0)),(i<16?"0":"")+i.toString(16)}function w0(i,o,l,h){return h<=0?i=o=l=NaN:l<=0||l>=1?i=o=NaN:o<=0&&(i=NaN),new uo(i,o,l,h)}function T0(i){if(i instanceof uo)return new uo(i.h,i.s,i.l,i.opacity);if(i instanceof Lu||(i=ba(i)),!i)return new uo;if(i instanceof uo)return i;i=i.rgb();var o=i.r/255,l=i.g/255,h=i.b/255,_=Math.min(o,l,h),x=Math.max(o,l,h),E=NaN,s=x-_,A=(x+_)/2;return s?(o===x?E=(l-h)/s+(l<h)*6:l===x?E=(h-o)/s+2:E=(o-l)/s+4,s/=A<.5?x+_:2-x-_,E*=60):s=A>0&&A<1?0:E,new uo(E,s,A,i.opacity)}function iE(i,o,l,h){return arguments.length===1?T0(i):new uo(i,o,l,h==null?1:h)}function uo(i,o,l,h){this.h=+i,this.s=+o,this.l=+l,this.opacity=+h}Ym(uo,iE,m0(Lu,{brighter:function(i){return i=i==null?nd:Math.pow(nd,i),new uo(this.h,this.s,this.l*i,this.opacity)},darker:function(i){return i=i==null?Fu:Math.pow(Fu,i),new uo(this.h,this.s,this.l*i,this.opacity)},rgb:function(){var i=this.h%360+(this.h<0)*360,o=isNaN(i)||isNaN(this.s)?0:this.s,l=this.l,h=l+(l<.5?l:1-l)*o,_=2*l-h;return new mn(e_(i>=240?i-240:i+120,_,h),e_(i,_,h),e_(i<120?i+240:i-120,_,h),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var i=this.opacity;return i=isNaN(i)?1:Math.max(0,Math.min(1,i)),(i===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(i===1?")":", "+i+")")}}));function e_(i,o,l){return(i<60?o+(l-o)*i/60:i<180?l:i<240?o+(l-o)*(240-i)/60:o)*255}var t_=i=>()=>i;function nE(i,o){return function(l){return i+l*o}}function oE(i,o,l){return i=Math.pow(i,l),o=Math.pow(o,l)-i,l=1/l,function(h){return Math.pow(i+h*o,l)}}function sE(i){return(i=+i)==1?E0:function(o,l){return l-o?oE(o,l,i):t_(isNaN(o)?l:o)}}function E0(i,o){var l=o-i;return l?nE(i,l):t_(isNaN(i)?o:i)}var sd=function i(o){var l=sE(o);function h(_,x){var E=l((_=Km(_)).r,(x=Km(x)).r),s=l(_.g,x.g),A=l(_.b,x.b),M=E0(_.opacity,x.opacity);return function(z){return _.r=E(z),_.g=s(z),_.b=A(z),_.opacity=M(z),_+""}}return h.gamma=i,h}(1);function aE(i,o){o||(o=[]);var l=i?Math.min(o.length,i.length):0,h=o.slice(),_;return function(x){for(_=0;_<l;++_)h[_]=i[_]*(1-x)+o[_]*x;return h}}function lE(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function cE(i,o){var l=o?o.length:0,h=i?Math.min(l,i.length):0,_=new Array(h),x=new Array(l),E;for(E=0;E<h;++E)_[E]=n_(i[E],o[E]);for(;E<l;++E)x[E]=o[E];return function(s){for(E=0;E<h;++E)x[E]=_[E](s);return x}}function uE(i,o){var l=new Date;return i=+i,o=+o,function(h){return l.setTime(i*(1-h)+o*h),l}}function Fn(i,o){return i=+i,o=+o,function(l){return i*(1-l)+o*l}}function hE(i,o){var l={},h={},_;(i===null||typeof i!="object")&&(i={}),(o===null||typeof o!="object")&&(o={});for(_ in o)_ in i?l[_]=n_(i[_],o[_]):h[_]=o[_];return function(x){for(_ in l)h[_]=l[_](x);return h}}var r_=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,i_=new RegExp(r_.source,"g");function fE(i){return function(){return i}}function dE(i){return function(o){return i(o)+""}}function S0(i,o){var l=r_.lastIndex=i_.lastIndex=0,h,_,x,E=-1,s=[],A=[];for(i=i+"",o=o+"";(h=r_.exec(i))&&(_=i_.exec(o));)(x=_.index)>l&&(x=o.slice(l,x),s[E]?s[E]+=x:s[++E]=x),(h=h[0])===(_=_[0])?s[E]?s[E]+=_:s[++E]=_:(s[++E]=null,A.push({i:E,x:Fn(h,_)})),l=i_.lastIndex;return l<o.length&&(x=o.slice(l),s[E]?s[E]+=x:s[++E]=x),s.length<2?A[0]?dE(A[0].x):fE(o):(o=A.length,function(M){for(var z=0,L;z<o;++z)s[(L=A[z]).i]=L.x(M);return s.join("")})}function n_(i,o){var l=typeof o,h;return o==null||l==="boolean"?t_(o):(l==="number"?Fn:l==="string"?(h=ba(o))?(o=h,sd):S0:o instanceof ba?sd:o instanceof Date?uE:lE(o)?aE:Array.isArray(o)?cE:typeof o.valueOf!="function"&&typeof o.toString!="function"||isNaN(o)?hE:Fn)(i,o)}function pE(i,o){return i=+i,o=+o,function(l){return Math.round(i*(1-l)+o*l)}}var A0=180/Math.PI,o_={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function P0(i,o,l,h,_,x){var E,s,A;return(E=Math.sqrt(i*i+o*o))&&(i/=E,o/=E),(A=i*l+o*h)&&(l-=i*A,h-=o*A),(s=Math.sqrt(l*l+h*h))&&(l/=s,h/=s,A/=s),i*h<o*l&&(i=-i,o=-o,A=-A,E=-E),{translateX:_,translateY:x,rotate:Math.atan2(o,i)*A0,skewX:Math.atan(A)*A0,scaleX:E,scaleY:s}}var ad;function mE(i){const o=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(i+"");return o.isIdentity?o_:P0(o.a,o.b,o.c,o.d,o.e,o.f)}function _E(i){return i==null||(ad||(ad=document.createElementNS("http://www.w3.org/2000/svg","g")),ad.setAttribute("transform",i),!(i=ad.transform.baseVal.consolidate()))?o_:(i=i.matrix,P0(i.a,i.b,i.c,i.d,i.e,i.f))}function I0(i,o,l,h){function _(M){return M.length?M.pop()+" ":""}function x(M,z,L,F,j,H){if(M!==L||z!==F){var W=j.push("translate(",null,o,null,l);H.push({i:W-4,x:Fn(M,L)},{i:W-2,x:Fn(z,F)})}else(L||F)&&j.push("translate("+L+o+F+l)}function E(M,z,L,F){M!==z?(M-z>180?z+=360:z-M>180&&(M+=360),F.push({i:L.push(_(L)+"rotate(",null,h)-2,x:Fn(M,z)})):z&&L.push(_(L)+"rotate("+z+h)}function s(M,z,L,F){M!==z?F.push({i:L.push(_(L)+"skewX(",null,h)-2,x:Fn(M,z)}):z&&L.push(_(L)+"skewX("+z+h)}function A(M,z,L,F,j,H){if(M!==L||z!==F){var W=j.push(_(j)+"scale(",null,",",null,")");H.push({i:W-4,x:Fn(M,L)},{i:W-2,x:Fn(z,F)})}else(L!==1||F!==1)&&j.push(_(j)+"scale("+L+","+F+")")}return function(M,z){var L=[],F=[];return M=i(M),z=i(z),x(M.translateX,M.translateY,z.translateX,z.translateY,L,F),E(M.rotate,z.rotate,L,F),s(M.skewX,z.skewX,L,F),A(M.scaleX,M.scaleY,z.scaleX,z.scaleY,L,F),M=z=null,function(j){for(var H=-1,W=F.length,he;++H<W;)L[(he=F[H]).i]=he.x(j);return L.join("")}}}var gE=I0(mE,"px, ","px)","deg)"),yE=I0(_E,", ",")",")");function vE(i){return function(){return i}}function xE(i){return+i}var M0=[0,1];function $l(i){return i}function s_(i,o){return(o-=i=+i)?function(l){return(l-i)/o}:vE(isNaN(o)?NaN:.5)}function bE(i,o){var l;return i>o&&(l=i,i=o,o=l),function(h){return Math.max(i,Math.min(o,h))}}function wE(i,o,l){var h=i[0],_=i[1],x=o[0],E=o[1];return _<h?(h=s_(_,h),x=l(E,x)):(h=s_(h,_),x=l(x,E)),function(s){return x(h(s))}}function TE(i,o,l){var h=Math.min(i.length,o.length)-1,_=new Array(h),x=new Array(h),E=-1;for(i[h]<i[0]&&(i=i.slice().reverse(),o=o.slice().reverse());++E<h;)_[E]=s_(i[E],i[E+1]),x[E]=l(o[E],o[E+1]);return function(s){var A=UT(i,s,1,h)-1;return x[A](_[A](s))}}function EE(i,o){return o.domain(i.domain()).range(i.range()).interpolate(i.interpolate()).clamp(i.clamp()).unknown(i.unknown())}function SE(){var i=M0,o=M0,l=n_,h,_,x,E=$l,s,A,M;function z(){var F=Math.min(i.length,o.length);return E!==$l&&(E=bE(i[0],i[F-1])),s=F>2?TE:wE,A=M=null,L}function L(F){return F==null||isNaN(F=+F)?x:(A||(A=s(i.map(h),o,l)))(h(E(F)))}return L.invert=function(F){return E(_((M||(M=s(o,i.map(h),Fn)))(F)))},L.domain=function(F){return arguments.length?(i=Array.from(F,xE),z()):i.slice()},L.range=function(F){return arguments.length?(o=Array.from(F),z()):o.slice()},L.rangeRound=function(F){return o=Array.from(F),l=pE,z()},L.clamp=function(F){return arguments.length?(E=F?!0:$l,z()):E!==$l},L.interpolate=function(F){return arguments.length?(l=F,z()):l},L.unknown=function(F){return arguments.length?(x=F,L):x},function(F,j){return h=F,_=j,z()}}function AE(){return SE()($l,$l)}function PE(i){return Math.abs(i=Math.round(i))>=1e21?i.toLocaleString("en").replace(/,/g,""):i.toString(10)}function ld(i,o){if((l=(i=o?i.toExponential(o-1):i.toExponential()).indexOf("e"))<0)return null;var l,h=i.slice(0,l);return[h.length>1?h[0]+h.slice(2):h,+i.slice(l+1)]}function Gl(i){return i=ld(Math.abs(i)),i?i[1]:NaN}function IE(i,o){return function(l,h){for(var _=l.length,x=[],E=0,s=i[0],A=0;_>0&&s>0&&(A+s+1>h&&(s=Math.max(1,h-A)),x.push(l.substring(_-=s,_+s)),!((A+=s+1)>h));)s=i[E=(E+1)%i.length];return x.reverse().join(o)}}function ME(i){return function(o){return o.replace(/[0-9]/g,function(l){return i[+l]})}}var CE=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function cd(i){if(!(o=CE.exec(i)))throw new Error("invalid format: "+i);var o;return new a_({fill:o[1],align:o[2],sign:o[3],symbol:o[4],zero:o[5],width:o[6],comma:o[7],precision:o[8]&&o[8].slice(1),trim:o[9],type:o[10]})}cd.prototype=a_.prototype;function a_(i){this.fill=i.fill===void 0?" ":i.fill+"",this.align=i.align===void 0?">":i.align+"",this.sign=i.sign===void 0?"-":i.sign+"",this.symbol=i.symbol===void 0?"":i.symbol+"",this.zero=!!i.zero,this.width=i.width===void 0?void 0:+i.width,this.comma=!!i.comma,this.precision=i.precision===void 0?void 0:+i.precision,this.trim=!!i.trim,this.type=i.type===void 0?"":i.type+""}a_.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function zE(i){e:for(var o=i.length,l=1,h=-1,_;l<o;++l)switch(i[l]){case".":h=_=l;break;case"0":h===0&&(h=l),_=l;break;default:if(!+i[l])break e;h>0&&(h=0);break}return h>0?i.slice(0,h)+i.slice(_+1):i}var C0;function RE(i,o){var l=ld(i,o);if(!l)return i+"";var h=l[0],_=l[1],x=_-(C0=Math.max(-8,Math.min(8,Math.floor(_/3)))*3)+1,E=h.length;return x===E?h:x>E?h+new Array(x-E+1).join("0"):x>0?h.slice(0,x)+"."+h.slice(x):"0."+new Array(1-x).join("0")+ld(i,Math.max(0,o+x-1))[0]}function z0(i,o){var l=ld(i,o);if(!l)return i+"";var h=l[0],_=l[1];return _<0?"0."+new Array(-_).join("0")+h:h.length>_+1?h.slice(0,_+1)+"."+h.slice(_+1):h+new Array(_-h.length+2).join("0")}var R0={"%":(i,o)=>(i*100).toFixed(o),b:i=>Math.round(i).toString(2),c:i=>i+"",d:PE,e:(i,o)=>i.toExponential(o),f:(i,o)=>i.toFixed(o),g:(i,o)=>i.toPrecision(o),o:i=>Math.round(i).toString(8),p:(i,o)=>z0(i*100,o),r:z0,s:RE,X:i=>Math.round(i).toString(16).toUpperCase(),x:i=>Math.round(i).toString(16)};function k0(i){return i}var D0=Array.prototype.map,O0=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function kE(i){var o=i.grouping===void 0||i.thousands===void 0?k0:IE(D0.call(i.grouping,Number),i.thousands+""),l=i.currency===void 0?"":i.currency[0]+"",h=i.currency===void 0?"":i.currency[1]+"",_=i.decimal===void 0?".":i.decimal+"",x=i.numerals===void 0?k0:ME(D0.call(i.numerals,String)),E=i.percent===void 0?"%":i.percent+"",s=i.minus===void 0?"\u2212":i.minus+"",A=i.nan===void 0?"NaN":i.nan+"";function M(L){L=cd(L);var F=L.fill,j=L.align,H=L.sign,W=L.symbol,he=L.zero,ve=L.width,Ce=L.comma,De=L.precision,Se=L.trim,Ie=L.type;Ie==="n"?(Ce=!0,Ie="g"):R0[Ie]||(De===void 0&&(De=12),Se=!0,Ie="g"),(he||F==="0"&&j==="=")&&(he=!0,F="0",j="=");var We=W==="$"?l:W==="#"&&/[boxX]/.test(Ie)?"0"+Ie.toLowerCase():"",mt=W==="$"?h:/[%p]/.test(Ie)?E:"",Te=R0[Ie],Ue=/[defgprs%]/.test(Ie);De=De===void 0?6:/[gprs]/.test(Ie)?Math.max(1,Math.min(21,De)):Math.max(0,Math.min(20,De));function Xe(tt){var Dt=We,Ft=mt,zr,Kt,Rr;if(Ie==="c")Ft=Te(tt)+Ft,tt="";else{tt=+tt;var Wr=tt<0||1/tt<0;if(tt=isNaN(tt)?A:Te(Math.abs(tt),De),Se&&(tt=zE(tt)),Wr&&+tt==0&&H!=="+"&&(Wr=!1),Dt=(Wr?H==="("?H:s:H==="-"||H==="("?"":H)+Dt,Ft=(Ie==="s"?O0[8+C0/3]:"")+Ft+(Wr&&H==="("?")":""),Ue){for(zr=-1,Kt=tt.length;++zr<Kt;)if(Rr=tt.charCodeAt(zr),48>Rr||Rr>57){Ft=(Rr===46?_+tt.slice(zr+1):tt.slice(zr))+Ft,tt=tt.slice(0,zr);break}}}Ce&&!he&&(tt=o(tt,1/0));var xr=Dt.length+tt.length+Ft.length,Ht=xr<ve?new Array(ve-xr+1).join(F):"";switch(Ce&&he&&(tt=o(Ht+tt,Ht.length?ve-Ft.length:1/0),Ht=""),j){case"<":tt=Dt+tt+Ft+Ht;break;case"=":tt=Dt+Ht+tt+Ft;break;case"^":tt=Ht.slice(0,xr=Ht.length>>1)+Dt+tt+Ft+Ht.slice(xr);break;default:tt=Ht+Dt+tt+Ft;break}return x(tt)}return Xe.toString=function(){return L+""},Xe}function z(L,F){var j=M((L=cd(L),L.type="f",L)),H=Math.max(-8,Math.min(8,Math.floor(Gl(F)/3)))*3,W=Math.pow(10,-H),he=O0[8+H/3];return function(ve){return j(W*ve)+he}}return{format:M,formatPrefix:z}}var ud,L0,F0;DE({thousands:",",grouping:[3],currency:["$",""]});function DE(i){return ud=kE(i),L0=ud.format,F0=ud.formatPrefix,ud}function OE(i){return Math.max(0,-Gl(Math.abs(i)))}function LE(i,o){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Gl(o)/3)))*3-Gl(Math.abs(i)))}function FE(i,o){return i=Math.abs(i),o=Math.abs(o)-i,Math.max(0,Gl(o)-Gl(i))+1}function BE(i,o,l,h){var _=ZT(i,o,l),x;switch(h=cd(h==null?",f":h),h.type){case"s":{var E=Math.max(Math.abs(i),Math.abs(o));return h.precision==null&&!isNaN(x=LE(_,E))&&(h.precision=x),F0(h,E)}case"":case"e":case"g":case"p":case"r":{h.precision==null&&!isNaN(x=FE(_,Math.max(Math.abs(i),Math.abs(o))))&&(h.precision=x-(h.type==="e"));break}case"f":case"%":{h.precision==null&&!isNaN(x=OE(_))&&(h.precision=x-(h.type==="%")*2);break}}return L0(h)}function jE(i){var o=i.domain;return i.ticks=function(l){var h=o();return qT(h[0],h[h.length-1],l==null?10:l)},i.tickFormat=function(l,h){var _=o();return BE(_[0],_[_.length-1],l==null?10:l,h)},i.nice=function(l){l==null&&(l=10);var h=o(),_=0,x=h.length-1,E=h[_],s=h[x],A,M,z=10;for(s<E&&(M=E,E=s,s=M,M=_,_=x,x=M);z-- >0;){if(M=f0(E,s,l),M===A)return h[_]=E,h[x]=s,o(h);if(M>0)E=Math.floor(E/M)*M,s=Math.ceil(s/M)*M;else if(M<0)E=Math.ceil(E*M)/M,s=Math.floor(s*M)/M;else break;A=M}return i},i}function NE(){var i=AE();return i.copy=function(){return EE(i,NE())},d0.apply(i,arguments),jE(i)}const wa=id(!1),Ta=id(null),Ea=id([]),B0=id(null);function UE(i=1){var o,l;const h=xa(Ea).length,_=xa(Ea)[h-1];return xa(Ta)||((o=_==null?void 0:_.callbacks)===null||o===void 0?void 0:o.onBeforeClose)&&((l=_==null?void 0:_.callbacks)===null||l===void 0?void 0:l.onBeforeClose())===!1?!1:(xa(wa)&&h>0&&Ta.set(!0),wa.set(!1),B0.set("pop"),VE(i),!0)}function vD(){return UE(1)}function xD(i,o,l){xa(Ta)||(B0.set("push"),xa(wa)&&xa(Ea).length&&Ta.set(!0),wa.set(!1),(l==null?void 0:l.replace)?Ea.update(h=>[...h.slice(0,h.length-1),{component:i,props:o}]):Ea.update(h=>[...h,{component:i,props:o}]))}function VE(i=1){Ea.update(o=>o.slice(0,Math.max(0,o.length-i)))}function j0(i,o,l){const h=i.slice();return h[9]=o[l],h[11]=l,h}const $E=i=>({}),N0=i=>({}),GE=i=>({}),U0=i=>({});function V0(i){let o;const l=i[4].backdrop,h=jf(l,i,i[3],U0);return{c(){h&&h.c()},l(_){h&&h.l(_)},m(_,x){h&&h.m(_,x),o=!0},p(_,x){h&&h.p&&(!o||x&8)&&Uf(h,l,_,_[3],o?Nf(l,_[3],x,GE):Vf(_[3]),U0)},i(_){o||(pi(h,_),o=!0)},o(_){Pi(h,_),o=!1},d(_){h&&h.d(_)}}}function qE(i){let o,l,h;const _=[{isOpen:i[11]===i[0].length-1&&!i[1]},i[9].props];var x=i[9].component;function E(s){let A={};for(let M=0;M<_.length;M+=1)A=Rl(A,_[M]);return{props:A}}return x&&(o=Xf(x,E()),o.$on("introstart",i[7]),o.$on("outroend",i[8])),{c(){o&&Ou(o.$$.fragment),l=lo()},l(s){o&&Gm(o.$$.fragment,s),l=lo()},m(s,A){o&&jl(o,s,A),ao(s,l,A),h=!0},p(s,A){const M=A&3?Vm(_,[{isOpen:s[11]===s[0].length-1&&!s[1]},A&1&&$m(s[9].props)]):{};if(x!==(x=s[9].component)){if(o){Fl();const z=o;Pi(z.$$.fragment,1,0,()=>{Nl(z,1)}),Bl()}x?(o=Xf(x,E()),o.$on("introstart",s[7]),o.$on("outroend",s[8]),Ou(o.$$.fragment),pi(o.$$.fragment,1),jl(o,l.parentNode,l)):o=null}else x&&o.$set(M)},i(s){h||(o&&pi(o.$$.fragment,s),h=!0)},o(s){o&&Pi(o.$$.fragment,s),h=!1},d(s){s&&Ai(l),o&&Nl(o,s)}}}function ZE(i){let o,l,h,_={ctx:i,current:null,token:null,hasCatch:!1,pending:XE,then:WE,catch:HE,value:12,blocks:[,,,]};return l0(l=G0(i[9].component),_),{c(){o=lo(),_.block.c()},l(x){o=lo(),_.block.l(x)},m(x,E){ao(x,o,E),_.block.m(x,_.anchor=E),_.mount=()=>o.parentNode,_.anchor=o,h=!0},p(x,E){i=x,_.ctx=i,E&1&&l!==(l=G0(i[9].component))&&l0(l,_)||IT(_,i,E)},i(x){h||(pi(_.block),h=!0)},o(x){for(let E=0;E<3;E+=1){const s=_.blocks[E];Pi(s)}h=!1},d(x){x&&Ai(o),_.block.d(x),_.token=null,_=null}}}function HE(i){return{c:bi,l:bi,m:bi,p:bi,i:bi,o:bi,d:bi}}function WE(i){let o,l,h;const _=[{isOpen:i[11]===i[0].length-1&&!i[1]},i[9].props];var x=i[12];function E(s){let A={};for(let M=0;M<_.length;M+=1)A=Rl(A,_[M]);return{props:A}}return x&&(o=Xf(x,E()),o.$on("introstart",i[5]),o.$on("outroend",i[6])),{c(){o&&Ou(o.$$.fragment),l=Zf()},l(s){o&&Gm(o.$$.fragment,s),l=Hf(s)},m(s,A){o&&jl(o,s,A),ao(s,l,A),h=!0},p(s,A){const M=A&3?Vm(_,[{isOpen:s[11]===s[0].length-1&&!s[1]},A&1&&$m(s[9].props)]):{};if(x!==(x=s[12])){if(o){Fl();const z=o;Pi(z.$$.fragment,1,0,()=>{Nl(z,1)}),Bl()}x?(o=Xf(x,E()),o.$on("introstart",s[5]),o.$on("outroend",s[6]),Ou(o.$$.fragment),pi(o.$$.fragment,1),jl(o,l.parentNode,l)):o=null}else x&&o.$set(M)},i(s){h||(o&&pi(o.$$.fragment,s),h=!0)},o(s){o&&Pi(o.$$.fragment,s),h=!1},d(s){o&&Nl(o,s),s&&Ai(l)}}}function XE(i){let o,l;const h=i[4].loading,_=jf(h,i,i[3],N0);return{c(){_&&_.c(),o=Zf()},l(x){_&&_.l(x),o=Hf(x)},m(x,E){_&&_.m(x,E),ao(x,o,E),l=!0},p(x,E){_&&_.p&&(!l||E&8)&&Uf(_,h,x,x[3],l?Nf(h,x[3],E,$E):Vf(x[3]),N0)},i(x){l||(pi(_,x),l=!0)},o(x){Pi(_,x),l=!1},d(x){_&&_.d(x),x&&Ai(o)}}}function $0(i,o){let l,h,_,x,E,s;const A=[ZE,qE],M=[];function z(L,F){return F&1&&(h=null),h==null&&(h=!!KE(L[9].component)),h?0:1}return _=z(o,-1),x=M[_]=A[_](o),{key:i,first:null,c(){l=lo(),x.c(),E=lo(),this.h()},l(L){l=lo(),x.l(L),E=lo(),this.h()},h(){this.first=l},m(L,F){ao(L,l,F),M[_].m(L,F),ao(L,E,F),s=!0},p(L,F){o=L;let j=_;_=z(o,F),_===j?M[_].p(o,F):(Fl(),Pi(M[j],1,1,()=>{M[j]=null}),Bl(),x=M[_],x?x.p(o,F):(x=M[_]=A[_](o),x.c()),pi(x,1),x.m(E.parentNode,E))},i(L){s||(pi(x),s=!0)},o(L){Pi(x),s=!1},d(L){L&&Ai(l),M[_].d(L),L&&Ai(E)}}}function QE(i){let o=[],l=new Map,h,_,x=i[0];const E=s=>s[11];for(let s=0;s<x.length;s+=1){let A=j0(i,x,s),M=E(A);l.set(M,o[s]=$0(M,A))}return{c(){for(let s=0;s<o.length;s+=1)o[s].c();h=lo()},l(s){for(let A=0;A<o.length;A+=1)o[A].l(s);h=lo()},m(s,A){for(let M=0;M<o.length;M+=1)o[M].m(s,A);ao(s,h,A),_=!0},p(s,A){A&15&&(x=s[0],Fl(),o=CT(o,A,E,1,s,x,l,h.parentNode,MT,$0,h,j0),Bl())},i(s){if(!_){for(let A=0;A<x.length;A+=1)pi(o[A]);_=!0}},o(s){for(let A=0;A<o.length;A+=1)Pi(o[A]);_=!1},d(s){for(let A=0;A<o.length;A+=1)o[A].d(s);s&&Ai(h)}}}function YE(i){let o,l,h=i[0].length>0&&V0(i);const _=i[4].default,x=jf(_,i,i[3],null),E=x||QE(i);return{c(){h&&h.c(),o=Zf(),E&&E.c()},l(s){h&&h.l(s),o=Hf(s),E&&E.l(s)},m(s,A){h&&h.m(s,A),ao(s,o,A),E&&E.m(s,A),l=!0},p(s,[A]){s[0].length>0?h?(h.p(s,A),A&1&&pi(h,1)):(h=V0(s),h.c(),pi(h,1),h.m(o.parentNode,o)):h&&(Fl(),Pi(h,1,1,()=>{h=null}),Bl()),x?x.p&&(!l||A&8)&&Uf(x,_,s,s[3],l?Nf(_,s[3],A,null):Vf(s[3]),null):E&&E.p&&(!l||A&15)&&E.p(s,l?A:-1)},i(s){l||(pi(h),pi(E,s),l=!0)},o(s){Pi(h),Pi(E,s),l=!1},d(s){h&&h.d(s),s&&Ai(o),E&&E.d(s)}}}function KE(i){return typeof i.prototype=="undefined"}async function G0(i){return i().then(o=>o.default)}function JE(i,o,l){let h,_,x;Dm(i,Ea,F=>l(0,h=F)),Dm(i,Ta,F=>l(1,_=F)),Dm(i,wa,F=>l(2,x=F));let{$$slots:E={},$$scope:s}=o;const A=()=>{$f(wa,x=!0,x)},M=()=>{$f(Ta,_=!1,_)},z=()=>{$f(wa,x=!0,x)},L=()=>{$f(Ta,_=!1,_)};return i.$$set=F=>{"$$scope"in F&&l(3,s=F.$$scope)},[h,_,x,s,E,A,M,z,L]}class bD extends Zm{constructor(o){super();qm(this,o,JE,YE,Ff,{})}}function q0(i){const o=i-1;return o*o*o+1}function wD(i){return--i*i*i*i*i+1}function TD(i,{delay:o=0,duration:l=400,easing:h=q0,x:_=0,y:x=0,opacity:E=0}={}){const s=getComputedStyle(i),A=+s.opacity,M=s.transform==="none"?"":s.transform,z=A*(1-E);return{delay:o,duration:l,easing:h,css:(L,F)=>`
			transform: ${M} translate(${(1-L)*_}px, ${(1-L)*x}px);
			opacity: ${A-z*F}`}}function ED(i,{delay:o=0,duration:l=400,easing:h=q0,start:_=0,opacity:x=0}={}){const E=getComputedStyle(i),s=+E.opacity,A=E.transform==="none"?"":E.transform,M=1-_,z=s*(1-x);return{delay:o,duration:l,easing:h,css:(L,F)=>`
			transform: ${A} scale(${1-M*F});
			opacity: ${s-z*F}
		`}}var eS={value:()=>{}};function hd(){for(var i=0,o=arguments.length,l={},h;i<o;++i){if(!(h=arguments[i]+"")||h in l||/[\s.]/.test(h))throw new Error("illegal type: "+h);l[h]=[]}return new fd(l)}function fd(i){this._=i}function tS(i,o){return i.trim().split(/^|\s+/).map(function(l){var h="",_=l.indexOf(".");if(_>=0&&(h=l.slice(_+1),l=l.slice(0,_)),l&&!o.hasOwnProperty(l))throw new Error("unknown type: "+l);return{type:l,name:h}})}fd.prototype=hd.prototype={constructor:fd,on:function(i,o){var l=this._,h=tS(i+"",l),_,x=-1,E=h.length;if(arguments.length<2){for(;++x<E;)if((_=(i=h[x]).type)&&(_=rS(l[_],i.name)))return _;return}if(o!=null&&typeof o!="function")throw new Error("invalid callback: "+o);for(;++x<E;)if(_=(i=h[x]).type)l[_]=Z0(l[_],i.name,o);else if(o==null)for(_ in l)l[_]=Z0(l[_],i.name,null);return this},copy:function(){var i={},o=this._;for(var l in o)i[l]=o[l].slice();return new fd(i)},call:function(i,o){if((_=arguments.length-2)>0)for(var l=new Array(_),h=0,_,x;h<_;++h)l[h]=arguments[h+2];if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(x=this._[i],h=0,_=x.length;h<_;++h)x[h].value.apply(o,l)},apply:function(i,o,l){if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(var h=this._[i],_=0,x=h.length;_<x;++_)h[_].value.apply(o,l)}};function rS(i,o){for(var l=0,h=i.length,_;l<h;++l)if((_=i[l]).name===o)return _.value}function Z0(i,o,l){for(var h=0,_=i.length;h<_;++h)if(i[h].name===o){i[h]=eS,i=i.slice(0,h).concat(i.slice(h+1));break}return l!=null&&i.push({name:o,value:l}),i}var l_="http://www.w3.org/1999/xhtml",H0={svg:"http://www.w3.org/2000/svg",xhtml:l_,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function dd(i){var o=i+="",l=o.indexOf(":");return l>=0&&(o=i.slice(0,l))!=="xmlns"&&(i=i.slice(l+1)),H0.hasOwnProperty(o)?{space:H0[o],local:i}:i}function iS(i){return function(){var o=this.ownerDocument,l=this.namespaceURI;return l===l_&&o.documentElement.namespaceURI===l_?o.createElement(i):o.createElementNS(l,i)}}function nS(i){return function(){return this.ownerDocument.createElementNS(i.space,i.local)}}function W0(i){var o=dd(i);return(o.local?nS:iS)(o)}function oS(){}function c_(i){return i==null?oS:function(){return this.querySelector(i)}}function sS(i){typeof i!="function"&&(i=c_(i));for(var o=this._groups,l=o.length,h=new Array(l),_=0;_<l;++_)for(var x=o[_],E=x.length,s=h[_]=new Array(E),A,M,z=0;z<E;++z)(A=x[z])&&(M=i.call(A,A.__data__,z,x))&&("__data__"in A&&(M.__data__=A.__data__),s[z]=M);return new Zi(h,this._parents)}function X0(i){return i==null?[]:Array.isArray(i)?i:Array.from(i)}function aS(){return[]}function Q0(i){return i==null?aS:function(){return this.querySelectorAll(i)}}function lS(i){return function(){return X0(i.apply(this,arguments))}}function cS(i){typeof i=="function"?i=lS(i):i=Q0(i);for(var o=this._groups,l=o.length,h=[],_=[],x=0;x<l;++x)for(var E=o[x],s=E.length,A,M=0;M<s;++M)(A=E[M])&&(h.push(i.call(A,A.__data__,M,E)),_.push(A));return new Zi(h,_)}function Y0(i){return function(){return this.matches(i)}}function K0(i){return function(o){return o.matches(i)}}var uS=Array.prototype.find;function hS(i){return function(){return uS.call(this.children,i)}}function fS(){return this.firstElementChild}function dS(i){return this.select(i==null?fS:hS(typeof i=="function"?i:K0(i)))}var pS=Array.prototype.filter;function mS(){return Array.from(this.children)}function _S(i){return function(){return pS.call(this.children,i)}}function gS(i){return this.selectAll(i==null?mS:_S(typeof i=="function"?i:K0(i)))}function yS(i){typeof i!="function"&&(i=Y0(i));for(var o=this._groups,l=o.length,h=new Array(l),_=0;_<l;++_)for(var x=o[_],E=x.length,s=h[_]=[],A,M=0;M<E;++M)(A=x[M])&&i.call(A,A.__data__,M,x)&&s.push(A);return new Zi(h,this._parents)}function J0(i){return new Array(i.length)}function vS(){return new Zi(this._enter||this._groups.map(J0),this._parents)}function pd(i,o){this.ownerDocument=i.ownerDocument,this.namespaceURI=i.namespaceURI,this._next=null,this._parent=i,this.__data__=o}pd.prototype={constructor:pd,appendChild:function(i){return this._parent.insertBefore(i,this._next)},insertBefore:function(i,o){return this._parent.insertBefore(i,o)},querySelector:function(i){return this._parent.querySelector(i)},querySelectorAll:function(i){return this._parent.querySelectorAll(i)}};function xS(i){return function(){return i}}function bS(i,o,l,h,_,x){for(var E=0,s,A=o.length,M=x.length;E<M;++E)(s=o[E])?(s.__data__=x[E],h[E]=s):l[E]=new pd(i,x[E]);for(;E<A;++E)(s=o[E])&&(_[E]=s)}function wS(i,o,l,h,_,x,E){var s,A,M=new Map,z=o.length,L=x.length,F=new Array(z),j;for(s=0;s<z;++s)(A=o[s])&&(F[s]=j=E.call(A,A.__data__,s,o)+"",M.has(j)?_[s]=A:M.set(j,A));for(s=0;s<L;++s)j=E.call(i,x[s],s,x)+"",(A=M.get(j))?(h[s]=A,A.__data__=x[s],M.delete(j)):l[s]=new pd(i,x[s]);for(s=0;s<z;++s)(A=o[s])&&M.get(F[s])===A&&(_[s]=A)}function TS(i){return i.__data__}function ES(i,o){if(!arguments.length)return Array.from(this,TS);var l=o?wS:bS,h=this._parents,_=this._groups;typeof i!="function"&&(i=xS(i));for(var x=_.length,E=new Array(x),s=new Array(x),A=new Array(x),M=0;M<x;++M){var z=h[M],L=_[M],F=L.length,j=SS(i.call(z,z&&z.__data__,M,h)),H=j.length,W=s[M]=new Array(H),he=E[M]=new Array(H),ve=A[M]=new Array(F);l(z,L,W,he,ve,j,o);for(var Ce=0,De=0,Se,Ie;Ce<H;++Ce)if(Se=W[Ce]){for(Ce>=De&&(De=Ce+1);!(Ie=he[De])&&++De<H;);Se._next=Ie||null}}return E=new Zi(E,h),E._enter=s,E._exit=A,E}function SS(i){return typeof i=="object"&&"length"in i?i:Array.from(i)}function AS(){return new Zi(this._exit||this._groups.map(J0),this._parents)}function PS(i,o,l){var h=this.enter(),_=this,x=this.exit();return typeof i=="function"?(h=i(h),h&&(h=h.selection())):h=h.append(i+""),o!=null&&(_=o(_),_&&(_=_.selection())),l==null?x.remove():l(x),h&&_?h.merge(_).order():_}function IS(i){for(var o=i.selection?i.selection():i,l=this._groups,h=o._groups,_=l.length,x=h.length,E=Math.min(_,x),s=new Array(_),A=0;A<E;++A)for(var M=l[A],z=h[A],L=M.length,F=s[A]=new Array(L),j,H=0;H<L;++H)(j=M[H]||z[H])&&(F[H]=j);for(;A<_;++A)s[A]=l[A];return new Zi(s,this._parents)}function MS(){for(var i=this._groups,o=-1,l=i.length;++o<l;)for(var h=i[o],_=h.length-1,x=h[_],E;--_>=0;)(E=h[_])&&(x&&E.compareDocumentPosition(x)^4&&x.parentNode.insertBefore(E,x),x=E);return this}function CS(i){i||(i=zS);function o(L,F){return L&&F?i(L.__data__,F.__data__):!L-!F}for(var l=this._groups,h=l.length,_=new Array(h),x=0;x<h;++x){for(var E=l[x],s=E.length,A=_[x]=new Array(s),M,z=0;z<s;++z)(M=E[z])&&(A[z]=M);A.sort(o)}return new Zi(_,this._parents).order()}function zS(i,o){return i<o?-1:i>o?1:i>=o?0:NaN}function RS(){var i=arguments[0];return arguments[0]=this,i.apply(null,arguments),this}function kS(){return Array.from(this)}function DS(){for(var i=this._groups,o=0,l=i.length;o<l;++o)for(var h=i[o],_=0,x=h.length;_<x;++_){var E=h[_];if(E)return E}return null}function OS(){let i=0;for(const o of this)++i;return i}function LS(){return!this.node()}function FS(i){for(var o=this._groups,l=0,h=o.length;l<h;++l)for(var _=o[l],x=0,E=_.length,s;x<E;++x)(s=_[x])&&i.call(s,s.__data__,x,_);return this}function BS(i){return function(){this.removeAttribute(i)}}function jS(i){return function(){this.removeAttributeNS(i.space,i.local)}}function NS(i,o){return function(){this.setAttribute(i,o)}}function US(i,o){return function(){this.setAttributeNS(i.space,i.local,o)}}function VS(i,o){return function(){var l=o.apply(this,arguments);l==null?this.removeAttribute(i):this.setAttribute(i,l)}}function $S(i,o){return function(){var l=o.apply(this,arguments);l==null?this.removeAttributeNS(i.space,i.local):this.setAttributeNS(i.space,i.local,l)}}function GS(i,o){var l=dd(i);if(arguments.length<2){var h=this.node();return l.local?h.getAttributeNS(l.space,l.local):h.getAttribute(l)}return this.each((o==null?l.local?jS:BS:typeof o=="function"?l.local?$S:VS:l.local?US:NS)(l,o))}function ex(i){return i.ownerDocument&&i.ownerDocument.defaultView||i.document&&i||i.defaultView}function qS(i){return function(){this.style.removeProperty(i)}}function ZS(i,o,l){return function(){this.style.setProperty(i,o,l)}}function HS(i,o,l){return function(){var h=o.apply(this,arguments);h==null?this.style.removeProperty(i):this.style.setProperty(i,h,l)}}function WS(i,o,l){return arguments.length>1?this.each((o==null?qS:typeof o=="function"?HS:ZS)(i,o,l==null?"":l)):ql(this.node(),i)}function ql(i,o){return i.style.getPropertyValue(o)||ex(i).getComputedStyle(i,null).getPropertyValue(o)}function XS(i){return function(){delete this[i]}}function QS(i,o){return function(){this[i]=o}}function YS(i,o){return function(){var l=o.apply(this,arguments);l==null?delete this[i]:this[i]=l}}function KS(i,o){return arguments.length>1?this.each((o==null?XS:typeof o=="function"?YS:QS)(i,o)):this.node()[i]}function tx(i){return i.trim().split(/^|\s+/)}function u_(i){return i.classList||new rx(i)}function rx(i){this._node=i,this._names=tx(i.getAttribute("class")||"")}rx.prototype={add:function(i){var o=this._names.indexOf(i);o<0&&(this._names.push(i),this._node.setAttribute("class",this._names.join(" ")))},remove:function(i){var o=this._names.indexOf(i);o>=0&&(this._names.splice(o,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(i){return this._names.indexOf(i)>=0}};function ix(i,o){for(var l=u_(i),h=-1,_=o.length;++h<_;)l.add(o[h])}function nx(i,o){for(var l=u_(i),h=-1,_=o.length;++h<_;)l.remove(o[h])}function JS(i){return function(){ix(this,i)}}function eA(i){return function(){nx(this,i)}}function tA(i,o){return function(){(o.apply(this,arguments)?ix:nx)(this,i)}}function rA(i,o){var l=tx(i+"");if(arguments.length<2){for(var h=u_(this.node()),_=-1,x=l.length;++_<x;)if(!h.contains(l[_]))return!1;return!0}return this.each((typeof o=="function"?tA:o?JS:eA)(l,o))}function iA(){this.textContent=""}function nA(i){return function(){this.textContent=i}}function oA(i){return function(){var o=i.apply(this,arguments);this.textContent=o==null?"":o}}function sA(i){return arguments.length?this.each(i==null?iA:(typeof i=="function"?oA:nA)(i)):this.node().textContent}function aA(){this.innerHTML=""}function lA(i){return function(){this.innerHTML=i}}function cA(i){return function(){var o=i.apply(this,arguments);this.innerHTML=o==null?"":o}}function uA(i){return arguments.length?this.each(i==null?aA:(typeof i=="function"?cA:lA)(i)):this.node().innerHTML}function hA(){this.nextSibling&&this.parentNode.appendChild(this)}function fA(){return this.each(hA)}function dA(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function pA(){return this.each(dA)}function mA(i){var o=typeof i=="function"?i:W0(i);return this.select(function(){return this.appendChild(o.apply(this,arguments))})}function _A(){return null}function gA(i,o){var l=typeof i=="function"?i:W0(i),h=o==null?_A:typeof o=="function"?o:c_(o);return this.select(function(){return this.insertBefore(l.apply(this,arguments),h.apply(this,arguments)||null)})}function yA(){var i=this.parentNode;i&&i.removeChild(this)}function vA(){return this.each(yA)}function xA(){var i=this.cloneNode(!1),o=this.parentNode;return o?o.insertBefore(i,this.nextSibling):i}function bA(){var i=this.cloneNode(!0),o=this.parentNode;return o?o.insertBefore(i,this.nextSibling):i}function wA(i){return this.select(i?bA:xA)}function TA(i){return arguments.length?this.property("__data__",i):this.node().__data__}function EA(i){return function(o){i.call(this,o,this.__data__)}}function SA(i){return i.trim().split(/^|\s+/).map(function(o){var l="",h=o.indexOf(".");return h>=0&&(l=o.slice(h+1),o=o.slice(0,h)),{type:o,name:l}})}function AA(i){return function(){var o=this.__on;if(!!o){for(var l=0,h=-1,_=o.length,x;l<_;++l)x=o[l],(!i.type||x.type===i.type)&&x.name===i.name?this.removeEventListener(x.type,x.listener,x.options):o[++h]=x;++h?o.length=h:delete this.__on}}}function PA(i,o,l){return function(){var h=this.__on,_,x=EA(o);if(h){for(var E=0,s=h.length;E<s;++E)if((_=h[E]).type===i.type&&_.name===i.name){this.removeEventListener(_.type,_.listener,_.options),this.addEventListener(_.type,_.listener=x,_.options=l),_.value=o;return}}this.addEventListener(i.type,x,l),_={type:i.type,name:i.name,value:o,listener:x,options:l},h?h.push(_):this.__on=[_]}}function IA(i,o,l){var h=SA(i+""),_,x=h.length,E;if(arguments.length<2){var s=this.node().__on;if(s){for(var A=0,M=s.length,z;A<M;++A)for(_=0,z=s[A];_<x;++_)if((E=h[_]).type===z.type&&E.name===z.name)return z.value}return}for(s=o?PA:AA,_=0;_<x;++_)this.each(s(h[_],o,l));return this}function ox(i,o,l){var h=ex(i),_=h.CustomEvent;typeof _=="function"?_=new _(o,l):(_=h.document.createEvent("Event"),l?(_.initEvent(o,l.bubbles,l.cancelable),_.detail=l.detail):_.initEvent(o,!1,!1)),i.dispatchEvent(_)}function MA(i,o){return function(){return ox(this,i,o)}}function CA(i,o){return function(){return ox(this,i,o.apply(this,arguments))}}function zA(i,o){return this.each((typeof o=="function"?CA:MA)(i,o))}function*RA(){for(var i=this._groups,o=0,l=i.length;o<l;++o)for(var h=i[o],_=0,x=h.length,E;_<x;++_)(E=h[_])&&(yield E)}var h_=[null];function Zi(i,o){this._groups=i,this._parents=o}function ju(){return new Zi([[document.documentElement]],h_)}function kA(){return this}Zi.prototype=ju.prototype={constructor:Zi,select:sS,selectAll:cS,selectChild:dS,selectChildren:gS,filter:yS,data:ES,enter:vS,exit:AS,join:PS,merge:IS,selection:kA,order:MS,sort:CS,call:RS,nodes:kS,node:DS,size:OS,empty:LS,each:FS,attr:GS,style:WS,property:KS,classed:rA,text:sA,html:uA,raise:fA,lower:pA,append:mA,insert:gA,remove:vA,clone:wA,datum:TA,on:IA,dispatch:zA,[Symbol.iterator]:RA};function md(i){return typeof i=="string"?new Zi([[document.querySelector(i)]],[document.documentElement]):new Zi([[i]],h_)}function DA(i){let o;for(;o=i.sourceEvent;)i=o;return i}function sx(i,o){if(i=DA(i),o===void 0&&(o=i.currentTarget),o){var l=o.ownerSVGElement||o;if(l.createSVGPoint){var h=l.createSVGPoint();return h.x=i.clientX,h.y=i.clientY,h=h.matrixTransform(o.getScreenCTM().inverse()),[h.x,h.y]}if(o.getBoundingClientRect){var _=o.getBoundingClientRect();return[i.clientX-_.left-o.clientLeft,i.clientY-_.top-o.clientTop]}}return[i.pageX,i.pageY]}function SD(i){return typeof i=="string"?new Zi([document.querySelectorAll(i)],[document.documentElement]):new Zi([X0(i)],h_)}const OA={passive:!1},Nu={capture:!0,passive:!1};function f_(i){i.stopImmediatePropagation()}function Zl(i){i.preventDefault(),i.stopImmediatePropagation()}function LA(i){var o=i.document.documentElement,l=md(i).on("dragstart.drag",Zl,Nu);"onselectstart"in o?l.on("selectstart.drag",Zl,Nu):(o.__noselect=o.style.MozUserSelect,o.style.MozUserSelect="none")}function FA(i,o){var l=i.document.documentElement,h=md(i).on("dragstart.drag",null);o&&(h.on("click.drag",Zl,Nu),setTimeout(function(){h.on("click.drag",null)},0)),"onselectstart"in l?h.on("selectstart.drag",null):(l.style.MozUserSelect=l.__noselect,delete l.__noselect)}var _d=i=>()=>i;function d_(i,{sourceEvent:o,subject:l,target:h,identifier:_,active:x,x:E,y:s,dx:A,dy:M,dispatch:z}){Object.defineProperties(this,{type:{value:i,enumerable:!0,configurable:!0},sourceEvent:{value:o,enumerable:!0,configurable:!0},subject:{value:l,enumerable:!0,configurable:!0},target:{value:h,enumerable:!0,configurable:!0},identifier:{value:_,enumerable:!0,configurable:!0},active:{value:x,enumerable:!0,configurable:!0},x:{value:E,enumerable:!0,configurable:!0},y:{value:s,enumerable:!0,configurable:!0},dx:{value:A,enumerable:!0,configurable:!0},dy:{value:M,enumerable:!0,configurable:!0},_:{value:z}})}d_.prototype.on=function(){var i=this._.on.apply(this._,arguments);return i===this._?this:i};function BA(i){return!i.ctrlKey&&!i.button}function jA(){return this.parentNode}function NA(i,o){return o==null?{x:i.x,y:i.y}:o}function UA(){return navigator.maxTouchPoints||"ontouchstart"in this}function AD(){var i=BA,o=jA,l=NA,h=UA,_={},x=hd("start","drag","end"),E=0,s,A,M,z,L=0;function F(Se){Se.on("mousedown.drag",j).filter(h).on("touchstart.drag",he).on("touchmove.drag",ve,OA).on("touchend.drag touchcancel.drag",Ce).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function j(Se,Ie){if(!(z||!i.call(this,Se,Ie))){var We=De(this,o.call(this,Se,Ie),Se,Ie,"mouse");!We||(md(Se.view).on("mousemove.drag",H,Nu).on("mouseup.drag",W,Nu),LA(Se.view),f_(Se),M=!1,s=Se.clientX,A=Se.clientY,We("start",Se))}}function H(Se){if(Zl(Se),!M){var Ie=Se.clientX-s,We=Se.clientY-A;M=Ie*Ie+We*We>L}_.mouse("drag",Se)}function W(Se){md(Se.view).on("mousemove.drag mouseup.drag",null),FA(Se.view,M),Zl(Se),_.mouse("end",Se)}function he(Se,Ie){if(!!i.call(this,Se,Ie)){var We=Se.changedTouches,mt=o.call(this,Se,Ie),Te=We.length,Ue,Xe;for(Ue=0;Ue<Te;++Ue)(Xe=De(this,mt,Se,Ie,We[Ue].identifier,We[Ue]))&&(f_(Se),Xe("start",Se,We[Ue]))}}function ve(Se){var Ie=Se.changedTouches,We=Ie.length,mt,Te;for(mt=0;mt<We;++mt)(Te=_[Ie[mt].identifier])&&(Zl(Se),Te("drag",Se,Ie[mt]))}function Ce(Se){var Ie=Se.changedTouches,We=Ie.length,mt,Te;for(z&&clearTimeout(z),z=setTimeout(function(){z=null},500),mt=0;mt<We;++mt)(Te=_[Ie[mt].identifier])&&(f_(Se),Te("end",Se,Ie[mt]))}function De(Se,Ie,We,mt,Te,Ue){var Xe=x.copy(),tt=sx(Ue||We,Ie),Dt,Ft,zr;if((zr=l.call(Se,new d_("beforestart",{sourceEvent:We,target:F,identifier:Te,active:E,x:tt[0],y:tt[1],dx:0,dy:0,dispatch:Xe}),mt))!=null)return Dt=zr.x-tt[0]||0,Ft=zr.y-tt[1]||0,function Kt(Rr,Wr,xr){var Ht=tt,Br;switch(Rr){case"start":_[Te]=Kt,Br=E++;break;case"end":delete _[Te],--E;case"drag":tt=sx(xr||Wr,Ie),Br=E;break}Xe.call(Rr,Se,new d_(Rr,{sourceEvent:Wr,subject:zr,target:F,identifier:Te,active:Br,x:tt[0]+Dt,y:tt[1]+Ft,dx:tt[0]-Ht[0],dy:tt[1]-Ht[1],dispatch:Xe}),mt)}}return F.filter=function(Se){return arguments.length?(i=typeof Se=="function"?Se:_d(!!Se),F):i},F.container=function(Se){return arguments.length?(o=typeof Se=="function"?Se:_d(Se),F):o},F.subject=function(Se){return arguments.length?(l=typeof Se=="function"?Se:_d(Se),F):l},F.touchable=function(Se){return arguments.length?(h=typeof Se=="function"?Se:_d(!!Se),F):h},F.on=function(){var Se=x.on.apply(x,arguments);return Se===x?F:Se},F.clickDistance=function(Se){return arguments.length?(L=(Se=+Se)*Se,F):Math.sqrt(L)},F}var Hl=0,Uu=0,Vu=0,ax=1e3,gd,$u,yd=0,Sa=0,vd=0,Gu=typeof performance=="object"&&performance.now?performance:Date,lx=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(i){setTimeout(i,17)};function p_(){return Sa||(lx(VA),Sa=Gu.now()+vd)}function VA(){Sa=0}function xd(){this._call=this._time=this._next=null}xd.prototype=m_.prototype={constructor:xd,restart:function(i,o,l){if(typeof i!="function")throw new TypeError("callback is not a function");l=(l==null?p_():+l)+(o==null?0:+o),!this._next&&$u!==this&&($u?$u._next=this:gd=this,$u=this),this._call=i,this._time=l,__()},stop:function(){this._call&&(this._call=null,this._time=1/0,__())}};function m_(i,o,l){var h=new xd;return h.restart(i,o,l),h}function $A(){p_(),++Hl;for(var i=gd,o;i;)(o=Sa-i._time)>=0&&i._call.call(void 0,o),i=i._next;--Hl}function cx(){Sa=(yd=Gu.now())+vd,Hl=Uu=0;try{$A()}finally{Hl=0,qA(),Sa=0}}function GA(){var i=Gu.now(),o=i-yd;o>ax&&(vd-=o,yd=i)}function qA(){for(var i,o=gd,l,h=1/0;o;)o._call?(h>o._time&&(h=o._time),i=o,o=o._next):(l=o._next,o._next=null,o=i?i._next=l:gd=l);$u=i,__(h)}function __(i){if(!Hl){Uu&&(Uu=clearTimeout(Uu));var o=i-Sa;o>24?(i<1/0&&(Uu=setTimeout(cx,i-Gu.now()-vd)),Vu&&(Vu=clearInterval(Vu))):(Vu||(yd=Gu.now(),Vu=setInterval(GA,ax)),Hl=1,lx(cx))}}function ux(i,o,l){var h=new xd;return o=o==null?0:+o,h.restart(_=>{h.stop(),i(_+o)},o,l),h}var ZA=hd("start","end","cancel","interrupt"),HA=[],hx=0,fx=1,g_=2,bd=3,dx=4,y_=5,wd=6;function Td(i,o,l,h,_,x){var E=i.__transition;if(!E)i.__transition={};else if(l in E)return;WA(i,l,{name:o,index:h,group:_,on:ZA,tween:HA,time:x.time,delay:x.delay,duration:x.duration,ease:x.ease,timer:null,state:hx})}function v_(i,o){var l=Bn(i,o);if(l.state>hx)throw new Error("too late; already scheduled");return l}function ho(i,o){var l=Bn(i,o);if(l.state>bd)throw new Error("too late; already running");return l}function Bn(i,o){var l=i.__transition;if(!l||!(l=l[o]))throw new Error("transition not found");return l}function WA(i,o,l){var h=i.__transition,_;h[o]=l,l.timer=m_(x,0,l.time);function x(M){l.state=fx,l.timer.restart(E,l.delay,l.time),l.delay<=M&&E(M-l.delay)}function E(M){var z,L,F,j;if(l.state!==fx)return A();for(z in h)if(j=h[z],j.name===l.name){if(j.state===bd)return ux(E);j.state===dx?(j.state=wd,j.timer.stop(),j.on.call("interrupt",i,i.__data__,j.index,j.group),delete h[z]):+z<o&&(j.state=wd,j.timer.stop(),j.on.call("cancel",i,i.__data__,j.index,j.group),delete h[z])}if(ux(function(){l.state===bd&&(l.state=dx,l.timer.restart(s,l.delay,l.time),s(M))}),l.state=g_,l.on.call("start",i,i.__data__,l.index,l.group),l.state===g_){for(l.state=bd,_=new Array(F=l.tween.length),z=0,L=-1;z<F;++z)(j=l.tween[z].value.call(i,i.__data__,l.index,l.group))&&(_[++L]=j);_.length=L+1}}function s(M){for(var z=M<l.duration?l.ease.call(null,M/l.duration):(l.timer.restart(A),l.state=y_,1),L=-1,F=_.length;++L<F;)_[L].call(i,z);l.state===y_&&(l.on.call("end",i,i.__data__,l.index,l.group),A())}function A(){l.state=wd,l.timer.stop(),delete h[o];for(var M in h)return;delete i.__transition}}function XA(i,o){var l=i.__transition,h,_,x=!0,E;if(!!l){o=o==null?null:o+"";for(E in l){if((h=l[E]).name!==o){x=!1;continue}_=h.state>g_&&h.state<y_,h.state=wd,h.timer.stop(),h.on.call(_?"interrupt":"cancel",i,i.__data__,h.index,h.group),delete l[E]}x&&delete i.__transition}}function QA(i){return this.each(function(){XA(this,i)})}function YA(i,o){var l,h;return function(){var _=ho(this,i),x=_.tween;if(x!==l){h=l=x;for(var E=0,s=h.length;E<s;++E)if(h[E].name===o){h=h.slice(),h.splice(E,1);break}}_.tween=h}}function KA(i,o,l){var h,_;if(typeof l!="function")throw new Error;return function(){var x=ho(this,i),E=x.tween;if(E!==h){_=(h=E).slice();for(var s={name:o,value:l},A=0,M=_.length;A<M;++A)if(_[A].name===o){_[A]=s;break}A===M&&_.push(s)}x.tween=_}}function JA(i,o){var l=this._id;if(i+="",arguments.length<2){for(var h=Bn(this.node(),l).tween,_=0,x=h.length,E;_<x;++_)if((E=h[_]).name===i)return E.value;return null}return this.each((o==null?YA:KA)(l,i,o))}function x_(i,o,l){var h=i._id;return i.each(function(){var _=ho(this,h);(_.value||(_.value={}))[o]=l.apply(this,arguments)}),function(_){return Bn(_,h).value[o]}}function px(i,o){var l;return(typeof o=="number"?Fn:o instanceof ba?sd:(l=ba(o))?(o=l,sd):S0)(i,o)}function eP(i){return function(){this.removeAttribute(i)}}function tP(i){return function(){this.removeAttributeNS(i.space,i.local)}}function rP(i,o,l){var h,_=l+"",x;return function(){var E=this.getAttribute(i);return E===_?null:E===h?x:x=o(h=E,l)}}function iP(i,o,l){var h,_=l+"",x;return function(){var E=this.getAttributeNS(i.space,i.local);return E===_?null:E===h?x:x=o(h=E,l)}}function nP(i,o,l){var h,_,x;return function(){var E,s=l(this),A;return s==null?void this.removeAttribute(i):(E=this.getAttribute(i),A=s+"",E===A?null:E===h&&A===_?x:(_=A,x=o(h=E,s)))}}function oP(i,o,l){var h,_,x;return function(){var E,s=l(this),A;return s==null?void this.removeAttributeNS(i.space,i.local):(E=this.getAttributeNS(i.space,i.local),A=s+"",E===A?null:E===h&&A===_?x:(_=A,x=o(h=E,s)))}}function sP(i,o){var l=dd(i),h=l==="transform"?yE:px;return this.attrTween(i,typeof o=="function"?(l.local?oP:nP)(l,h,x_(this,"attr."+i,o)):o==null?(l.local?tP:eP)(l):(l.local?iP:rP)(l,h,o))}function aP(i,o){return function(l){this.setAttribute(i,o.call(this,l))}}function lP(i,o){return function(l){this.setAttributeNS(i.space,i.local,o.call(this,l))}}function cP(i,o){var l,h;function _(){var x=o.apply(this,arguments);return x!==h&&(l=(h=x)&&lP(i,x)),l}return _._value=o,_}function uP(i,o){var l,h;function _(){var x=o.apply(this,arguments);return x!==h&&(l=(h=x)&&aP(i,x)),l}return _._value=o,_}function hP(i,o){var l="attr."+i;if(arguments.length<2)return(l=this.tween(l))&&l._value;if(o==null)return this.tween(l,null);if(typeof o!="function")throw new Error;var h=dd(i);return this.tween(l,(h.local?cP:uP)(h,o))}function fP(i,o){return function(){v_(this,i).delay=+o.apply(this,arguments)}}function dP(i,o){return o=+o,function(){v_(this,i).delay=o}}function pP(i){var o=this._id;return arguments.length?this.each((typeof i=="function"?fP:dP)(o,i)):Bn(this.node(),o).delay}function mP(i,o){return function(){ho(this,i).duration=+o.apply(this,arguments)}}function _P(i,o){return o=+o,function(){ho(this,i).duration=o}}function gP(i){var o=this._id;return arguments.length?this.each((typeof i=="function"?mP:_P)(o,i)):Bn(this.node(),o).duration}function yP(i,o){if(typeof o!="function")throw new Error;return function(){ho(this,i).ease=o}}function vP(i){var o=this._id;return arguments.length?this.each(yP(o,i)):Bn(this.node(),o).ease}function xP(i,o){return function(){var l=o.apply(this,arguments);if(typeof l!="function")throw new Error;ho(this,i).ease=l}}function bP(i){if(typeof i!="function")throw new Error;return this.each(xP(this._id,i))}function wP(i){typeof i!="function"&&(i=Y0(i));for(var o=this._groups,l=o.length,h=new Array(l),_=0;_<l;++_)for(var x=o[_],E=x.length,s=h[_]=[],A,M=0;M<E;++M)(A=x[M])&&i.call(A,A.__data__,M,x)&&s.push(A);return new Oo(h,this._parents,this._name,this._id)}function TP(i){if(i._id!==this._id)throw new Error;for(var o=this._groups,l=i._groups,h=o.length,_=l.length,x=Math.min(h,_),E=new Array(h),s=0;s<x;++s)for(var A=o[s],M=l[s],z=A.length,L=E[s]=new Array(z),F,j=0;j<z;++j)(F=A[j]||M[j])&&(L[j]=F);for(;s<h;++s)E[s]=o[s];return new Oo(E,this._parents,this._name,this._id)}function EP(i){return(i+"").trim().split(/^|\s+/).every(function(o){var l=o.indexOf(".");return l>=0&&(o=o.slice(0,l)),!o||o==="start"})}function SP(i,o,l){var h,_,x=EP(o)?v_:ho;return function(){var E=x(this,i),s=E.on;s!==h&&(_=(h=s).copy()).on(o,l),E.on=_}}function AP(i,o){var l=this._id;return arguments.length<2?Bn(this.node(),l).on.on(i):this.each(SP(l,i,o))}function PP(i){return function(){var o=this.parentNode;for(var l in this.__transition)if(+l!==i)return;o&&o.removeChild(this)}}function IP(){return this.on("end.remove",PP(this._id))}function MP(i){var o=this._name,l=this._id;typeof i!="function"&&(i=c_(i));for(var h=this._groups,_=h.length,x=new Array(_),E=0;E<_;++E)for(var s=h[E],A=s.length,M=x[E]=new Array(A),z,L,F=0;F<A;++F)(z=s[F])&&(L=i.call(z,z.__data__,F,s))&&("__data__"in z&&(L.__data__=z.__data__),M[F]=L,Td(M[F],o,l,F,M,Bn(z,l)));return new Oo(x,this._parents,o,l)}function CP(i){var o=this._name,l=this._id;typeof i!="function"&&(i=Q0(i));for(var h=this._groups,_=h.length,x=[],E=[],s=0;s<_;++s)for(var A=h[s],M=A.length,z,L=0;L<M;++L)if(z=A[L]){for(var F=i.call(z,z.__data__,L,A),j,H=Bn(z,l),W=0,he=F.length;W<he;++W)(j=F[W])&&Td(j,o,l,W,F,H);x.push(F),E.push(z)}return new Oo(x,E,o,l)}var zP=ju.prototype.constructor;function RP(){return new zP(this._groups,this._parents)}function kP(i,o){var l,h,_;return function(){var x=ql(this,i),E=(this.style.removeProperty(i),ql(this,i));return x===E?null:x===l&&E===h?_:_=o(l=x,h=E)}}function mx(i){return function(){this.style.removeProperty(i)}}function DP(i,o,l){var h,_=l+"",x;return function(){var E=ql(this,i);return E===_?null:E===h?x:x=o(h=E,l)}}function OP(i,o,l){var h,_,x;return function(){var E=ql(this,i),s=l(this),A=s+"";return s==null&&(A=s=(this.style.removeProperty(i),ql(this,i))),E===A?null:E===h&&A===_?x:(_=A,x=o(h=E,s))}}function LP(i,o){var l,h,_,x="style."+o,E="end."+x,s;return function(){var A=ho(this,i),M=A.on,z=A.value[x]==null?s||(s=mx(o)):void 0;(M!==l||_!==z)&&(h=(l=M).copy()).on(E,_=z),A.on=h}}function FP(i,o,l){var h=(i+="")==="transform"?gE:px;return o==null?this.styleTween(i,kP(i,h)).on("end.style."+i,mx(i)):typeof o=="function"?this.styleTween(i,OP(i,h,x_(this,"style."+i,o))).each(LP(this._id,i)):this.styleTween(i,DP(i,h,o),l).on("end.style."+i,null)}function BP(i,o,l){return function(h){this.style.setProperty(i,o.call(this,h),l)}}function jP(i,o,l){var h,_;function x(){var E=o.apply(this,arguments);return E!==_&&(h=(_=E)&&BP(i,E,l)),h}return x._value=o,x}function NP(i,o,l){var h="style."+(i+="");if(arguments.length<2)return(h=this.tween(h))&&h._value;if(o==null)return this.tween(h,null);if(typeof o!="function")throw new Error;return this.tween(h,jP(i,o,l==null?"":l))}function UP(i){return function(){this.textContent=i}}function VP(i){return function(){var o=i(this);this.textContent=o==null?"":o}}function $P(i){return this.tween("text",typeof i=="function"?VP(x_(this,"text",i)):UP(i==null?"":i+""))}function GP(i){return function(o){this.textContent=i.call(this,o)}}function qP(i){var o,l;function h(){var _=i.apply(this,arguments);return _!==l&&(o=(l=_)&&GP(_)),o}return h._value=i,h}function ZP(i){var o="text";if(arguments.length<1)return(o=this.tween(o))&&o._value;if(i==null)return this.tween(o,null);if(typeof i!="function")throw new Error;return this.tween(o,qP(i))}function HP(){for(var i=this._name,o=this._id,l=_x(),h=this._groups,_=h.length,x=0;x<_;++x)for(var E=h[x],s=E.length,A,M=0;M<s;++M)if(A=E[M]){var z=Bn(A,o);Td(A,i,l,M,E,{time:z.time+z.delay+z.duration,delay:0,duration:z.duration,ease:z.ease})}return new Oo(h,this._parents,i,l)}function WP(){var i,o,l=this,h=l._id,_=l.size();return new Promise(function(x,E){var s={value:E},A={value:function(){--_==0&&x()}};l.each(function(){var M=ho(this,h),z=M.on;z!==i&&(o=(i=z).copy(),o._.cancel.push(s),o._.interrupt.push(s),o._.end.push(A)),M.on=o}),_===0&&x()})}var XP=0;function Oo(i,o,l,h){this._groups=i,this._parents=o,this._name=l,this._id=h}function _x(){return++XP}var Lo=ju.prototype;Oo.prototype={constructor:Oo,select:MP,selectAll:CP,selectChild:Lo.selectChild,selectChildren:Lo.selectChildren,filter:wP,merge:TP,selection:RP,transition:HP,call:Lo.call,nodes:Lo.nodes,node:Lo.node,size:Lo.size,empty:Lo.empty,each:Lo.each,on:AP,attr:sP,attrTween:hP,style:FP,styleTween:NP,text:$P,textTween:ZP,remove:IP,tween:JA,delay:pP,duration:gP,ease:vP,easeVarying:bP,end:WP,[Symbol.iterator]:Lo[Symbol.iterator]};function QP(i){return((i*=2)<=1?i*i*i:(i-=2)*i*i+2)/2}var YP={time:null,delay:0,duration:250,ease:QP};function KP(i,o){for(var l;!(l=i.__transition)||!(l=l[o]);)if(!(i=i.parentNode))throw new Error(`transition ${o} not found`);return l}function JP(i){var o,l;i instanceof Oo?(o=i._id,i=i._name):(o=_x(),(l=YP).time=p_(),i=i==null?null:i+"");for(var h=this._groups,_=h.length,x=0;x<_;++x)for(var E=h[x],s=E.length,A,M=0;M<s;++M)(A=E[M])&&Td(A,i,o,M,E,l||KP(A,o));return new Oo(h,this._parents,i,o)}ju.prototype.interrupt=QA;ju.prototype.transition=JP;const b_=Math.PI,w_=2*b_,Aa=1e-6,eI=w_-Aa;function T_(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function tI(){return new T_}T_.prototype=tI.prototype={constructor:T_,moveTo:function(i,o){this._+="M"+(this._x0=this._x1=+i)+","+(this._y0=this._y1=+o)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(i,o){this._+="L"+(this._x1=+i)+","+(this._y1=+o)},quadraticCurveTo:function(i,o,l,h){this._+="Q"+ +i+","+ +o+","+(this._x1=+l)+","+(this._y1=+h)},bezierCurveTo:function(i,o,l,h,_,x){this._+="C"+ +i+","+ +o+","+ +l+","+ +h+","+(this._x1=+_)+","+(this._y1=+x)},arcTo:function(i,o,l,h,_){i=+i,o=+o,l=+l,h=+h,_=+_;var x=this._x1,E=this._y1,s=l-i,A=h-o,M=x-i,z=E-o,L=M*M+z*z;if(_<0)throw new Error("negative radius: "+_);if(this._x1===null)this._+="M"+(this._x1=i)+","+(this._y1=o);else if(L>Aa)if(!(Math.abs(z*s-A*M)>Aa)||!_)this._+="L"+(this._x1=i)+","+(this._y1=o);else{var F=l-x,j=h-E,H=s*s+A*A,W=F*F+j*j,he=Math.sqrt(H),ve=Math.sqrt(L),Ce=_*Math.tan((b_-Math.acos((H+L-W)/(2*he*ve)))/2),De=Ce/ve,Se=Ce/he;Math.abs(De-1)>Aa&&(this._+="L"+(i+De*M)+","+(o+De*z)),this._+="A"+_+","+_+",0,0,"+ +(z*F>M*j)+","+(this._x1=i+Se*s)+","+(this._y1=o+Se*A)}},arc:function(i,o,l,h,_,x){i=+i,o=+o,l=+l,x=!!x;var E=l*Math.cos(h),s=l*Math.sin(h),A=i+E,M=o+s,z=1^x,L=x?h-_:_-h;if(l<0)throw new Error("negative radius: "+l);this._x1===null?this._+="M"+A+","+M:(Math.abs(this._x1-A)>Aa||Math.abs(this._y1-M)>Aa)&&(this._+="L"+A+","+M),!!l&&(L<0&&(L=L%w_+w_),L>eI?this._+="A"+l+","+l+",0,1,"+z+","+(i-E)+","+(o-s)+"A"+l+","+l+",0,1,"+z+","+(this._x1=A)+","+(this._y1=M):L>Aa&&(this._+="A"+l+","+l+",0,"+ +(L>=b_)+","+z+","+(this._x1=i+l*Math.cos(_))+","+(this._y1=o+l*Math.sin(_))))},rect:function(i,o,l,h){this._+="M"+(this._x0=this._x1=+i)+","+(this._y0=this._y1=+o)+"h"+ +l+"v"+ +h+"h"+-l+"Z"},toString:function(){return this._}};function PD(i,o){var l,h=1;i==null&&(i=0),o==null&&(o=0);function _(){var x,E=l.length,s,A=0,M=0;for(x=0;x<E;++x)s=l[x],A+=s.x,M+=s.y;for(A=(A/E-i)*h,M=(M/E-o)*h,x=0;x<E;++x)s=l[x],s.x-=A,s.y-=M}return _.initialize=function(x){l=x},_.x=function(x){return arguments.length?(i=+x,_):i},_.y=function(x){return arguments.length?(o=+x,_):o},_.strength=function(x){return arguments.length?(h=+x,_):h},_}function rI(i){const o=+this._x.call(null,i),l=+this._y.call(null,i);return gx(this.cover(o,l),o,l,i)}function gx(i,o,l,h){if(isNaN(o)||isNaN(l))return i;var _,x=i._root,E={data:h},s=i._x0,A=i._y0,M=i._x1,z=i._y1,L,F,j,H,W,he,ve,Ce;if(!x)return i._root=E,i;for(;x.length;)if((W=o>=(L=(s+M)/2))?s=L:M=L,(he=l>=(F=(A+z)/2))?A=F:z=F,_=x,!(x=x[ve=he<<1|W]))return _[ve]=E,i;if(j=+i._x.call(null,x.data),H=+i._y.call(null,x.data),o===j&&l===H)return E.next=x,_?_[ve]=E:i._root=E,i;do _=_?_[ve]=new Array(4):i._root=new Array(4),(W=o>=(L=(s+M)/2))?s=L:M=L,(he=l>=(F=(A+z)/2))?A=F:z=F;while((ve=he<<1|W)==(Ce=(H>=F)<<1|j>=L));return _[Ce]=x,_[ve]=E,i}function iI(i){var o,l,h=i.length,_,x,E=new Array(h),s=new Array(h),A=1/0,M=1/0,z=-1/0,L=-1/0;for(l=0;l<h;++l)isNaN(_=+this._x.call(null,o=i[l]))||isNaN(x=+this._y.call(null,o))||(E[l]=_,s[l]=x,_<A&&(A=_),_>z&&(z=_),x<M&&(M=x),x>L&&(L=x));if(A>z||M>L)return this;for(this.cover(A,M).cover(z,L),l=0;l<h;++l)gx(this,E[l],s[l],i[l]);return this}function nI(i,o){if(isNaN(i=+i)||isNaN(o=+o))return this;var l=this._x0,h=this._y0,_=this._x1,x=this._y1;if(isNaN(l))_=(l=Math.floor(i))+1,x=(h=Math.floor(o))+1;else{for(var E=_-l||1,s=this._root,A,M;l>i||i>=_||h>o||o>=x;)switch(M=(o<h)<<1|i<l,A=new Array(4),A[M]=s,s=A,E*=2,M){case 0:_=l+E,x=h+E;break;case 1:l=_-E,x=h+E;break;case 2:_=l+E,h=x-E;break;case 3:l=_-E,h=x-E;break}this._root&&this._root.length&&(this._root=s)}return this._x0=l,this._y0=h,this._x1=_,this._y1=x,this}function oI(){var i=[];return this.visit(function(o){if(!o.length)do i.push(o.data);while(o=o.next)}),i}function sI(i){return arguments.length?this.cover(+i[0][0],+i[0][1]).cover(+i[1][0],+i[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Hi(i,o,l,h,_){this.node=i,this.x0=o,this.y0=l,this.x1=h,this.y1=_}function aI(i,o,l){var h,_=this._x0,x=this._y0,E,s,A,M,z=this._x1,L=this._y1,F=[],j=this._root,H,W;for(j&&F.push(new Hi(j,_,x,z,L)),l==null?l=1/0:(_=i-l,x=o-l,z=i+l,L=o+l,l*=l);H=F.pop();)if(!(!(j=H.node)||(E=H.x0)>z||(s=H.y0)>L||(A=H.x1)<_||(M=H.y1)<x))if(j.length){var he=(E+A)/2,ve=(s+M)/2;F.push(new Hi(j[3],he,ve,A,M),new Hi(j[2],E,ve,he,M),new Hi(j[1],he,s,A,ve),new Hi(j[0],E,s,he,ve)),(W=(o>=ve)<<1|i>=he)&&(H=F[F.length-1],F[F.length-1]=F[F.length-1-W],F[F.length-1-W]=H)}else{var Ce=i-+this._x.call(null,j.data),De=o-+this._y.call(null,j.data),Se=Ce*Ce+De*De;if(Se<l){var Ie=Math.sqrt(l=Se);_=i-Ie,x=o-Ie,z=i+Ie,L=o+Ie,h=j.data}}return h}function lI(i){if(isNaN(z=+this._x.call(null,i))||isNaN(L=+this._y.call(null,i)))return this;var o,l=this._root,h,_,x,E=this._x0,s=this._y0,A=this._x1,M=this._y1,z,L,F,j,H,W,he,ve;if(!l)return this;if(l.length)for(;;){if((H=z>=(F=(E+A)/2))?E=F:A=F,(W=L>=(j=(s+M)/2))?s=j:M=j,o=l,!(l=l[he=W<<1|H]))return this;if(!l.length)break;(o[he+1&3]||o[he+2&3]||o[he+3&3])&&(h=o,ve=he)}for(;l.data!==i;)if(_=l,!(l=l.next))return this;return(x=l.next)&&delete l.next,_?(x?_.next=x:delete _.next,this):o?(x?o[he]=x:delete o[he],(l=o[0]||o[1]||o[2]||o[3])&&l===(o[3]||o[2]||o[1]||o[0])&&!l.length&&(h?h[ve]=l:this._root=l),this):(this._root=x,this)}function cI(i){for(var o=0,l=i.length;o<l;++o)this.remove(i[o]);return this}function uI(){return this._root}function hI(){var i=0;return this.visit(function(o){if(!o.length)do++i;while(o=o.next)}),i}function fI(i){var o=[],l,h=this._root,_,x,E,s,A;for(h&&o.push(new Hi(h,this._x0,this._y0,this._x1,this._y1));l=o.pop();)if(!i(h=l.node,x=l.x0,E=l.y0,s=l.x1,A=l.y1)&&h.length){var M=(x+s)/2,z=(E+A)/2;(_=h[3])&&o.push(new Hi(_,M,z,s,A)),(_=h[2])&&o.push(new Hi(_,x,z,M,A)),(_=h[1])&&o.push(new Hi(_,M,E,s,z)),(_=h[0])&&o.push(new Hi(_,x,E,M,z))}return this}function dI(i){var o=[],l=[],h;for(this._root&&o.push(new Hi(this._root,this._x0,this._y0,this._x1,this._y1));h=o.pop();){var _=h.node;if(_.length){var x,E=h.x0,s=h.y0,A=h.x1,M=h.y1,z=(E+A)/2,L=(s+M)/2;(x=_[0])&&o.push(new Hi(x,E,s,z,L)),(x=_[1])&&o.push(new Hi(x,z,s,A,L)),(x=_[2])&&o.push(new Hi(x,E,L,z,M)),(x=_[3])&&o.push(new Hi(x,z,L,A,M))}l.push(h)}for(;h=l.pop();)i(h.node,h.x0,h.y0,h.x1,h.y1);return this}function pI(i){return i[0]}function mI(i){return arguments.length?(this._x=i,this):this._x}function _I(i){return i[1]}function gI(i){return arguments.length?(this._y=i,this):this._y}function E_(i,o,l){var h=new S_(o==null?pI:o,l==null?_I:l,NaN,NaN,NaN,NaN);return i==null?h:h.addAll(i)}function S_(i,o,l,h,_,x){this._x=i,this._y=o,this._x0=l,this._y0=h,this._x1=_,this._y1=x,this._root=void 0}function yx(i){for(var o={data:i.data},l=o;i=i.next;)l=l.next={data:i.data};return o}var Wi=E_.prototype=S_.prototype;Wi.copy=function(){var i=new S_(this._x,this._y,this._x0,this._y0,this._x1,this._y1),o=this._root,l,h;if(!o)return i;if(!o.length)return i._root=yx(o),i;for(l=[{source:o,target:i._root=new Array(4)}];o=l.pop();)for(var _=0;_<4;++_)(h=o.source[_])&&(h.length?l.push({source:h,target:o.target[_]=new Array(4)}):o.target[_]=yx(h));return i};Wi.add=rI;Wi.addAll=iI;Wi.cover=nI;Wi.data=oI;Wi.extent=sI;Wi.find=aI;Wi.remove=lI;Wi.removeAll=cI;Wi.root=uI;Wi.size=hI;Wi.visit=fI;Wi.visitAfter=dI;Wi.x=mI;Wi.y=gI;function Tn(i){return function(){return i}}function Wl(i){return(i()-.5)*1e-6}function yI(i){return i.x+i.vx}function vI(i){return i.y+i.vy}function ID(i){var o,l,h,_=1,x=1;typeof i!="function"&&(i=Tn(i==null?1:+i));function E(){for(var M,z=o.length,L,F,j,H,W,he,ve=0;ve<x;++ve)for(L=E_(o,yI,vI).visitAfter(s),M=0;M<z;++M)F=o[M],W=l[F.index],he=W*W,j=F.x+F.vx,H=F.y+F.vy,L.visit(Ce);function Ce(De,Se,Ie,We,mt){var Te=De.data,Ue=De.r,Xe=W+Ue;if(Te){if(Te.index>F.index){var tt=j-Te.x-Te.vx,Dt=H-Te.y-Te.vy,Ft=tt*tt+Dt*Dt;Ft<Xe*Xe&&(tt===0&&(tt=Wl(h),Ft+=tt*tt),Dt===0&&(Dt=Wl(h),Ft+=Dt*Dt),Ft=(Xe-(Ft=Math.sqrt(Ft)))/Ft*_,F.vx+=(tt*=Ft)*(Xe=(Ue*=Ue)/(he+Ue)),F.vy+=(Dt*=Ft)*Xe,Te.vx-=tt*(Xe=1-Xe),Te.vy-=Dt*Xe)}return}return Se>j+Xe||We<j-Xe||Ie>H+Xe||mt<H-Xe}}function s(M){if(M.data)return M.r=l[M.data.index];for(var z=M.r=0;z<4;++z)M[z]&&M[z].r>M.r&&(M.r=M[z].r)}function A(){if(!!o){var M,z=o.length,L;for(l=new Array(z),M=0;M<z;++M)L=o[M],l[L.index]=+i(L,M,o)}}return E.initialize=function(M,z){o=M,h=z,A()},E.iterations=function(M){return arguments.length?(x=+M,E):x},E.strength=function(M){return arguments.length?(_=+M,E):_},E.radius=function(M){return arguments.length?(i=typeof M=="function"?M:Tn(+M),A(),E):i},E}const xI=1664525,bI=1013904223,vx=4294967296;function wI(){let i=1;return()=>(i=(xI*i+bI)%vx)/vx}function TI(i){return i.x}function EI(i){return i.y}var SI=10,AI=Math.PI*(3-Math.sqrt(5));function MD(i){var o,l=1,h=.001,_=1-Math.pow(h,1/300),x=0,E=.6,s=new Map,A=m_(L),M=hd("tick","end"),z=wI();i==null&&(i=[]);function L(){F(),M.call("tick",o),l<h&&(A.stop(),M.call("end",o))}function F(W){var he,ve=i.length,Ce;W===void 0&&(W=1);for(var De=0;De<W;++De)for(l+=(x-l)*_,s.forEach(function(Se){Se(l)}),he=0;he<ve;++he)Ce=i[he],Ce.fx==null?Ce.x+=Ce.vx*=E:(Ce.x=Ce.fx,Ce.vx=0),Ce.fy==null?Ce.y+=Ce.vy*=E:(Ce.y=Ce.fy,Ce.vy=0);return o}function j(){for(var W=0,he=i.length,ve;W<he;++W){if(ve=i[W],ve.index=W,ve.fx!=null&&(ve.x=ve.fx),ve.fy!=null&&(ve.y=ve.fy),isNaN(ve.x)||isNaN(ve.y)){var Ce=SI*Math.sqrt(.5+W),De=W*AI;ve.x=Ce*Math.cos(De),ve.y=Ce*Math.sin(De)}(isNaN(ve.vx)||isNaN(ve.vy))&&(ve.vx=ve.vy=0)}}function H(W){return W.initialize&&W.initialize(i,z),W}return j(),o={tick:F,restart:function(){return A.restart(L),o},stop:function(){return A.stop(),o},nodes:function(W){return arguments.length?(i=W,j(),s.forEach(H),o):i},alpha:function(W){return arguments.length?(l=+W,o):l},alphaMin:function(W){return arguments.length?(h=+W,o):h},alphaDecay:function(W){return arguments.length?(_=+W,o):+_},alphaTarget:function(W){return arguments.length?(x=+W,o):x},velocityDecay:function(W){return arguments.length?(E=1-W,o):1-E},randomSource:function(W){return arguments.length?(z=W,s.forEach(H),o):z},force:function(W,he){return arguments.length>1?(he==null?s.delete(W):s.set(W,H(he)),o):s.get(W)},find:function(W,he,ve){var Ce=0,De=i.length,Se,Ie,We,mt,Te;for(ve==null?ve=1/0:ve*=ve,Ce=0;Ce<De;++Ce)mt=i[Ce],Se=W-mt.x,Ie=he-mt.y,We=Se*Se+Ie*Ie,We<ve&&(Te=mt,ve=We);return Te},on:function(W,he){return arguments.length>1?(M.on(W,he),o):M.on(W)}}}function CD(){var i,o,l,h,_=Tn(-30),x,E=1,s=1/0,A=.81;function M(j){var H,W=i.length,he=E_(i,TI,EI).visitAfter(L);for(h=j,H=0;H<W;++H)o=i[H],he.visit(F)}function z(){if(!!i){var j,H=i.length,W;for(x=new Array(H),j=0;j<H;++j)W=i[j],x[W.index]=+_(W,j,i)}}function L(j){var H=0,W,he,ve=0,Ce,De,Se;if(j.length){for(Ce=De=Se=0;Se<4;++Se)(W=j[Se])&&(he=Math.abs(W.value))&&(H+=W.value,ve+=he,Ce+=he*W.x,De+=he*W.y);j.x=Ce/ve,j.y=De/ve}else{W=j,W.x=W.data.x,W.y=W.data.y;do H+=x[W.data.index];while(W=W.next)}j.value=H}function F(j,H,W,he){if(!j.value)return!0;var ve=j.x-o.x,Ce=j.y-o.y,De=he-H,Se=ve*ve+Ce*Ce;if(De*De/A<Se)return Se<s&&(ve===0&&(ve=Wl(l),Se+=ve*ve),Ce===0&&(Ce=Wl(l),Se+=Ce*Ce),Se<E&&(Se=Math.sqrt(E*Se)),o.vx+=ve*j.value*h/Se,o.vy+=Ce*j.value*h/Se),!0;if(j.length||Se>=s)return;(j.data!==o||j.next)&&(ve===0&&(ve=Wl(l),Se+=ve*ve),Ce===0&&(Ce=Wl(l),Se+=Ce*Ce),Se<E&&(Se=Math.sqrt(E*Se)));do j.data!==o&&(De=x[j.data.index]*h/Se,o.vx+=ve*De,o.vy+=Ce*De);while(j=j.next)}return M.initialize=function(j,H){i=j,l=H,z()},M.strength=function(j){return arguments.length?(_=typeof j=="function"?j:Tn(+j),z(),M):_},M.distanceMin=function(j){return arguments.length?(E=j*j,M):Math.sqrt(E)},M.distanceMax=function(j){return arguments.length?(s=j*j,M):Math.sqrt(s)},M.theta=function(j){return arguments.length?(A=j*j,M):Math.sqrt(A)},M}function zD(i){var o=Tn(.1),l,h,_;typeof i!="function"&&(i=Tn(i==null?0:+i));function x(s){for(var A=0,M=l.length,z;A<M;++A)z=l[A],z.vx+=(_[A]-z.x)*h[A]*s}function E(){if(!!l){var s,A=l.length;for(h=new Array(A),_=new Array(A),s=0;s<A;++s)h[s]=isNaN(_[s]=+i(l[s],s,l))?0:+o(l[s],s,l)}}return x.initialize=function(s){l=s,E()},x.strength=function(s){return arguments.length?(o=typeof s=="function"?s:Tn(+s),E(),x):o},x.x=function(s){return arguments.length?(i=typeof s=="function"?s:Tn(+s),E(),x):i},x}function RD(i){var o=Tn(.1),l,h,_;typeof i!="function"&&(i=Tn(i==null?0:+i));function x(s){for(var A=0,M=l.length,z;A<M;++A)z=l[A],z.vy+=(_[A]-z.y)*h[A]*s}function E(){if(!!l){var s,A=l.length;for(h=new Array(A),_=new Array(A),s=0;s<A;++s)h[s]=isNaN(_[s]=+i(l[s],s,l))?0:+o(l[s],s,l)}}return x.initialize=function(s){l=s,E()},x.strength=function(s){return arguments.length?(o=typeof s=="function"?s:Tn(+s),E(),x):o},x.y=function(s){return arguments.length?(i=typeof s=="function"?s:Tn(+s),E(),x):i},x}var xx=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},bx={exports:{}};(function(i,o){(function(l,h){i.exports=h()})(xx,function(){var l,h,_;function x(s,A){if(!l)l=A;else if(!h)h=A;else{var M="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+h+")(sharedChunk); self.onerror = null;",z={};l(z),_=A(z),typeof window!="undefined"&&window&&window.URL&&window.URL.createObjectURL&&(_.workerUrl=window.URL.createObjectURL(new Blob([M],{type:"text/javascript"})))}}x(["exports"],function(s){var A=typeof self!="undefined"?self:{},M=z;function z(r,e,t,a){this.cx=3*r,this.bx=3*(t-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=a,this.p2x=t,this.p2y=a}z.prototype.sampleCurveX=function(r){return((this.ax*r+this.bx)*r+this.cx)*r},z.prototype.sampleCurveY=function(r){return((this.ay*r+this.by)*r+this.cy)*r},z.prototype.sampleCurveDerivativeX=function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},z.prototype.solveCurveX=function(r,e){var t,a,u,d,m;for(e===void 0&&(e=1e-6),u=r,m=0;m<8;m++){if(d=this.sampleCurveX(u)-r,Math.abs(d)<e)return u;var g=this.sampleCurveDerivativeX(u);if(Math.abs(g)<1e-6)break;u-=d/g}if((u=r)<(t=0))return t;if(u>(a=1))return a;for(;t<a;){if(d=this.sampleCurveX(u),Math.abs(d-r)<e)return u;r>d?t=u:a=u,u=.5*(a-t)+t}return u},z.prototype.solve=function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))};var L=F;function F(r,e){this.x=r,this.y=e}F.prototype={clone:function(){return new F(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,t=r.y-this.y;return e*e+t*t},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),t=Math.sin(r),a=t*this.x+e*this.y;return this.x=e*this.x-t*this.y,this.y=a,this},_rotateAround:function(r,e){var t=Math.cos(r),a=Math.sin(r),u=e.y+a*(this.x-e.x)+t*(this.y-e.y);return this.x=e.x+t*(this.x-e.x)-a*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},F.convert=function(r){return r instanceof F?r:Array.isArray(r)?new F(r[0],r[1]):r};const j=Math.PI/180,H=180/Math.PI;function W(r){return r*j}function he(r){return r*H}const ve=[[0,0],[1,0],[1,1],[0,1]];function Ce(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,t=e*r;return 4*(r<.5?t:3*(r-e)+t-.75)}function De(r,e,t,a){const u=new M(r,e,t,a);return function(d){return u.solve(d)}}const Se=De(.25,.1,.25,1);function Ie(r,e,t){return Math.min(t,Math.max(e,r))}function We(r,e,t){return(t=Ie((t-r)/(e-r),0,1))*t*(3-2*t)}function mt(r,e,t){const a=t-e,u=((r-e)%a+a)%a+e;return u===e?t:u}function Te(r,e,t){if(!r.length)return t(null,[]);let a=r.length;const u=new Array(r.length);let d=null;r.forEach((m,g)=>{e(m,(b,w)=>{b&&(d=b),u[g]=w,--a==0&&t(d,u)})})}function Ue(r){const e=[];for(const t in r)e.push(r[t]);return e}function Xe(r,...e){for(const t of e)for(const a in t)r[a]=t[a];return r}let tt=1;function Dt(){return tt++}function Ft(){return function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()}function zr(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function Kt(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)}function Rr(r,e){r.forEach(t=>{e[t]&&(e[t]=e[t].bind(e))})}function Wr(r,e){return r.indexOf(e,r.length-e.length)!==-1}function xr(r,e,t){const a={};for(const u in r)a[u]=e.call(t||this,r[u],u,r);return a}function Ht(r,e,t){const a={};for(const u in r)e.call(t||this,r[u],u,r)&&(a[u]=r[u]);return a}function Br(r){return Array.isArray(r)?r.map(Br):typeof r=="object"&&r?xr(r,Br):r}const wr={};function hr(r){wr[r]||(typeof console!="undefined"&&console.warn(r),wr[r]=!0)}function kr(r,e,t){return(t.y-r.y)*(e.x-r.x)>(e.y-r.y)*(t.x-r.x)}function Yr(r){let e=0;for(let t,a,u=0,d=r.length,m=d-1;u<d;m=u++)t=r[u],a=r[m],e+=(a.x-t.x)*(t.y+a.y);return e}function oi(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Ci(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(t,a,u,d)=>{const m=u||d;return e[a]=!m||m.toLowerCase(),""}),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let Fe=null;function He(r){if(Fe==null){const e=r.navigator?r.navigator.userAgent:null;Fe=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Fe}function $e(r){try{const e=A[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Ye(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}const dt=A.performance;function vt(r){const e=r?r.url.toString():void 0;return dt.getEntriesByName(e)}var St="2.10.0";let lt,er,mr,br;const Ar={now:()=>mr!==void 0?mr:A.performance.now(),setNow(r){mr=r},restoreNow(){mr=void 0},frame(r){const e=A.requestAnimationFrame(r);return{cancel:()=>A.cancelAnimationFrame(e)}},getImageData(r,e=0){const{width:t,height:a}=r;br||(br=A.document.createElement("canvas"));const u=br.getContext("2d");if(!u)throw new Error("failed to create canvas 2d context");return(t>br.width||a>br.height)&&(br.width=t,br.height=a),u.clearRect(-e,-e,t+2*e,a+2*e),u.drawImage(r,0,0,t,a),u.getImageData(-e,-e,t+2*e,a+2*e)},resolveURL:r=>(lt||(lt=A.document.createElement("a")),lt.href=r,lt.href),get devicePixelRatio(){return A.devicePixelRatio},get prefersReducedMotion(){return!!A.matchMedia&&(er==null&&(er=A.matchMedia("(prefers-reduced-motion: reduce)")),er.matches)}};let $r;const Rt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if($r==null){const r=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{$r={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):r}catch{$r=r}}return $r},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ir={supported:!1,testSupport:function(r){!ri&&ti&&(an?Dr(r):Pr=r)}};let Pr,ti,ri=!1,an=!1;function Dr(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,ti),r.isContextLost())return;ir.supported=!0}catch{}r.deleteTexture(e),ri=!0}A.document&&(ti=A.document.createElement("img"),ti.onload=function(){Pr&&Dr(Pr),Pr=null,an=!0},ti.onerror=function(){ri=!0,Pr=null},ti.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const or="01",jr="NO_ACCESS_TOKEN";function ii(r){return r.indexOf("mapbox:")===0}function zi(r){return Rt.API_URL_REGEX.test(r)}const gn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function si(r){const e=r.match(gn);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Ni(r){const e=r.params.length?`?${r.params.join("&")}`:"";return`${r.protocol}://${r.authority}${r.path}${e}`}function $o(r){if(!r)return null;const e=r.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(A.atob(e[1]).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Is{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const t=$o(Rt.ACCESS_TOKEN);let a="";return a=t&&t.u?A.btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,(u,d)=>String.fromCharCode(Number("0x"+d)))):Rt.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${a}`:`mapbox.eventData:${a}`}fetchEventData(){const e=$e("localStorage"),t=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{const u=A.localStorage.getItem(t);u&&(this.eventData=JSON.parse(u));const d=A.localStorage.getItem(a);d&&(this.anonId=d)}catch{hr("Unable to read from LocalStorage")}}saveEventData(){const e=$e("localStorage"),t=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{A.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&A.localStorage.setItem(t,JSON.stringify(this.eventData))}catch{hr("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,a,u){if(!Rt.EVENTS_URL)return;const d=si(Rt.EVENTS_URL);d.params.push(`access_token=${u||Rt.ACCESS_TOKEN||""}`);const m={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:St,skuId:or,userId:this.anonId},g=t?Xe(m,t):m,b={url:Ni(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([g])};this.pendingRequest=Ge(b,w=>{this.pendingRequest=null,a(w),this.saveEventData(),this.processRequests(u)})}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const Ms=new class extends Is{constructor(r){super("appUserTurnstile"),this._customAccessToken=r}postTurnstileEvent(r,e){Rt.EVENTS_URL&&Rt.ACCESS_TOKEN&&Array.isArray(r)&&r.some(t=>ii(t)||zi(t))&&this.queueRequest(Date.now(),e)}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=$o(Rt.ACCESS_TOKEN),t=e?e.u:Rt.ACCESS_TOKEN;let a=t!==this.eventData.tokenU;Kt(this.anonId)||(this.anonId=Ft(),a=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const d=new Date(this.eventData.lastSuccess),m=new Date(u),g=(u-this.eventData.lastSuccess)/864e5;a=a||g>=1||g<-1||d.getDate()!==m.getDate()}else a=!0;a?this.postEvent(u,{"enabled.telemetry":!1},d=>{d||(this.eventData.lastSuccess=u,this.eventData.tokenU=t)},r):this.processRequests()}},Cs=Ms.postTurnstileEvent.bind(Ms),zs=new class extends Is{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(r,e,t,a){this.skuToken=e,this.errorCb=a,Rt.EVENTS_URL&&(t||Rt.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},t):this.errorCb(new Error(jr)))}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:t}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Kt(this.anonId)||(this.anonId=Ft()),this.postEvent(t,{skuToken:this.skuToken},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},r))}},za=zs.postMapLoadEvent.bind(zs),Ra=new class extends Is{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(r,e,t,a){if(!Rt.API_URL||!Rt.SESSION_PATH)return;const u=si(Rt.API_URL+Rt.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${a||Rt.ACCESS_TOKEN||""}`);const d={url:Ni(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=ct(d,m=>{this.pendingRequest=null,t(m),this.saveEventData(),this.processRequests(a)})}getSessionAPI(r,e,t,a){this.skuToken=e,this.errorCb=a,Rt.SESSION_PATH&&Rt.API_URL&&(t||Rt.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},t):this.errorCb(new Error(jr)))}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:t}=this.queue.shift();e&&this.success[e]||this.getSession(t,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},r)}},rc=Ra.getSessionAPI.bind(Ra),Vn=new Set;let Sn,Go=500,ka=50,Ri={};function Rs(r){const e=V(r);let t,a;e&&e.forEach(d=>{const m=d.split("=");m[0]==="language"?t=m[1]:m[0]==="worldview"&&(a=m[1])});let u="mapbox-tiles";return t&&(u+=`-${t}`),a&&(u+=`-${a}`),u}function re(){try{return A.caches}catch{}}function N(r){const e=re();e&&!Ri[r]&&(Ri[r]=e.open(r))}function V(r){const e=r.indexOf("?");return e>0?r.slice(e+1).split("&"):[]}function ee(r){const e=r.indexOf("?");if(e<0)return r;const t=V(r).filter(a=>{const u=a.split("=");return u[0]==="language"||u[0]==="worldview"});return t.length?`${r.slice(0,e)}?${t.join("&")}`:r.slice(0,e)}let oe=1/0;const _e={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(_e);class we extends Error{constructor(e,t,a){t===401&&zi(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const xe=oi()?()=>self.worker&&self.worker.referrer:()=>(A.location.protocol==="blob:"?A.parent:A).location.href,ge=function(r,e){if(!(/^file:/.test(t=r.url)||/^file:/.test(xe())&&!/^\w+:/.test(t))){if(A.fetch&&A.Request&&A.AbortController&&A.Request.prototype.hasOwnProperty("signal"))return function(a,u){const d=new A.AbortController,m=new A.Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:xe(),signal:d.signal});let g=!1,b=!1;const w=(P=m.url).indexOf("sku=")>0&&zi(P);var P;a.type==="json"&&m.headers.set("Accept","application/json");const C=(O,B,$)=>{if(b)return;if(O&&O.message!=="SecurityError"&&hr(O),B&&$)return R(B);const q=Date.now();A.fetch(m).then(te=>{if(te.ok){const le=w?te.clone():null;return R(te,le,q)}return u(new we(te.statusText,te.status,a.url))}).catch(te=>{te.code!==20&&u(new Error(te.message))})},R=(O,B,$)=>{(a.type==="arrayBuffer"?O.arrayBuffer():a.type==="json"?O.json():O.text()).then(q=>{b||(B&&$&&function(te,le,ne){const se=Rs(te.url);if(N(se),!Ri[se])return;const me={status:le.status,statusText:le.statusText,headers:new A.Headers};le.headers.forEach((Pe,Oe)=>me.headers.set(Oe,Pe));const ce=Ci(le.headers.get("Cache-Control")||"");if(ce["no-store"])return;ce["max-age"]&&me.headers.set("Expires",new Date(ne+1e3*ce["max-age"]).toUTCString());const Me=me.headers.get("Expires");Me&&(new Date(Me).getTime()-ne<42e4||function(Pe,Oe){if(Sn===void 0)try{new Response(new ReadableStream),Sn=!0}catch{Sn=!1}Sn?Oe(Pe.body):Pe.blob().then(Oe)}(le,Pe=>{const Oe=new A.Response(Pe,me);N(se),Ri[se]&&Ri[se].then(rt=>rt.put(ee(te.url),Oe)).catch(rt=>hr(rt.message))}))}(m,B,$),g=!0,u(null,q,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(q=>{b||u(new Error(q.message))})};return w?function(O,B){const $=Rs(O.url);if(N($),!Ri[$])return B(null);const q=ee(O.url);Ri[$].then(te=>{te.match(q).then(le=>{const ne=function(se){if(!se)return!1;const me=new Date(se.headers.get("Expires")||0),ce=Ci(se.headers.get("Cache-Control")||"");return me>Date.now()&&!ce["no-cache"]}(le);te.delete(q),ne&&te.put(q,le.clone()),B(null,le,ne)}).catch(B)}).catch(B)}(m,C):C(null,null),{cancel:()=>{b=!0,g||d.abort()}}}(r,e);if(oi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var t;return function(a,u){const d=new A.XMLHttpRequest;d.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const m in a.headers)d.setRequestHeader(m,a.headers[m]);return a.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=a.credentials==="include",d.onerror=()=>{u(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let m=d.response;if(a.type==="json")try{m=JSON.parse(d.response)}catch(g){return u(g)}u(null,m,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else u(new we(d.statusText,d.status,a.url))},d.send(a.body),{cancel:()=>d.abort()}}(r,e)},Ee=function(r,e){return ge(Xe(r,{type:"arrayBuffer"}),e)},Ge=function(r,e){return ge(Xe(r,{method:"POST"}),e)},ct=function(r,e){return ge(Xe(r,{method:"GET"}),e)};function Qe(r){const e=A.document.createElement("a");return e.href=r,e.protocol===A.document.location.protocol&&e.host===A.document.location.host}const Et="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let At,yt;At=[],yt=0;const Pt=function(r,e){if(ir.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),yt>=Rt.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return At.push(d),d}yt++;let t=!1;const a=()=>{if(!t)for(t=!0,yt--;At.length&&yt<Rt.MAX_PARALLEL_IMAGE_REQUESTS;){const d=At.shift(),{requestParameters:m,callback:g,cancelled:b}=d;b||(d.cancel=Pt(m,g).cancel)}},u=Ee(r,(d,m,g,b)=>{a(),d?e(d):m&&(A.createImageBitmap?function(w,P){const C=new A.Blob([new Uint8Array(w)],{type:"image/png"});A.createImageBitmap(C).then(R=>{P(null,R)}).catch(R=>{P(new Error(`Could not load image because of ${R.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(w,P)=>e(w,P,g,b)):function(w,P){const C=new A.Image,R=A.URL;C.onload=()=>{P(null,C),R.revokeObjectURL(C.src),C.onload=null,A.requestAnimationFrame(()=>{C.src=Et})},C.onerror=()=>P(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const O=new A.Blob([new Uint8Array(w)],{type:"image/png"});C.src=w.byteLength?R.createObjectURL(O):Et}(m,(w,P)=>e(w,P,g,b)))});return{cancel:()=>{u.cancel(),a()}}};function Nt(r,e,t){t[r]&&t[r].indexOf(e)!==-1||(t[r]=t[r]||[],t[r].push(e))}function sr(r,e,t){if(t&&t[r]){const a=t[r].indexOf(e);a!==-1&&t[r].splice(a,1)}}class fr{constructor(e,t={}){Xe(this,t),this.type=e}}class ar extends fr{constructor(e,t={}){super("error",Xe({error:e},t))}}class Tt{on(e,t){return this._listeners=this._listeners||{},Nt(e,t,this._listeners),this}off(e,t){return sr(e,t,this._listeners),sr(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},Nt(e,t,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,t){typeof e=="string"&&(e=new fr(e,t||{}));const a=e.type;if(this.listens(a)){e.target=this;const u=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const g of u)g.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const g of d)sr(a,g,this._oneTimeListeners),g.call(this,e);const m=this._eventedParent;m&&(Xe(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof ar&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var ke=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ui(r,...e){for(const t of e)for(const a in t)r[a]=t[a];return r}function Nr(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function $n(r){if(Array.isArray(r))return r.map($n);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const t in r)e[t]=$n(r[t]);return e}return Nr(r)}class Da extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var ln=Da;class Oa{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[a,u]of t)this.bindings[a]=u}concat(e){return new Oa(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var lp=Oa;const qo={kind:"null"},ut={kind:"number"},Vt={kind:"string"},$t={kind:"boolean"},cn={kind:"color"},un={kind:"object"},Ot={kind:"value"},ks={kind:"collator"},Ds={kind:"formatted"},Os={kind:"resolvedImage"};function Vi(r,e){return{kind:"array",itemType:r,N:e}}function Or(r){if(r.kind==="array"){const e=Or(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const ah=[qo,ut,Vt,$t,cn,Ds,un,Vi(Ot),Os];function Zo(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Zo(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const t of ah)if(!Zo(t,e))return null}}return`Expected ${Or(r)} but found ${Or(e)} instead.`}function La(r,e){return e.some(t=>t.kind===r.kind)}function Gn(r,e){return e.some(t=>t==="null"?r===null:t==="array"?Array.isArray(r):t==="object"?r&&!Array.isArray(r)&&typeof r=="object":t===typeof r)}function ic(r){var e={exports:{}};return r(e,e.exports),e.exports}var qn=ic(function(r,e){var t={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function a(g){return(g=Math.round(g))<0?0:g>255?255:g}function u(g){return a(g[g.length-1]==="%"?parseFloat(g)/100*255:parseInt(g))}function d(g){return(b=g[g.length-1]==="%"?parseFloat(g)/100:parseFloat(g))<0?0:b>1?1:b;var b}function m(g,b,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?g+(b-g)*w*6:2*w<1?b:3*w<2?g+(b-g)*(2/3-w)*6:g}try{e.parseCSSColor=function(g){var b,w=g.replace(/ /g,"").toLowerCase();if(w in t)return t[w].slice();if(w[0]==="#")return w.length===4?(b=parseInt(w.substr(1),16))>=0&&b<=4095?[(3840&b)>>4|(3840&b)>>8,240&b|(240&b)>>4,15&b|(15&b)<<4,1]:null:w.length===7&&(b=parseInt(w.substr(1),16))>=0&&b<=16777215?[(16711680&b)>>16,(65280&b)>>8,255&b,1]:null;var P=w.indexOf("("),C=w.indexOf(")");if(P!==-1&&C+1===w.length){var R=w.substr(0,P),O=w.substr(P+1,C-(P+1)).split(","),B=1;switch(R){case"rgba":if(O.length!==4)return null;B=d(O.pop());case"rgb":return O.length!==3?null:[u(O[0]),u(O[1]),u(O[2]),B];case"hsla":if(O.length!==4)return null;B=d(O.pop());case"hsl":if(O.length!==3)return null;var $=(parseFloat(O[0])%360+360)%360/360,q=d(O[1]),te=d(O[2]),le=te<=.5?te*(q+1):te+q-te*q,ne=2*te-le;return[a(255*m(ne,le,$+1/3)),a(255*m(ne,le,$)),a(255*m(ne,le,$-1/3)),B];default:return null}}return null}}catch{}});class wi{constructor(e,t,a,u=1){this.r=e,this.g=t,this.b=a,this.a=u}static parse(e){if(!e)return;if(e instanceof wi)return e;if(typeof e!="string")return;const t=qn.parseCSSColor(e);return t?new wi(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,a,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(a)},${u})`}toArray(){const{r:e,g:t,b:a,a:u}=this;return u===0?[0,0,0,0]:[255*e/u,255*t/u,255*a/u,u]}toArray01(){const{r:e,g:t,b:a,a:u}=this;return u===0?[0,0,0,0]:[e/u,t/u,a/u,u]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:a,a:u}=this;return[e,t,a,u]}}wi.black=new wi(0,0,0,1),wi.white=new wi(1,1,1,1),wi.transparent=new wi(0,0,0,0),wi.red=new wi(1,0,0,1),wi.blue=new wi(0,0,1,1);var lr=wi;class nc{constructor(e,t,a){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ls{constructor(e,t,a,u,d){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=a,this.fontStack=u,this.textColor=d}}class ki{constructor(e){this.sections=e}static fromString(e){return new ki([new Ls(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof ki?e:ki.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const a={};t.fontStack&&(a["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(a["font-scale"]=t.scale),t.textColor&&(a["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(a)}return e}}class Di{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Di({name:e,available:!1}):null}serialize(){return["image",this.name]}}function oc(r,e,t,a){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[r,e,t,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[r,e,t,a]:[r,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Zn(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof lr||r instanceof nc||r instanceof ki||r instanceof Di)return!0;if(Array.isArray(r)){for(const e of r)if(!Zn(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!Zn(r[e]))return!1;return!0}return!1}function Zr(r){if(r===null)return qo;if(typeof r=="string")return Vt;if(typeof r=="boolean")return $t;if(typeof r=="number")return ut;if(r instanceof lr)return cn;if(r instanceof nc)return ks;if(r instanceof ki)return Ds;if(r instanceof Di)return Os;if(Array.isArray(r)){const e=r.length;let t;for(const a of r){const u=Zr(a);if(t){if(t===u)continue;t=Ot;break}t=u}return Vi(t||Ot,e)}return un}function Fs(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof lr||r instanceof ki||r instanceof Di?r.toString():JSON.stringify(r)}class sc{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(e.length!==2)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Zn(e[1]))return t.error("invalid value");const a=e[1];let u=Zr(a);const d=t.expectedType;return u.kind!=="array"||u.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(u=d),new sc(u,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof lr?["rgba"].concat(this.value.toArray()):this.value instanceof ki?this.value.serialize():this.value}}var Bs=sc,ai=class{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}};const js={string:Vt,number:ut,boolean:$t,object:un};class ac{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let a,u=1;const d=e[0];if(d==="array"){let g,b;if(e.length>2){const w=e[1];if(typeof w!="string"||!(w in js)||w==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);g=js[w],u++}else g=Ot;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);b=e[2],u++}a=Vi(g,b)}else a=js[d];const m=[];for(;u<e.length;u++){const g=t.parse(e[u],u,Ot);if(!g)return null;m.push(g)}return new ac(a,m)}evaluate(e){for(let t=0;t<this.args.length;t++){const a=this.args[t].evaluate(e);if(!Zo(this.type,Zr(a)))return a;if(t===this.args.length-1)throw new ai(`Expected value to be of type ${Or(this.type)}, but found ${Or(Zr(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,t=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){t.push(a.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&t.push(u)}}return t.concat(this.args.map(a=>a.serialize()))}}var Xi=ac;class Ns{constructor(e){this.type=Ds,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return t.error("First argument must be an image or text section.");const u=[];let d=!1;for(let m=1;m<=e.length-1;++m){const g=e[m];if(d&&typeof g=="object"&&!Array.isArray(g)){d=!1;let b=null;if(g["font-scale"]&&(b=t.parse(g["font-scale"],1,ut),!b))return null;let w=null;if(g["text-font"]&&(w=t.parse(g["text-font"],1,Vi(Vt)),!w))return null;let P=null;if(g["text-color"]&&(P=t.parse(g["text-color"],1,cn),!P))return null;const C=u[u.length-1];C.scale=b,C.font=w,C.textColor=P}else{const b=t.parse(e[m],1,Ot);if(!b)return null;const w=b.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,u.push({content:b,scale:null,font:null,textColor:null})}}return new Ns(u)}evaluate(e){return new ki(this.sections.map(t=>{const a=t.content.evaluate(e);return Zr(a)===Os?new Ls("",a,null,null,null):new Ls(Fs(a),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const a={};t.scale&&(a["font-scale"]=t.scale.serialize()),t.font&&(a["text-font"]=t.font.serialize()),t.textColor&&(a["text-color"]=t.textColor.serialize()),e.push(a)}return e}}class Fa{constructor(e){this.type=Os,this.input=e}static parse(e,t){if(e.length!==2)return t.error("Expected two arguments.");const a=t.parse(e[1],1,Vt);return a?new Fa(a):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),a=Di.fromString(t);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(t)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const cp={"to-boolean":$t,"to-color":cn,"to-number":ut,"to-string":Vt};class lc{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const a=e[0];if((a==="to-boolean"||a==="to-string")&&e.length!==2)return t.error("Expected one argument.");const u=cp[a],d=[];for(let m=1;m<e.length;m++){const g=t.parse(e[m],m,Ot);if(!g)return null;d.push(g)}return new lc(u,d)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let t,a;for(const u of this.args){if(t=u.evaluate(e),a=null,t instanceof lr)return t;if(typeof t=="string"){const d=e.parseColor(t);if(d)return d}else if(Array.isArray(t)&&(a=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:oc(t[0],t[1],t[2],t[3]),!a))return new lr(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new ai(a||`Could not parse color from value '${typeof t=="string"?t:String(JSON.stringify(t))}'`)}if(this.type.kind==="number"){let t=null;for(const a of this.args){if(t=a.evaluate(e),t===null)return 0;const u=Number(t);if(!isNaN(u))return u}throw new ai(`Could not convert ${JSON.stringify(t)} to number.`)}return this.type.kind==="formatted"?ki.fromString(Fs(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Di.fromString(Fs(this.args[0].evaluate(e))):Fs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ns([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Fa(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(t=>{e.push(t.serialize())}),e}}var Ho=lc;const up=["Unknown","Point","LineString","Polygon"];var lh=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?up[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:t,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(t*e-r[0])+this.featureDistanceData.bearing[1]*(a*e-r[1])}return 0}parseColor(r){let e=this._parseColorCache[r];return e||(e=this._parseColorCache[r]=lr.parse(r)),e}};class mo{constructor(e,t,a,u){this.name=e,this.type=t,this._evaluate=a,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,t){const a=e[0],u=mo.definitions[a];if(!u)return t.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(u)?u[0]:u.type,m=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,g=m.filter(([w])=>!Array.isArray(w)||w.length===e.length-1);let b=null;for(const[w,P]of g){b=new go(t.registry,t.path,null,t.scope);const C=[];let R=!1;for(let O=1;O<e.length;O++){const B=e[O],$=Array.isArray(w)?w[O-1]:w.type,q=b.parse(B,1+C.length,$);if(!q){R=!0;break}C.push(q)}if(!R)if(Array.isArray(w)&&w.length!==C.length)b.error(`Expected ${w.length} arguments, but found ${C.length} instead.`);else{for(let O=0;O<C.length;O++){const B=Array.isArray(w)?w[O]:w.type,$=C[O];b.concat(O+1).checkSubtype(B,$.type)}if(b.errors.length===0)return new mo(a,d,P,C)}}if(g.length===1)t.errors.push(...b.errors);else{const w=(g.length?g:m).map(([C])=>{return R=C,Array.isArray(R)?`(${R.map(Or).join(", ")})`:`(${Or(R.type)}...)`;var R}).join(" | "),P=[];for(let C=1;C<e.length;C++){const R=t.parse(e[C],1+P.length);if(!R)return null;P.push(Or(R.type))}t.error(`Expected arguments of type ${w}, but found (${P.join(", ")}) instead.`)}return null}static register(e,t){mo.definitions=t;for(const a in t)e[a]=mo}}var hn=mo;class Ba{constructor(e,t,a){this.type=ks,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(e.length!==2)return t.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return t.error("Collator options argument must be an object.");const u=t.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,$t);if(!u)return null;const d=t.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,$t);if(!d)return null;let m=null;return a.locale&&(m=t.parse(a.locale,1,Vt),!m)?null:new Ba(u,d,m)}evaluate(e){return new nc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Hn=8192;function cc(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function ja(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function hp(r,e){const t=(180+r[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(t*u*Hn),Math.round(a*u*Hn)]}function fp(r,e,t){const a=r[0]-e[0],u=r[1]-e[1],d=r[0]-t[0],m=r[1]-t[1];return a*m-d*u==0&&a*d<=0&&u*m<=0}function Na(r,e){let t=!1;for(let m=0,g=e.length;m<g;m++){const b=e[m];for(let w=0,P=b.length;w<P-1;w++){if(fp(r,b[w],b[w+1]))return!1;(u=b[w])[1]>(a=r)[1]!=(d=b[w+1])[1]>a[1]&&a[0]<(d[0]-u[0])*(a[1]-u[1])/(d[1]-u[1])+u[0]&&(t=!t)}}var a,u,d;return t}function Ua(r,e){for(let t=0;t<e.length;t++)if(Na(r,e[t]))return!0;return!1}function ch(r,e,t,a){const u=a[0]-t[0],d=a[1]-t[1],m=(r[0]-t[0])*d-u*(r[1]-t[1]),g=(e[0]-t[0])*d-u*(e[1]-t[1]);return m>0&&g<0||m<0&&g>0}function dp(r,e,t){for(const w of t)for(let P=0;P<w.length-1;++P)if((g=[(m=w[P+1])[0]-(d=w[P])[0],m[1]-d[1]])[0]*(b=[(u=e)[0]-(a=r)[0],u[1]-a[1]])[1]-g[1]*b[0]!=0&&ch(a,u,d,m)&&ch(d,m,a,u))return!0;var a,u,d,m,g,b;return!1}function uh(r,e){for(let t=0;t<r.length;++t)if(!Na(r[t],e))return!1;for(let t=0;t<r.length-1;++t)if(dp(r[t],r[t+1],e))return!1;return!0}function pp(r,e){for(let t=0;t<e.length;t++)if(uh(r,e[t]))return!0;return!1}function Qi(r,e,t){const a=[];for(let u=0;u<r.length;u++){const d=[];for(let m=0;m<r[u].length;m++){const g=hp(r[u][m],t);cc(e,g),d.push(g)}a.push(d)}return a}function uc(r,e,t){const a=[];for(let u=0;u<r.length;u++){const d=Qi(r[u],e,t);a.push(d)}return a}function hc(r,e,t,a){if(r[0]<t[0]||r[0]>t[2]){const u=.5*a;let d=r[0]-t[0]>u?-a:t[0]-r[0]>u?a:0;d===0&&(d=r[0]-t[2]>u?-a:t[2]-r[0]>u?a:0),r[0]+=d}cc(e,r)}function fc(r,e,t,a){const u=Math.pow(2,a.z)*Hn,d=[a.x*Hn,a.y*Hn],m=[];if(!r)return m;for(const g of r)for(const b of g){const w=[b.x+d[0],b.y+d[1]];hc(w,e,t,u),m.push(w)}return m}function dc(r,e,t,a){const u=Math.pow(2,a.z)*Hn,d=[a.x*Hn,a.y*Hn],m=[];if(!r)return m;for(const b of r){const w=[];for(const P of b){const C=[P.x+d[0],P.y+d[1]];cc(e,C),w.push(C)}m.push(w)}if(e[2]-e[0]<=u/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const b of m)for(const w of b)hc(w,e,t,u)}var g;return m}class Wo{constructor(e,t){this.type=$t,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Zn(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let u=0;u<a.features.length;++u){const d=a.features[u].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Wo(a,a.features[u].geometry)}else if(a.type==="Feature"){const u=a.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Wo(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Wo(a,a)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,a){const u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],m=t.canonicalID();if(!m)return!1;if(a.type==="Polygon"){const g=Qi(a.coordinates,d,m),b=fc(t.geometry(),u,d,m);if(!ja(u,d))return!1;for(const w of b)if(!Na(w,g))return!1}if(a.type==="MultiPolygon"){const g=uc(a.coordinates,d,m),b=fc(t.geometry(),u,d,m);if(!ja(u,d))return!1;for(const w of b)if(!Ua(w,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,a){const u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],m=t.canonicalID();if(!m)return!1;if(a.type==="Polygon"){const g=Qi(a.coordinates,d,m),b=dc(t.geometry(),u,d,m);if(!ja(u,d))return!1;for(const w of b)if(!uh(w,g))return!1}if(a.type==="MultiPolygon"){const g=uc(a.coordinates,d,m),b=dc(t.geometry(),u,d,m);if(!ja(u,d))return!1;for(const w of b)if(!pp(w,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Va=Wo;function _o(r){if(r instanceof hn&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Va)return!1;let e=!0;return r.eachChild(t=>{e&&!_o(t)&&(e=!1)}),e}function Wn(r){if(r instanceof hn&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(t=>{e&&!Wn(t)&&(e=!1)}),e}function Us(r,e){if(r instanceof hn&&e.indexOf(r.name)>=0)return!1;let t=!0;return r.eachChild(a=>{t&&!Us(a,e)&&(t=!1)}),t}class $a{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");const a=e[1];return t.scope.has(a)?new $a(a,t.scope.get(a)):t.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Ga=$a;class qa{constructor(e,t=[],a,u=new lp,d=[]){this.registry=e,this.path=t,this.key=t.map(m=>`[${m}]`).join(""),this.scope=u,this.errors=d,this.expectedType=a}parse(e,t,a,u,d={}){return t?this.concat(t,a,u)._parse(e,d):this._parse(e,d)}_parse(e,t){function a(u,d,m){return m==="assert"?new Xi(d,[u]):m==="coerce"?new Ho(d,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[u];if(d){let m=d.parse(e,this);if(!m)return null;if(this.expectedType){const g=this.expectedType,b=m.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||b.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(g,b))return null}else m=a(m,g,t.typeAnnotation||"coerce");else m=a(m,g,t.typeAnnotation||"assert")}if(!(m instanceof Bs)&&m.type.kind!=="resolvedImage"&&Jt(m)){const g=new lh;try{m=new Bs(m.type,m.evaluate(g))}catch(b){return this.error(b.message),null}}return m}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,a){const u=typeof e=="number"?this.path.concat(e):this.path,d=a?this.scope.concat(a):this.scope;return new qa(this.registry,u,t||null,d,this.errors)}error(e,...t){const a=`${this.key}${t.map(u=>`[${u}]`).join("")}`;this.errors.push(new ln(a,e))}checkSubtype(e,t){const a=Zo(e,t);return a&&this.error(a),a}}var go=qa;function Jt(r){if(r instanceof Ga)return Jt(r.boundExpression);if(r instanceof hn&&r.name==="error"||r instanceof Ba||r instanceof Va)return!1;const e=r instanceof Ho||r instanceof Xi;let t=!0;return r.eachChild(a=>{t=e?t&&Jt(a):t&&a instanceof Bs}),!!t&&_o(r)&&Us(r,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Za(r,e){const t=r.length-1;let a,u,d=0,m=t,g=0;for(;d<=m;)if(g=Math.floor((d+m)/2),a=r[g],u=r[g+1],a<=e){if(g===t||e<u)return g;d=g+1}else{if(!(a>e))throw new ai("Input is not a number.");m=g-1}return 0}class pc{constructor(e,t,a){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[u,d]of a)this.labels.push(u),this.outputs.push(d)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const a=t.parse(e[1],1,ut);if(!a)return null;const u=[];let d=null;t.expectedType&&t.expectedType.kind!=="value"&&(d=t.expectedType);for(let m=1;m<e.length;m+=2){const g=m===1?-1/0:e[m],b=e[m+1],w=m,P=m+1;if(typeof g!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(u.length&&u[u.length-1][0]>=g)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const C=t.parse(b,P,d);if(!C)return null;d=d||C.type,u.push([g,C])}return new pc(d,a,u)}evaluate(e){const t=this.labels,a=this.outputs;if(t.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=t[0])return a[0].evaluate(e);const d=t.length;return u>=t[d-1]?a[d-1].evaluate(e):a[Za(t,u)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var mc=pc;function Xt(r,e,t){return r*(1-t)+e*t}function Xo(r,e,t){return r.map((a,u)=>Xt(a,e[u],t))}var Vs=Object.freeze({__proto__:null,number:Xt,color:function(r,e,t){return new lr(Xt(r.r,e.r,t),Xt(r.g,e.g,t),Xt(r.b,e.b,t),Xt(r.a,e.a,t))},array:Xo});const _c=.95047,gc=1.08883,yc=4/29,Xn=6/29,$s=3*Xn*Xn,mp=Math.PI/180,vc=180/Math.PI;function Ha(r){return r>.008856451679035631?Math.pow(r,1/3):r/$s+yc}function xc(r){return r>Xn?r*r*r:$s*(r-yc)}function bc(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function Wa(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function hh(r){const e=Wa(r.r),t=Wa(r.g),a=Wa(r.b),u=Ha((.4124564*e+.3575761*t+.1804375*a)/_c),d=Ha((.2126729*e+.7151522*t+.072175*a)/1);return{l:116*d-16,a:500*(u-d),b:200*(d-Ha((.0193339*e+.119192*t+.9503041*a)/gc)),alpha:r.a}}function wc(r){let e=(r.l+16)/116,t=isNaN(r.a)?e:e+r.a/500,a=isNaN(r.b)?e:e-r.b/200;return e=1*xc(e),t=_c*xc(t),a=gc*xc(a),new lr(bc(3.2404542*t-1.5371385*e-.4985314*a),bc(-.969266*t+1.8760108*e+.041556*a),bc(.0556434*t-.2040259*e+1.0572252*a),r.alpha)}function fh(r,e,t){const a=e-r;return r+t*(a>180||a<-180?a-360*Math.round(a/360):a)}const Gs={forward:hh,reverse:wc,interpolate:function(r,e,t){return{l:Xt(r.l,e.l,t),a:Xt(r.a,e.a,t),b:Xt(r.b,e.b,t),alpha:Xt(r.alpha,e.alpha,t)}}},Qo={forward:function(r){const{l:e,a:t,b:a}=hh(r),u=Math.atan2(a,t)*vc;return{h:u<0?u+360:u,c:Math.sqrt(t*t+a*a),l:e,alpha:r.a}},reverse:function(r){const e=r.h*mp,t=r.c;return wc({l:r.l,a:Math.cos(e)*t,b:Math.sin(e)*t,alpha:r.alpha})},interpolate:function(r,e,t){return{h:fh(r.h,e.h,t),c:Xt(r.c,e.c,t),l:Xt(r.l,e.l,t),alpha:Xt(r.alpha,e.alpha,t)}}};var dh=Object.freeze({__proto__:null,lab:Gs,hcl:Qo});class qs{constructor(e,t,a,u,d){this.type=e,this.operator=t,this.interpolation=a,this.input=u,this.labels=[],this.outputs=[];for(const[m,g]of d)this.labels.push(m),this.outputs.push(g)}static interpolationFactor(e,t,a,u){let d=0;if(e.name==="exponential")d=Xa(t,e.base,a,u);else if(e.name==="linear")d=Xa(t,1,a,u);else if(e.name==="cubic-bezier"){const m=e.controlPoints;d=new M(m[0],m[1],m[2],m[3]).solve(Xa(t,1,a,u))}return d}static parse(e,t){let[a,u,d,...m]=e;if(!Array.isArray(u)||u.length===0)return t.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const w=u[1];if(typeof w!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:w}}else{if(u[0]!=="cubic-bezier")return t.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const w=u.slice(1);if(w.length!==4||w.some(P=>typeof P!="number"||P<0||P>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(d=t.parse(d,2,ut),!d)return null;const g=[];let b=null;a==="interpolate-hcl"||a==="interpolate-lab"?b=cn:t.expectedType&&t.expectedType.kind!=="value"&&(b=t.expectedType);for(let w=0;w<m.length;w+=2){const P=m[w],C=m[w+1],R=w+3,O=w+4;if(typeof P!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(g.length&&g[g.length-1][0]>=P)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const B=t.parse(C,O,b);if(!B)return null;b=b||B.type,g.push([P,B])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new qs(b,a,u,d,g):t.error(`Type ${Or(b)} is not interpolatable.`)}evaluate(e){const t=this.labels,a=this.outputs;if(t.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=t[0])return a[0].evaluate(e);const d=t.length;if(u>=t[d-1])return a[d-1].evaluate(e);const m=Za(t,u),g=qs.interpolationFactor(this.interpolation,u,t[m],t[m+1]),b=a[m].evaluate(e),w=a[m+1].evaluate(e);return this.operator==="interpolate"?Vs[this.type.kind.toLowerCase()](b,w,g):this.operator==="interpolate-hcl"?Qo.reverse(Qo.interpolate(Qo.forward(b),Qo.forward(w),g)):Gs.reverse(Gs.interpolate(Gs.forward(b),Gs.forward(w),g))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)t.push(this.labels[a],this.outputs[a].serialize());return t}}function Xa(r,e,t,a){const u=a-t,d=r-t;return u===0?0:e===1?d/u:(Math.pow(e,d)-1)/(Math.pow(e,u)-1)}var yn=qs;class Tc{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let a=null;const u=t.expectedType;u&&u.kind!=="value"&&(a=u);const d=[];for(const g of e.slice(1)){const b=t.parse(g,1+d.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,d.push(b)}const m=u&&d.some(g=>Zo(u,g.type));return new Tc(m?Ot:a,d)}evaluate(e){let t,a=null,u=0;for(const d of this.args){if(u++,a=d.evaluate(e),a&&a instanceof Di&&!a.available&&(t||(t=a),a=null,u===this.args.length))return t;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var ph=Tc;class Ec{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let d=1;d<e.length-1;d+=2){const m=e[d];if(typeof m!="string")return t.error(`Expected string, but found ${typeof m} instead.`,d);if(/[^a-zA-Z0-9_]/.test(m))return t.error("Variable names must contain only alphanumeric characters or '_'.",d);const g=t.parse(e[d+1],d+1);if(!g)return null;a.push([m,g])}const u=t.parse(e[e.length-1],e.length-1,t.expectedType,a);return u?new Ec(a,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,a]of this.bindings)e.push(t,a.serialize());return e.push(this.result.serialize()),e}}var mh=Ec;class Sc{constructor(e,t,a){this.type=e,this.index=t,this.input=a}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=t.parse(e[1],1,ut),u=t.parse(e[2],2,Vi(t.expectedType||Ot));return a&&u?new Sc(u.type.itemType,a,u):null}evaluate(e){const t=this.index.evaluate(e),a=this.input.evaluate(e);if(t<0)throw new ai(`Array index out of bounds: ${t} < 0.`);if(t>=a.length)throw new ai(`Array index out of bounds: ${t} > ${a.length-1}.`);if(t!==Math.floor(t))throw new ai(`Array index must be an integer, but found ${t} instead.`);return a[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var _h=Sc;class Ac{constructor(e,t){this.type=$t,this.needle=e,this.haystack=t}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=t.parse(e[1],1,Ot),u=t.parse(e[2],2,Ot);return a&&u?La(a.type,[$t,Vt,ut,qo,Ot])?new Ac(a,u):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Or(a.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!Gn(t,["boolean","string","number","null"]))throw new ai(`Expected first argument to be of type boolean, string, number or null, but found ${Or(Zr(t))} instead.`);if(!Gn(a,["string","array"]))throw new ai(`Expected second argument to be of type array or string, but found ${Or(Zr(a))} instead.`);return a.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var _p=Ac;class Qa{constructor(e,t,a){this.type=ut,this.needle=e,this.haystack=t,this.fromIndex=a}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=t.parse(e[1],1,Ot),u=t.parse(e[2],2,Ot);if(!a||!u)return null;if(!La(a.type,[$t,Vt,ut,qo,Ot]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Or(a.type)} instead`);if(e.length===4){const d=t.parse(e[3],3,ut);return d?new Qa(a,u,d):null}return new Qa(a,u)}evaluate(e){const t=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Gn(t,["boolean","string","number","null"]))throw new ai(`Expected first argument to be of type boolean, string, number or null, but found ${Or(Zr(t))} instead.`);if(!Gn(a,["string","array"]))throw new ai(`Expected second argument to be of type array or string, but found ${Or(Zr(a))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return a.indexOf(t,u)}return a.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var gp=Qa;class Ya{constructor(e,t,a,u,d,m){this.inputType=e,this.type=t,this.input=a,this.cases=u,this.outputs=d,this.otherwise=m}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let a,u;t.expectedType&&t.expectedType.kind!=="value"&&(u=t.expectedType);const d={},m=[];for(let w=2;w<e.length-1;w+=2){let P=e[w];const C=e[w+1];Array.isArray(P)||(P=[P]);const R=t.concat(w);if(P.length===0)return R.error("Expected at least one branch label.");for(const B of P){if(typeof B!="number"&&typeof B!="string")return R.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return R.error("Numeric branch labels must be integer values.");if(a){if(R.checkSubtype(a,Zr(B)))return null}else a=Zr(B);if(d[String(B)]!==void 0)return R.error("Branch labels must be unique.");d[String(B)]=m.length}const O=t.parse(C,w,u);if(!O)return null;u=u||O.type,m.push(O)}const g=t.parse(e[1],1,Ot);if(!g)return null;const b=t.parse(e[e.length-1],e.length-1,u);return b?g.type.kind!=="value"&&t.concat(1).checkSubtype(a,g.type)?null:new Ya(a,u,g,d,m,b):null}evaluate(e){const t=this.input.evaluate(e);return(Zr(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),a=[],u={};for(const m of t){const g=u[this.cases[m]];g===void 0?(u[this.cases[m]]=a.length,a.push([this.cases[m],[m]])):a[g][1].push(m)}const d=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,g]of a)e.push(g.length===1?d(g[0]):g.map(d)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}var gh=Ya;class Ka{constructor(e,t,a){this.type=e,this.branches=t,this.otherwise=a}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let a;t.expectedType&&t.expectedType.kind!=="value"&&(a=t.expectedType);const u=[];for(let m=1;m<e.length-1;m+=2){const g=t.parse(e[m],m,$t);if(!g)return null;const b=t.parse(e[m+1],m+1,a);if(!b)return null;u.push([g,b]),a=a||b.type}const d=t.parse(e[e.length-1],e.length-1,a);return d?new Ka(a,u,d):null}evaluate(e){for(const[t,a]of this.branches)if(t.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,a]of this.branches)e(t),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var yp=Ka;class Ja{constructor(e,t,a,u){this.type=e,this.input=t,this.beginIndex=a,this.endIndex=u}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=t.parse(e[1],1,Ot),u=t.parse(e[2],2,ut);if(!a||!u)return null;if(!La(a.type,[Vi(Ot),Vt,Ot]))return t.error(`Expected first argument to be of type array or string, but found ${Or(a.type)} instead`);if(e.length===4){const d=t.parse(e[3],3,ut);return d?new Ja(a.type,a,u,d):null}return new Ja(a.type,a,u)}evaluate(e){const t=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Gn(t,["string","array"]))throw new ai(`Expected first argument to be of type array or string, but found ${Or(Zr(t))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return t.slice(a,u)}return t.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var yh=Ja;function Pc(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Ic(r,e,t,a){return a.compare(e,t)===0}function Yo(r,e,t){const a=r!=="=="&&r!=="!=";return class wx{constructor(d,m,g){this.type=$t,this.lhs=d,this.rhs=m,this.collator=g,this.hasUntypedArgument=d.type.kind==="value"||m.type.kind==="value"}static parse(d,m){if(d.length!==3&&d.length!==4)return m.error("Expected two or three arguments.");const g=d[0];let b=m.parse(d[1],1,Ot);if(!b)return null;if(!Pc(g,b.type))return m.concat(1).error(`"${g}" comparisons are not supported for type '${Or(b.type)}'.`);let w=m.parse(d[2],2,Ot);if(!w)return null;if(!Pc(g,w.type))return m.concat(2).error(`"${g}" comparisons are not supported for type '${Or(w.type)}'.`);if(b.type.kind!==w.type.kind&&b.type.kind!=="value"&&w.type.kind!=="value")return m.error(`Cannot compare types '${Or(b.type)}' and '${Or(w.type)}'.`);a&&(b.type.kind==="value"&&w.type.kind!=="value"?b=new Xi(w.type,[b]):b.type.kind!=="value"&&w.type.kind==="value"&&(w=new Xi(b.type,[w])));let P=null;if(d.length===4){if(b.type.kind!=="string"&&w.type.kind!=="string"&&b.type.kind!=="value"&&w.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(P=m.parse(d[3],3,ks),!P)return null}return new wx(b,w,P)}evaluate(d){const m=this.lhs.evaluate(d),g=this.rhs.evaluate(d);if(a&&this.hasUntypedArgument){const b=Zr(m),w=Zr(g);if(b.kind!==w.kind||b.kind!=="string"&&b.kind!=="number")throw new ai(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${b.kind}, ${w.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const b=Zr(m),w=Zr(g);if(b.kind!=="string"||w.kind!=="string")return e(d,m,g)}return this.collator?t(d,m,g,this.collator.evaluate(d)):e(d,m,g)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[r];return this.eachChild(m=>{d.push(m.serialize())}),d}}}const vp=Yo("==",function(r,e,t){return e===t},Ic),xp=Yo("!=",function(r,e,t){return e!==t},function(r,e,t,a){return!Ic(0,e,t,a)}),bp=Yo("<",function(r,e,t){return e<t},function(r,e,t,a){return a.compare(e,t)<0}),el=Yo(">",function(r,e,t){return e>t},function(r,e,t,a){return a.compare(e,t)>0}),vh=Yo("<=",function(r,e,t){return e<=t},function(r,e,t,a){return a.compare(e,t)<=0}),xh=Yo(">=",function(r,e,t){return e>=t},function(r,e,t,a){return a.compare(e,t)>=0});class Mc{constructor(e,t,a,u,d,m){this.type=Vt,this.number=e,this.locale=t,this.currency=a,this.unit=u,this.minFractionDigits=d,this.maxFractionDigits=m}static parse(e,t){if(e.length!==3)return t.error("Expected two arguments.");const a=t.parse(e[1],1,ut);if(!a)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return t.error("NumberFormat options argument must be an object.");let d=null;if(u.locale&&(d=t.parse(u.locale,1,Vt),!d))return null;let m=null;if(u.currency&&(m=t.parse(u.currency,1,Vt),!m))return null;let g=null;if(u.unit&&(g=t.parse(u.unit,1,Vt),!g))return null;let b=null;if(u["min-fraction-digits"]&&(b=t.parse(u["min-fraction-digits"],1,ut),!b))return null;let w=null;return u["max-fraction-digits"]&&(w=t.parse(u["max-fraction-digits"],1,ut),!w)?null:new Mc(a,d,m,g,b,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Cc{constructor(e){this.type=ut,this.input=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=t.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?t.error(`Expected argument of type string or array, but found ${Or(a.type)} instead.`):new Cc(a):null}evaluate(e){const t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new ai(`Expected value to be of type string or array, but found ${Or(Zr(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(t=>{e.push(t.serialize())}),e}}const bh={"==":vp,"!=":xp,">":el,"<":bp,">=":xh,"<=":vh,array:Xi,at:_h,boolean:Xi,case:yp,coalesce:ph,collator:Ba,format:Ns,image:Fa,in:_p,"index-of":gp,interpolate:yn,"interpolate-hcl":yn,"interpolate-lab":yn,length:Cc,let:mh,literal:Bs,match:gh,number:Xi,"number-format":Mc,object:Xi,slice:yh,step:mc,string:Xi,"to-boolean":Ho,"to-color":Ho,"to-number":Ho,"to-string":Ho,var:Ga,within:Va};function zc(r,[e,t,a,u]){e=e.evaluate(r),t=t.evaluate(r),a=a.evaluate(r);const d=u?u.evaluate(r):1,m=oc(e,t,a,d);if(m)throw new ai(m);return new lr(e/255*d,t/255*d,a/255*d,d)}function Rc(r,e){return r in e}function tl(r,e){const t=e[r];return t===void 0?null:t}function An(r){return{type:r}}hn.register(bh,{error:[{kind:"error"},[Vt],(r,[e])=>{throw new ai(e.evaluate(r))}],typeof:[Vt,[Ot],(r,[e])=>Or(Zr(e.evaluate(r)))],"to-rgba":[Vi(ut,4),[cn],(r,[e])=>e.evaluate(r).toArray()],rgb:[cn,[ut,ut,ut],zc],rgba:[cn,[ut,ut,ut,ut],zc],has:{type:$t,overloads:[[[Vt],(r,[e])=>Rc(e.evaluate(r),r.properties())],[[Vt,un],(r,[e,t])=>Rc(e.evaluate(r),t.evaluate(r))]]},get:{type:Ot,overloads:[[[Vt],(r,[e])=>tl(e.evaluate(r),r.properties())],[[Vt,un],(r,[e,t])=>tl(e.evaluate(r),t.evaluate(r))]]},"feature-state":[Ot,[Vt],(r,[e])=>tl(e.evaluate(r),r.featureState||{})],properties:[un,[],r=>r.properties()],"geometry-type":[Vt,[],r=>r.geometryType()],id:[Ot,[],r=>r.id()],zoom:[ut,[],r=>r.globals.zoom],pitch:[ut,[],r=>r.globals.pitch||0],"distance-from-center":[ut,[],r=>r.distanceFromCenter()],"heatmap-density":[ut,[],r=>r.globals.heatmapDensity||0],"line-progress":[ut,[],r=>r.globals.lineProgress||0],"sky-radial-progress":[ut,[],r=>r.globals.skyRadialProgress||0],accumulated:[Ot,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[ut,An(ut),(r,e)=>{let t=0;for(const a of e)t+=a.evaluate(r);return t}],"*":[ut,An(ut),(r,e)=>{let t=1;for(const a of e)t*=a.evaluate(r);return t}],"-":{type:ut,overloads:[[[ut,ut],(r,[e,t])=>e.evaluate(r)-t.evaluate(r)],[[ut],(r,[e])=>-e.evaluate(r)]]},"/":[ut,[ut,ut],(r,[e,t])=>e.evaluate(r)/t.evaluate(r)],"%":[ut,[ut,ut],(r,[e,t])=>e.evaluate(r)%t.evaluate(r)],ln2:[ut,[],()=>Math.LN2],pi:[ut,[],()=>Math.PI],e:[ut,[],()=>Math.E],"^":[ut,[ut,ut],(r,[e,t])=>Math.pow(e.evaluate(r),t.evaluate(r))],sqrt:[ut,[ut],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[ut,[ut],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[ut,[ut],(r,[e])=>Math.log(e.evaluate(r))],log2:[ut,[ut],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[ut,[ut],(r,[e])=>Math.sin(e.evaluate(r))],cos:[ut,[ut],(r,[e])=>Math.cos(e.evaluate(r))],tan:[ut,[ut],(r,[e])=>Math.tan(e.evaluate(r))],asin:[ut,[ut],(r,[e])=>Math.asin(e.evaluate(r))],acos:[ut,[ut],(r,[e])=>Math.acos(e.evaluate(r))],atan:[ut,[ut],(r,[e])=>Math.atan(e.evaluate(r))],min:[ut,An(ut),(r,e)=>Math.min(...e.map(t=>t.evaluate(r)))],max:[ut,An(ut),(r,e)=>Math.max(...e.map(t=>t.evaluate(r)))],abs:[ut,[ut],(r,[e])=>Math.abs(e.evaluate(r))],round:[ut,[ut],(r,[e])=>{const t=e.evaluate(r);return t<0?-Math.round(-t):Math.round(t)}],floor:[ut,[ut],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[ut,[ut],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[$t,[Vt,Ot],(r,[e,t])=>r.properties()[e.value]===t.value],"filter-id-==":[$t,[Ot],(r,[e])=>r.id()===e.value],"filter-type-==":[$t,[Vt],(r,[e])=>r.geometryType()===e.value],"filter-<":[$t,[Vt,Ot],(r,[e,t])=>{const a=r.properties()[e.value],u=t.value;return typeof a==typeof u&&a<u}],"filter-id-<":[$t,[Ot],(r,[e])=>{const t=r.id(),a=e.value;return typeof t==typeof a&&t<a}],"filter->":[$t,[Vt,Ot],(r,[e,t])=>{const a=r.properties()[e.value],u=t.value;return typeof a==typeof u&&a>u}],"filter-id->":[$t,[Ot],(r,[e])=>{const t=r.id(),a=e.value;return typeof t==typeof a&&t>a}],"filter-<=":[$t,[Vt,Ot],(r,[e,t])=>{const a=r.properties()[e.value],u=t.value;return typeof a==typeof u&&a<=u}],"filter-id-<=":[$t,[Ot],(r,[e])=>{const t=r.id(),a=e.value;return typeof t==typeof a&&t<=a}],"filter->=":[$t,[Vt,Ot],(r,[e,t])=>{const a=r.properties()[e.value],u=t.value;return typeof a==typeof u&&a>=u}],"filter-id->=":[$t,[Ot],(r,[e])=>{const t=r.id(),a=e.value;return typeof t==typeof a&&t>=a}],"filter-has":[$t,[Ot],(r,[e])=>e.value in r.properties()],"filter-has-id":[$t,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[$t,[Vi(Vt)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[$t,[Vi(Ot)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[$t,[Vt,Vi(Ot)],(r,[e,t])=>t.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[$t,[Vt,Vi(Ot)],(r,[e,t])=>function(a,u,d,m){for(;d<=m;){const g=d+m>>1;if(u[g]===a)return!0;u[g]>a?m=g-1:d=g+1}return!1}(r.properties()[e.value],t.value,0,t.value.length-1)],all:{type:$t,overloads:[[[$t,$t],(r,[e,t])=>e.evaluate(r)&&t.evaluate(r)],[An($t),(r,e)=>{for(const t of e)if(!t.evaluate(r))return!1;return!0}]]},any:{type:$t,overloads:[[[$t,$t],(r,[e,t])=>e.evaluate(r)||t.evaluate(r)],[An($t),(r,e)=>{for(const t of e)if(t.evaluate(r))return!0;return!1}]]},"!":[$t,[$t],(r,[e])=>!e.evaluate(r)],"is-supported-script":[$t,[Vt],(r,[e])=>{const t=r.globals&&r.globals.isSupportedScript;return!t||t(e.evaluate(r))}],upcase:[Vt,[Vt],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[Vt,[Vt],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[Vt,An(Ot),(r,e)=>e.map(t=>Fs(t.evaluate(r))).join("")],"resolved-locale":[Vt,[ks],(r,[e])=>e.evaluate(r).resolvedLocale()]});var Zs=bh;function wh(r){return{result:"success",value:r}}function Ko(r){return{result:"error",value:r}}function Jo(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function Th(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function kc(r){return!!r.expression&&r.expression.interpolated}function tr(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Hs(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Eh(r){return r}function Ws(r,e){const t=e.type==="color",a=r.stops&&typeof r.stops[0][0]=="object",u=a||!(a||r.property!==void 0),d=r.type||(kc(e)?"exponential":"interval");if(t&&((r=Ui({},r)).stops&&(r.stops=r.stops.map(w=>[w[0],lr.parse(w[1])])),r.default=lr.parse(r.default?r.default:e.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!dh[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let m,g,b;if(d==="exponential")m=Dc;else if(d==="interval")m=Qn;else if(d==="categorical"){m=wp,g=Object.create(null);for(const w of r.stops)g[w[0]]=w[1];b=typeof r.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);m=es}if(a){const w={},P=[];for(let O=0;O<r.stops.length;O++){const B=r.stops[O],$=B[0].zoom;w[$]===void 0&&(w[$]={zoom:$,type:r.type,property:r.property,default:r.default,stops:[]},P.push($)),w[$].stops.push([B[0].value,B[1]])}const C=[];for(const O of P)C.push([w[O].zoom,Ws(w[O],e)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:yn.interpolationFactor.bind(void 0,R),zoomStops:C.map(O=>O[0]),evaluate:({zoom:O},B)=>Dc({stops:C,base:r.base},e,O).evaluate(O,B)}}if(u){const w=d==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:yn.interpolationFactor.bind(void 0,w),zoomStops:r.stops.map(P=>P[0]),evaluate:({zoom:P})=>m(r,e,P,g,b)}}return{kind:"source",evaluate(w,P){const C=P&&P.properties?P.properties[r.property]:void 0;return C===void 0?Xs(r.default,e.default):m(r,e,C,g,b)}}}function Xs(r,e,t){return r!==void 0?r:e!==void 0?e:t!==void 0?t:void 0}function wp(r,e,t,a,u){return Xs(typeof t===u?a[t]:void 0,r.default,e.default)}function Qn(r,e,t){if(tr(t)!=="number")return Xs(r.default,e.default);const a=r.stops.length;if(a===1||t<=r.stops[0][0])return r.stops[0][1];if(t>=r.stops[a-1][0])return r.stops[a-1][1];const u=Za(r.stops.map(d=>d[0]),t);return r.stops[u][1]}function Dc(r,e,t){const a=r.base!==void 0?r.base:1;if(tr(t)!=="number")return Xs(r.default,e.default);const u=r.stops.length;if(u===1||t<=r.stops[0][0])return r.stops[0][1];if(t>=r.stops[u-1][0])return r.stops[u-1][1];const d=Za(r.stops.map(P=>P[0]),t),m=function(P,C,R,O){const B=O-R,$=P-R;return B===0?0:C===1?$/B:(Math.pow(C,$)-1)/(Math.pow(C,B)-1)}(t,a,r.stops[d][0],r.stops[d+1][0]),g=r.stops[d][1],b=r.stops[d+1][1];let w=Vs[e.type]||Eh;if(r.colorSpace&&r.colorSpace!=="rgb"){const P=dh[r.colorSpace];w=(C,R)=>P.reverse(P.interpolate(P.forward(C),P.forward(R),m))}return typeof g.evaluate=="function"?{evaluate(...P){const C=g.evaluate.apply(void 0,P),R=b.evaluate.apply(void 0,P);if(C!==void 0&&R!==void 0)return w(C,R,m)}}:w(g,b,m)}function es(r,e,t){return e.type==="color"?t=lr.parse(t):e.type==="formatted"?t=ki.fromString(t.toString()):e.type==="resolvedImage"?t=Di.fromString(t.toString()):tr(t)===e.type||e.type==="enum"&&e.values[t]||(t=void 0),Xs(t,r.default,e.default)}class Oc{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new lh,this._defaultValue=t?function(a){return a.type==="color"&&(Hs(a.default)||Array.isArray(a.default))?new lr(0,0,0,0):a.type==="color"?lr.parse(a.default)||null:a.default===void 0?null:a.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null}evaluateWithoutErrorHandling(e,t,a,u,d,m,g,b){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=a,this._evaluator.canonical=u||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,a,u,d,m,g,b){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=a||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=b||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new ai(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console!="undefined"&&console.warn(w.message)),this._defaultValue}}}function rl(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Zs}function ts(r,e){const t=new go(Zs,[],e?function(u){const d={color:cn,string:Vt,number:ut,enum:Vt,boolean:$t,formatted:Ds,resolvedImage:Os};return u.type==="array"?Vi(d[u.value]||Ot,u.length):d[u.type]}(e):void 0),a=t.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?wh(new Oc(a,e)):Ko(t.errors)}class Lc{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!Wn(t.expression)}evaluateWithoutErrorHandling(e,t,a,u,d,m){return this._styleExpression.evaluateWithoutErrorHandling(e,t,a,u,d,m)}evaluate(e,t,a,u,d,m){return this._styleExpression.evaluate(e,t,a,u,d,m)}}class Qs{constructor(e,t,a,u){this.kind=e,this.zoomStops=a,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!Wn(t.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,t,a,u,d,m){return this._styleExpression.evaluateWithoutErrorHandling(e,t,a,u,d,m)}evaluate(e,t,a,u,d,m){return this._styleExpression.evaluate(e,t,a,u,d,m)}interpolationFactor(e,t,a){return this.interpolationType?yn.interpolationFactor(this.interpolationType,e,t,a):0}}function Fc(r,e){if((r=ts(r,e)).result==="error")return r;const t=r.value.expression,a=_o(t);if(!a&&!Jo(e))return Ko([new ln("","data expressions not supported")]);const u=Us(t,["zoom","pitch","distance-from-center"]);if(!u&&!Th(e))return Ko([new ln("","zoom expressions not supported")]);const d=is(t);return d||u?d instanceof ln?Ko([d]):d instanceof yn&&!kc(e)?Ko([new ln("",'"interpolate" expressions cannot be used with this property')]):wh(d?new Qs(a?"camera":"composite",r.value,d.labels,d instanceof yn?d.interpolation:void 0):new Lc(a?"constant":"source",r.value)):Ko([new ln("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class rs{constructor(e,t){this._parameters=e,this._specification=t,Ui(this,Ws(this._parameters,this._specification))}static deserialize(e){return new rs(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function is(r){let e=null;if(r instanceof mh)e=is(r.result);else if(r instanceof ph){for(const t of r.args)if(e=is(t),e)break}else(r instanceof mc||r instanceof yn)&&r.input instanceof hn&&r.input.name==="zoom"&&(e=r);return e instanceof ln||r.eachChild(t=>{const a=is(t);a instanceof ln?e=a:!e&&a?e=new ln("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new ln("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class ht{constructor(e,t,a,u){this.message=(e?`${e}: `:"")+a,u&&(this.identifier=u),t!=null&&t.__line__&&(this.line=t.__line__)}}function $i(r){const e=r.key,t=r.value,a=r.valueSpec||{},u=r.objectElementValidators||{},d=r.style,m=r.styleSpec;let g=[];const b=tr(t);if(b!=="object")return[new ht(e,t,`object expected, ${b} found`)];for(const w in t){const P=w.split(".")[0],C=a[P]||a["*"];let R;u[P]?R=u[P]:a[P]?R=ci:u["*"]?R=u["*"]:a["*"]&&(R=ci),R?g=g.concat(R({key:(e&&`${e}.`)+w,value:t[w],valueSpec:C,style:d,styleSpec:m,object:t,objectKey:w},t)):g.push(new ht(e,t[w],`unknown property "${w}"`))}for(const w in a)u[w]||a[w].required&&a[w].default===void 0&&t[w]===void 0&&g.push(new ht(e,t,`missing required property "${w}"`));return g}function Bc(r){const e=r.value,t=r.valueSpec,a=r.style,u=r.styleSpec,d=r.key,m=r.arrayElementValidator||ci;if(tr(e)!=="array")return[new ht(d,e,`array expected, ${tr(e)} found`)];if(t.length&&e.length!==t.length)return[new ht(d,e,`array length ${t.length} expected, length ${e.length} found`)];if(t["min-length"]&&e.length<t["min-length"])return[new ht(d,e,`array length at least ${t["min-length"]} expected, length ${e.length} found`)];let g={type:t.value,values:t.values,minimum:t.minimum,maximum:t.maximum,function:void 0};u.$version<7&&(g.function=t.function),tr(t.value)==="object"&&(g=t.value);let b=[];for(let w=0;w<e.length;w++)b=b.concat(m({array:e,arrayIndex:w,value:e[w],valueSpec:g,style:a,styleSpec:u,key:`${d}[${w}]`}));return b}function jc(r){const e=r.key,t=r.value,a=r.valueSpec;let u=tr(t);if(u==="number"&&t!=t&&(u="NaN"),u!=="number")return[new ht(e,t,`number expected, ${u} found`)];if("minimum"in a){let d=a.minimum;if(tr(a.minimum)==="array"&&(d=a.minimum[r.arrayIndex]),t<d)return[new ht(e,t,`${t} is less than the minimum value ${d}`)]}if("maximum"in a){let d=a.maximum;if(tr(a.maximum)==="array"&&(d=a.maximum[r.arrayIndex]),t>d)return[new ht(e,t,`${t} is greater than the maximum value ${d}`)]}return[]}function Ys(r){const e=r.valueSpec,t=Nr(r.value.type);let a,u,d,m={};const g=t!=="categorical"&&r.value.property===void 0,b=!g,w=tr(r.value.stops)==="array"&&tr(r.value.stops[0])==="array"&&tr(r.value.stops[0][0])==="object",P=$i({key:r.key,value:r.value,valueSpec:r.styleSpec.function,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(O){if(t==="identity")return[new ht(O.key,O.value,'identity function may not have a "stops" property')];let B=[];const $=O.value;return B=B.concat(Bc({key:O.key,value:$,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:C})),tr($)==="array"&&$.length===0&&B.push(new ht(O.key,$,"array must have at least one stop")),B},default:function(O){return ci({key:O.key,value:O.value,valueSpec:e,style:O.style,styleSpec:O.styleSpec})}}});return t==="identity"&&g&&P.push(new ht(r.key,r.value,'missing required property "property"')),t==="identity"||r.value.stops||P.push(new ht(r.key,r.value,'missing required property "stops"')),t==="exponential"&&r.valueSpec.expression&&!kc(r.valueSpec)&&P.push(new ht(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(b&&!Jo(r.valueSpec)?P.push(new ht(r.key,r.value,"property functions not supported")):g&&!Th(r.valueSpec)&&P.push(new ht(r.key,r.value,"zoom functions not supported"))),t!=="categorical"&&!w||r.value.property!==void 0||P.push(new ht(r.key,r.value,'"property" property is required')),P;function C(O){let B=[];const $=O.value,q=O.key;if(tr($)!=="array")return[new ht(q,$,`array expected, ${tr($)} found`)];if($.length!==2)return[new ht(q,$,`array length 2 expected, length ${$.length} found`)];if(w){if(tr($[0])!=="object")return[new ht(q,$,`object expected, ${tr($[0])} found`)];if($[0].zoom===void 0)return[new ht(q,$,"object stop key must have zoom")];if($[0].value===void 0)return[new ht(q,$,"object stop key must have value")];const te=Nr($[0].zoom);if(typeof te!="number")return[new ht(q,$[0].zoom,"stop zoom values must be numbers")];if(d&&d>te)return[new ht(q,$[0].zoom,"stop zoom values must appear in ascending order")];te!==d&&(d=te,u=void 0,m={}),B=B.concat($i({key:`${q}[0]`,value:$[0],valueSpec:{zoom:{}},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:jc,value:R}}))}else B=B.concat(R({key:`${q}[0]`,value:$[0],valueSpec:{},style:O.style,styleSpec:O.styleSpec},$));return rl($n($[1]))?B.concat([new ht(`${q}[1]`,$[1],"expressions are not allowed in function stops.")]):B.concat(ci({key:`${q}[1]`,value:$[1],valueSpec:e,style:O.style,styleSpec:O.styleSpec}))}function R(O,B){const $=tr(O.value),q=Nr(O.value),te=O.value!==null?O.value:B;if(a){if($!==a)return[new ht(O.key,te,`${$} stop domain type must match previous stop domain type ${a}`)]}else a=$;if($!=="number"&&$!=="string"&&$!=="boolean"&&typeof q!="number"&&typeof q!="string"&&typeof q!="boolean")return[new ht(O.key,te,"stop domain value must be a number, string, or boolean")];if($!=="number"&&t!=="categorical"){let le=`number expected, ${$} found`;return Jo(e)&&t===void 0&&(le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ht(O.key,te,le)]}return t!=="categorical"||$!=="number"||typeof q=="number"&&isFinite(q)&&Math.floor(q)===q?t!=="categorical"&&$==="number"&&typeof q=="number"&&typeof u=="number"&&u!==void 0&&q<u?[new ht(O.key,te,"stop domain values must appear in ascending order")]:(u=q,t==="categorical"&&q in m?[new ht(O.key,te,"stop domain values must be unique")]:(m[q]=!0,[])):[new ht(O.key,te,`integer expected, found ${String(q)}`)]}}function fn(r){const e=(r.expressionContext==="property"?Fc:ts)($n(r.value),r.valueSpec);if(e.result==="error")return e.value.map(a=>new ht(`${r.key}${a.key}`,r.value,a.message));const t=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!t.outputDefined())return[new ht(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Wn(t))return[new ht(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter")return Nc(t,r);if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!Us(t,["zoom","feature-state"]))return[new ht(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!_o(t))return[new ht(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Nc(r,e){const t=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const u of e.valueSpec.expression.parameters)t.delete(u);if(t.size===0)return[];const a=[];return r instanceof hn&&t.has(r.name)?[new ht(e.key,e.value,`["${r.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(r.eachChild(u=>{a.push(...Nc(u,e))}),a)}function Ks(r){const e=r.key,t=r.value,a=r.valueSpec,u=[];return Array.isArray(a.values)?a.values.indexOf(Nr(t))===-1&&u.push(new ht(e,t,`expected one of [${a.values.join(", ")}], ${JSON.stringify(t)} found`)):Object.keys(a.values).indexOf(Nr(t))===-1&&u.push(new ht(e,t,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(t)} found`)),u}function Js(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!Js(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function ea(r,e="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Js(r)||(r=il(r));const t=r;let a=!0;try{a=function(w){if(!Pn(w))return w;let P=$n(w);return Uc(P),P=Sh(P),P}(t)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(t,null,2)}
        `)}const u=ke[`filter_${e}`],d=ts(a,u);let m=null;if(d.result==="error")throw new Error(d.value.map(w=>`${w.key}: ${w.message}`).join(", "));m=(w,P,C)=>d.value.evaluate(w,P,{},C);let g=null,b=null;if(a!==t){const w=ts(t,u);if(w.result==="error")throw new Error(w.value.map(P=>`${P.key}: ${P.message}`).join(", "));g=(P,C,R,O,B)=>w.value.evaluate(P,C,{},R,void 0,void 0,O,B),b=!_o(w.value.expression)}return m=m,{filter:m,dynamicFilter:g||void 0,needGeometry:Ah(a),needFeature:!!b}}function Sh(r){if(!Array.isArray(r))return r;const e=function(t){if(Tp.has(t[0])){for(let a=1;a<t.length;a++)if(Pn(t[a]))return!0}return t}(r);return e===!0?e:e.map(t=>Sh(t))}function Uc(r){let e=!1;const t=[];if(r[0]==="case"){for(let a=1;a<r.length-1;a+=2)e=e||Pn(r[a]),t.push(r[a+1]);t.push(r[r.length-1])}else if(r[0]==="match"){e=e||Pn(r[1]);for(let a=2;a<r.length-1;a+=2)t.push(r[a+1]);t.push(r[r.length-1])}else if(r[0]==="step"){e=e||Pn(r[1]);for(let a=1;a<r.length-1;a+=2)t.push(r[a+1])}e&&(r.length=0,r.push("any",...t));for(let a=1;a<r.length;a++)Uc(r[a])}function Pn(r){if(!Array.isArray(r))return!1;if((e=r[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let t=1;t<r.length;t++)if(Pn(r[t]))return!0;return!1}const Tp=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ep(r,e){return r<e?-1:r>e?1:0}function Ah(r){if(!Array.isArray(r))return!1;if(r[0]==="within")return!0;for(let e=1;e<r.length;e++)if(Ah(r[e]))return!0;return!1}function il(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Vc(r[1],r[2],"=="):e==="!="?mi(Vc(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Vc(r[1],r[2],e):e==="any"?(t=r.slice(1),["any"].concat(t.map(il))):e==="all"?["all"].concat(r.slice(1).map(il)):e==="none"?["all"].concat(r.slice(1).map(il).map(mi)):e==="in"?ta(r[1],r.slice(2)):e==="!in"?mi(ta(r[1],r.slice(2))):e==="has"?ra(r[1]):e==="!has"?mi(ra(r[1])):e!=="within"||r;var t}function Vc(r,e,t){switch(r){case"$type":return[`filter-type-${t}`,e];case"$id":return[`filter-id-${t}`,e];default:return[`filter-${t}`,r,e]}}function ta(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",r,["literal",e.sort(Ep)]]:["filter-in-small",r,["literal",e]]}}function ra(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function mi(r){return["!",r]}function ns(r){return Js($n(r.value))?fn(Ui({},r,{expressionContext:"filter",valueSpec:r.styleSpec[`filter_${r.layerType||"fill"}`]})):Ph(r)}function Ph(r){const e=r.value,t=r.key;if(tr(e)!=="array")return[new ht(t,e,`array expected, ${tr(e)} found`)];const a=r.styleSpec;let u,d=[];if(e.length<1)return[new ht(t,e,"filter array must have at least 1 element")];switch(d=d.concat(Ks({key:`${t}[0]`,value:e[0],valueSpec:a.filter_operator,style:r.style,styleSpec:r.styleSpec})),Nr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Nr(e[1])==="$type"&&d.push(new ht(t,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&d.push(new ht(t,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=tr(e[1]),u!=="string"&&d.push(new ht(`${t}[1]`,e[1],`string expected, ${u} found`)));for(let m=2;m<e.length;m++)u=tr(e[m]),Nr(e[1])==="$type"?d=d.concat(Ks({key:`${t}[${m}]`,value:e[m],valueSpec:a.geometry_type,style:r.style,styleSpec:r.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&d.push(new ht(`${t}[${m}]`,e[m],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let m=1;m<e.length;m++)d=d.concat(Ph({key:`${t}[${m}]`,value:e[m],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":u=tr(e[1]),e.length!==2?d.push(new ht(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&d.push(new ht(`${t}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=tr(e[1]),e.length!==2?d.push(new ht(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="object"&&d.push(new ht(`${t}[1]`,e[1],`object expected, ${u} found`))}return d}function Ih(r,e){const t=r.key,a=r.style,u=r.styleSpec,d=r.value,m=r.objectKey,g=u[`${e}_${r.layerType}`];if(!g)return[];const b=m.match(/^(.*)-transition$/);if(e==="paint"&&b&&g[b[1]]&&g[b[1]].transition)return ci({key:t,value:d,valueSpec:u.transition,style:a,styleSpec:u});const w=r.valueSpec||g[m];if(!w)return[new ht(t,d,`unknown property "${m}"`)];let P;if(tr(d)==="string"&&Jo(w)&&!w.tokens&&(P=/^{([^}]+)}$/.exec(d)))return[new ht(t,d,`"${m}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];const C=[];return r.layerType==="symbol"&&(m==="text-field"&&a&&!a.glyphs&&C.push(new ht(t,d,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&Hs($n(d))&&Nr(d.type)==="identity"&&C.push(new ht(t,d,'"text-font" does not support identity functions'))),C.concat(ci({key:r.key,value:d,valueSpec:w,style:a,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:m}))}function Mh(r){return Ih(r,"paint")}function Ch(r){return Ih(r,"layout")}function nl(r){let e=[];const t=r.value,a=r.key,u=r.style,d=r.styleSpec;t.type||t.ref||e.push(new ht(a,t,'either "type" or "ref" is required'));let m=Nr(t.type);const g=Nr(t.ref);if(t.id){const b=Nr(t.id);for(let w=0;w<r.arrayIndex;w++){const P=u.layers[w];Nr(P.id)===b&&e.push(new ht(a,t.id,`duplicate layer id "${t.id}", previously used at line ${P.id.__line__}`))}}if("ref"in t){let b;["type","source","source-layer","filter","layout"].forEach(w=>{w in t&&e.push(new ht(a,t[w],`"${w}" is prohibited for ref layers`))}),u.layers.forEach(w=>{Nr(w.id)===g&&(b=w)}),b?b.ref?e.push(new ht(a,t.ref,"ref cannot reference another ref layer")):m=Nr(b.type):typeof g=="string"&&e.push(new ht(a,t.ref,`ref layer "${g}" not found`))}else if(m!=="background"&&m!=="sky")if(t.source){const b=u.sources&&u.sources[t.source],w=b&&Nr(b.type);b?w==="vector"&&m==="raster"?e.push(new ht(a,t.source,`layer "${t.id}" requires a raster source`)):w==="raster"&&m!=="raster"?e.push(new ht(a,t.source,`layer "${t.id}" requires a vector source`)):w!=="vector"||t["source-layer"]?w==="raster-dem"&&m!=="hillshade"?e.push(new ht(a,t.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!t.paint||!t.paint["line-gradient"]&&!t.paint["line-trim-offset"]||w==="geojson"&&b.lineMetrics||e.push(new ht(a,t,`layer "${t.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ht(a,t,`layer "${t.id}" must specify a "source-layer"`)):e.push(new ht(a,t.source,`source "${t.source}" not found`))}else e.push(new ht(a,t,'missing required property "source"'));return e=e.concat($i({key:a,value:t,valueSpec:d.layer,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ci({key:`${a}.type`,value:t.type,valueSpec:d.layer.type,style:r.style,styleSpec:r.styleSpec,object:t,objectKey:"type"}),filter:b=>ns(Ui({layerType:m},b)),layout:b=>$i({layer:t,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":w=>Ch(Ui({layerType:m},w))}}),paint:b=>$i({layer:t,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":w=>Mh(Ui({layerType:m},w))}})}})),e}function os(r){const e=r.value,t=r.key,a=tr(e);return a!=="string"?[new ht(t,e,`string expected, ${a} found`)]:[]}const ol={promoteId:function({key:r,value:e}){if(tr(e)==="string")return os({key:r,value:e});{const t=[];for(const a in e)t.push(...os({key:`${r}.${a}`,value:e[a]}));return t}}};function zh(r){const e=r.value,t=r.key,a=r.styleSpec,u=r.style;if(!e.type)return[new ht(t,e,'"type" is required')];const d=Nr(e.type);let m;switch(d){case"vector":case"raster":case"raster-dem":return m=$i({key:t,value:e,valueSpec:a[`source_${d.replace("-","_")}`],style:r.style,styleSpec:a,objectElementValidators:ol}),m;case"geojson":if(m=$i({key:t,value:e,valueSpec:a.source_geojson,style:u,styleSpec:a,objectElementValidators:ol}),e.cluster)for(const g in e.clusterProperties){const[b,w]=e.clusterProperties[g],P=typeof b=="string"?[b,["accumulated"],["get",g]]:b;m.push(...fn({key:`${t}.${g}.map`,value:w,expressionContext:"cluster-map"})),m.push(...fn({key:`${t}.${g}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return m;case"video":return $i({key:t,value:e,valueSpec:a.source_video,style:u,styleSpec:a});case"image":return $i({key:t,value:e,valueSpec:a.source_image,style:u,styleSpec:a});case"canvas":return[new ht(t,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ks({key:`${t}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,styleSpec:a})}}function Rh(r){const e=r.value,t=r.styleSpec,a=t.light,u=r.style;let d=[];const m=tr(e);if(e===void 0)return d;if(m!=="object")return d=d.concat([new ht("light",e,`object expected, ${m} found`)]),d;for(const g in e){const b=g.match(/^(.*)-transition$/);d=d.concat(b&&a[b[1]]&&a[b[1]].transition?ci({key:g,value:e[g],valueSpec:t.transition,style:u,styleSpec:t}):a[g]?ci({key:g,value:e[g],valueSpec:a[g],style:u,styleSpec:t}):[new ht(g,e[g],`unknown property "${g}"`)])}return d}function sl(r){const e=r.value,t=r.key,a=r.style,u=r.styleSpec,d=u.terrain;let m=[];const g=tr(e);if(e===void 0)return m;if(g!=="object")return m=m.concat([new ht("terrain",e,`object expected, ${g} found`)]),m;for(const b in e){const w=b.match(/^(.*)-transition$/);m=m.concat(w&&d[w[1]]&&d[w[1]].transition?ci({key:b,value:e[b],valueSpec:u.transition,style:a,styleSpec:u}):d[b]?ci({key:b,value:e[b],valueSpec:d[b],style:a,styleSpec:u}):[new ht(b,e[b],`unknown property "${b}"`)])}if(e.source){const b=a.sources&&a.sources[e.source],w=b&&Nr(b.type);b?w!=="raster-dem"&&m.push(new ht(t,e.source,`terrain cannot be used with a source of type ${String(w)}, it only be used with a "raster-dem" source type`)):m.push(new ht(t,e.source,`source "${e.source}" not found`))}else m.push(new ht(t,e,'terrain is missing required property "source"'));return m}function kh(r){const e=r.value,t=r.style,a=r.styleSpec,u=a.fog;let d=[];const m=tr(e);if(e===void 0)return d;if(m!=="object")return d=d.concat([new ht("fog",e,`object expected, ${m} found`)]),d;for(const g in e){const b=g.match(/^(.*)-transition$/);d=d.concat(b&&u[b[1]]&&u[b[1]].transition?ci({key:g,value:e[g],valueSpec:a.transition,style:t,styleSpec:a}):u[g]?ci({key:g,value:e[g],valueSpec:u[g],style:t,styleSpec:a}):[new ht(g,e[g],`unknown property "${g}"`)])}return d}const $c={"*":()=>[],array:Bc,boolean:function(r){const e=r.value,t=r.key,a=tr(e);return a!=="boolean"?[new ht(t,e,`boolean expected, ${a} found`)]:[]},number:jc,color:function(r){const e=r.key,t=r.value,a=tr(t);return a!=="string"?[new ht(e,t,`color expected, ${a} found`)]:qn.parseCSSColor(t)===null?[new ht(e,t,`color expected, "${t}" found`)]:[]},enum:Ks,filter:ns,function:Ys,layer:nl,object:$i,source:zh,light:Rh,terrain:sl,fog:kh,string:os,formatted:function(r){return os(r).length===0?[]:fn(r)},resolvedImage:function(r){return os(r).length===0?[]:fn(r)},projection:function(r){const e=r.value,t=r.styleSpec,a=t.projection,u=r.style;let d=[];const m=tr(e);if(m==="object")for(const g in e)d=d.concat(ci({key:g,value:e[g],valueSpec:a[g],style:u,styleSpec:t}));else m!=="string"&&(d=d.concat([new ht("projection",e,`object or string expected, ${m} found`)]));return d}};function ci(r){const e=r.value,t=r.valueSpec,a=r.styleSpec;return t.expression&&Hs(Nr(e))?Ys(r):t.expression&&rl($n(e))?fn(r):t.type&&$c[t.type]?$c[t.type](r):$i(Ui({},r,{valueSpec:t.type?a[t.type]:t}))}function Sp(r){const e=r.value,t=r.key,a=os(r);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new ht(t,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new ht(t,e,'"glyphs" url must include a "{range}" token'))),a}function al(r,e=ke){return In(ci({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,objectElementValidators:{glyphs:Sp,"*":()=>[]}}))}const ll=r=>In(Mh(r)),Dh=r=>In(Ch(r));function In(r){return r.slice().sort((e,t)=>e.line&&t.line?e.line-t.line:0)}function Gc(r,e){let t=!1;if(e&&e.length)for(const a of e)r.fire(new ar(new Error(a.message))),t=!0;return t}var ss=Yi;function Yi(r,e,t){var a=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var u=new Int32Array(this.arrayBuffer);r=u[0],this.d=(e=u[1])+2*(t=u[2]);for(var d=0;d<this.d*this.d;d++){var m=u[3+d],g=u[3+d+1];a.push(m===g?null:u.subarray(m,g))}var b=u[3+a.length+1];this.keys=u.subarray(u[3+a.length],b),this.bboxes=u.subarray(b),this.insert=this._insertReadonly}else{this.d=e+2*t;for(var w=0;w<this.d*this.d;w++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=r,this.padding=t,this.scale=e/r,this.uid=0;var P=t/e*r;this.min=-P,this.max=r+P}Yi.prototype.insert=function(r,e,t,a,u){this._forEachCell(e,t,a,u,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(e),this.bboxes.push(t),this.bboxes.push(a),this.bboxes.push(u)},Yi.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Yi.prototype._insertCell=function(r,e,t,a,u,d){this.cells[u].push(d)},Yi.prototype.query=function(r,e,t,a,u){var d=this.min,m=this.max;if(r<=d&&e<=d&&m<=t&&m<=a&&!u)return Array.prototype.slice.call(this.keys);var g=[];return this._forEachCell(r,e,t,a,this._queryCell,g,{},u),g},Yi.prototype._queryCell=function(r,e,t,a,u,d,m,g){var b=this.cells[u];if(b!==null)for(var w=this.keys,P=this.bboxes,C=0;C<b.length;C++){var R=b[C];if(m[R]===void 0){var O=4*R;(g?g(P[O+0],P[O+1],P[O+2],P[O+3]):r<=P[O+2]&&e<=P[O+3]&&t>=P[O+0]&&a>=P[O+1])?(m[R]=!0,d.push(w[R])):m[R]=!1}}},Yi.prototype._forEachCell=function(r,e,t,a,u,d,m,g){for(var b=this._convertToCellCoord(r),w=this._convertToCellCoord(e),P=this._convertToCellCoord(t),C=this._convertToCellCoord(a),R=b;R<=P;R++)for(var O=w;O<=C;O++){var B=this.d*O+R;if((!g||g(this._convertFromCellCoord(R),this._convertFromCellCoord(O),this._convertFromCellCoord(R+1),this._convertFromCellCoord(O+1)))&&u.call(this,r,e,t,a,B,d,m,g))return}},Yi.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},Yi.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},Yi.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,e=3+this.cells.length+1+1,t=0,a=0;a<this.cells.length;a++)t+=this.cells[a].length;var u=new Int32Array(e+t+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var d=e,m=0;m<r.length;m++){var g=r[m];u[3+m]=d,u.set(g,d),d+=g.length}return u[3+r.length]=d,u.set(this.keys,d),u[3+r.length+1]=d+=this.keys.length,u.set(this.bboxes,d),d+=this.bboxes.length,u.buffer};const cl={};function pt(r,e,t={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writeable:!1}),cl[e]={klass:r,omit:t.omit||[]}}pt(Object,"Object"),ss.serialize=function(r,e){const t=r.toArrayBuffer();return e&&e.push(t),{buffer:t}},ss.deserialize=function(r){return new ss(r.buffer)},Object.defineProperty(ss,"name",{value:"Grid"}),pt(ss,"Grid"),pt(lr,"Color"),pt(Error,"Error"),pt(we,"AJAXError"),pt(Di,"ResolvedImage"),pt(rs,"StylePropertyFunction"),pt(Oc,"StyleExpression",{omit:["_evaluator"]}),pt(Qs,"ZoomDependentExpression"),pt(Lc,"ZoomConstantExpression"),pt(hn,"CompoundExpression",{omit:["_evaluate"]});for(const r in Zs)cl[Zs[r]._classRegistryKey]||pt(Zs[r],`Expression${r}`);function Oh(r){return r&&typeof ArrayBuffer!="undefined"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Lh(r){return A.ImageBitmap&&r instanceof A.ImageBitmap}function as(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(Oh(r)||Lh(r))return e&&e.push(r),r;if(ArrayBuffer.isView(r)){const t=r;return e&&e.push(t.buffer),t}if(r instanceof A.ImageData)return e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const t=[];for(const a of r)t.push(as(a,e));return t}if(typeof r=="object"){const t=r.constructor,a=t._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);const u=t.serialize?t.serialize(r,e):{};if(!t.serialize){for(const d in r)r.hasOwnProperty(d)&&(cl[a].omit.indexOf(d)>=0||(u[d]=as(r[d],e)));r instanceof Error&&(u.message=r.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(u.$name=a),u}throw new Error("can't serialize object of type "+typeof r)}function ia(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||Oh(r)||Lh(r)||ArrayBuffer.isView(r)||r instanceof A.ImageData)return r;if(Array.isArray(r))return r.map(ia);if(typeof r=="object"){const e=r.$name||"Object",{klass:t}=cl[e];if(!t)throw new Error(`can't deserialize unregistered class ${e}`);if(t.deserialize)return t.deserialize(r);const a=Object.create(t.prototype);for(const u of Object.keys(r))u!=="$name"&&(a[u]=ia(r[u]));return a}throw new Error("can't deserialize object of type "+typeof r)}class Fh{constructor(){this.first=!0}update(e,t){const a=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=a,!0))}}const Bh=r=>r>=1536&&r<=1791,jh=r=>r>=1872&&r<=1919,Nh=r=>r>=2208&&r<=2303,Uh=r=>r>=11904&&r<=12031,Vh=r=>r>=12032&&r<=12255,na=r=>r>=12272&&r<=12287,ul=r=>r>=12288&&r<=12351,qc=r=>r>=12352&&r<=12447,yo=r=>r>=12448&&r<=12543,$h=r=>r>=12544&&r<=12591,Zc=r=>r>=12704&&r<=12735,Gh=r=>r>=12736&&r<=12783,Hc=r=>r>=12784&&r<=12799,Wc=r=>r>=12800&&r<=13055,Xc=r=>r>=13056&&r<=13311,Qc=r=>r>=13312&&r<=19903,oa=r=>r>=19968&&r<=40959,hl=r=>r>=40960&&r<=42127,qh=r=>r>=42128&&r<=42191,Zh=r=>r>=44032&&r<=55215,Hh=r=>r>=63744&&r<=64255,sa=r=>r>=64336&&r<=65023,Wh=r=>r>=65040&&r<=65055,Yc=r=>r>=65072&&r<=65103,Xh=r=>r>=65104&&r<=65135,Kc=r=>r>=65136&&r<=65279,Jc=r=>r>=65280&&r<=65519;function fl(r){for(const e of r)if(dl(e.charCodeAt(0)))return!0;return!1}function Ap(r){for(const e of r)if(!Pp(e.charCodeAt(0)))return!1;return!0}function Pp(r){return!(Bh(r)||jh(r)||Nh(r)||sa(r)||Kc(r))}function dl(r){return!(r!==746&&r!==747&&(r<4352||!(Zc(r)||$h(r)||Yc(r)&&!(r>=65097&&r<=65103)||Hh(r)||Xc(r)||Uh(r)||Gh(r)||!(!ul(r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Qc(r)||oa(r)||Wc(r)||(e=>e>=12592&&e<=12687)(r)||(e=>e>=43360&&e<=43391)(r)||(e=>e>=55216&&e<=55295)(r)||(e=>e>=4352&&e<=4607)(r)||Zh(r)||qc(r)||na(r)||(e=>e>=12688&&e<=12703)(r)||Vh(r)||Hc(r)||yo(r)&&r!==12540||!(!Jc(r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Xh(r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||(e=>e>=5120&&e<=5759)(r)||(e=>e>=6320&&e<=6399)(r)||Wh(r)||(e=>e>=19904&&e<=19967)(r)||hl(r)||qh(r))))}function aa(r){return!(dl(r)||function(e){return!!((t=>t>=128&&t<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(t=>t>=8192&&t<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(t=>t>=8448&&t<=8527)(e)||(t=>t>=8528&&t<=8591)(e)||(t=>t>=8960&&t<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(t=>t>=9216&&t<=9279)(e)&&e!==9251||(t=>t>=9280&&t<=9311)(e)||(t=>t>=9312&&t<=9471)(e)||(t=>t>=9632&&t<=9727)(e)||(t=>t>=9728&&t<=9983)(e)&&!(e>=9754&&e<=9759)||(t=>t>=11008&&t<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ul(e)||yo(e)||(t=>t>=57344&&t<=63743)(e)||Yc(e)||Xh(e)||Jc(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function f(r){return r>=1424&&r<=2303||sa(r)||Kc(r)}function n(r,e){return!(!e&&f(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||(t=>t>=6016&&t<=6143)(r))}function c(r){for(const e of r)if(f(e.charCodeAt(0)))return!0;return!1}const p="deferred",y="loading",v="loaded";let T=null,S="unavailable",I=null;const k=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(S="error"),T&&T(r)};function D(){U.fire(new fr("pluginStateChange",{pluginStatus:S,pluginURL:I}))}const U=new Tt,G=function(){return S},K=function(){if(S!==p||!I)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");S=y,D(),I&&Ee({url:I},r=>{r?k(r):(S=v,D())})},X={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>S===v||X.applyArabicShaping!=null,isLoading:()=>S===y,setState(r){S=r.pluginStatus,I=r.pluginURL},isParsed:()=>X.applyArabicShaping!=null&&X.processBidirectionalText!=null&&X.processStyledBidirectionalText!=null,getPluginURL:()=>I};class Q{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition,this.pitch=t.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Fh,this.transition={},this.pitch=0)}isSupportedScript(e){return function(t,a){for(const u of t)if(!n(u.charCodeAt(0),a))return!1;return!0}(e,X.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),a=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*t}}}class Y{constructor(e,t){this.property=e,this.value=t,this.expression=function(a,u){if(Hs(a))return new rs(a,u);if(rl(a)){const d=Fc(a,u);if(d.result==="error")throw new Error(d.value.map(m=>`${m.key}: ${m.message}`).join(", "));return d.value}{let d=a;return typeof a=="string"&&u.type==="color"&&(d=lr.parse(a)),{kind:"constant",evaluate:()=>d}}}(t===void 0?e.specification.default:t,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,t,a){return this.property.possiblyEvaluate(this,e,t,a)}}class Z{constructor(e){this.property=e,this.value=new Y(e,void 0)}transitioned(e,t){return new J(this.property,this.value,t,Xe({},e.transition,this.transition),e.now)}untransitioned(){return new J(this.property,this.value,null,{},0)}}class ie{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Br(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Z(this._values[e].property)),this._values[e].value=new Y(this._values[e].property,t===null?void 0:Br(t))}getTransition(e){return Br(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Z(this._values[e].property)),this._values[e].transition=Br(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const a=this.getValue(t);a!==void 0&&(e[t]=a);const u=this.getTransition(t);u!==void 0&&(e[`${t}-transition`]=u)}return e}transitioned(e,t){const a=new pe(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].transitioned(e,t._values[u]);return a}untransitioned(){const e=new pe(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class J{constructor(e,t,a,u,d){const m=u.delay||0,g=u.duration||0;d=d||0,this.property=e,this.value=t,this.begin=d+m,this.end=this.begin+g,e.specification.transition&&(u.delay||u.duration)&&(this.prior=a)}possiblyEvaluate(e,t,a){const u=e.now||0,d=this.value.possiblyEvaluate(e,t,a),m=this.prior;if(m){if(u>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(u<this.begin)return m.possiblyEvaluate(e,t,a);{const g=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,t,a),d,Ce(g))}}return d}}class pe{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,a){const u=new de(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(e,t,a);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class fe{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Br(this._values[e].value)}setValue(e,t){this._values[e]=new Y(this._values[e].property,t===null?void 0:Br(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const a=this.getValue(t);a!==void 0&&(e[t]=a)}return e}possiblyEvaluate(e,t,a){const u=new de(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(e,t,a);return u}}class ae{constructor(e,t,a){this.property=e,this.value=t,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,t,a,u){return this.property.evaluate(this.value,this.parameters,e,t,a,u)}}class de{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ue{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,a){const u=Vs[this.specification.type];return u?u(e,t,a):e}}class ye{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,a,u){return new ae(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},a,u)}:e.expression,t)}interpolate(e,t,a){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new ae(this,{kind:"constant",value:void 0},e.parameters);const u=Vs[this.specification.type];return u?new ae(this,{kind:"constant",value:u(e.value.value,t.value.value,a)},e.parameters):e}evaluate(e,t,a,u,d,m){return e.kind==="constant"?e.value:e.evaluate(t,a,u,d,m)}}class Ae extends ye{possiblyEvaluate(e,t,a,u){if(e.value===void 0)return new ae(this,{kind:"constant",value:void 0},t);if(e.expression.kind==="constant"){const d=e.expression.evaluate(t,null,{},a,u),m=e.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,g=this._calculate(m,m,m,t);return new ae(this,{kind:"constant",value:g},t)}if(e.expression.kind==="camera"){const d=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new ae(this,{kind:"constant",value:d},t)}return new ae(this,e.expression,t)}evaluate(e,t,a,u,d,m){if(e.kind==="source"){const g=e.evaluate(t,a,u,d,m);return this._calculate(g,g,g,t)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},a,u),e.evaluate({zoom:Math.floor(t.zoom)},a,u),e.evaluate({zoom:Math.floor(t.zoom)+1},a,u),t):e.value}_calculate(e,t,a,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:t,other:a}:{from:a,to:t,other:e}}interpolate(e){return e}}class Je{constructor(e){this.specification=e}possiblyEvaluate(e,t,a,u){if(e.value!==void 0){if(e.expression.kind==="constant"){const d=e.expression.evaluate(t,null,{},a,u);return this._calculate(d,d,d,t)}return this._calculate(e.expression.evaluate(new Q(Math.floor(t.zoom-1),t)),e.expression.evaluate(new Q(Math.floor(t.zoom),t)),e.expression.evaluate(new Q(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,a,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:a,to:t}}interpolate(e){return e}}class be{constructor(e){this.specification=e}possiblyEvaluate(e,t,a,u){return!!e.expression.evaluate(t,null,{},a,u)}interpolate(){return!1}}class Le{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new Q(0,{});for(const a in e){const u=e[a];u.specification.overridable&&this.overridableProperties.push(a);const d=this.defaultPropertyValues[a]=new Y(u,void 0),m=this.defaultTransitionablePropertyValues[a]=new Z(u);this.defaultTransitioningPropertyValues[a]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=d.possiblyEvaluate(t)}}}function Ve(r,e){return 256*(r=Ie(Math.floor(r),0,255))+Ie(Math.floor(e),0,255)}pt(ye,"DataDrivenProperty"),pt(ue,"DataConstantProperty"),pt(Ae,"CrossFadedDataDrivenProperty"),pt(Je,"CrossFadedProperty"),pt(be,"ColorRampProperty");const it={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Re{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ke{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Be(r,e=1){let t=0,a=0;return{members:r.map(u=>{const d=it[u.type].BYTES_PER_ELEMENT,m=t=st(t,Math.max(e,d)),g=u.components||1;return a=Math.max(a,d),t+=d*g,{name:u.name,type:u.type,components:g,offset:m}}),size:st(t,Math.max(a,e)),alignment:e}}function st(r,e){return Math.ceil(r/e)*e}class ot extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const a=this.length;return this.resize(a+1),this.emplace(a,e,t)}emplace(e,t,a){const u=2*e;return this.int16[u+0]=t,this.int16[u+1]=a,e}}ot.prototype.bytesPerElement=4,pt(ot,"StructArrayLayout2i4");class _t extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,a)}emplace(e,t,a,u){const d=3*e;return this.int16[d+0]=t,this.int16[d+1]=a,this.int16[d+2]=u,e}}_t.prototype.bytesPerElement=6,pt(_t,"StructArrayLayout3i6");class wt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,a,u)}emplace(e,t,a,u,d){const m=4*e;return this.int16[m+0]=t,this.int16[m+1]=a,this.int16[m+2]=u,this.int16[m+3]=d,e}}wt.prototype.bytesPerElement=8,pt(wt,"StructArrayLayout4i8");class Mt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,a,u,d,m,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,a,u,d,m,g)}emplace(e,t,a,u,d,m,g,b){const w=6*e,P=12*e,C=3*e;return this.int16[w+0]=t,this.int16[w+1]=a,this.uint8[P+4]=u,this.uint8[P+5]=d,this.uint8[P+6]=m,this.uint8[P+7]=g,this.float32[C+2]=b,e}}Mt.prototype.bytesPerElement=12,pt(Mt,"StructArrayLayout2i4ub1f12");class qt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,a,u)}emplace(e,t,a,u,d){const m=4*e;return this.float32[m+0]=t,this.float32[m+1]=a,this.float32[m+2]=u,this.float32[m+3]=d,e}}qt.prototype.bytesPerElement=16,pt(qt,"StructArrayLayout4f16");class gt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,a,u,d,m,g,b,w,P){const C=this.length;return this.resize(C+1),this.emplace(C,e,t,a,u,d,m,g,b,w,P)}emplace(e,t,a,u,d,m,g,b,w,P,C){const R=10*e;return this.uint16[R+0]=t,this.uint16[R+1]=a,this.uint16[R+2]=u,this.uint16[R+3]=d,this.uint16[R+4]=m,this.uint16[R+5]=g,this.uint16[R+6]=b,this.uint16[R+7]=w,this.uint16[R+8]=P,this.uint16[R+9]=C,e}}gt.prototype.bytesPerElement=20,pt(gt,"StructArrayLayout10ui20");class zt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,a,u,d,m,g,b){const w=this.length;return this.resize(w+1),this.emplace(w,e,t,a,u,d,m,g,b)}emplace(e,t,a,u,d,m,g,b,w){const P=8*e;return this.uint16[P+0]=t,this.uint16[P+1]=a,this.uint16[P+2]=u,this.uint16[P+3]=d,this.uint16[P+4]=m,this.uint16[P+5]=g,this.uint16[P+6]=b,this.uint16[P+7]=w,e}}zt.prototype.bytesPerElement=16,pt(zt,"StructArrayLayout8ui16");class Qt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,a,u,d,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,t,a,u,d,m)}emplace(e,t,a,u,d,m,g){const b=6*e;return this.int16[b+0]=t,this.int16[b+1]=a,this.int16[b+2]=u,this.int16[b+3]=d,this.int16[b+4]=m,this.int16[b+5]=g,e}}Qt.prototype.bytesPerElement=12,pt(Qt,"StructArrayLayout6i12");class Tr extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,a,u,d,m,g,b,w,P,C,R){const O=this.length;return this.resize(O+1),this.emplace(O,e,t,a,u,d,m,g,b,w,P,C,R)}emplace(e,t,a,u,d,m,g,b,w,P,C,R,O){const B=12*e;return this.int16[B+0]=t,this.int16[B+1]=a,this.int16[B+2]=u,this.int16[B+3]=d,this.uint16[B+4]=m,this.uint16[B+5]=g,this.uint16[B+6]=b,this.uint16[B+7]=w,this.int16[B+8]=P,this.int16[B+9]=C,this.int16[B+10]=R,this.int16[B+11]=O,e}}Tr.prototype.bytesPerElement=24,pt(Tr,"StructArrayLayout4i4ui4i24");class Ur extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,a,u,d,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,t,a,u,d,m)}emplace(e,t,a,u,d,m,g){const b=10*e,w=5*e;return this.int16[b+0]=t,this.int16[b+1]=a,this.int16[b+2]=u,this.float32[w+2]=d,this.float32[w+3]=m,this.float32[w+4]=g,e}}Ur.prototype.bytesPerElement=20,pt(Ur,"StructArrayLayout3i3f20");class cr extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}cr.prototype.bytesPerElement=4,pt(cr,"StructArrayLayout1ul4");class ui extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,a,u,d,m,g,b,w,P,C,R,O){const B=this.length;return this.resize(B+1),this.emplace(B,e,t,a,u,d,m,g,b,w,P,C,R,O)}emplace(e,t,a,u,d,m,g,b,w,P,C,R,O,B){const $=20*e,q=10*e;return this.int16[$+0]=t,this.int16[$+1]=a,this.int16[$+2]=u,this.int16[$+3]=d,this.int16[$+4]=m,this.float32[q+3]=g,this.float32[q+4]=b,this.float32[q+5]=w,this.float32[q+6]=P,this.int16[$+14]=C,this.uint32[q+8]=R,this.uint16[$+18]=O,this.uint16[$+19]=B,e}}ui.prototype.bytesPerElement=40,pt(ui,"StructArrayLayout5i4f1i1ul2ui40");class dn extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,a,u,d,m,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,a,u,d,m,g)}emplace(e,t,a,u,d,m,g,b){const w=8*e;return this.int16[w+0]=t,this.int16[w+1]=a,this.int16[w+2]=u,this.int16[w+4]=d,this.int16[w+5]=m,this.int16[w+6]=g,this.int16[w+7]=b,e}}dn.prototype.bytesPerElement=16,pt(dn,"StructArrayLayout3i2i2i16");class Mn extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,a,u,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,t,a,u,d)}emplace(e,t,a,u,d,m){const g=4*e,b=8*e;return this.float32[g+0]=t,this.float32[g+1]=a,this.float32[g+2]=u,this.int16[b+6]=d,this.int16[b+7]=m,e}}Mn.prototype.bytesPerElement=16,pt(Mn,"StructArrayLayout2f1f2i16");class Er extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,a,u)}emplace(e,t,a,u,d){const m=12*e,g=3*e;return this.uint8[m+0]=t,this.uint8[m+1]=a,this.float32[g+1]=u,this.float32[g+2]=d,e}}Er.prototype.bytesPerElement=12,pt(Er,"StructArrayLayout2ub2f12");class Ir extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,a)}emplace(e,t,a,u){const d=3*e;return this.float32[d+0]=t,this.float32[d+1]=a,this.float32[d+2]=u,e}}Ir.prototype.bytesPerElement=12,pt(Ir,"StructArrayLayout3f12");class Ut extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,a)}emplace(e,t,a,u){const d=3*e;return this.uint16[d+0]=t,this.uint16[d+1]=a,this.uint16[d+2]=u,e}}Ut.prototype.bytesPerElement=6,pt(Ut,"StructArrayLayout3ui6");class Xr extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,a,u,d,m,g,b,w,P,C,R,O,B,$,q,te,le,ne,se,me){const ce=this.length;return this.resize(ce+1),this.emplace(ce,e,t,a,u,d,m,g,b,w,P,C,R,O,B,$,q,te,le,ne,se,me)}emplace(e,t,a,u,d,m,g,b,w,P,C,R,O,B,$,q,te,le,ne,se,me,ce){const Me=30*e,Pe=15*e,Oe=60*e;return this.int16[Me+0]=t,this.int16[Me+1]=a,this.int16[Me+2]=u,this.float32[Pe+2]=d,this.float32[Pe+3]=m,this.uint16[Me+8]=g,this.uint16[Me+9]=b,this.uint32[Pe+5]=w,this.uint32[Pe+6]=P,this.uint32[Pe+7]=C,this.uint16[Me+16]=R,this.uint16[Me+17]=O,this.uint16[Me+18]=B,this.float32[Pe+10]=$,this.float32[Pe+11]=q,this.uint8[Oe+48]=te,this.uint8[Oe+49]=le,this.uint8[Oe+50]=ne,this.uint32[Pe+13]=se,this.int16[Me+28]=me,this.uint8[Oe+58]=ce,e}}Xr.prototype.bytesPerElement=60,pt(Xr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class _i extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,a,u,d,m,g,b,w,P,C,R,O,B,$,q,te,le,ne,se,me,ce,Me,Pe,Oe,rt,ze,je,qe,Ne){const et=this.length;return this.resize(et+1),this.emplace(et,e,t,a,u,d,m,g,b,w,P,C,R,O,B,$,q,te,le,ne,se,me,ce,Me,Pe,Oe,rt,ze,je,qe,Ne)}emplace(e,t,a,u,d,m,g,b,w,P,C,R,O,B,$,q,te,le,ne,se,me,ce,Me,Pe,Oe,rt,ze,je,qe,Ne,et){const Ze=38*e,at=19*e;return this.int16[Ze+0]=t,this.int16[Ze+1]=a,this.int16[Ze+2]=u,this.float32[at+2]=d,this.float32[at+3]=m,this.int16[Ze+8]=g,this.int16[Ze+9]=b,this.int16[Ze+10]=w,this.int16[Ze+11]=P,this.int16[Ze+12]=C,this.int16[Ze+13]=R,this.uint16[Ze+14]=O,this.uint16[Ze+15]=B,this.uint16[Ze+16]=$,this.uint16[Ze+17]=q,this.uint16[Ze+18]=te,this.uint16[Ze+19]=le,this.uint16[Ze+20]=ne,this.uint16[Ze+21]=se,this.uint16[Ze+22]=me,this.uint16[Ze+23]=ce,this.uint16[Ze+24]=Me,this.uint16[Ze+25]=Pe,this.uint16[Ze+26]=Oe,this.uint16[Ze+27]=rt,this.uint16[Ze+28]=ze,this.uint32[at+15]=je,this.float32[at+16]=qe,this.float32[at+17]=Ne,this.float32[at+18]=et,e}}_i.prototype.bytesPerElement=76,pt(_i,"StructArrayLayout3i2f6i15ui1ul3f76");class _r extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}_r.prototype.bytesPerElement=4,pt(_r,"StructArrayLayout1f4");class gi extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,a,u,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,t,a,u,d)}emplace(e,t,a,u,d,m){const g=5*e;return this.float32[g+0]=t,this.float32[g+1]=a,this.float32[g+2]=u,this.float32[g+3]=d,this.float32[g+4]=m,e}}gi.prototype.bytesPerElement=20,pt(gi,"StructArrayLayout5f20");class vo extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,a,u)}emplace(e,t,a,u,d){const m=6*e;return this.uint32[3*e+0]=t,this.uint16[m+2]=a,this.uint16[m+3]=u,this.uint16[m+4]=d,e}}vo.prototype.bytesPerElement=12,pt(vo,"StructArrayLayout1ul3ui12");class Ti extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const a=this.length;return this.resize(a+1),this.emplace(a,e,t)}emplace(e,t,a){const u=2*e;return this.uint16[u+0]=t,this.uint16[u+1]=a,e}}Ti.prototype.bytesPerElement=4,pt(Ti,"StructArrayLayout2ui4");class xo extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}xo.prototype.bytesPerElement=2,pt(xo,"StructArrayLayout1ui2");class bo extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const a=this.length;return this.resize(a+1),this.emplace(a,e,t)}emplace(e,t,a){const u=2*e;return this.float32[u+0]=t,this.float32[u+1]=a,e}}bo.prototype.bytesPerElement=8,pt(bo,"StructArrayLayout2f8");class wo extends Re{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}wo.prototype.size=12;class Ei extends Qt{get(e){return new wo(this,e)}}pt(Ei,"FillExtrusionExtArray");class To extends Re{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}To.prototype.size=40;class Yn extends ui{get(e){return new To(this,e)}}pt(Yn,"CollisionBoxArray");class la extends Re{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}la.prototype.size=60;class xg extends Xr{get(e){return new la(this,e)}}pt(xg,"PlacedSymbolArray");class bg extends Re{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}bg.prototype.size=76;class wg extends _i{get(e){return new bg(this,e)}}pt(wg,"SymbolInstanceArray");class Tg extends _r{getoffsetX(e){return this.float32[1*e+0]}}pt(Tg,"GlyphOffsetArray");class Eg extends _t{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}pt(Eg,"SymbolLineVertexArray");class Sg extends Re{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Sg.prototype.size=12;class Ag extends vo{get(e){return new Sg(this,e)}}pt(Ag,"FeatureIndexArray");class Pg extends Re{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Pg.prototype.size=4;class Ig extends Ti{get(e){return new Pg(this,e)}}pt(Ig,"FillExtrusionCentroidArray");class Mg extends Re{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Mg.prototype.size=12;class Cg extends Qt{get(e){return new Mg(this,e)}}pt(Cg,"CircleGlobeExtArray");const Rb=Be([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),kb=Be([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var zg=ic(function(r){r.exports=function(e,t){var a,u,d,m,g,b,w,P;for(u=e.length-(a=3&e.length),d=t,g=3432918353,b=461845907,P=0;P<u;)w=255&e.charCodeAt(P)|(255&e.charCodeAt(++P))<<8|(255&e.charCodeAt(++P))<<16|(255&e.charCodeAt(++P))<<24,++P,d=27492+(65535&(m=5*(65535&(d=(d^=w=(65535&(w=(w=(65535&w)*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*b+(((w>>>16)*b&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(w=0,a){case 3:w^=(255&e.charCodeAt(P+2))<<16;case 2:w^=(255&e.charCodeAt(P+1))<<8;case 1:d^=w=(65535&(w=(w=(65535&(w^=255&e.charCodeAt(P)))*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*b+(((w>>>16)*b&65535)<<16)&4294967295}return d^=e.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0}}),Db=ic(function(r){r.exports=function(e,t){for(var a,u=e.length,d=t^u,m=0;u>=4;)a=1540483477*(65535&(a=255&e.charCodeAt(m)|(255&e.charCodeAt(++m))<<8|(255&e.charCodeAt(++m))<<16|(255&e.charCodeAt(++m))<<24))+((1540483477*(a>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),u-=4,++m;switch(u){case 3:d^=(255&e.charCodeAt(m+2))<<16;case 2:d^=(255&e.charCodeAt(m+1))<<8;case 1:d=1540483477*(65535&(d^=255&e.charCodeAt(m)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0}}),eu=zg,Ob=Db;eu.murmur3=zg,eu.murmur2=Ob;class Qh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,a,u){this.ids.push(Rg(e)),this.positions.push(t,a,u)}getPositions(e){const t=Rg(e);let a=0,u=this.ids.length-1;for(;a<u;){const m=a+u>>1;this.ids[m]>=t?u=m:a=m+1}const d=[];for(;this.ids[a]===t;)d.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return d}static serialize(e,t){const a=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Ip(a,u,0,a.length-1),t&&t.push(a.buffer,u.buffer),{ids:a,positions:u}}static deserialize(e){const t=new Qh;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function Rg(r){const e=+r;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:eu(String(r))}function Ip(r,e,t,a){for(;t<a;){const u=r[t+a>>1];let d=t-1,m=a+1;for(;;){do d++;while(r[d]<u);do m--;while(r[m]>u);if(d>=m)break;Yh(r,d,m),Yh(e,3*d,3*m),Yh(e,3*d+1,3*m+1),Yh(e,3*d+2,3*m+2)}m-t<a-m?(Ip(r,e,t,m),t=m+1):(Ip(r,e,m+1,a),a=m)}}function Yh(r,e,t){const a=r[e];r[e]=r[t],r[t]=a}pt(Qh,"FeaturePositionMap");class Eo{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}class Kh extends Eo{constructor(e){super(e),this.current=0}set(e,t,a){this.fetchUniformLocation(e,t)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class kg extends Eo{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,a){this.fetchUniformLocation(e,t)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class Dg extends Eo{constructor(e){super(e),this.current=lr.transparent}set(e,t,a){this.fetchUniformLocation(e,t)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const Lb=new Float32Array(16),Fb=new Float32Array(9),Bb=new Float32Array(4);function Mp(r){return[Ve(255*r.r,255*r.g),Ve(255*r.b,255*r.a)]}class tu{constructor(e,t,a){this.value=e,this.uniformNames=t.map(u=>`u_${u}`),this.type=a}setUniform(e,t,a,u,d){t.set(e,d,u.constantOr(this.value))}getBinding(e,t){return this.type==="color"?new Dg(e):new Kh(e)}}class pl{constructor(e,t){this.uniformNames=t.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=t.tl.concat(t.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,t,a,u,d){const m=d==="u_pattern_to"||d==="u_dash_to"?this.patternTo:d==="u_pattern_from"||d==="u_dash_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&t.set(e,d,m)}getBinding(e,t){return t==="u_pattern_from"||t==="u_pattern_to"||t==="u_dash_from"||t==="u_dash_to"?new kg(e):new Kh(e)}}class So{constructor(e,t,a,u){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=t.map(d=>({name:`a_${d}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,t,a,u,d,m){const g=this.paintVertexArray.length,b=this.expression.evaluate(new Q(0),t,{},d,u,m);this.paintVertexArray.resize(e),this._setPaintValue(g,e,b)}updatePaintArray(e,t,a,u,d){const m=this.expression.evaluate({zoom:0},a,u,void 0,d);this._setPaintValue(e,t,m)}_setPaintValue(e,t,a){if(this.type==="color"){const u=Mp(a);for(let d=e;d<t;d++)this.paintVertexArray.emplace(d,u[0],u[1])}else{for(let u=e;u<t;u++)this.paintVertexArray.emplace(u,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Cn{constructor(e,t,a,u,d,m){this.expression=e,this.uniformNames=t.map(g=>`u_${g}_t`),this.type=a,this.useIntegerZoom=u,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=t.map(g=>({name:`a_${g}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,t,a,u,d,m){const g=this.expression.evaluate(new Q(this.zoom),t,{},d,u,m),b=this.expression.evaluate(new Q(this.zoom+1),t,{},d,u,m),w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,g,b)}updatePaintArray(e,t,a,u,d){const m=this.expression.evaluate({zoom:this.zoom},a,u,void 0,d),g=this.expression.evaluate({zoom:this.zoom+1},a,u,void 0,d);this._setPaintValue(e,t,m,g)}_setPaintValue(e,t,a,u){if(this.type==="color"){const d=Mp(a),m=Mp(u);for(let g=e;g<t;g++)this.paintVertexArray.emplace(g,d[0],d[1],m[0],m[1])}else{for(let d=e;d<t;d++)this.paintVertexArray.emplace(d,a,u);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,a,u,d){const m=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,g=Ie(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);t.set(e,d,g)}getBinding(e,t){return new Kh(e)}}class ls{constructor(e,t,a,u,d,m,g){this.expression=e,this.type=a,this.useIntegerZoom=u,this.zoom=d,this.layerId=g,this.paintVertexAttributes=(a==="array"?kb:Rb).members;for(let b=0;b<t.length;++b);this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(e,t,a){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,t.patterns&&t.patterns[this.layerId],a)}updatePaintArray(e,t,a,u,d,m){this._setPaintValues(e,t,a.patterns&&a.patterns[this.layerId],m)}_setPaintValues(e,t,a,u){if(!u||!a)return;const{min:d,mid:m,max:g}=a,b=u[d],w=u[m],P=u[g];if(b&&w&&P)for(let C=e;C<t;C++)this._setPaintValue(this.zoomInPaintVertexArray,C,w,b),this._setPaintValue(this.zoomOutPaintVertexArray,C,w,P)}_setPaintValue(e,t,a,u){e.emplace(t,a.tl[0],a.tl[1],a.br[0],a.br[1],u.tl[0],u.tl[1],u.br[0],u.br[1],a.pixelRatio,u.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class cs{constructor(e,t,a=()=>!0){this.binders={},this._buffers=[];const u=[];for(const d in e.paint._values){if(!a(d))continue;const m=e.paint.get(d);if(!(m instanceof ae&&Jo(m.property.specification)))continue;const g=Nb(d,e.type),b=m.value,w=m.property.specification.type,P=m.property.useIntegerZoom,C=m.property.specification["property-type"],R=C==="cross-faded"||C==="cross-faded-data-driven",O=String(d)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(b.kind!=="constant"||O)if(b.kind==="source"||O||R){const B=Og(d,w,"source");this.binders[d]=R?new ls(b,g,w,P,t,B,e.id):new So(b,g,w,B),u.push(`/a_${d}`)}else{const B=Og(d,w,"composite");this.binders[d]=new Cn(b,g,w,P,t,B),u.push(`/z_${d}`)}else this.binders[d]=R?new pl(b.value,g):new tu(b.value,g,w),u.push(`/u_${d}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof So||t instanceof Cn?t.maxValue:0}populatePaintArrays(e,t,a,u,d,m){for(const g in this.binders){const b=this.binders[g];(b instanceof So||b instanceof Cn||b instanceof ls)&&b.populatePaintArray(e,t,a,u,d,m)}}setConstantPatternPositions(e,t){for(const a in this.binders){const u=this.binders[a];u instanceof pl&&u.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,a,u,d,m){let g=!1;for(const b in e){const w=t.getPositions(b);for(const P of w){const C=a.feature(P.index);for(const R in this.binders){const O=this.binders[R];if((O instanceof So||O instanceof Cn||O instanceof ls)&&O.expression.isStateDependent===!0){const B=u.paint.get(R);O.expression=B.value,O.updatePaintArray(P.start,P.end,C,e[b],d,m),g=!0}}}}return g}defines(){const e=[];for(const t in this.binders){const a=this.binders[t];(a instanceof tu||a instanceof pl)&&e.push(...a.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const a=this.binders[t];if(a instanceof So||a instanceof Cn||a instanceof ls)for(let u=0;u<a.paintVertexAttributes.length;u++)e.push(a.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const a=this.binders[t];if(a instanceof tu||a instanceof pl||a instanceof Cn)for(const u of a.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof tu||u instanceof pl||u instanceof Cn)for(const d of u.uniformNames)t.push({name:d,property:a,binding:u.getBinding(e,d)})}return t}setUniforms(e,t,a,u,d){for(const{name:m,property:g,binding:b}of a)this.binders[g].setUniform(e,b,d,u.get(g),m)}updatePaintBuffers(e){this._buffers=[];for(const t in this.binders){const a=this.binders[t];if(e&&a instanceof ls){const u=e.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(a instanceof So||a instanceof Cn)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(e){for(const t in this.binders){const a=this.binders[t];(a instanceof So||a instanceof Cn||a instanceof ls)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof So||t instanceof Cn||t instanceof ls)&&t.destroy()}}}class ca{constructor(e,t,a=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new cs(u,t,a);this.needsUpload=!1,this._featureMap=new Qh,this._bufferOffset=0}populatePaintArrays(e,t,a,u,d,m,g){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,t,u,d,m,g);t.id!==void 0&&this._featureMap.add(t.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,a,u,d){for(const m of a)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,t,m,u,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const jb={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Nb(r,e){return jb[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const Ub={"line-pattern":{source:gt,composite:gt},"fill-pattern":{source:gt,composite:gt},"fill-extrusion-pattern":{source:gt,composite:gt},"line-dasharray":{source:zt,composite:zt}},Vb={color:{source:bo,composite:qt},number:{source:_r,composite:bo}};function Og(r,e,t){const a=Ub[r];return a&&a[t]||Vb[e][t]}pt(tu,"ConstantBinder"),pt(pl,"CrossFadedConstantBinder"),pt(So,"SourceExpressionBinder"),pt(ls,"CrossFadedCompositeBinder"),pt(Cn,"CompositeExpressionBinder"),pt(cs,"ProgramConfiguration",{omit:["_buffers"]}),pt(ca,"ProgramConfigurationSet");const Jh="-transition";class zn extends Tt{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new fe(t.layout)),t.paint)){this._transitionablePaint=new ie(t.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new de(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,a={}){t!=null&&this._validate(Dh,`layers.${this.id}.layout.${e}`,e,t,a)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return Wr(e,Jh)?this._transitionablePaint.getTransition(e.slice(0,-Jh.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,a={}){if(t!=null&&this._validate(ll,`layers.${this.id}.paint.${e}`,e,t,a))return!1;if(Wr(e,Jh))return this._transitionablePaint.setTransition(e.slice(0,-Jh.length),t||void 0),!1;{const u=this._transitionablePaint._values[e],d=u.property.specification["property-type"]==="cross-faded-data-driven",m=u.value.isDataDriven(),g=u.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const b=this._transitionablePaint._values[e].value;return b.isDataDriven()||m||d||this._handleOverridablePaintPropertyUpdate(e,g,b)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,t,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Ht(e,(t,a)=>!(t===void 0||a==="layout"&&!Object.keys(t).length||a==="paint"&&!Object.keys(t).length))}_validate(e,t,a,u,d={}){return(!d||d.validate!==!1)&&Gc(this,e.call(al,{key:t,layerType:this.type,objectKey:a,value:u,styleSpec:ke,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof ae&&Jo(t.property.specification)&&(t.value.kind==="source"||t.value.kind==="composite")&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ea(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const $b=Be([{name:"a_pos",components:2,type:"Int16"}],4),Gb=Be([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Kr{constructor(e=[]){this.segments=e}prepareSegment(e,t,a,u){let d=this.segments[this.segments.length-1];return e>Kr.MAX_VERTEX_ARRAY_LENGTH&&hr(`Max vertices per segment is ${Kr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>Kr.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==u)&&(d={vertexOffset:t.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},u!==void 0&&(d.sortKey=u),this.segments.push(d)),d}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,a,u){return new Kr([{vertexOffset:e,primitiveOffset:t,vertexLength:a,primitiveLength:u,vaos:{},sortKey:0}])}}Kr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,pt(Kr,"SegmentVector");var It=8192;class us{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof nr?new nr(e.lng,e.lat):nr.convert(e),this}setSouthWest(e){return this._sw=e instanceof nr?new nr(e.lng,e.lat):nr.convert(e),this}extend(e){const t=this._sw,a=this._ne;let u,d;if(e instanceof nr)u=e,d=e;else{if(!(e instanceof us))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(us.convert(e)):this.extend(nr.convert(e)):this;if(u=e._sw,d=e._ne,!u||!d)return this}return t||a?(t.lng=Math.min(u.lng,t.lng),t.lat=Math.min(u.lat,t.lat),a.lng=Math.max(d.lng,a.lng),a.lat=Math.max(d.lat,a.lat)):(this._sw=new nr(u.lng,u.lat),this._ne=new nr(d.lng,d.lat)),this}getCenter(){return new nr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new nr(this.getWest(),this.getNorth())}getSouthEast(){return new nr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:a}=nr.convert(e);let u=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&u}static convert(e){return!e||e instanceof us?e:new us(e)}}const Cp=63710088e-1;class nr{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new nr(mt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,a=this.lat*t,u=e.lat*t,d=Math.sin(a)*Math.sin(u)+Math.cos(a)*Math.cos(u)*Math.cos((e.lng-this.lng)*t);return Cp*Math.acos(Math.min(d,1))}toBounds(e=0){const t=360*e/40075017,a=t/Math.cos(Math.PI/180*this.lat);return new us(new nr(this.lng-a,this.lat-t),new nr(this.lng+a,this.lat+t))}static convert(e){if(e instanceof nr)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new nr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new nr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Lg=2*Math.PI*Cp;function zp(r){return Lg*Math.cos(r*Math.PI/180)}function Kn(r){return(180+r)/360}function Ao(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function vn(r,e){return r/zp(e)}function xn(r){return 360*r-180}function yi(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Fg(r,e){return r*zp(yi(e))}const Jn=85.051129;function Bg(r){return 1/Math.cos(r*Math.PI/180)}class ml{constructor(e,t,a=0){this.x=+e,this.y=+t,this.z=+a}static fromLngLat(e,t=0){const a=nr.convert(e);return new ml(Kn(a.lng),Ao(a.lat),vn(t,a.lat))}toLngLat(){return new nr(xn(this.x),yi(this.y))}toAltitude(){return Fg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Lg*Bg(yi(this.y))}}function Rp(r,e,t,a,u,d,m,g,b){const w=(e+a)/2,P=(t+u)/2,C=new L(w,P);g(C),function(R,O,B,$,q,te){const le=B-q,ne=$-te;return Math.abs(($-O)*le-(B-R)*ne)/Math.hypot(le,ne)}(C.x,C.y,d.x,d.y,m.x,m.y)>=b?(Rp(r,e,t,w,P,d,C,g,b),Rp(r,w,P,a,u,C,m,g,b)):r.push(m)}function jg(r,e,t){let a=r[0],u=a.x,d=a.y;e(a);const m=[a];for(let g=1;g<r.length;g++){const b=r[g],{x:w,y:P}=b;e(b),Rp(m,u,d,w,P,a,b,e,t),u=w,d=P,a=b}return m}function kp(r,e,t,a,u){if(u(e,t)){const d=e.add(t).mult(.5);a(d),kp(r,e,d,a,u),kp(r,d,t,a,u)}else r.push(t)}function qb(r,e,t){let a=r[0];e(a);const u=[a];for(let d=1;d<r.length;d++){const m=r[d];e(m),kp(u,a,m,e,t),a=m}return u}const Dp=Math.pow(2,14)-1,Ng=-Dp-1;function Zb(r,e){const t=Math.round(r.x*e),a=Math.round(r.y*e);return r.x=Ie(t,Ng,Dp),r.y=Ie(a,Ng,Dp),(t<r.x||t>r.x+1||a<r.y||a>r.y+1)&&hr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function Po(r,e,t){const a=r.loadGeometry(),u=r.extent,d=It/u;if(e&&t&&t.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:g,x:b,y:w,projection:P}=t,C=R=>{const O=xn((e.x+R.x/u)/m),B=yi((e.y+R.y/u)/m),$=P.project(O,B);R.x=($.x*g-b)*u,R.y=($.y*g-w)*u};for(let R=0;R<a.length;R++)if(r.type!==1)a[R]=jg(a[R],C,1);else{const O=[];for(const B of a[R])B.x<0||B.x>=u||B.y<0||B.y>=u||(C(B),O.push(B));a[R]=O}}for(const m of a)for(const g of m)Zb(g,d);return a}function ua(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?Po(r):[]}}function ef(r,e,t,a,u){r.emplaceBack(2*e+(a+1)/2,2*t+(u+1)/2)}function tf(r,e,t){const a=16384;r.emplaceBack(e.x,e.y,e.z,t[0]*a,t[1]*a,t[2]*a)}class Op{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ot,this.indexArray=new Ut,this.segments=new Kr,this.programConfigurations=new ca(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(e,t,a,u){const d=this.layers[0],m=[];let g=null;d.type==="circle"&&(g=d.layout.get("circle-sort-key"));for(const{feature:w,id:P,index:C,sourceLayerIndex:R}of e){const O=this.layers[0]._featureFilter.needGeometry,B=ua(w,O);if(!this.layers[0]._featureFilter.filter(new Q(this.zoom),B,a))continue;const $=g?g.evaluate(B,{},a):void 0,q={id:P,properties:w.properties,type:w.type,sourceLayerIndex:R,index:C,geometry:O?B.geometry:Po(w,a,u),patterns:{},sortKey:$};m.push(q)}g&&m.sort((w,P)=>w.sortKey-P.sortKey);let b=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new Cg,b=u.projection);for(const w of m){const{geometry:P,index:C,sourceLayerIndex:R}=w,O=e[C].feature;this.addFeature(w,P,C,t.availableImages,a,b),t.featureIndex.insert(O,P,C,R,this.index)}}update(e,t,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,a,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$b.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Gb.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,a,u,d,m){for(const g of t)for(const b of g){const w=b.x,P=b.y;if(w<0||w>=It||P<0||P>=It)continue;if(m){const O=m.projectTilePoint(w,P,d),B=m.upVector(d,w,P),$=this.globeExtVertexArray;tf($,O,B),tf($,O,B),tf($,O,B),tf($,O,B)}const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),R=C.vertexLength;ef(this.layoutVertexArray,w,P,-1,-1),ef(this.layoutVertexArray,w,P,1,-1),ef(this.layoutVertexArray,w,P,1,1),ef(this.layoutVertexArray,w,P,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+2,R+3),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},u,d)}}function Ug(r,e){for(let t=0;t<r.length;t++)if(ha(e,r[t]))return!0;for(let t=0;t<e.length;t++)if(ha(r,e[t]))return!0;return!!Lp(r,e)}function Hb(r,e,t){return!!ha(r,e)||!!Fp(e,r,t)}function Vg(r,e){if(r.length===1)return Gg(e,r[0]);for(let t=0;t<e.length;t++){const a=e[t];for(let u=0;u<a.length;u++)if(ha(r,a[u]))return!0}for(let t=0;t<r.length;t++)if(Gg(e,r[t]))return!0;for(let t=0;t<e.length;t++)if(Lp(r,e[t]))return!0;return!1}function Wb(r,e,t){if(r.length>1){if(Lp(r,e))return!0;for(let a=0;a<e.length;a++)if(Fp(e[a],r,t))return!0}for(let a=0;a<r.length;a++)if(Fp(r[a],e,t))return!0;return!1}function Lp(r,e){if(r.length===0||e.length===0)return!1;for(let t=0;t<r.length-1;t++){const a=r[t],u=r[t+1];for(let d=0;d<e.length-1;d++)if(Xb(a,u,e[d],e[d+1]))return!0}return!1}function Xb(r,e,t,a){return kr(r,t,a)!==kr(e,t,a)&&kr(r,e,t)!==kr(r,e,a)}function Fp(r,e,t){const a=t*t;if(e.length===1)return r.distSqr(e[0])<a;for(let u=1;u<e.length;u++)if($g(r,e[u-1],e[u])<a)return!0;return!1}function $g(r,e,t){const a=e.distSqr(t);if(a===0)return r.distSqr(e);const u=((r.x-e.x)*(t.x-e.x)+(r.y-e.y)*(t.y-e.y))/a;return r.distSqr(u<0?e:u>1?t:t.sub(e)._mult(u)._add(e))}function Gg(r,e){let t,a,u,d=!1;for(let m=0;m<r.length;m++){t=r[m];for(let g=0,b=t.length-1;g<t.length;b=g++)a=t[g],u=t[b],a.y>e.y!=u.y>e.y&&e.x<(u.x-a.x)*(e.y-a.y)/(u.y-a.y)+a.x&&(d=!d)}return d}function ha(r,e){let t=!1;for(let a=0,u=r.length-1;a<r.length;u=a++){const d=r[a],m=r[u];d.y>e.y!=m.y>e.y&&e.x<(m.x-d.x)*(e.y-d.y)/(m.y-d.y)+d.x&&(t=!t)}return t}function qg(r,e,t,a,u){for(const m of r)if(e<=m.x&&t<=m.y&&a>=m.x&&u>=m.y)return!0;const d=[new L(e,t),new L(e,u),new L(a,u),new L(a,t)];if(r.length>2){for(const m of d)if(ha(r,m))return!0}for(let m=0;m<r.length-1;m++)if(Qb(r[m],r[m+1],d))return!0;return!1}function Qb(r,e,t){const a=t[0],u=t[2];if(r.x<a.x&&e.x<a.x||r.x>u.x&&e.x>u.x||r.y<a.y&&e.y<a.y||r.y>u.y&&e.y>u.y)return!1;const d=kr(r,e,t[0]);return d!==kr(r,e,t[1])||d!==kr(r,e,t[2])||d!==kr(r,e,t[3])}function _l(r,e,t){const a=e.paint.get(r).value;return a.kind==="constant"?a.value:t.programConfigurations.get(e.id).getMaxValue(r)}function rf(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Zg(r,e,t,a,u){if(!e[0]&&!e[1])return r;const d=L.convert(e)._mult(u);t==="viewport"&&d._rotate(-a);const m=[];for(let g=0;g<r.length;g++)m.push(r[g].sub(d));return m}function Hg(r,e,t,a){const u=L.convert(r)._mult(a);return e==="viewport"&&u._rotate(-t),u}pt(Op,"CircleBucket",{omit:["layers"]});const Yb=new Le({"circle-sort-key":new ye(ke.layout_circle["circle-sort-key"])});var Kb={paint:new Le({"circle-radius":new ye(ke.paint_circle["circle-radius"]),"circle-color":new ye(ke.paint_circle["circle-color"]),"circle-blur":new ye(ke.paint_circle["circle-blur"]),"circle-opacity":new ye(ke.paint_circle["circle-opacity"]),"circle-translate":new ue(ke.paint_circle["circle-translate"]),"circle-translate-anchor":new ue(ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ue(ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ue(ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ye(ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ye(ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ye(ke.paint_circle["circle-stroke-opacity"])}),layout:Yb},nf=1e-6,Ki=typeof Float32Array!="undefined"?Float32Array:Array;function Wg(){var r=new Ki(9);return Ki!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function eo(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Bp(r,e){var t=e[0],a=e[1],u=e[2],d=e[3],m=e[4],g=e[5],b=e[6],w=e[7],P=e[8],C=e[9],R=e[10],O=e[11],B=e[12],$=e[13],q=e[14],te=e[15],le=t*g-a*m,ne=t*b-u*m,se=t*w-d*m,me=a*b-u*g,ce=a*w-d*g,Me=u*w-d*b,Pe=P*$-C*B,Oe=P*q-R*B,rt=P*te-O*B,ze=C*q-R*$,je=C*te-O*$,qe=R*te-O*q,Ne=le*qe-ne*je+se*ze+me*rt-ce*Oe+Me*Pe;return Ne?(r[0]=(g*qe-b*je+w*ze)*(Ne=1/Ne),r[1]=(u*je-a*qe-d*ze)*Ne,r[2]=($*Me-q*ce+te*me)*Ne,r[3]=(R*ce-C*Me-O*me)*Ne,r[4]=(b*rt-m*qe-w*Oe)*Ne,r[5]=(t*qe-u*rt+d*Oe)*Ne,r[6]=(q*se-B*Me-te*ne)*Ne,r[7]=(P*Me-R*se+O*ne)*Ne,r[8]=(m*je-g*rt+w*Pe)*Ne,r[9]=(a*rt-t*je-d*Pe)*Ne,r[10]=(B*ce-$*se+te*le)*Ne,r[11]=(C*se-P*ce-O*le)*Ne,r[12]=(g*Oe-m*ze-b*Pe)*Ne,r[13]=(t*ze-a*Oe+u*Pe)*Ne,r[14]=($*ne-B*me-q*le)*Ne,r[15]=(P*me-C*ne+R*le)*Ne,r):null}function gl(r,e,t){var a=e[0],u=e[1],d=e[2],m=e[3],g=e[4],b=e[5],w=e[6],P=e[7],C=e[8],R=e[9],O=e[10],B=e[11],$=e[12],q=e[13],te=e[14],le=e[15],ne=t[0],se=t[1],me=t[2],ce=t[3];return r[0]=ne*a+se*g+me*C+ce*$,r[1]=ne*u+se*b+me*R+ce*q,r[2]=ne*d+se*w+me*O+ce*te,r[3]=ne*m+se*P+me*B+ce*le,r[4]=(ne=t[4])*a+(se=t[5])*g+(me=t[6])*C+(ce=t[7])*$,r[5]=ne*u+se*b+me*R+ce*q,r[6]=ne*d+se*w+me*O+ce*te,r[7]=ne*m+se*P+me*B+ce*le,r[8]=(ne=t[8])*a+(se=t[9])*g+(me=t[10])*C+(ce=t[11])*$,r[9]=ne*u+se*b+me*R+ce*q,r[10]=ne*d+se*w+me*O+ce*te,r[11]=ne*m+se*P+me*B+ce*le,r[12]=(ne=t[12])*a+(se=t[13])*g+(me=t[14])*C+(ce=t[15])*$,r[13]=ne*u+se*b+me*R+ce*q,r[14]=ne*d+se*w+me*O+ce*te,r[15]=ne*m+se*P+me*B+ce*le,r}function ru(r,e,t){var a,u,d,m,g,b,w,P,C,R,O,B,$=t[0],q=t[1],te=t[2];return e===r?(r[12]=e[0]*$+e[4]*q+e[8]*te+e[12],r[13]=e[1]*$+e[5]*q+e[9]*te+e[13],r[14]=e[2]*$+e[6]*q+e[10]*te+e[14],r[15]=e[3]*$+e[7]*q+e[11]*te+e[15]):(u=e[1],d=e[2],m=e[3],g=e[4],b=e[5],w=e[6],P=e[7],C=e[8],R=e[9],O=e[10],B=e[11],r[0]=a=e[0],r[1]=u,r[2]=d,r[3]=m,r[4]=g,r[5]=b,r[6]=w,r[7]=P,r[8]=C,r[9]=R,r[10]=O,r[11]=B,r[12]=a*$+g*q+C*te+e[12],r[13]=u*$+b*q+R*te+e[13],r[14]=d*$+w*q+O*te+e[14],r[15]=m*$+P*q+B*te+e[15]),r}function fa(r,e,t){var a=t[0],u=t[1],d=t[2];return r[0]=e[0]*a,r[1]=e[1]*a,r[2]=e[2]*a,r[3]=e[3]*a,r[4]=e[4]*u,r[5]=e[5]*u,r[6]=e[6]*u,r[7]=e[7]*u,r[8]=e[8]*d,r[9]=e[9]*d,r[10]=e[10]*d,r[11]=e[11]*d,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function jp(r,e,t){var a=Math.sin(t),u=Math.cos(t),d=e[4],m=e[5],g=e[6],b=e[7],w=e[8],P=e[9],C=e[10],R=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=d*u+w*a,r[5]=m*u+P*a,r[6]=g*u+C*a,r[7]=b*u+R*a,r[8]=w*u-d*a,r[9]=P*u-m*a,r[10]=C*u-g*a,r[11]=R*u-b*a,r}function of(r,e,t){var a=Math.sin(t),u=Math.cos(t),d=e[0],m=e[1],g=e[2],b=e[3],w=e[8],P=e[9],C=e[10],R=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=d*u-w*a,r[1]=m*u-P*a,r[2]=g*u-C*a,r[3]=b*u-R*a,r[8]=d*a+w*u,r[9]=m*a+P*u,r[10]=g*a+C*u,r[11]=b*a+R*u,r}function Xg(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Qg(r,e,t){var a,u,d,m=t[0],g=t[1],b=t[2],w=Math.hypot(m,g,b);return w<nf?null:(m*=w=1/w,g*=w,b*=w,a=Math.sin(e),u=Math.cos(e),r[0]=m*m*(d=1-u)+u,r[1]=g*m*d+b*a,r[2]=b*m*d-g*a,r[3]=0,r[4]=m*g*d-b*a,r[5]=g*g*d+u,r[6]=b*g*d+m*a,r[7]=0,r[8]=m*b*d+g*a,r[9]=g*b*d-m*a,r[10]=b*b*d+u,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var Jb=gl;function Np(){var r=new Ki(3);return Ki!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Yg(r){var e=new Ki(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function iu(r){return Math.hypot(r[0],r[1],r[2])}function yl(r,e,t){var a=new Ki(3);return a[0]=r,a[1]=e,a[2]=t,a}function hs(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r}function Up(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r}function Kg(r,e,t){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r}function Vp(r,e,t){return r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r}function $p(r,e,t){return r[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r}function Rn(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r}function sf(r,e,t,a){return r[0]=e[0]+t[0]*a,r[1]=e[1]+t[1]*a,r[2]=e[2]+t[2]*a,r}function Oi(r,e){var t=e[0],a=e[1],u=e[2],d=t*t+a*a+u*u;return d>0&&(d=1/Math.sqrt(d)),r[0]=e[0]*d,r[1]=e[1]*d,r[2]=e[2]*d,r}function bn(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Gp(r,e,t){var a=e[0],u=e[1],d=e[2],m=t[0],g=t[1],b=t[2];return r[0]=u*b-d*g,r[1]=d*m-a*b,r[2]=a*g-u*m,r}function ni(r,e,t){var a=e[0],u=e[1],d=e[2],m=t[3]*a+t[7]*u+t[11]*d+t[15];return r[0]=(t[0]*a+t[4]*u+t[8]*d+t[12])/(m=m||1),r[1]=(t[1]*a+t[5]*u+t[9]*d+t[13])/m,r[2]=(t[2]*a+t[6]*u+t[10]*d+t[14])/m,r}function Jg(r,e,t){var a=t[0],u=t[1],d=t[2],m=e[0],g=e[1],b=e[2],w=u*b-d*g,P=d*m-a*b,C=a*g-u*m,R=u*C-d*P,O=d*w-a*C,B=a*P-u*w,$=2*t[3];return P*=$,C*=$,O*=2,B*=2,r[0]=m+(w*=$)+(R*=2),r[1]=g+P+O,r[2]=b+C+B,r}var nu,kn=Up,ew=Kg,tw=iu;function ey(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function da(r,e,t){var a=e[0],u=e[1],d=e[2],m=e[3];return r[0]=t[0]*a+t[4]*u+t[8]*d+t[12]*m,r[1]=t[1]*a+t[5]*u+t[9]*d+t[13]*m,r[2]=t[2]*a+t[6]*u+t[10]*d+t[14]*m,r[3]=t[3]*a+t[7]*u+t[11]*d+t[15]*m,r}function ty(){var r=new Ki(4);return Ki!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function ry(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function iy(r,e,t){t*=.5;var a=e[0],u=e[1],d=e[2],m=e[3],g=Math.sin(t),b=Math.cos(t);return r[0]=a*b+m*g,r[1]=u*b+d*g,r[2]=d*b-u*g,r[3]=m*b-a*g,r}function ny(r,e,t){t*=.5;var a=e[0],u=e[1],d=e[2],m=e[3],g=Math.sin(t),b=Math.cos(t);return r[0]=a*b-d*g,r[1]=u*b+m*g,r[2]=d*b+a*g,r[3]=m*b-u*g,r}Np(),nu=new Ki(4),Ki!=Float32Array&&(nu[0]=0,nu[1]=0,nu[2]=0,nu[3]=0),Np(),yl(1,0,0),yl(0,1,0),ty(),ty(),Wg();class qp{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,a){const u=bn(t,this.dir);if(Math.abs(u)<1e-6)return!1;const d=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/u;return a[0]=this.pos[0]+this.dir[0]*d,a[1]=this.pos[1]+this.dir[1]*d,a[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,t,a){if(function(O,B){var $=O[0],q=O[1],te=O[2],le=B[0],ne=B[1],se=B[2];return Math.abs($-le)<=nf*Math.max(1,Math.abs($),Math.abs(le))&&Math.abs(q-ne)<=nf*Math.max(1,Math.abs(q),Math.abs(ne))&&Math.abs(te-se)<=nf*Math.max(1,Math.abs(te),Math.abs(se))}(this.pos,e)||t===0)return a[0]=a[1]=a[2]=0,!1;const[u,d,m]=this.dir,g=this.pos[0]-e[0],b=this.pos[1]-e[1],w=this.pos[2]-e[2],P=u*u+d*d+m*m,C=2*(g*u+b*d+w*m),R=C*C-4*P*(g*g+b*b+w*w-t*t);if(R<0){const O=Math.max(-C/2,0),B=g+u*O,$=b+d*O,q=w+m*O,te=Math.hypot(B,$,q);return a[0]=B*t/te,a[1]=$*t/te,a[2]=q*t/te,!1}{const O=(-C-Math.sqrt(R))/(2*P);if(O<0){const B=Math.hypot(g,b,w);return a[0]=g*t/B,a[1]=b*t/B,a[2]=w*t/B,!1}return a[0]=g+u*O,a[1]=b+d*O,a[2]=w+m*O,!0}}}class Zp{constructor(e,t,a,u,d){this.TL=e,this.TR=t,this.BR=a,this.BL=u,this.horizon=d}static fromInvProjectionMatrix(e,t,a){const u=[-1,1,1],d=[1,1,1],m=[1,-1,1],g=[-1,-1,1],b=ni(u,u,e),w=ni(d,d,e),P=ni(m,m,e),C=ni(g,g,e);return new Zp(b,w,P,C,t/a)}}class Hp{constructor(e,t){this.points=e,this.planes=t}static fromInvProjectionMatrix(e,t,a,u){const d=Math.pow(2,a),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const w=da([],b,e),P=1/w[3]/t*d;return function(C,R,O){return C[0]=R[0]*O[0],C[1]=R[1]*O[1],C[2]=R[2]*O[2],C[3]=R[3]*O[3],C}(w,w,[P,P,u?1/w[3]:P,P])}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const w=Oi([],Gp([],kn([],m[b[0]],m[b[1]]),kn([],m[b[2]],m[b[1]]))),P=-bn(w,m[b[1]]);return w.concat(P)});return new Hp(m,g)}}class Gi{static fromPoints(e){const t=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],a=[Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE];for(const u of e)t[0]=Math.min(t[0],u[0]),t[1]=Math.min(t[1],u[1]),t[2]=Math.min(t[2],u[2]),a[0]=Math.max(a[0],u[0]),a[1]=Math.max(a[1],u[1]),a[2]=Math.max(a[2],u[2]);return new Gi(t,a)}constructor(e,t){this.min=e,this.max=t,this.center=Rn([],hs([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],a=Yg(this.min),u=Yg(this.max);for(let d=0;d<t.length;d++)a[d]=t[d]?this.min[d]:this.center[d],u[d]=t[d]?this.center[d]:this.max[d];return u[2]=this.max[2],new Gi(a,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){const t=this.getCorners();let a=!0;for(let u=0;u<e.planes.length;u++){const d=e.planes[u];let m=0;for(let g=0;g<t.length;g++)m+=bn(d,t[g])+d[3]>=0;if(m===0)return 0;m!==t.length&&(a=!1)}if(a)return 2;for(let u=0;u<3;u++){let d=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let g=0;g<e.points.length;g++){const b=e.points[g][u]-this.min[u];d=Math.min(d,b),m=Math.max(m,b)}if(m<0||d>this.max[u]-this.min[u])return 0}return 1}}function oy(r,e,t,a,u,d,m,g,b){if(d&&r.queryGeometry.isAboveHorizon)return!1;d&&(b*=r.pixelToTileUnitsFactor);const w=r.tileID.canonical,P=t.projection.upVectorScale(w,t.center.lat,t.worldSize).metersToTile;for(const C of e)for(const R of C){const O=R.add(g),B=u&&t.elevation?t.elevation.exaggeration()*u.getElevationAt(O.x,O.y,!0):0,$=t.projection.projectTilePoint(O.x,O.y,w);if(B>0){const ne=t.projection.upVector(w,O.x,O.y);$.x+=ne[0]*P*B,$.y+=ne[1]*P*B,$.z+=ne[2]*P*B}const q=d?O:rw($.x,$.y,$.z,a),te=d?r.tilespaceRays.map(ne=>nw(ne,B)):r.queryGeometry.screenGeometry,le=da([],[$.x,$.y,$.z,1],a);if(!m&&d?b*=le[3]/t.cameraToCenterDistance:m&&!d&&(b*=t.cameraToCenterDistance/le[3]),d){const ne=yi((R.y/It+w.y)/(1<<w.z));b/=t.projection.pixelsPerMeter(ne,1)/vn(1,ne)}if(Hb(te,q,b))return!0}return!1}function rw(r,e,t,a){const u=da([],[r,e,t,1],a);return new L(u[0]/u[3],u[1]/u[3])}const sy=yl(0,0,0),iw=yl(0,0,1);function nw(r,e){const t=Np();return sy[2]=e,r.intersectsPlane(sy,iw,t),new L(t[0],t[1])}class ay extends Op{}function ly(r,{width:e,height:t},a,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*t*a)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*t*a);return r.width=e,r.height=t,r.data=u,r}function cy(r,e,t){const{width:a,height:u}=e;a===r.width&&u===r.height||(Wp(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,a),height:Math.min(r.height,u)},t),r.width=a,r.height=u,r.data=e.data)}function Wp(r,e,t,a,u,d){if(u.width===0||u.height===0)return e;if(u.width>r.width||u.height>r.height||t.x>r.width-u.width||t.y>r.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||a.x>e.width-u.width||a.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const m=r.data,g=e.data;for(let b=0;b<u.height;b++){const w=((t.y+b)*r.width+t.x)*d,P=((a.y+b)*e.width+a.x)*d;for(let C=0;C<u.width*d;C++)g[P+C]=m[w+C]}return e}pt(ay,"HeatmapBucket",{omit:["layers"]});class Io{constructor(e,t){ly(this,e,1,t)}resize(e){cy(this,new Io(e),1)}clone(){return new Io({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,a,u,d){Wp(e,t,a,u,d,1)}}class Ji{constructor(e,t){ly(this,e,4,t)}resize(e){cy(this,new Ji(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ji({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,a,u,d){Wp(e,t,a,u,d,4)}}pt(Io,"AlphaImage"),pt(Ji,"RGBAImage");var ow={paint:new Le({"heatmap-radius":new ye(ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ye(ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ue(ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new be(ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ue(ke.paint_heatmap["heatmap-opacity"])})};function Xp(r){const e={},t=r.resolution||256,a=r.clips?r.clips.length:1,u=r.image||new Ji({width:t,height:a}),d=(m,g,b)=>{e[r.evaluationKey]=b;const w=r.expression.evaluate(e);u.data[m+g+0]=Math.floor(255*w.r/w.a),u.data[m+g+1]=Math.floor(255*w.g/w.a),u.data[m+g+2]=Math.floor(255*w.b/w.a),u.data[m+g+3]=Math.floor(255*w.a)};if(r.clips)for(let m=0,g=0;m<a;++m,g+=4*t)for(let b=0,w=0;b<t;b++,w+=4){const P=b/(t-1),{start:C,end:R}=r.clips[m];d(g,w,C*(1-P)+R*P)}else for(let m=0,g=0;m<t;m++,g+=4)d(0,g,m/(t-1));return u}var sw={paint:new Le({"hillshade-illumination-direction":new ue(ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ue(ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ue(ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ue(ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ue(ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ue(ke.paint_hillshade["hillshade-accent-color"])})};const aw=Be([{name:"a_pos",components:2,type:"Int16"}],4),{members:lw}=aw;var af=lf,cw=lf;function lf(r,e,t){t=t||2;var a,u,d,m,g,b,w,P=e&&e.length,C=P?e[0]*t:r.length,R=uy(r,0,C,t,!0),O=[];if(!R||R.next===R.prev)return O;if(P&&(R=function($,q,te,le){var ne,se,me,ce=[];for(ne=0,se=q.length;ne<se;ne++)(me=uy($,q[ne]*le,ne<se-1?q[ne+1]*le:$.length,le,!1))===me.next&&(me.steiner=!0),ce.push(gw(me));for(ce.sort(pw),ne=0;ne<ce.length;ne++)te=mw(ce[ne],te);return te}(r,e,R,t)),r.length>80*t){a=d=r[0],u=m=r[1];for(var B=t;B<C;B+=t)(g=r[B])<a&&(a=g),(b=r[B+1])<u&&(u=b),g>d&&(d=g),b>m&&(m=b);w=(w=Math.max(d-a,m-u))!==0?32767/w:0}return ou(R,O,t,a,u,w,0),O}function uy(r,e,t,a,u){var d,m;if(u===Kp(r,e,t,a)>0)for(d=e;d<t;d+=a)m=dy(d,r[d],r[d+1],m);else for(d=t-a;d>=e;d-=a)m=dy(d,r[d],r[d+1],m);return m&&cf(m,m.next)&&(au(m),m=m.next),m}function pa(r,e){if(!r)return r;e||(e=r);var t,a=r;do if(t=!1,a.steiner||!cf(a,a.next)&&Qr(a.prev,a,a.next)!==0)a=a.next;else{if(au(a),(a=e=a.prev)===a.next)break;t=!0}while(t||a!==e);return e}function ou(r,e,t,a,u,d,m){if(r){!m&&d&&function(P,C,R,O){var B=P;do B.z===0&&(B.z=Qp(B.x,B.y,C,R,O)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==P);B.prevZ.nextZ=null,B.prevZ=null,function($){var q,te,le,ne,se,me,ce,Me,Pe=1;do{for(te=$,$=null,se=null,me=0;te;){for(me++,le=te,ce=0,q=0;q<Pe&&(ce++,le=le.nextZ);q++);for(Me=Pe;ce>0||Me>0&&le;)ce!==0&&(Me===0||!le||te.z<=le.z)?(ne=te,te=te.nextZ,ce--):(ne=le,le=le.nextZ,Me--),se?se.nextZ=ne:$=ne,ne.prevZ=se,se=ne;te=le}se.nextZ=null,Pe*=2}while(me>1)}(B)}(r,a,u,d);for(var g,b,w=r;r.prev!==r.next;)if(g=r.prev,b=r.next,d?hw(r,a,u,d):uw(r))e.push(g.i/t|0),e.push(r.i/t|0),e.push(b.i/t|0),au(r),r=b.next,w=b.next;else if((r=b)===w){m?m===1?ou(r=fw(pa(r),e,t),e,t,a,u,d,2):m===2&&dw(r,e,t,a,u,d):ou(pa(r),e,t,a,u,d,1);break}}}function uw(r){var e=r.prev,t=r,a=r.next;if(Qr(e,t,a)>=0)return!1;for(var u=e.x,d=t.x,m=a.x,g=e.y,b=t.y,w=a.y,P=u<d?u<m?u:m:d<m?d:m,C=g<b?g<w?g:w:b<w?b:w,R=u>d?u>m?u:m:d>m?d:m,O=g>b?g>w?g:w:b>w?b:w,B=a.next;B!==e;){if(B.x>=P&&B.x<=R&&B.y>=C&&B.y<=O&&vl(u,g,d,b,m,w,B.x,B.y)&&Qr(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function hw(r,e,t,a){var u=r.prev,d=r,m=r.next;if(Qr(u,d,m)>=0)return!1;for(var g=u.x,b=d.x,w=m.x,P=u.y,C=d.y,R=m.y,O=g<b?g<w?g:w:b<w?b:w,B=P<C?P<R?P:R:C<R?C:R,$=g>b?g>w?g:w:b>w?b:w,q=P>C?P>R?P:R:C>R?C:R,te=Qp(O,B,e,t,a),le=Qp($,q,e,t,a),ne=r.prevZ,se=r.nextZ;ne&&ne.z>=te&&se&&se.z<=le;){if(ne.x>=O&&ne.x<=$&&ne.y>=B&&ne.y<=q&&ne!==u&&ne!==m&&vl(g,P,b,C,w,R,ne.x,ne.y)&&Qr(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,se.x>=O&&se.x<=$&&se.y>=B&&se.y<=q&&se!==u&&se!==m&&vl(g,P,b,C,w,R,se.x,se.y)&&Qr(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;ne&&ne.z>=te;){if(ne.x>=O&&ne.x<=$&&ne.y>=B&&ne.y<=q&&ne!==u&&ne!==m&&vl(g,P,b,C,w,R,ne.x,ne.y)&&Qr(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;se&&se.z<=le;){if(se.x>=O&&se.x<=$&&se.y>=B&&se.y<=q&&se!==u&&se!==m&&vl(g,P,b,C,w,R,se.x,se.y)&&Qr(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function fw(r,e,t){var a=r;do{var u=a.prev,d=a.next.next;!cf(u,d)&&hy(u,a,a.next,d)&&su(u,d)&&su(d,u)&&(e.push(u.i/t|0),e.push(a.i/t|0),e.push(d.i/t|0),au(a),au(a.next),a=r=d),a=a.next}while(a!==r);return pa(a)}function dw(r,e,t,a,u,d){var m=r;do{for(var g=m.next.next;g!==m.prev;){if(m.i!==g.i&&yw(m,g)){var b=fy(m,g);return m=pa(m,m.next),b=pa(b,b.next),ou(m,e,t,a,u,d,0),void ou(b,e,t,a,u,d,0)}g=g.next}m=m.next}while(m!==r)}function pw(r,e){return r.x-e.x}function mw(r,e){var t=function(u,d){var m,g=d,b=u.x,w=u.y,P=-1/0;do{if(w<=g.y&&w>=g.next.y&&g.next.y!==g.y){var C=g.x+(w-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(C<=b&&C>P&&(P=C,m=g.x<g.next.x?g:g.next,C===b))return m}g=g.next}while(g!==d);if(!m)return null;var R,O=m,B=m.x,$=m.y,q=1/0;g=m;do b>=g.x&&g.x>=B&&b!==g.x&&vl(w<$?b:P,w,B,$,w<$?P:b,w,g.x,g.y)&&(R=Math.abs(w-g.y)/(b-g.x),su(g,u)&&(R<q||R===q&&(g.x>m.x||g.x===m.x&&_w(m,g)))&&(m=g,q=R)),g=g.next;while(g!==O);return m}(r,e);if(!t)return e;var a=fy(t,r);return pa(a,a.next),pa(t,t.next)}function _w(r,e){return Qr(r.prev,r,e.prev)<0&&Qr(e.next,r,r.next)<0}function Qp(r,e,t,a,u){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-t)*u|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function gw(r){var e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t}function vl(r,e,t,a,u,d,m,g){return(u-m)*(e-g)>=(r-m)*(d-g)&&(r-m)*(a-g)>=(t-m)*(e-g)&&(t-m)*(d-g)>=(u-m)*(a-g)}function yw(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(t,a){var u=t;do{if(u.i!==t.i&&u.next.i!==t.i&&u.i!==a.i&&u.next.i!==a.i&&hy(u,u.next,t,a))return!0;u=u.next}while(u!==t);return!1}(r,e)&&(su(r,e)&&su(e,r)&&function(t,a){var u=t,d=!1,m=(t.x+a.x)/2,g=(t.y+a.y)/2;do u.y>g!=u.next.y>g&&u.next.y!==u.y&&m<(u.next.x-u.x)*(g-u.y)/(u.next.y-u.y)+u.x&&(d=!d),u=u.next;while(u!==t);return d}(r,e)&&(Qr(r.prev,r,e.prev)||Qr(r,e.prev,e))||cf(r,e)&&Qr(r.prev,r,r.next)>0&&Qr(e.prev,e,e.next)>0)}function Qr(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function cf(r,e){return r.x===e.x&&r.y===e.y}function hy(r,e,t,a){var u=hf(Qr(r,e,t)),d=hf(Qr(r,e,a)),m=hf(Qr(t,a,r)),g=hf(Qr(t,a,e));return u!==d&&m!==g||!(u!==0||!uf(r,t,e))||!(d!==0||!uf(r,a,e))||!(m!==0||!uf(t,r,a))||!(g!==0||!uf(t,e,a))}function uf(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function hf(r){return r>0?1:r<0?-1:0}function su(r,e){return Qr(r.prev,r,r.next)<0?Qr(r,e,r.next)>=0&&Qr(r,r.prev,e)>=0:Qr(r,e,r.prev)<0||Qr(r,r.next,e)<0}function fy(r,e){var t=new Yp(r.i,r.x,r.y),a=new Yp(e.i,e.x,e.y),u=r.next,d=e.prev;return r.next=e,e.prev=r,t.next=u,u.prev=t,a.next=t,t.prev=a,d.next=a,a.prev=d,a}function dy(r,e,t,a){var u=new Yp(r,e,t);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function au(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Yp(r,e,t){this.i=r,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Kp(r,e,t,a){for(var u=0,d=e,m=t-a;d<t;d+=a)u+=(r[m]-r[d])*(r[d+1]+r[m+1]),m=d;return u}function vw(r,e,t,a,u){py(r,e,t||0,a||r.length-1,u||xw)}function py(r,e,t,a,u){for(;a>t;){if(a-t>600){var d=a-t+1,m=e-t+1,g=Math.log(d),b=.5*Math.exp(2*g/3),w=.5*Math.sqrt(g*b*(d-b)/d)*(m-d/2<0?-1:1);py(r,e,Math.max(t,Math.floor(e-m*b/d+w)),Math.min(a,Math.floor(e+(d-m)*b/d+w)),u)}var P=r[e],C=t,R=a;for(lu(r,t,e),u(r[a],P)>0&&lu(r,t,a);C<R;){for(lu(r,C,R),C++,R--;u(r[C],P)<0;)C++;for(;u(r[R],P)>0;)R--}u(r[t],P)===0?lu(r,t,R):lu(r,++R,a),R<=e&&(t=R+1),e<=R&&(a=R-1)}}function lu(r,e,t){var a=r[e];r[e]=r[t],r[t]=a}function xw(r,e){return r<e?-1:r>e?1:0}function Jp(r,e){const t=r.length;if(t<=1)return[r];const a=[];let u,d;for(let m=0;m<t;m++){const g=Yr(r[m]);g!==0&&(r[m].area=Math.abs(g),d===void 0&&(d=g<0),d===g<0?(u&&a.push(u),u=[r[m]]):u.push(r[m]))}if(u&&a.push(u),e>1)for(let m=0;m<a.length;m++)a[m].length<=e||(vw(a[m],e,1,a[m].length-1,bw),a[m]=a[m].slice(0,e));return a}function bw(r,e){return e.area-r.area}function em(r,e,t){const a=t.patternDependencies;let u=!1;for(const d of e){const m=d.paint.get(`${r}-pattern`);m.isConstant()||(u=!0);const g=m.constantOr(null);g&&(u=!0,a[g.to]=!0,a[g.from]=!0)}return u}function tm(r,e,t,a,u){const d=u.patternDependencies;for(const m of e){const g=m.paint.get(`${r}-pattern`).value;if(g.kind!=="constant"){let b=g.evaluate({zoom:a-1},t,{},u.availableImages),w=g.evaluate({zoom:a},t,{},u.availableImages),P=g.evaluate({zoom:a+1},t,{},u.availableImages);b=b&&b.name?b.name:b,w=w&&w.name?w.name:w,P=P&&P.name?P.name:P,d[b]=!0,d[w]=!0,d[P]=!0,t.patterns[m.id]={min:b,mid:w,max:P}}}return t}lf.deviation=function(r,e,t,a){var u=e&&e.length,d=Math.abs(Kp(r,0,u?e[0]*t:r.length,t));if(u)for(var m=0,g=e.length;m<g;m++)d-=Math.abs(Kp(r,e[m]*t,m<g-1?e[m+1]*t:r.length,t));var b=0;for(m=0;m<a.length;m+=3){var w=a[m]*t,P=a[m+1]*t,C=a[m+2]*t;b+=Math.abs((r[w]-r[C])*(r[P+1]-r[w+1])-(r[w]-r[P])*(r[C+1]-r[w+1]))}return d===0&&b===0?0:Math.abs((b-d)/d)},lf.flatten=function(r){for(var e=r[0][0].length,t={vertices:[],holes:[],dimensions:e},a=0,u=0;u<r.length;u++){for(var d=0;d<r[u].length;d++)for(var m=0;m<e;m++)t.vertices.push(r[u][d][m]);u>0&&t.holes.push(a+=r[u-1].length)}return t},af.default=cw;class ff{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ot,this.indexArray=new Ut,this.indexArray2=new Ti,this.programConfigurations=new ca(e.layers,e.zoom),this.segments=new Kr,this.segments2=new Kr,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.projection=e.projection}populate(e,t,a,u){this.hasPattern=em("fill",this.layers,t);const d=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:g,id:b,index:w,sourceLayerIndex:P}of e){const C=this.layers[0]._featureFilter.needGeometry,R=ua(g,C);if(!this.layers[0]._featureFilter.filter(new Q(this.zoom),R,a))continue;const O=d?d.evaluate(R,{},a,t.availableImages):void 0,B={id:b,properties:g.properties,type:g.type,sourceLayerIndex:P,index:w,geometry:C?R.geometry:Po(g,a,u),patterns:{},sortKey:O};m.push(B)}d&&m.sort((g,b)=>g.sortKey-b.sortKey);for(const g of m){const{geometry:b,index:w,sourceLayerIndex:P}=g;if(this.hasPattern){const C=tm("fill",this.layers,g,this.zoom,t);this.patternFeatures.push(C)}else this.addFeature(g,b,w,a,{},t.availableImages);t.featureIndex.insert(e[w].feature,b,w,P,this.index)}}update(e,t,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,a,u)}addFeatures(e,t,a,u,d){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,t,a,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lw),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,a,u,d,m=[]){for(const g of Jp(t,500)){let b=0;for(const B of g)b+=B.length;const w=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),P=w.vertexLength,C=[],R=[];for(const B of g){if(B.length===0)continue;B!==g[0]&&R.push(C.length/2);const $=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),q=$.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(q+B.length-1,q),C.push(B[0].x),C.push(B[0].y);for(let te=1;te<B.length;te++)this.layoutVertexArray.emplaceBack(B[te].x,B[te].y),this.indexArray2.emplaceBack(q+te-1,q+te),C.push(B[te].x),C.push(B[te].y);$.vertexLength+=B.length,$.primitiveLength+=B.length}const O=af(C,R);for(let B=0;B<O.length;B+=3)this.indexArray.emplaceBack(P+O[B],P+O[B+1],P+O[B+2]);w.vertexLength+=b,w.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,m,u)}}pt(ff,"FillBucket",{omit:["layers","patternFeatures"]});const ww=new Le({"fill-sort-key":new ye(ke.layout_fill["fill-sort-key"])});var Tw={paint:new Le({"fill-antialias":new ue(ke.paint_fill["fill-antialias"]),"fill-opacity":new ye(ke.paint_fill["fill-opacity"]),"fill-color":new ye(ke.paint_fill["fill-color"]),"fill-outline-color":new ye(ke.paint_fill["fill-outline-color"]),"fill-translate":new ue(ke.paint_fill["fill-translate"]),"fill-translate-anchor":new ue(ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ae(ke.paint_fill["fill-pattern"])}),layout:ww};const Ew=Be([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Sw=Be([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Aw=Be([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Pw}=Ew;var my=xl;function xl(r,e,t,a,u){this.properties={},this.extent=t,this.type=0,this._pbf=r,this._geometry=-1,this._keys=a,this._values=u,r.readFields(Iw,this,e)}function Iw(r,e,t){r==1?e.id=t.readVarint():r==2?function(a,u){for(var d=a.readVarint()+a.pos;a.pos<d;){var m=u._keys[a.readVarint()],g=u._values[a.readVarint()];u.properties[m]=g}}(t,e):r==3?e.type=t.readVarint():r==4&&(e._geometry=t.pos)}function Mw(r){for(var e,t,a=0,u=0,d=r.length,m=d-1;u<d;m=u++)a+=((t=r[m]).x-(e=r[u]).x)*(e.y+t.y);return a}xl.types=["Unknown","Point","LineString","Polygon"],xl.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,t=r.readVarint()+r.pos,a=1,u=0,d=0,m=0,g=[];r.pos<t;){if(u<=0){var b=r.readVarint();a=7&b,u=b>>3}if(u--,a===1||a===2)d+=r.readSVarint(),m+=r.readSVarint(),a===1&&(e&&g.push(e),e=[]),e.push(new L(d,m));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&g.push(e),g},xl.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,t=1,a=0,u=0,d=0,m=1/0,g=-1/0,b=1/0,w=-1/0;r.pos<e;){if(a<=0){var P=r.readVarint();t=7&P,a=P>>3}if(a--,t===1||t===2)(u+=r.readSVarint())<m&&(m=u),u>g&&(g=u),(d+=r.readSVarint())<b&&(b=d),d>w&&(w=d);else if(t!==7)throw new Error("unknown command "+t)}return[m,b,g,w]},xl.prototype.toGeoJSON=function(r,e,t){var a,u,d=this.extent*Math.pow(2,t),m=this.extent*r,g=this.extent*e,b=this.loadGeometry(),w=xl.types[this.type];function P(O){for(var B=0;B<O.length;B++){var $=O[B];O[B]=[360*($.x+m)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*($.y+g)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(a=0;a<b.length;a++)C[a]=b[a][0];P(b=C);break;case 2:for(a=0;a<b.length;a++)P(b[a]);break;case 3:for(b=function(O){var B=O.length;if(B<=1)return[O];for(var $,q,te=[],le=0;le<B;le++){var ne=Mw(O[le]);ne!==0&&(q===void 0&&(q=ne<0),q===ne<0?($&&te.push($),$=[O[le]]):$.push(O[le]))}return $&&te.push($),te}(b),a=0;a<b.length;a++)for(u=0;u<b[a].length;u++)P(b[a][u])}b.length===1?b=b[0]:w="Multi"+w;var R={type:"Feature",geometry:{type:w,coordinates:b},properties:this.properties};return"id"in this&&(R.id=this.id),R};var _y=gy;function gy(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(Cw,this,e),this.length=this._features.length}function Cw(r,e,t){r===15?e.version=t.readVarint():r===1?e.name=t.readString():r===5?e.extent=t.readVarint():r===2?e._features.push(t.pos):r===3?e._keys.push(t.readString()):r===4&&e._values.push(function(a){for(var u=null,d=a.readVarint()+a.pos;a.pos<d;){var m=a.readVarint()>>3;u=m===1?a.readString():m===2?a.readFloat():m===3?a.readDouble():m===4?a.readVarint64():m===5?a.readVarint():m===6?a.readSVarint():m===7?a.readBoolean():null}return u}(t))}function zw(r,e,t){if(r===3){var a=new _y(t,t.readVarint()+t.pos);a.length&&(e[a.name]=a)}}gy.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new my(this._pbf,e,this.extent,this._keys,this._values)};var ma={VectorTile:function(r,e){this.layers=r.readFields(zw,{},e)},VectorTileFeature:my,VectorTileLayer:_y};function df(r,e,t,a){const u=[],d=a===0?(m,g,b,w,P,C)=>{m.push(new L(C,b+(C-g)/(w-g)*(P-b)))}:(m,g,b,w,P,C)=>{m.push(new L(g+(C-b)/(P-b)*(w-g),C))};for(const m of r){const g=[];for(const b of m){if(b.length<=2)continue;const w=[];for(let R=0;R<b.length-1;R++){const O=b[R].x,B=b[R].y,$=b[R+1].x,q=b[R+1].y,te=a===0?O:B,le=a===0?$:q;te<e?le>e&&d(w,O,B,$,q,e):te>t?le<t&&d(w,O,B,$,q,t):w.push(b[R]),le<e&&te>=e&&d(w,O,B,$,q,e),le>t&&te<=t&&d(w,O,B,$,q,t)}let P=b[b.length-1];const C=a===0?P.x:P.y;C>=e&&C<=t&&w.push(P),w.length&&(P=w[w.length-1],w[0].x===P.x&&w[0].y===P.y||w.push(w[0]),g.push(w))}g.length&&u.push(g)}return u}const Rw=ma.VectorTileFeature.types,kw=Math.pow(2,13);function cu(r,e,t,a,u,d,m,g){r.emplaceBack((e<<1)+m,(t<<1)+d,(Math.floor(a*kw)<<1)+u,Math.round(g))}function uu(r,e,t){const a=16384;r.emplaceBack(e.x,e.y,e.z,t[0]*a,t[1]*a,t[2]*a)}class yy{constructor(){this.acc=new L(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new L(e.x,e.y),this.max=new L(e.x,e.y))}append(e,t){this.currentPolyCount.edges++,this.acc._add(e);const a=this.min,u=this.max;e.x<a.x?a.x=e.x:e.x>u.x&&(u.x=e.x),e.y<a.y?a.y=e.y:e.y>u.y&&(u.y=e.y),((e.x===0||e.x===It)&&e.x===t.x)!=((e.y===0||e.y===It)&&e.y===t.y)&&this.processBorderOverlap(e,t),t.x<0!=e.x<0&&this.addBorderIntersection(0,Xt(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>It!=e.x>It&&this.addBorderIntersection(1,Xt(t.y,e.y,(It-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,Xt(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>It!=e.y>It&&this.addBorderIntersection(3,Xt(t.x,e.x,(It-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];t<a[0]&&(a[0]=t),t>a[1]&&(a[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,t.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,t.x),this.addBorderIntersection(a,e.x)}}centroid(){const e=this.polyCount.reduce((t,a)=>t+a.edges,0);return e!==0?this.acc.div(e)._round():new L(0,0)}span(){return new L(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,t)=>e+ +(t[0]!==Number.MAX_VALUE),0)}}class hu{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new wt,this.centroidVertexArray=new Ig,this.indexArray=new Ut,this.programConfigurations=new ca(e.layers,e.zoom),this.segments=new Kr,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.enableTerrain=e.enableTerrain}populate(e,t,a,u){this.features=[],this.hasPattern=em("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(d){const m=Math.exp(Math.PI*(1-d.y/(1<<d.z)*2));return 80150034*m/(m*m+1)/It/(1<<d.z)}(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:d,id:m,index:g,sourceLayerIndex:b}of e){const w=this.layers[0]._featureFilter.needGeometry,P=ua(d,w);if(!this.layers[0]._featureFilter.filter(new Q(this.zoom),P,a))continue;const C={id:m,sourceLayerIndex:b,index:g,geometry:w?P.geometry:Po(d,a,u),properties:d.properties,type:d.type,patterns:{}},R=this.layoutVertexArray.length;this.hasPattern?this.features.push(tm("fill-extrusion",this.layers,C,this.zoom,t)):this.addFeature(C,C.geometry,g,a,{},t.availableImages,u),t.featureIndex.insert(d,C.geometry,g,b,this.index,R)}this.sortBorders()}addFeatures(e,t,a,u,d){for(const m of this.features){const{geometry:g}=m;this.addFeature(m,g,m.index,t,a,u,d)}this.sortBorders()}update(e,t,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,a,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Pw),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Aw.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Sw.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,a,u,d,m,g){const b=[new L(0,0),new L(It,It)],w=g.projection,P=w.name==="globe",C=this.enableTerrain&&!P?new yy:null,R=Rw[e.type]==="Polygon";P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ei);const O=Jp(t,500);for(let te=O.length-1;te>=0;te--){const le=O[te];(le.length===0||(B=le[0]).every(ne=>ne.x<=0)||B.every(ne=>ne.x>=It)||B.every(ne=>ne.y<=0)||B.every(ne=>ne.y>=It))&&O.splice(te,1)}var B;let $;if(P)$=Sy(O,b,u);else{$=[];for(const te of O)$.push({polygon:te,bounds:b})}const q=R?this.edgeRadius:0;for(const{polygon:te,bounds:le}of $){let ne=0,se=0;for(const ce of te)R&&!ce[0].equals(ce[ce.length-1])&&ce.push(ce[0]),se+=R?ce.length-1:ce.length;const me=this.segments.prepareSegment((R?5:4)*se,this.layoutVertexArray,this.indexArray);if(R){const ce=[],Me=[];ne=me.vertexLength;for(const Oe of te){let rt,ze;Oe.length&&Oe!==te[0]&&Me.push(ce.length/2),rt=Oe[1].sub(Oe[0])._perp()._unit();for(let je=1;je<Oe.length;je++){const qe=Oe[je],Ne=Oe[je===Oe.length-1?1:je+1];let{x:et,y:Ze}=qe;if(q){ze=Ne.sub(qe)._perp()._unit();const at=rt.add(ze)._unit(),kt=q*Math.min(4,1/(rt.x*at.x+rt.y*at.y));et+=kt*at.x,Ze+=kt*at.y,rt=ze}cu(this.layoutVertexArray,et,Ze,0,0,1,1,0),me.vertexLength++,ce.push(qe.x,qe.y),P&&uu(this.layoutVertexExtArray,w.projectTilePoint(et,Ze,u),w.upVector(u,et,Ze))}}const Pe=af(ce,Me);for(let Oe=0;Oe<Pe.length;Oe+=3)this.indexArray.emplaceBack(ne+Pe[Oe],ne+Pe[Oe+2],ne+Pe[Oe+1]),me.primitiveLength++}for(const ce of te){C&&ce.length&&C.startRing(ce[0]);let Me,Pe,Oe,rt=ce.length>4&&wy(ce[ce.length-2],ce[0],ce[1]),ze=q?Dw(ce[ce.length-2],ce[0],ce[1],q):0;Pe=ce[1].sub(ce[0])._perp()._unit();for(let je=1,qe=0;je<ce.length;je++){let Ne=ce[je-1],et=ce[je];const Ze=ce[je===ce.length-1?1:je+1];if(C&&R&&C.currentPolyCount.top++,by(et,Ne,le)){q&&(Pe=Ze.sub(et)._perp()._unit());continue}C&&C.append(et,Ne);const at=et.sub(Ne)._perp(),kt=at.x/(Math.abs(at.x)+Math.abs(at.y)),Lt=at.y>0?1:0,xt=Ne.dist(et);if(qe+xt>32768&&(qe=0),q){Oe=Ze.sub(et)._perp()._unit();let ft=xy(Ne,et,Ze,vy(Pe,Oe),q);isNaN(ft)&&(ft=0);const yr=et.sub(Ne)._unit();Ne=Ne.add(yr.mult(ze))._round(),et=et.add(yr.mult(-ft))._round(),ze=ft,Pe=Oe}const nt=me.vertexLength,Zt=ce.length>4&&wy(Ne,et,Ze);let Ct=Ty(qe,rt,!0);if(cu(this.layoutVertexArray,Ne.x,Ne.y,kt,Lt,0,0,Ct),cu(this.layoutVertexArray,Ne.x,Ne.y,kt,Lt,0,1,Ct),qe+=xt,Ct=Ty(qe,Zt,!1),rt=Zt,cu(this.layoutVertexArray,et.x,et.y,kt,Lt,0,0,Ct),cu(this.layoutVertexArray,et.x,et.y,kt,Lt,0,1,Ct),me.vertexLength+=4,this.indexArray.emplaceBack(nt+0,nt+1,nt+2),this.indexArray.emplaceBack(nt+1,nt+3,nt+2),me.primitiveLength+=2,q){const ft=ne+(je===1?ce.length-2:je-2),yr=je===1?ne:ft+1;if(this.indexArray.emplaceBack(nt+1,ft,nt+3),this.indexArray.emplaceBack(ft,yr,nt+3),me.primitiveLength+=2,Me===void 0&&(Me=nt),!by(Ze,ce[je],le)){const dr=je===ce.length-1?Me:me.vertexLength;this.indexArray.emplaceBack(nt+2,nt+3,dr),this.indexArray.emplaceBack(nt+3,dr+1,dr),this.indexArray.emplaceBack(nt+3,yr,dr+1),me.primitiveLength+=3}}if(P){const ft=this.layoutVertexExtArray,yr=w.projectTilePoint(Ne.x,Ne.y,u),dr=w.projectTilePoint(et.x,et.y,u),Mr=w.upVector(u,Ne.x,Ne.y),jt=w.upVector(u,et.x,et.y);uu(ft,yr,Mr),uu(ft,yr,Mr),uu(ft,dr,jt),uu(ft,dr,jt)}}R&&(ne+=ce.length-1)}}if(C&&C.polyCount.length>0){if(C.borders){C.vertexArrayOffset=this.centroidVertexArray.length;const te=C.borders,le=this.featuresOnBorder.push(C)-1;for(let ne=0;ne<4;ne++)te[ne][0]!==Number.MAX_VALUE&&this.borders[ne].push(le)}this.encodeCentroid(C.borders?void 0:C.centroid(),C)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,m,u)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((t,a)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}encodeCentroid(e,t,a=!0){let u,d;if(e)if(e.y!==0){const g=t.span()._mult(this.tileToMeter);u=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(g.x/10)),d=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(g.y/10))}else u=Math.ceil(7*(e.x+450)),d=0;else u=0,d=+a;let m=a?this.centroidVertexArray.length:t.vertexArrayOffset;for(const g of t.polyCount){a&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*g.edges+g.top);for(let b=0;b<g.top;b++)this.centroidVertexArray.emplace(m++,u,d);for(let b=0;b<2*g.edges;b++)this.centroidVertexArray.emplace(m++,0,d),this.centroidVertexArray.emplace(m++,u,d)}}}function vy(r,e){const t=r.add(e)._unit();return r.x*t.x+r.y*t.y}function Dw(r,e,t,a){const u=e.sub(r)._perp()._unit(),d=t.sub(e)._perp()._unit();return xy(r,e,t,vy(u,d),a)}function xy(r,e,t,a,u){const d=Math.sqrt(1-a*a);return Math.min(r.dist(e)/3,e.dist(t)/3,u*d/a)}function by(r,e,t){return r.x<t[0].x&&e.x<t[0].x||r.x>t[1].x&&e.x>t[1].x||r.y<t[0].y&&e.y<t[0].y||r.y>t[1].y&&e.y>t[1].y}function wy(r,e,t){if(r.x<0||r.x>=It||e.x<0||e.x>=It||t.x<0||t.x>=It)return!1;const a=t.sub(e),u=a.perp(),d=r.sub(e);return(a.x*d.x+a.y*d.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(d.x*d.x+d.y*d.y))>-.866&&u.x*d.x+u.y*d.y<0}function Ty(r,e,t){const a=e?2|r:-3&r;return t?1|a:-2&a}function Ey(){const r=Math.PI/32,e=Math.tan(r),t=Cp;return t*Math.sqrt(1+2*e*e)-t}function Sy(r,e,t){const a=1<<t.z,u=xn(t.x/a),d=xn((t.x+1)/a),m=yi(t.y/a),g=yi((t.y+1)/a);return function(b,w,P,C,R=0,O){const B=[];if(!b.length||!P||!C)return B;const $=(ce,Me)=>{for(const Pe of ce)B.push({polygon:Pe,bounds:Me})},q=Math.ceil(Math.log2(P)),te=Math.ceil(Math.log2(C)),le=q-te,ne=[];for(let ce=0;ce<Math.abs(le);ce++)ne.push(le>0?0:1);for(let ce=0;ce<Math.min(q,te);ce++)ne.push(0),ne.push(1);let se=b;if(se=df(se,w[0].y-R,w[1].y+R,1),se=df(se,w[0].x-R,w[1].x+R,0),!se.length)return B;const me=[];for(ne.length?me.push({polygons:se,bounds:w,depth:0}):$(se,w);me.length;){const ce=me.pop(),Me=ce.depth,Pe=ne[Me],Oe=ce.bounds[0],rt=ce.bounds[1],ze=Pe===0?Oe.x:Oe.y,je=Pe===0?rt.x:rt.y,qe=O?O(Pe,ze,je):.5*(ze+je),Ne=df(ce.polygons,ze-R,qe+R,Pe),et=df(ce.polygons,qe-R,je+R,Pe);if(Ne.length){const Ze=[Oe,new L(Pe===0?qe:rt.x,Pe===1?qe:rt.y)];ne.length>Me+1?me.push({polygons:Ne,bounds:Ze,depth:Me+1}):$(Ne,Ze)}if(et.length){const Ze=[new L(Pe===0?qe:Oe.x,Pe===1?qe:Oe.y),rt];ne.length>Me+1?me.push({polygons:et,bounds:Ze,depth:Me+1}):$(et,Ze)}}return B}(r,e,Math.ceil((d-u)/11.25),Math.ceil((m-g)/11.25),1,(b,w,P)=>{if(b===0)return .5*(w+P);{const C=yi((t.y+w/It)/a);return(Ao(.5*(yi((t.y+P/It)/a)+C))*a-t.y)*It}})}pt(hu,"FillExtrusionBucket",{omit:["layers","features"]}),pt(yy,"PartMetadata");const Ow=new Le({"fill-extrusion-edge-radius":new ue(ke["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Lw={paint:new Le({"fill-extrusion-opacity":new ue(ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ye(ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ue(ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ue(ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ae(ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ye(ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ye(ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ue(ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ue(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ue(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:Ow};function Ay(r,e,t){var a=2*Math.PI*6378137/256/Math.pow(2,t);return[r*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class pf{constructor(e,t,a){this.z=e,this.x=t,this.y=a,this.key=fu(0,e,e,t,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const a=function(d,m,g){var b=Ay(256*d,256*(m=Math.pow(2,g)-m-1),g),w=Ay(256*(d+1),256*(m+1),g);return b[0]+","+b[1]+","+w[0]+","+w[1]}(this.x,this.y,this.z),u=function(d,m,g){let b,w="";for(let P=d;P>0;P--)b=1<<P-1,w+=(m&b?1:0)+(g&b?2:0);return w}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Py{constructor(e,t){this.wrap=e,this.canonical=t,this.key=fu(e,t.z,t.z,t.x,t.y)}}class Li{constructor(e,t,a,u,d){this.overscaledZ=e,this.wrap=t,this.canonical=new pf(a,+u,+d),this.key=t===0&&e===a?this.canonical.key:fu(t,e,a,u,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new Li(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Li(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return fu(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return fu(this.wrap*+t,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new Li(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,a=2*this.canonical.x,u=2*this.canonical.y;return[new Li(t,this.wrap,t,a,u),new Li(t,this.wrap,t,a+1,u),new Li(t,this.wrap,t,a,u+1),new Li(t,this.wrap,t,a+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Li(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Li(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Py(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function fu(r,e,t,a,u){const d=1<<Math.min(t,22);let m=d*(u%d)+a%d;return r&&t<22&&(m+=d*d*((r<0?-2*r-1:2*r)%(1<<2*(22-t)))),16*(32*m+t)+(e-t)}function du(r,e){return r.x*e.x+r.y*e.y}function Iy(r,e){if(r.length===1){let t=0;const a=e[t++];let u;for(;!u||a.equals(u);)if(u=e[t++],!u)return 1/0;for(;t<e.length;t++){const d=e[t],m=r[0],g=u.sub(a),b=d.sub(a),w=m.sub(a),P=du(g,g),C=du(g,b),R=du(b,b),O=du(w,g),B=du(w,b),$=P*R-C*C,q=(R*O-C*B)/$,te=(P*B-C*O)/$,le=a.z*(1-q-te)+u.z*q+d.z*te;if(isFinite(le))return le}return 1/0}{let t=1/0;for(const a of e)t=Math.min(t,a.z);return t}}function mf(r){const e=new L(r[0],r[1]);return e.z=r[2],e}function My(r,e,t,a,u,d,m,g){const b=m*u.getElevationAt(r,e,!0,!0),w=d[0]!==0,P=w?d[1]===0?m*(d[0]/7-450):m*function(C,R,O){const B=Math.floor(R[0]/8),$=Math.floor(R[1]/8),q=10*(R[0]-8*B),te=10*(R[1]-8*$),le=C.getElevationAt(B,$,!0,!0),ne=C.getMeterToDEM(O),se=Math.floor(.5*(q*ne-1)),me=Math.floor(.5*(te*ne-1)),ce=C.tileCoordToPixel(B,$),Me=2*se+1,Pe=2*me+1,Oe=function(et,Ze,at,kt,Lt){return[et.getElevationAtPixel(Ze,at,!0),et.getElevationAtPixel(Ze+Lt,at,!0),et.getElevationAtPixel(Ze,at+Lt,!0),et.getElevationAtPixel(Ze+kt,at+Lt,!0)]}(C,ce.x-se,ce.y-me,Me,Pe),rt=Math.abs(Oe[0]-Oe[1]),ze=Math.abs(Oe[2]-Oe[3]),je=Math.abs(Oe[0]-Oe[2])+Math.abs(Oe[1]-Oe[3]),qe=Math.min(.25,.5*ne*(rt+ze)/Me),Ne=Math.min(.25,.5*ne*je/Pe);return le+Math.max(qe*q,Ne*te)}(u,d,g):b;return{base:b+(t===0)?-1:t,top:w?Math.max(P+a,b+t+2):b+a}}pt(pf,"CanonicalTileID"),pt(Li,"OverscaledTileID",{omit:["projMatrix"]});const Fw=Be([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Bw}=Fw,jw=Be([{name:"a_packed",components:4,type:"Float32"}]),{members:Nw}=jw,Uw=ma.VectorTileFeature.types,Vw=Math.cos(Math.PI/180*37.5);class _f{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(t=>{this.gradients[t.id]={}}),this.layoutVertexArray=new Mt,this.layoutVertexArray2=new qt,this.indexArray=new Ut,this.programConfigurations=new ca(e.layers,e.zoom),this.segments=new Kr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(e,t,a,u){this.hasPattern=em("line",this.layers,t);const d=this.layers[0].layout.get("line-sort-key"),m=[];for(const{feature:P,id:C,index:R,sourceLayerIndex:O}of e){const B=this.layers[0]._featureFilter.needGeometry,$=ua(P,B);if(!this.layers[0]._featureFilter.filter(new Q(this.zoom),$,a))continue;const q=d?d.evaluate($,{},a):void 0,te={id:C,properties:P.properties,type:P.type,sourceLayerIndex:O,index:R,geometry:B?$.geometry:Po(P,a,u),patterns:{},sortKey:q};m.push(te)}d&&m.sort((P,C)=>P.sortKey-C.sortKey);const{lineAtlas:g,featureIndex:b}=t,w=this.addConstantDashes(g);for(const P of m){const{geometry:C,index:R,sourceLayerIndex:O}=P;if(w&&this.addFeatureDashes(P,g),this.hasPattern){const B=tm("line",this.layers,P,this.zoom,t);this.patternFeatures.push(B)}else this.addFeature(P,C,R,a,g.positions,t.availableImages);b.insert(e[R].feature,C,R,O,this.index)}}addConstantDashes(e){let t=!1;for(const a of this.layers){const u=a.paint.get("line-dasharray").value,d=a.layout.get("line-cap").value;if(u.kind!=="constant"||d.kind!=="constant")t=!0;else{const m=d.value,g=u.value;if(!g)continue;e.addDash(g.from,m),e.addDash(g.to,m),g.other&&e.addDash(g.other,m)}}return t}addFeatureDashes(e,t){const a=this.zoom;for(const u of this.layers){const d=u.paint.get("line-dasharray").value,m=u.layout.get("line-cap").value;if(d.kind==="constant"&&m.kind==="constant")continue;let g,b,w,P,C,R;if(d.kind==="constant"){const q=d.value;if(!q)continue;g=q.other||q.to,b=q.to,w=q.from}else g=d.evaluate({zoom:a-1},e),b=d.evaluate({zoom:a},e),w=d.evaluate({zoom:a+1},e);m.kind==="constant"?P=C=R=m.value:(P=m.evaluate({zoom:a-1},e),C=m.evaluate({zoom:a},e),R=m.evaluate({zoom:a+1},e)),t.addDash(g,P),t.addDash(b,C),t.addDash(w,R);const O=t.getKey(g,P),B=t.getKey(b,C),$=t.getKey(w,R);e.patterns[u.id]={min:O,mid:B,max:$}}}update(e,t,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,a,u)}addFeatures(e,t,a,u,d){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,t,a,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Nw)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Bw),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,a,u,d,m){const g=this.layers[0].layout,b=g.get("line-join").evaluate(e,{}),w=g.get("line-cap").evaluate(e,{}),P=g.get("line-miter-limit"),C=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const R of t)this.addLine(R,e,b,w,P,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,m,u)}addLine(e,t,a,u,d,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let te=0;te<e.length-1;te++)this.totalDistance+=e[te].dist(e[te+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const g=Uw[t.type]==="Polygon";let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let w=0;for(;w<b-1&&e[w].equals(e[w+1]);)w++;if(b<(g?3:2))return;a==="bevel"&&(d=1.05);const P=this.overscaling<=16?122880/(512*this.overscaling):0,C=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let R,O,B,$,q;this.e1=this.e2=-1,g&&(R=e[b-2],q=e[w].sub(R)._unit()._perp());for(let te=w;te<b;te++){if(B=te===b-1?g?e[w+1]:void 0:e[te+1],B&&e[te].equals(B))continue;q&&($=q),R&&(O=R),R=e[te],q=B?B.sub(R)._unit()._perp():$,$=$||q;let le=$.add(q);le.x===0&&le.y===0||le._unit();const ne=$.x*q.x+$.y*q.y,se=le.x*q.x+le.y*q.y,me=se!==0?1/se:1/0,ce=2*Math.sqrt(2-2*se),Me=se<Vw&&O&&B,Pe=$.x*q.y-$.y*q.x>0;if(Me&&te>w){const ze=R.dist(O);if(ze>2*P){const je=R.sub(R.sub(O)._mult(P/ze)._round());this.updateDistance(O,je),this.addCurrentVertex(je,$,0,0,C),O=je}}const Oe=O&&B;let rt=Oe?a:g?"butt":u;if(Oe&&rt==="round"&&(me<m?rt="miter":me<=2&&(rt="fakeround")),rt==="miter"&&me>d&&(rt="bevel"),rt==="bevel"&&(me>2&&(rt="flipbevel"),me<d&&(rt="miter")),O&&this.updateDistance(O,R),rt==="miter")le._mult(me),this.addCurrentVertex(R,le,0,0,C);else if(rt==="flipbevel"){if(me>100)le=q.mult(-1);else{const ze=me*$.add(q).mag()/$.sub(q).mag();le._perp()._mult(ze*(Pe?-1:1))}this.addCurrentVertex(R,le,0,0,C),this.addCurrentVertex(R,le.mult(-1),0,0,C)}else if(rt==="bevel"||rt==="fakeround"){const ze=-Math.sqrt(me*me-1),je=Pe?ze:0,qe=Pe?0:ze;if(O&&this.addCurrentVertex(R,$,je,qe,C),rt==="fakeround"){const Ne=Math.round(180*ce/Math.PI/20);for(let et=1;et<Ne;et++){let Ze=et/Ne;if(Ze!==.5){const kt=Ze-.5;Ze+=Ze*kt*(Ze-1)*((1.0904+ne*(ne*(3.55645-1.43519*ne)-3.2452))*kt*kt+(.848013+ne*(.215638*ne-1.06021)))}const at=q.sub($)._mult(Ze)._add($)._unit()._mult(Pe?-1:1);this.addHalfVertex(R,at.x,at.y,!1,Pe,0,C)}}B&&this.addCurrentVertex(R,q,-je,-qe,C)}else if(rt==="butt")this.addCurrentVertex(R,le,0,0,C);else if(rt==="square"){const ze=O?1:-1;O||this.addCurrentVertex(R,le,ze,ze,C),this.addCurrentVertex(R,le,0,0,C),O&&this.addCurrentVertex(R,le,ze,ze,C)}else rt==="round"&&(O&&(this.addCurrentVertex(R,$,0,0,C),this.addCurrentVertex(R,$,1,1,C,!0)),B&&(this.addCurrentVertex(R,q,-1,-1,C,!0),this.addCurrentVertex(R,q,0,0,C)));if(Me&&te<b-1){const ze=R.dist(B);if(ze>2*P){const je=R.add(B.sub(R)._mult(P/ze)._round());this.updateDistance(R,je),this.addCurrentVertex(je,q,0,0,C),R=je}}}}addCurrentVertex(e,t,a,u,d,m=!1){const g=t.y*u-t.x,b=-t.y-t.x*u;this.addHalfVertex(e,t.x+t.y*a,t.y-t.x*a,m,!1,a,d),this.addHalfVertex(e,g,b,m,!0,-u,d)}addHalfVertex({x:e,y:t},a,u,d,m,g,b){this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(t<<1)+(m?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const w=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),b.primitiveLength++),m?this.e2=w:this.e1=w}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}pt(_f,"LineBucket",{omit:["layers","patternFeatures"]});const $w=new Le({"line-cap":new ye(ke.layout_line["line-cap"]),"line-join":new ye(ke.layout_line["line-join"]),"line-miter-limit":new ue(ke.layout_line["line-miter-limit"]),"line-round-limit":new ue(ke.layout_line["line-round-limit"]),"line-sort-key":new ye(ke.layout_line["line-sort-key"])});var Cy={paint:new Le({"line-opacity":new ye(ke.paint_line["line-opacity"]),"line-color":new ye(ke.paint_line["line-color"]),"line-translate":new ue(ke.paint_line["line-translate"]),"line-translate-anchor":new ue(ke.paint_line["line-translate-anchor"]),"line-width":new ye(ke.paint_line["line-width"]),"line-gap-width":new ye(ke.paint_line["line-gap-width"]),"line-offset":new ye(ke.paint_line["line-offset"]),"line-blur":new ye(ke.paint_line["line-blur"]),"line-dasharray":new Ae(ke.paint_line["line-dasharray"]),"line-pattern":new Ae(ke.paint_line["line-pattern"]),"line-gradient":new be(ke.paint_line["line-gradient"]),"line-trim-offset":new ue(ke.paint_line["line-trim-offset"])}),layout:$w};const zy=new class extends ye{possiblyEvaluate(r,e){return e=new Q(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(r,e)}evaluate(r,e,t,a){return e=Xe({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(r,e,t,a)}}(Cy.paint.properties["line-width"].specification);function Ry(r,e){return e>0?e+2*r:r}zy.useIntegerZoom=!0;const Gw=Be([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),qw=Be([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Zw=Be([{name:"a_projected_pos",components:4,type:"Float32"}],4);Be([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Hw=Be([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Ww=Be([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Be([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ky=Be([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Xw=Be([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Be([{name:"triangle",components:3,type:"Uint16"}]),Be([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Be([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Be([{type:"Float32",name:"offsetX"}]),Be([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var vi=24;const to=128;function rm(r,e){const{expression:t}=e;if(t.kind==="constant")return{kind:"constant",layoutSize:t.evaluate(new Q(r+1))};if(t.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:u}=t;let d=0;for(;d<a.length&&a[d]<=r;)d++;d=Math.max(0,d-1);let m=d;for(;m<a.length&&a[m]<r+1;)m++;m=Math.min(a.length-1,m);const g=a[d],b=a[m];return t.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:b,interpolationType:u}:{kind:"camera",minZoom:g,maxZoom:b,minSize:t.evaluate(new Q(g)),maxSize:t.evaluate(new Q(b)),interpolationType:u}}}function gf(r,{uSize:e,uSizeT:t},{lowerSize:a,upperSize:u}){return r.kind==="source"?a/to:r.kind==="composite"?Xt(a/to,u/to,t):e}function bl(r,e){let t=0,a=0;if(r.kind==="constant")a=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:u,minZoom:d,maxZoom:m}=r,g=u?Ie(yn.interpolationFactor(u,e,d,m),0,1):0;r.kind==="camera"?a=Xt(r.minSize,r.maxSize,g):t=g}return{uSizeT:t,uSize:a}}var Qw=Object.freeze({__proto__:null,getSizeData:rm,evaluateSizeForFeature:gf,evaluateSizeForZoom:bl,SIZE_PACK_FACTOR:to});function Yw(r,e,t){return r.sections.forEach(a=>{a.text=function(u,d,m){const g=d.layout.get("text-transform").evaluate(m,{});return g==="uppercase"?u=u.toLocaleUpperCase():g==="lowercase"&&(u=u.toLocaleLowerCase()),X.applyArabicShaping&&(u=X.applyArabicShaping(u)),u}(a.text,e,t)}),r}const pu={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function Kw(r){return r==="\uFE36"||r==="\uFE48"||r==="\uFE38"||r==="\uFE44"||r==="\uFE42"||r==="\uFE3E"||r==="\uFE3C"||r==="\uFE3A"||r==="\uFE18"||r==="\uFE40"||r==="\uFE10"||r==="\uFE13"||r==="\uFE14"||r==="\uFF40"||r==="\uFFE3"||r==="\uFE11"||r==="\uFE12"}function Jw(r){return r==="\uFE35"||r==="\uFE47"||r==="\uFE37"||r==="\uFE43"||r==="\uFE41"||r==="\uFE3D"||r==="\uFE3B"||r==="\uFE39"||r==="\uFE17"||r==="\uFE3F"}var Dy=function(r,e,t,a,u){var d,m,g=8*u-a-1,b=(1<<g)-1,w=b>>1,P=-7,C=t?u-1:0,R=t?-1:1,O=r[e+C];for(C+=R,d=O&(1<<-P)-1,O>>=-P,P+=g;P>0;d=256*d+r[e+C],C+=R,P-=8);for(m=d&(1<<-P)-1,d>>=-P,P+=a;P>0;m=256*m+r[e+C],C+=R,P-=8);if(d===0)d=1-w;else{if(d===b)return m?NaN:1/0*(O?-1:1);m+=Math.pow(2,a),d-=w}return(O?-1:1)*m*Math.pow(2,d-a)},Oy=function(r,e,t,a,u,d){var m,g,b,w=8*d-u-1,P=(1<<w)-1,C=P>>1,R=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=a?0:d-1,B=a?1:-1,$=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,m=P):(m=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-m))<1&&(m--,b*=2),(e+=m+C>=1?R/b:R*Math.pow(2,1-C))*b>=2&&(m++,b/=2),m+C>=P?(g=0,m=P):m+C>=1?(g=(e*b-1)*Math.pow(2,u),m+=C):(g=e*Math.pow(2,C-1)*Math.pow(2,u),m=0));u>=8;r[t+O]=255&g,O+=B,g/=256,u-=8);for(m=m<<u|g,w+=u;w>0;r[t+O]=255&m,O+=B,m/=256,w-=8);r[t+O-B]|=128*$},mu=gr;function gr(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}gr.Varint=0,gr.Fixed64=1,gr.Bytes=2,gr.Fixed32=5;var im=4294967296,Ly=1/im,Fy=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Mo(r){return r.type===gr.Bytes?r.readVarint()+r.pos:r.pos+1}function wl(r,e,t){return t?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function By(r,e,t){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));t.realloc(a);for(var u=t.pos-1;u>=r;u--)t.buf[u+a]=t.buf[u]}function e2(r,e){for(var t=0;t<r.length;t++)e.writeVarint(r[t])}function t2(r,e){for(var t=0;t<r.length;t++)e.writeSVarint(r[t])}function r2(r,e){for(var t=0;t<r.length;t++)e.writeFloat(r[t])}function i2(r,e){for(var t=0;t<r.length;t++)e.writeDouble(r[t])}function n2(r,e){for(var t=0;t<r.length;t++)e.writeBoolean(r[t])}function o2(r,e){for(var t=0;t<r.length;t++)e.writeFixed32(r[t])}function s2(r,e){for(var t=0;t<r.length;t++)e.writeSFixed32(r[t])}function a2(r,e){for(var t=0;t<r.length;t++)e.writeFixed64(r[t])}function l2(r,e){for(var t=0;t<r.length;t++)e.writeSFixed64(r[t])}function yf(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function Tl(r,e,t){r[t]=e,r[t+1]=e>>>8,r[t+2]=e>>>16,r[t+3]=e>>>24}function jy(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}function c2(r,e,t){e.glyphs=[],r===1&&t.readMessage(u2,e)}function u2(r,e,t){if(r===3){const{id:a,bitmap:u,width:d,height:m,left:g,top:b,advance:w}=t.readMessage(h2,{});e.glyphs.push({id:a,bitmap:new Io({width:d+6,height:m+6},u),metrics:{width:d,height:m,left:g,top:b,advance:w}})}else r===4?e.ascender=t.readSVarint():r===5&&(e.descender=t.readSVarint())}function h2(r,e,t){r===1?e.id=t.readVarint():r===2?e.bitmap=t.readBytes():r===3?e.width=t.readVarint():r===4?e.height=t.readVarint():r===5?e.left=t.readSVarint():r===6?e.top=t.readSVarint():r===7&&(e.advance=t.readVarint())}function nm(r){let e=0,t=0;for(const m of r)e+=m.w*m.h,t=Math.max(t,m.w);r.sort((m,g)=>g.h-m.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),t),h:1/0}];let u=0,d=0;for(const m of r)for(let g=a.length-1;g>=0;g--){const b=a[g];if(!(m.w>b.w||m.h>b.h)){if(m.x=b.x,m.y=b.y,d=Math.max(d,m.y+m.h),u=Math.max(u,m.x+m.w),m.w===b.w&&m.h===b.h){const w=a.pop();g<a.length&&(a[g]=w)}else m.h===b.h?(b.x+=m.w,b.w-=m.w):m.w===b.w?(b.y+=m.h,b.h-=m.h):(a.push({x:b.x+m.w,y:b.y,w:b.w-m.w,h:m.h}),b.y+=m.h,b.h-=m.h);break}}return{w:u,h:d,fill:e/(u*d)||0}}gr.prototype={destroy:function(){this.buf=null},readFields:function(r,e,t){for(t=t||this.length;this.pos<t;){var a=this.readVarint(),u=a>>3,d=this.pos;this.type=7&a,r(u,e,this),this.pos===d&&this.skip(a)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=yf(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=jy(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=yf(this.buf,this.pos)+yf(this.buf,this.pos+4)*im;return this.pos+=8,r},readSFixed64:function(){var r=yf(this.buf,this.pos)+jy(this.buf,this.pos+4)*im;return this.pos+=8,r},readFloat:function(){var r=Dy(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=Dy(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,t,a=this.buf;return e=127&(t=a[this.pos++]),t<128?e:(e|=(127&(t=a[this.pos++]))<<7,t<128?e:(e|=(127&(t=a[this.pos++]))<<14,t<128?e:(e|=(127&(t=a[this.pos++]))<<21,t<128?e:function(u,d,m){var g,b,w=m.buf;if(g=(112&(b=w[m.pos++]))>>4,b<128||(g|=(127&(b=w[m.pos++]))<<3,b<128)||(g|=(127&(b=w[m.pos++]))<<10,b<128)||(g|=(127&(b=w[m.pos++]))<<17,b<128)||(g|=(127&(b=w[m.pos++]))<<24,b<128)||(g|=(1&(b=w[m.pos++]))<<31,b<128))return wl(u,g,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(t=a[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&Fy?function(t,a,u){return Fy.decode(t.subarray(a,u))}(this.buf,e,r):function(t,a,u){for(var d="",m=a;m<u;){var g,b,w,P=t[m],C=null,R=P>239?4:P>223?3:P>191?2:1;if(m+R>u)break;R===1?P<128&&(C=P):R===2?(192&(g=t[m+1]))==128&&(C=(31&P)<<6|63&g)<=127&&(C=null):R===3?(b=t[m+2],(192&(g=t[m+1]))==128&&(192&b)==128&&((C=(15&P)<<12|(63&g)<<6|63&b)<=2047||C>=55296&&C<=57343)&&(C=null)):R===4&&(b=t[m+2],w=t[m+3],(192&(g=t[m+1]))==128&&(192&b)==128&&(192&w)==128&&((C=(15&P)<<18|(63&g)<<12|(63&b)<<6|63&w)<=65535||C>=1114112)&&(C=null)),C===null?(C=65533,R=1):C>65535&&(C-=65536,d+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),d+=String.fromCharCode(C),m+=R}return d}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==gr.Bytes)return r.push(this.readVarint(e));var t=Mo(this);for(r=r||[];this.pos<t;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==gr.Bytes)return r.push(this.readSVarint());var e=Mo(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==gr.Bytes)return r.push(this.readBoolean());var e=Mo(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==gr.Bytes)return r.push(this.readFloat());var e=Mo(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==gr.Bytes)return r.push(this.readDouble());var e=Mo(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==gr.Bytes)return r.push(this.readFixed32());var e=Mo(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==gr.Bytes)return r.push(this.readSFixed32());var e=Mo(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==gr.Bytes)return r.push(this.readFixed64());var e=Mo(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==gr.Bytes)return r.push(this.readSFixed64());var e=Mo(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===gr.Varint)for(;this.buf[this.pos++]>127;);else if(e===gr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===gr.Fixed32)this.pos+=4;else{if(e!==gr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),Tl(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),Tl(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),Tl(this.buf,-1&r,this.pos),Tl(this.buf,Math.floor(r*Ly),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),Tl(this.buf,-1&r,this.pos),Tl(this.buf,Math.floor(r*Ly),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,t){var a,u;if(e>=0?(a=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(d,m,g){g.buf[g.pos++]=127&d|128,d>>>=7,g.buf[g.pos++]=127&d|128,d>>>=7,g.buf[g.pos++]=127&d|128,d>>>=7,g.buf[g.pos++]=127&d|128,g.buf[g.pos]=127&(d>>>=7)}(a,0,t),function(d,m){var g=(7&d)<<4;m.buf[m.pos++]|=g|((d>>>=3)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d)))))}(u,t)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(Boolean(r))},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(a,u,d){for(var m,g,b=0;b<u.length;b++){if((m=u.charCodeAt(b))>55295&&m<57344){if(!g){m>56319||b+1===u.length?(a[d++]=239,a[d++]=191,a[d++]=189):g=m;continue}if(m<56320){a[d++]=239,a[d++]=191,a[d++]=189,g=m;continue}m=g-55296<<10|m-56320|65536,g=null}else g&&(a[d++]=239,a[d++]=191,a[d++]=189,g=null);m<128?a[d++]=m:(m<2048?a[d++]=m>>6|192:(m<65536?a[d++]=m>>12|224:(a[d++]=m>>18|240,a[d++]=m>>12&63|128),a[d++]=m>>6&63|128),a[d++]=63&m|128)}return d}(this.buf,r,this.pos);var t=this.pos-e;t>=128&&By(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(r){this.realloc(4),Oy(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),Oy(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var t=0;t<e;t++)this.buf[this.pos++]=r[t]},writeRawMessage:function(r,e){this.pos++;var t=this.pos;r(e,this);var a=this.pos-t;a>=128&&By(t,a,this),this.pos=t-1,this.writeVarint(a),this.pos+=a},writeMessage:function(r,e,t){this.writeTag(r,gr.Bytes),this.writeRawMessage(e,t)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,e2,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,t2,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,n2,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,r2,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,i2,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,o2,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,s2,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,a2,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,l2,e)},writeBytesField:function(r,e){this.writeTag(r,gr.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,gr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,gr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,gr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,gr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,gr.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,gr.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,gr.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,gr.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,gr.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,Boolean(e))}};class om{constructor(e,{pixelRatio:t,version:a,stretchX:u,stretchY:d,content:m}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=u,this.stretchY=d,this.content=m,this.version=a}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Ny{constructor(e,t){const a={},u={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,a,d),this.addImages(t,u,d);const{w:m,h:g}=nm(d),b=new Ji({width:m||1,height:g||1});for(const w in e){const P=e[w],C=a[w].paddedRect;Ji.copy(P.data,b,{x:0,y:0},{x:C.x+1,y:C.y+1},P.data)}for(const w in t){const P=t[w],C=u[w].paddedRect,R=C.x+1,O=C.y+1,B=P.data.width,$=P.data.height;Ji.copy(P.data,b,{x:0,y:0},{x:R,y:O},P.data),Ji.copy(P.data,b,{x:0,y:$-1},{x:R,y:O-1},{width:B,height:1}),Ji.copy(P.data,b,{x:0,y:0},{x:R,y:O+$},{width:B,height:1}),Ji.copy(P.data,b,{x:B-1,y:0},{x:R-1,y:O},{width:1,height:$}),Ji.copy(P.data,b,{x:0,y:0},{x:R+B,y:O},{width:1,height:$})}this.image=b,this.iconPositions=a,this.patternPositions=u}addImages(e,t,a){for(const u in e){const d=e[u],m={x:0,y:0,w:d.data.width+2,h:d.data.height+2};a.push(m),t[u]=new om(m,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,t){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>e.hasImage(a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),t),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),t)}patchUpdatedImage(e,t,a){if(!e||!t||e.version===t.version)return;e.version=t.version;const[u,d]=e.tl;a.update(t.data,void 0,{x:u,y:d})}}pt(om,"ImagePosition"),pt(Ny,"ImageAtlas");const pn={horizontal:1,vertical:2,horizontalOnly:3};class _u{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const a=new _u;return a.scale=e||1,a.fontStack=t,a}static forImage(e){const t=new _u;return t.imageName=e,t}}class El{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const a=new El;for(let u=0;u<e.sections.length;u++){const d=e.sections[u];d.image?a.addImageSection(d):a.addTextSection(d,t)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(t,a){let u="";for(let d=0;d<t.length;d++){const m=t.charCodeAt(d+1)||null,g=t.charCodeAt(d-1)||null;u+=!a&&(m&&aa(m)&&!pu[t[d+1]]||g&&aa(g)&&!pu[t[d-1]])||!pu[t[d]]?t[d]:pu[t[d]]}return u}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&vf[this.text.charCodeAt(a)];a++)e++;let t=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&vf[this.text.charCodeAt(a)];a--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const a=new El;return a.text=this.text.substring(e,t),a.sectionIndex=this.sectionIndex.slice(e,t),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(_u.forText(e.scale,e.fontStack||t));const a=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(a)}addImageSection(e){const t=e.image?e.image.name:"";if(t.length===0)return void hr("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(_u.forImage(t)),this.sectionIndex.push(this.sections.length-1)):hr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function sm(r,e,t,a,u,d,m,g,b,w,P,C,R,O,B,$){const q=El.fromFeature(r,u);let te;C===pn.vertical&&q.verticalizePunctuation(R);const{processBidirectionalText:le,processStyledBidirectionalText:ne}=X;if(le&&q.sections.length===1){te=[];const ce=le(q.toString(),am(q,w,d,e,a,O,B));for(const Me of ce){const Pe=new El;Pe.text=Me,Pe.sections=q.sections;for(let Oe=0;Oe<Me.length;Oe++)Pe.sectionIndex.push(0);te.push(Pe)}}else if(ne){te=[];const ce=ne(q.text,q.sectionIndex,am(q,w,d,e,a,O,B));for(const Me of ce){const Pe=new El;Pe.text=Me[0],Pe.sectionIndex=Me[1],Pe.sections=q.sections,te.push(Pe)}}else te=function(ce,Me){const Pe=[],Oe=ce.text;let rt=0;for(const ze of Me)Pe.push(ce.substring(rt,ze)),rt=ze;return rt<Oe.length&&Pe.push(ce.substring(rt,Oe.length)),Pe}(q,am(q,w,d,e,a,O,B));const se=[],me={positionedLines:se,text:q.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ce,Me,Pe,Oe,rt,ze,je,qe,Ne,et,Ze,at){let kt=0,Lt=0,xt=0;const nt=qe==="right"?1:qe==="left"?0:.5;let Zt=!1;for(const jt of rt){const Yt=jt.getSections();for(const vr of Yt){if(vr.imageName)continue;const pr=Me[vr.fontStack];if(pr&&(Zt=pr.ascender!==void 0&&pr.descender!==void 0,!Zt))break}if(!Zt)break}let Ct=0;for(const jt of rt){jt.trim();const Yt=jt.getMaxScale(),vr=(Yt-1)*vi,pr={positionedGlyphs:[],lineOffset:0};ce.positionedLines[Ct]=pr;const ur=pr.positionedGlyphs;let Sr=0;if(!jt.length()){Lt+=ze,++Ct;continue}let Lr=0,hi=0;for(let Wt=0;Wt<jt.length();Wt++){const Gr=jt.getSection(Wt),Si=jt.getSectionIndex(Wt),rr=jt.getCharCode(Wt);let Fr=Gr.scale,Fi=null,Cr=null,Hr=null,fi=vi,li=0;const xi=!(Ne===pn.horizontal||!Ze&&!dl(rr)||Ze&&(vf[rr]||(ft=rr,Bh(ft)||jh(ft)||Nh(ft)||sa(ft)||Kc(ft))));if(Gr.imageName){const Bi=Oe[Gr.imageName];if(!Bi)continue;Hr=Gr.imageName,ce.iconsInText=ce.iconsInText||!0,Cr=Bi.paddedRect;const di=Bi.displaySize;Fr=Fr*vi/at,Fi={width:di[0],height:di[1],left:1,top:-3,advance:xi?di[1]:di[0],localGlyph:!1},li=Zt?-Fi.height*Fr:Yt*vi-17-di[1]*Fr,fi=Fi.advance;const Ro=(xi?di[0]:di[1])*Fr-vi*Yt;Ro>0&&Ro>Sr&&(Sr=Ro)}else{const Bi=Pe[Gr.fontStack];if(!Bi)continue;Bi[rr]&&(Cr=Bi[rr]);const di=Me[Gr.fontStack];if(!di)continue;const Ro=di.glyphs[rr];if(!Ro)continue;if(Fi=Ro.metrics,fi=rr!==8203?vi:0,Zt){const zl=di.ascender!==void 0?Math.abs(di.ascender):0,Iu=di.descender!==void 0?Math.abs(di.descender):0,Mu=(zl+Iu)*Fr;Lr<Mu&&(Lr=Mu,hi=(zl-Iu)/2*Fr),li=-zl*Fr}else li=(Yt-Fr)*vi-17}xi?(ce.verticalizable=!0,ur.push({glyph:rr,imageName:Hr,x:kt,y:Lt+li,vertical:xi,scale:Fr,localGlyph:Fi.localGlyph,fontStack:Gr.fontStack,sectionIndex:Si,metrics:Fi,rect:Cr}),kt+=fi*Fr+et):(ur.push({glyph:rr,imageName:Hr,x:kt,y:Lt+li,vertical:xi,scale:Fr,localGlyph:Fi.localGlyph,fontStack:Gr.fontStack,sectionIndex:Si,metrics:Fi,rect:Cr}),kt+=Fi.advance*Fr+et)}ur.length!==0&&(xt=Math.max(kt-et,xt),Zt?qy(ur,nt,Sr,hi,ze*Yt/2):qy(ur,nt,Sr,0,ze/2)),kt=0;const qi=ze*Yt+Sr;pr.lineOffset=Math.max(Sr,vr),Lt+=qi,++Ct}var ft;const yr=Lt,{horizontalAlign:dr,verticalAlign:Mr}=lm(je);(function(jt,Yt,vr,pr,ur,Sr){const Lr=(Yt-vr)*ur,hi=-Sr*pr;for(const qi of jt)for(const Wt of qi.positionedGlyphs)Wt.x+=Lr,Wt.y+=hi})(ce.positionedLines,nt,dr,Mr,xt,yr),ce.top+=-Mr*yr,ce.bottom=ce.top+yr,ce.left+=-dr*xt,ce.right=ce.left+xt,ce.hasBaseline=Zt}(me,e,t,a,te,m,g,b,C,w,R,$),!function(ce){for(const Me of ce)if(Me.positionedGlyphs.length!==0)return!1;return!0}(se)&&me}const vf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},f2={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Uy(r,e,t,a,u,d){if(e.imageName){const m=a[e.imageName];return m?m.displaySize[0]*e.scale*vi/d+u:0}{const m=t[e.fontStack],g=m&&m.glyphs[r];return g?g.metrics.advance*e.scale+u:0}}function Vy(r,e,t,a){const u=Math.pow(r-e,2);return a?r<e?u/2:2*u:u+Math.abs(t)*t}function d2(r,e,t){let a=0;return r===10&&(a-=1e4),t&&(a+=150),r!==40&&r!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function $y(r,e,t,a,u,d){let m=null,g=Vy(e,t,u,d);for(const b of a){const w=Vy(e-b.x,t,u,d)+b.badness;w<=g&&(m=b,g=w)}return{index:r,x:e,priorBreak:m,badness:g}}function Gy(r){return r?Gy(r.priorBreak).concat(r.index):[]}function am(r,e,t,a,u,d,m){if(d!=="point")return[];if(!r)return[];const g=[],b=function(R,O,B,$,q,te){let le=0;for(let ne=0;ne<R.length();ne++){const se=R.getSection(ne);le+=Uy(R.getCharCode(ne),se,$,q,O,te)}return le/Math.max(1,Math.ceil(le/B))}(r,e,t,a,u,m),w=r.text.indexOf("\u200B")>=0;let P=0;for(let R=0;R<r.length();R++){const O=r.getSection(R),B=r.getCharCode(R);if(vf[B]||(P+=Uy(B,O,a,u,e,m)),R<r.length()-1){const $=!((C=B)<11904||!(Zc(C)||$h(C)||Yc(C)||Hh(C)||Xc(C)||Uh(C)||Gh(C)||ul(C)||Qc(C)||oa(C)||Wc(C)||Jc(C)||qc(C)||na(C)||Vh(C)||Hc(C)||yo(C)||Wh(C)||qh(C)||hl(C)));(f2[B]||$||O.imageName)&&g.push($y(R+1,P,b,g,d2(B,r.getCharCode(R+1),$&&w),!1))}}var C;return Gy($y(r.length(),P,b,g,0,!0))}function lm(r){let e=.5,t=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0}return{horizontalAlign:e,verticalAlign:t}}function qy(r,e,t,a,u){if(!(e||t||a||u))return;const d=r.length-1,m=r[d],g=(m.x+m.metrics.advance*m.scale)*e;for(let b=0;b<=d;b++)r[b].x-=g,r[b].y+=t+a+u}function p2(r,e,t){const{horizontalAlign:a,verticalAlign:u}=lm(t),d=e[0]-r.displaySize[0]*a,m=e[1]-r.displaySize[1]*u;return{image:r,top:m,bottom:m+r.displaySize[1],left:d,right:d+r.displaySize[0]}}function Zy(r,e,t,a,u,d){const m=r.image;let g;if(m.content){const q=m.content,te=m.pixelRatio||1;g=[q[0]/te,q[1]/te,m.displaySize[0]-q[2]/te,m.displaySize[1]-q[3]/te]}const b=e.left*d,w=e.right*d;let P,C,R,O;t==="width"||t==="both"?(O=u[0]+b-a[3],C=u[0]+w+a[1]):(O=u[0]+(b+w-m.displaySize[0])/2,C=O+m.displaySize[0]);const B=e.top*d,$=e.bottom*d;return t==="height"||t==="both"?(P=u[1]+B-a[0],R=u[1]+$+a[2]):(P=u[1]+(B+$-m.displaySize[1])/2,R=P+m.displaySize[1]),{image:m,top:P,right:C,bottom:R,left:O,collisionPadding:g}}class Co extends L{constructor(e,t,a,u,d){super(e,t),this.angle=u,this.z=a,d!==void 0&&(this.segment=d)}clone(){return new Co(this.x,this.y,this.z,this.angle,this.segment)}}function Hy(r,e,t,a,u){if(e.segment===void 0)return!0;let d=e,m=e.segment+1,g=0;for(;g>-t/2;){if(m--,m<0)return!1;g-=r[m].dist(d),d=r[m]}g+=r[m].dist(r[m+1]),m++;const b=[];let w=0;for(;g<t/2;){const P=r[m],C=r[m+1];if(!C)return!1;let R=r[m-1].angleTo(P)-P.angleTo(C);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:g,angleDelta:R}),w+=R;g-b[0].distance>a;)w-=b.shift().angleDelta;if(w>u)return!1;m++,g+=P.dist(C)}return!0}function Wy(r){let e=0;for(let t=0;t<r.length-1;t++)e+=r[t].dist(r[t+1]);return e}function Xy(r,e,t){return r?.6*e*t:0}function Qy(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function m2(r,e,t,a,u,d){const m=Xy(t,u,d),g=Qy(t,a)*d;let b=0;const w=Wy(r)/2;for(let P=0;P<r.length-1;P++){const C=r[P],R=r[P+1],O=C.dist(R);if(b+O>w){const B=(w-b)/O,$=Xt(C.x,R.x,B),q=Xt(C.y,R.y,B),te=new Co($,q,0,R.angleTo(C),P);return!m||Hy(r,te,g,m,e)?te:void 0}b+=O}}function _2(r,e,t,a,u,d,m,g,b){const w=Xy(a,d,m),P=Qy(a,u),C=P*m,R=r[0].x===0||r[0].x===b||r[0].y===0||r[0].y===b;return e-C<e/4&&(e=C+e/4),Yy(r,R?e/2*g%e:(P/2+2*d)*m*g%e,e,w,t,C,R,!1,b)}function Yy(r,e,t,a,u,d,m,g,b){const w=d/2,P=Wy(r);let C=0,R=e-t,O=[];for(let B=0;B<r.length-1;B++){const $=r[B],q=r[B+1],te=$.dist(q),le=q.angleTo($);for(;R+t<C+te;){R+=t;const ne=(R-C)/te,se=Xt($.x,q.x,ne),me=Xt($.y,q.y,ne);if(se>=0&&se<b&&me>=0&&me<b&&R-w>=0&&R+w<=P){const ce=new Co(se,me,0,le,B);ce._round(),a&&!Hy(r,ce,d,a,u)||O.push(ce)}}C+=te}return g||O.length||m||(O=Yy(r,C/2,t,a,u,d,m,!0,b)),O}function Ky(r,e,t,a,u){const d=[];for(let m=0;m<r.length;m++){const g=r[m];let b;for(let w=0;w<g.length-1;w++){let P=g[w],C=g[w+1];P.x<e&&C.x<e||(P.x<e?P=new L(e,P.y+(e-P.x)/(C.x-P.x)*(C.y-P.y))._round():C.x<e&&(C=new L(e,P.y+(e-P.x)/(C.x-P.x)*(C.y-P.y))._round()),P.y<t&&C.y<t||(P.y<t?P=new L(P.x+(t-P.y)/(C.y-P.y)*(C.x-P.x),t)._round():C.y<t&&(C=new L(P.x+(t-P.y)/(C.y-P.y)*(C.x-P.x),t)._round()),P.x>=a&&C.x>=a||(P.x>=a?P=new L(a,P.y+(a-P.x)/(C.x-P.x)*(C.y-P.y))._round():C.x>=a&&(C=new L(a,P.y+(a-P.x)/(C.x-P.x)*(C.y-P.y))._round()),P.y>=u&&C.y>=u||(P.y>=u?P=new L(P.x+(u-P.y)/(C.y-P.y)*(C.x-P.x),u)._round():C.y>=u&&(C=new L(P.x+(u-P.y)/(C.y-P.y)*(C.x-P.x),u)._round()),b&&P.equals(b[b.length-1])||(b=[P],d.push(b)),b.push(C)))))}}return d}pt(Co,"Anchor");const gu=1e20;function Jy(r,e,t,a,u,d,m,g,b){for(let w=e;w<e+a;w++)ev(r,t*d+w,d,u,m,g,b);for(let w=t;w<t+u;w++)ev(r,w*d+e,1,a,m,g,b)}function ev(r,e,t,a,u,d,m){d[0]=0,m[0]=-gu,m[1]=gu,u[0]=r[e];for(let g=1,b=0,w=0;g<a;g++){u[g]=r[e+g*t];const P=g*g;do{const C=d[b];w=(u[g]-u[C]+P-C*C)/(g-C)/2}while(w<=m[b]&&--b>-1);b++,d[b]=g,m[b]=w,m[b+1]=gu}for(let g=0,b=0;g<a;g++){for(;m[b+1]<g;)b++;const w=d[b],P=g-w;r[e+g*t]=u[w]+P*P}}const cm={none:0,ideographs:1,all:2};class Sl{constructor(e,t,a){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=a,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,t){const a=[];for(const u in e)for(const d of e[u])a.push({stack:u,id:d});Te(a,({stack:u,id:d},m)=>{let g=this.entries[u];g||(g=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=g.glyphs[d];if(b!==void 0)return void m(null,{stack:u,id:d,glyph:b});if(b=this._tinySDF(g,u,d),b)return g.glyphs[d]=b,void m(null,{stack:u,id:d,glyph:b});const w=Math.floor(d/256);if(256*w>65535)return void m(new Error("glyphs > 65535 not supported"));if(g.ranges[w])return void m(null,{stack:u,id:d,glyph:b});let P=g.requests[w];P||(P=g.requests[w]=[],Sl.loadGlyphRange(u,w,this.url,this.requestManager,(C,R)=>{if(R){g.ascender=R.ascender,g.descender=R.descender;for(const O in R.glyphs)this._doesCharSupportLocalGlyph(+O)||(g.glyphs[+O]=R.glyphs[+O]);g.ranges[w]=!0}for(const O of P)O(C,R);delete g.requests[w]})),P.push((C,R)=>{C?m(C):R&&m(null,{stack:u,id:d,glyph:R.glyphs[d]||null})})},(u,d)=>{if(u)t(u);else if(d){const m={};for(const{stack:g,id:b,glyph:w}of d)m[g]===void 0&&(m[g]={}),m[g].glyphs===void 0&&(m[g].glyphs={}),m[g].glyphs[b]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},m[g].ascender=this.entries[g].ascender,m[g].descender=this.entries[g].descender;t(null,m)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==cm.none&&(this.localGlyphMode===cm.all?!!this.localFontFamily:!!this.localFontFamily&&(oa(e)||Zh(e)||qc(e)||yo(e)||ul(e)))}_tinySDF(e,t,a){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(a))return;let d=e.tinySDF;if(!d){let $="400";/bold/i.test(t)?$="900":/medium/i.test(t)?$="500":/light/i.test(t)&&($="200"),d=e.tinySDF=new Sl.TinySDF({fontFamily:u,fontWeight:$,fontSize:48,buffer:6,radius:16}),d.fontWeight=$}if(this.localGlyphs[d.fontWeight][a])return this.localGlyphs[d.fontWeight][a];const m=String.fromCharCode(a),{data:g,width:b,height:w,glyphWidth:P,glyphHeight:C,glyphLeft:R,glyphTop:O,glyphAdvance:B}=d.draw(m);return this.localGlyphs[d.fontWeight][a]={id:a,bitmap:new Io({width:b,height:w},g),metrics:{width:P/2,height:C/2,left:R/2,top:O/2-27,advance:B/2,localGlyph:!0}}}}function tv(r,e,t,a){const u=[],d=r.image,m=d.pixelRatio,g=d.paddedRect.w-2,b=d.paddedRect.h-2,w=r.right-r.left,P=r.bottom-r.top,C=d.stretchX||[[0,g]],R=d.stretchY||[[0,b]],O=(ze,je)=>ze+je[1]-je[0],B=C.reduce(O,0),$=R.reduce(O,0),q=g-B,te=b-$;let le=0,ne=B,se=0,me=$,ce=0,Me=q,Pe=0,Oe=te;if(d.content&&a){const ze=d.content;le=xf(C,0,ze[0]),se=xf(R,0,ze[1]),ne=xf(C,ze[0],ze[2]),me=xf(R,ze[1],ze[3]),ce=ze[0]-le,Pe=ze[1]-se,Me=ze[2]-ze[0]-ne,Oe=ze[3]-ze[1]-me}const rt=(ze,je,qe,Ne)=>{const et=bf(ze.stretch-le,ne,w,r.left),Ze=wf(ze.fixed-ce,Me,ze.stretch,B),at=bf(je.stretch-se,me,P,r.top),kt=wf(je.fixed-Pe,Oe,je.stretch,$),Lt=bf(qe.stretch-le,ne,w,r.left),xt=wf(qe.fixed-ce,Me,qe.stretch,B),nt=bf(Ne.stretch-se,me,P,r.top),Zt=wf(Ne.fixed-Pe,Oe,Ne.stretch,$),Ct=new L(et,at),ft=new L(Lt,at),yr=new L(Lt,nt),dr=new L(et,nt),Mr=new L(Ze/m,kt/m),jt=new L(xt/m,Zt/m),Yt=e*Math.PI/180;if(Yt){const ur=Math.sin(Yt),Sr=Math.cos(Yt),Lr=[Sr,-ur,ur,Sr];Ct._matMult(Lr),ft._matMult(Lr),dr._matMult(Lr),yr._matMult(Lr)}const vr=ze.stretch+ze.fixed,pr=je.stretch+je.fixed;return{tl:Ct,tr:ft,bl:dr,br:yr,tex:{x:d.paddedRect.x+1+vr,y:d.paddedRect.y+1+pr,w:qe.stretch+qe.fixed-vr,h:Ne.stretch+Ne.fixed-pr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Mr,pixelOffsetBR:jt,minFontScaleX:Me/m/w,minFontScaleY:Oe/m/P,isSDF:t}};if(a&&(d.stretchX||d.stretchY)){const ze=rv(C,q,B),je=rv(R,te,$);for(let qe=0;qe<ze.length-1;qe++){const Ne=ze[qe],et=ze[qe+1];for(let Ze=0;Ze<je.length-1;Ze++)u.push(rt(Ne,je[Ze],et,je[Ze+1]))}}else u.push(rt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:b+1}));return u}function xf(r,e,t){let a=0;for(const u of r)a+=Math.max(e,Math.min(t,u[1]))-Math.max(e,Math.min(t,u[0]));return a}function rv(r,e,t){const a=[{fixed:-1,stretch:0}];for(const[u,d]of r){const m=a[a.length-1];a.push({fixed:u-m.stretch,stretch:m.stretch}),a.push({fixed:u-m.stretch,stretch:m.stretch+(d-u)})}return a.push({fixed:e+1,stretch:t}),a}function bf(r,e,t,a){return r/e*t+a}function wf(r,e,t,a){return r-e*t/a}function g2(r,e,t,a){const u=e+r.positionedLines[a].lineOffset;return a===0?t+u/2:t+(u+(e+r.positionedLines[a-1].lineOffset))/2}Sl.loadGlyphRange=function(r,e,t,a,u){const d=256*e,m=d+255,g=a.transformRequest(a.normalizeGlyphsURL(t).replace("{fontstack}",r).replace("{range}",`${d}-${m}`),_e.Glyphs);Ee(g,(b,w)=>{if(b)u(b);else if(w){const P={},C=function(R){return new mu(R).readFields(c2,{})}(w);for(const R of C.glyphs)P[R.id]=R;u(null,{glyphs:P,ascender:C.ascender,descender:C.descender})}})},Sl.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:t=8,cutoff:a=.25,fontFamily:u="sans-serif",fontWeight:d="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=t;const g=this.size=r+4*e,b=this._createCanvas(g),w=this.ctx=b.getContext("2d",{willReadFrequently:!0});w.font=`${m} ${d} ${r}px ${u}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:t,actualBoundingBoxDescent:a,actualBoundingBoxLeft:u,actualBoundingBoxRight:d}=this.ctx.measureText(r),m=Math.ceil(t),g=Math.min(this.size-this.buffer,Math.ceil(d-u)),b=Math.min(this.size-this.buffer,m+Math.ceil(a)),w=g+2*this.buffer,P=b+2*this.buffer,C=Math.max(w*P,0),R=new Uint8ClampedArray(C),O={data:R,width:w,height:P,glyphWidth:g,glyphHeight:b,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(g===0||b===0)return O;const{ctx:B,buffer:$,gridInner:q,gridOuter:te}=this;B.clearRect($,$,g,b),B.fillText(r,$,$+m);const le=B.getImageData($,$,g,b);te.fill(gu,0,C),q.fill(0,0,C);for(let ne=0;ne<b;ne++)for(let se=0;se<g;se++){const me=le.data[4*(ne*g+se)+3]/255;if(me===0)continue;const ce=(ne+$)*w+se+$;if(me===1)te[ce]=0,q[ce]=gu;else{const Me=.5-me;te[ce]=Me>0?Me*Me:0,q[ce]=Me<0?Me*Me:0}}Jy(te,0,0,w,P,w,this.f,this.v,this.z),Jy(q,$,$,g,b,w,this.f,this.v,this.z);for(let ne=0;ne<C;ne++){const se=Math.sqrt(te[ne])-Math.sqrt(q[ne]);R[ne]=Math.round(255-255*(se/this.radius+this.cutoff))}return O}};class y2{constructor(e=[],t=v2){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:a}=this,u=t[e];for(;e>0;){const d=e-1>>1,m=t[d];if(a(u,m)>=0)break;t[e]=m,e=d}t[e]=u}_down(e){const{data:t,compare:a}=this,u=this.length>>1,d=t[e];for(;e<u;){let m=1+(e<<1),g=t[m];const b=m+1;if(b<this.length&&a(t[b],g)<0&&(m=b,g=t[b]),a(g,d)>=0)break;t[e]=g,e=m}t[e]=d}}function v2(r,e){return r<e?-1:r>e?1:0}function x2(r,e=1,t=!1){let a=1/0,u=1/0,d=-1/0,m=-1/0;const g=r[0];for(let O=0;O<g.length;O++){const B=g[O];(!O||B.x<a)&&(a=B.x),(!O||B.y<u)&&(u=B.y),(!O||B.x>d)&&(d=B.x),(!O||B.y>m)&&(m=B.y)}const b=Math.min(d-a,m-u);let w=b/2;const P=new y2([],b2);if(b===0)return new L(a,u);for(let O=a;O<d;O+=b)for(let B=u;B<m;B+=b)P.push(new Al(O+w,B+w,w,r));let C=function(O){let B=0,$=0,q=0;const te=O[0];for(let le=0,ne=te.length,se=ne-1;le<ne;se=le++){const me=te[le],ce=te[se],Me=me.x*ce.y-ce.x*me.y;$+=(me.x+ce.x)*Me,q+=(me.y+ce.y)*Me,B+=3*Me}return new Al($/B,q/B,0,O)}(r),R=P.length;for(;P.length;){const O=P.pop();(O.d>C.d||!C.d)&&(C=O,t&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,R)),O.max-C.d<=e||(w=O.h/2,P.push(new Al(O.p.x-w,O.p.y-w,w,r)),P.push(new Al(O.p.x+w,O.p.y-w,w,r)),P.push(new Al(O.p.x-w,O.p.y+w,w,r)),P.push(new Al(O.p.x+w,O.p.y+w,w,r)),R+=4)}return t&&(console.log(`num probes: ${R}`),console.log(`best distance: ${C.d}`)),C.p}function b2(r,e){return e.max-r.max}function Al(r,e,t,a){this.p=new L(r,e),this.h=t,this.d=function(u,d){let m=!1,g=1/0;for(let b=0;b<d.length;b++){const w=d[b];for(let P=0,C=w.length,R=C-1;P<C;R=P++){const O=w[P],B=w[R];O.y>u.y!=B.y>u.y&&u.x<(B.x-O.x)*(u.y-O.y)/(B.y-O.y)+O.x&&(m=!m),g=Math.min(g,$g(u,O,B))}}return(m?1:-1)*Math.sqrt(g)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}const um=Number.POSITIVE_INFINITY,w2=Math.sqrt(2);function iv(r,e){return e[1]!==um?function(t,a,u){let d=0,m=0;switch(a=Math.abs(a),u=Math.abs(u),t){case"top-right":case"top-left":case"top":m=u-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-u}switch(t){case"top-right":case"bottom-right":case"right":d=-a;break;case"top-left":case"bottom-left":case"left":d=a}return[d,m]}(r,e[0],e[1]):function(t,a){let u=0,d=0;a<0&&(a=0);const m=a/w2;switch(t){case"top-right":case"top-left":d=m-7;break;case"bottom-right":case"bottom-left":d=7-m;break;case"bottom":d=7-a;break;case"top":d=a-7}switch(t){case"top-right":case"bottom-right":u=-m;break;case"top-left":case"bottom-left":u=m;break;case"left":u=a;break;case"right":u=-a}return[u,d]}(r,e[0])}function T2(r,e,t,a,u,d,m,g,b,w){r.createArrays(),r.tilePixelRatio=It/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const P=r.layers[0].layout,C=r.layers[0]._unevaluatedLayout._values,R={};if(r.textSizeData.kind==="composite"){const{minZoom:$,maxZoom:q}=r.textSizeData;R.compositeTextSizes=[C["text-size"].possiblyEvaluate(new Q($),g),C["text-size"].possiblyEvaluate(new Q(q),g)]}if(r.iconSizeData.kind==="composite"){const{minZoom:$,maxZoom:q}=r.iconSizeData;R.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new Q($),g),C["icon-size"].possiblyEvaluate(new Q(q),g)]}R.layoutTextSize=C["text-size"].possiblyEvaluate(new Q(b+1),g),R.layoutIconSize=C["icon-size"].possiblyEvaluate(new Q(b+1),g),R.textMaxSize=C["text-size"].possiblyEvaluate(new Q(18),g);const O=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",B=P.get("text-size");for(const $ of r.features){const q=P.get("text-font").evaluate($,{},g).join(","),te=B.evaluate($,{},g),le=R.layoutTextSize.evaluate($,{},g),ne=(R.layoutIconSize.evaluate($,{},g),{horizontal:{},vertical:void 0}),se=$.text;let me,ce=[0,0];if(se){const Oe=se.toString(),rt=P.get("text-letter-spacing").evaluate($,{},g)*vi,ze=P.get("text-line-height").evaluate($,{},g)*vi,je=Ap(Oe)?rt:0,qe=P.get("text-anchor").evaluate($,{},g),Ne=P.get("text-variable-anchor");if(!Ne){const xt=P.get("text-radial-offset").evaluate($,{},g);ce=xt?iv(qe,[xt*vi,um]):P.get("text-offset").evaluate($,{},g).map(nt=>nt*vi)}let et=O?"center":P.get("text-justify").evaluate($,{},g);const Ze=P.get("symbol-placement"),at=Ze==="point",kt=Ze==="point"?P.get("text-max-width").evaluate($,{},g)*vi:0,Lt=xt=>{r.allowVerticalPlacement&&fl(Oe)&&(ne.vertical=sm(se,e,t,u,q,kt,ze,qe,xt,je,ce,pn.vertical,!0,Ze,le,te))};if(!O&&Ne){const xt=et==="auto"?Ne.map(Zt=>hm(Zt)):[et];let nt=!1;for(let Zt=0;Zt<xt.length;Zt++){const Ct=xt[Zt];if(!ne.horizontal[Ct])if(nt)ne.horizontal[Ct]=ne.horizontal[0];else{const ft=sm(se,e,t,u,q,kt,ze,"center",Ct,je,ce,pn.horizontal,!1,Ze,le,te);ft&&(ne.horizontal[Ct]=ft,nt=ft.positionedLines.length===1)}}Lt("left")}else{if(et==="auto"&&(et=hm(qe)),at||P.get("text-writing-mode").indexOf("horizontal")>=0||!fl(Oe)){const xt=sm(se,e,t,u,q,kt,ze,qe,et,je,ce,pn.horizontal,!1,Ze,le,te);xt&&(ne.horizontal[et]=xt)}Lt(Ze==="point"?"left":et)}}let Me=!1;if($.icon&&$.icon.name){const Oe=a[$.icon.name];Oe&&(me=p2(u[$.icon.name],P.get("icon-offset").evaluate($,{},g),P.get("icon-anchor").evaluate($,{},g)),Me=Oe.sdf,r.sdfIcons===void 0?r.sdfIcons=Oe.sdf:r.sdfIcons!==Oe.sdf&&hr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Oe.pixelRatio!==r.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0))}const Pe=ov(ne.horizontal)||ne.vertical;r.iconsInText||(r.iconsInText=!!Pe&&Pe.iconsInText),(Pe||me)&&E2(r,$,ne,me,a,R,le,0,ce,Me,m,g,w)}d&&r.generateCollisionDebugBuffers(b,r.collisionBoxArray)}function hm(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function E2(r,e,t,a,u,d,m,g,b,w,P,C,R){let O=d.textMaxSize.evaluate(e,{},C);O===void 0&&(O=m);const B=r.layers[0].layout,$=B.get("icon-offset").evaluate(e,{},C),q=ov(t.horizontal)||t.vertical,te=R.name==="globe",le=m/24,ne=r.tilePixelRatio*O/24,se=(je=r.overscaling,r.zoom>18&&je>2&&(je>>=1),Math.max(It/(512*je),1)*B.get("symbol-spacing")),me=B.get("text-padding")*r.tilePixelRatio,ce=B.get("icon-padding")*r.tilePixelRatio,Me=W(B.get("text-max-angle")),Pe=B.get("text-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",Oe=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",rt=B.get("symbol-placement"),ze=se/2;var je;const qe=B.get("icon-text-fit");let Ne;a&&qe!=="none"&&(r.allowVerticalPlacement&&t.vertical&&(Ne=Zy(a,t.vertical,qe,B.get("icon-text-fit-padding"),$,le)),q&&(a=Zy(a,q,qe,B.get("icon-text-fit-padding"),$,le)));const et=(Ze,at,kt)=>{if(at.x<0||at.x>=It||at.y<0||at.y>=It)return;let Lt=null;if(te){const{x:xt,y:nt,z:Zt}=R.projectTilePoint(at.x,at.y,kt);Lt={anchor:new Co(xt,nt,Zt,0,void 0),up:R.upVector(kt,at.x,at.y)}}(function(xt,nt,Zt,Ct,ft,yr,dr,Mr,jt,Yt,vr,pr,ur,Sr,Lr,hi,qi,Wt,Gr,Si,rr,Fr,Fi,Cr,Hr){const fi=xt.addToLineVertexArray(nt,Ct);let li,xi,Bi,di,Ro,zl,Iu,Mu=0,Vv=0,$v=0,Gv=0,Im=-1,Mm=-1;const so={};let qv=eu("");const ya=Zt?Zt.anchor:nt;let Cm=0,zm=0;if(jt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Cm,zm]=jt.layout.get("text-offset").evaluate(rr,{},Hr).map(en=>en*vi):(Cm=jt.layout.get("text-radial-offset").evaluate(rr,{},Hr)*vi,zm=um),xt.allowVerticalPlacement&&ft.vertical){const en=ft.vertical;if(Lr)zl=fm(en),Mr&&(Iu=fm(Mr));else{const tn=jt.layout.get("text-rotate").evaluate(rr,{},Hr)+90;Bi=Tf(Yt,ya,nt,vr,pr,ur,en,Sr,tn,hi),Mr&&(di=Tf(Yt,ya,nt,vr,pr,ur,Mr,Wt,tn))}}if(yr){const en=jt.layout.get("icon-rotate").evaluate(rr,{},Hr),tn=jt.layout.get("icon-text-fit")!=="none",Cu=tv(yr,en,Fi,tn),km=Mr?tv(Mr,en,Fi,tn):void 0;xi=Tf(Yt,ya,nt,vr,pr,ur,yr,Wt,en),Mu=4*Cu.length;const Zv=xt.iconSizeData;let va=null;Zv.kind==="source"?(va=[to*jt.layout.get("icon-size").evaluate(rr,{},Hr)],va[0]>fs&&hr(`${xt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Zv.kind==="composite"&&(va=[to*Fr.compositeIconSizes[0].evaluate(rr,{},Hr),to*Fr.compositeIconSizes[1].evaluate(rr,{},Hr)],(va[0]>fs||va[1]>fs)&&hr(`${xt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),xt.addSymbols(xt.icon,Cu,va,Si,Gr,rr,!1,Zt,nt,fi.lineStartIndex,fi.lineLength,-1,Cr,Hr),Im=xt.icon.placedSymbolArray.length-1,km&&(Vv=4*km.length,xt.addSymbols(xt.icon,km,va,Si,Gr,rr,pn.vertical,Zt,nt,fi.lineStartIndex,fi.lineLength,-1,Cr,Hr),Mm=xt.icon.placedSymbolArray.length-1)}for(const en in ft.horizontal){const tn=ft.horizontal[en];li||(qv=eu(tn.text),Lr?Ro=fm(tn):li=Tf(Yt,ya,nt,vr,pr,ur,tn,Sr,jt.layout.get("text-rotate").evaluate(rr,{},Hr),hi));const Cu=tn.positionedLines.length===1;if($v+=nv(xt,Zt,nt,tn,dr,jt,Lr,rr,hi,fi,ft.vertical?pn.horizontal:pn.horizontalOnly,Cu?Object.keys(ft.horizontal):[en],so,Im,Fr,Cr,Hr),Cu)break}ft.vertical&&(Gv+=nv(xt,Zt,nt,ft.vertical,dr,jt,Lr,rr,hi,fi,pn.vertical,["vertical"],so,Mm,Fr,Cr,Hr));let ys=-1;const Rm=(en,tn)=>en?Math.max(en,tn):tn;ys=Rm(Ro,ys),ys=Rm(zl,ys),ys=Rm(Iu,ys);const rT=ys>-1?1:0;xt.glyphOffsetArray.length>=ps.MAX_GLYPHS&&hr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),rr.sortKey!==void 0&&xt.addToSortKeyRanges(xt.symbolInstances.length,rr.sortKey),xt.symbolInstances.emplaceBack(ya.x,ya.y,ya.z,nt.x,nt.y,so.right>=0?so.right:-1,so.center>=0?so.center:-1,so.left>=0?so.left:-1,so.vertical>=0?so.vertical:-1,Im,Mm,qv,li!==void 0?li:xt.collisionBoxArray.length,li!==void 0?li+1:xt.collisionBoxArray.length,Bi!==void 0?Bi:xt.collisionBoxArray.length,Bi!==void 0?Bi+1:xt.collisionBoxArray.length,xi!==void 0?xi:xt.collisionBoxArray.length,xi!==void 0?xi+1:xt.collisionBoxArray.length,di||xt.collisionBoxArray.length,di?di+1:xt.collisionBoxArray.length,vr,$v,Gv,Mu,Vv,rT,0,Cm,zm,ys)})(r,at,Lt,Ze,t,a,u,Ne,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,me,Pe,b,0,ce,Oe,$,e,d,w,P,C)};if(rt==="line")for(const Ze of Ky(e.geometry,0,0,It,It)){const at=_2(Ze,se,Me,t.vertical||q,a,24,ne,r.overscaling,It);for(const kt of at){const Lt=q;Lt&&S2(r,Lt.text,ze,kt)||et(Ze,kt,C)}}else if(rt==="line-center"){for(const Ze of e.geometry)if(Ze.length>1){const at=m2(Ze,Me,t.vertical||q,a,24,ne);at&&et(Ze,at,C)}}else if(e.type==="Polygon")for(const Ze of Jp(e.geometry,0)){const at=x2(Ze,16);et(Ze[0],new Co(at.x,at.y,0,0,void 0),C)}else if(e.type==="LineString")for(const Ze of e.geometry)et(Ze,new Co(Ze[0].x,Ze[0].y,0,0,void 0),C);else if(e.type==="Point")for(const Ze of e.geometry)for(const at of Ze)et([at],new Co(at.x,at.y,0,0,void 0),C)}const fs=32640;function nv(r,e,t,a,u,d,m,g,b,w,P,C,R,O,B,$,q){const te=function(se,me,ce,Me,Pe,Oe,rt,ze){const je=[];if(me.positionedLines.length===0)return je;const qe=Me.layout.get("text-rotate").evaluate(Oe,{})*Math.PI/180,Ne=function(Lt){const xt=Lt[0],nt=Lt[1],Zt=xt*nt;return Zt>0?[xt,-nt]:Zt<0?[-xt,nt]:xt===0?[nt,xt]:[nt,-xt]}(ce);let et=Math.abs(me.top-me.bottom);for(const Lt of me.positionedLines)et-=Lt.lineOffset;const Ze=me.positionedLines.length,at=et/Ze;let kt=me.top-ce[1];for(let Lt=0;Lt<Ze;++Lt){const xt=me.positionedLines[Lt];kt=g2(me,at,kt,Lt);for(const nt of xt.positionedGlyphs){if(!nt.rect)continue;const Zt=nt.rect||{};let Ct=4,ft=!0,yr=1,dr=0;if(nt.imageName){const Cr=rt[nt.imageName];if(!Cr)continue;if(Cr.sdf){hr("SDF images are not supported in formatted text and will be ignored.");continue}ft=!1,yr=Cr.pixelRatio,Ct=1/yr}const Mr=(Pe||ze)&&nt.vertical,jt=nt.metrics.advance*nt.scale/2,Yt=nt.metrics,vr=nt.rect;if(vr===null)continue;ze&&me.verticalizable&&(dr=nt.imageName?jt-nt.metrics.width*nt.scale/2:0);const pr=Pe?[nt.x+jt,nt.y]:[0,0];let ur=[0,0],Sr=[0,0],Lr=!1;Pe||(Mr?(Sr=[nt.x+jt+Ne[0],nt.y+Ne[1]-dr],Lr=!0):ur=[nt.x+jt+ce[0],nt.y+ce[1]-dr]);const hi=vr.w*nt.scale/(yr*(nt.localGlyph?2:1)),qi=vr.h*nt.scale/(yr*(nt.localGlyph?2:1));let Wt,Gr,Si,rr;if(Mr){const Cr=nt.y-kt,Hr=new L(-jt,jt-Cr),fi=-Math.PI/2,li=new L(...Sr);Wt=new L(-jt+ur[0],ur[1]),Wt._rotateAround(fi,Hr)._add(li),Wt.x+=-Cr+jt,Wt.y-=(Yt.left-Ct)*nt.scale;const xi=nt.imageName?Yt.advance*nt.scale:vi*nt.scale,Bi=String.fromCharCode(nt.glyph);Kw(Bi)?Wt.x+=(1-Ct)*nt.scale:Jw(Bi)?Wt.x+=xi-Yt.height*nt.scale+(-Ct-1)*nt.scale:Wt.x+=nt.imageName||Yt.width+2*Ct===vr.w&&Yt.height+2*Ct===vr.h?(xi-qi)/2:(xi-(Yt.height+2*Ct)*nt.scale)/2,Gr=new L(Wt.x,Wt.y-hi),Si=new L(Wt.x+qi,Wt.y),rr=new L(Wt.x+qi,Wt.y-hi)}else{const Cr=(Yt.left-Ct)*nt.scale-jt+ur[0],Hr=(-Yt.top-Ct)*nt.scale+ur[1],fi=Cr+hi,li=Hr+qi;Wt=new L(Cr,Hr),Gr=new L(fi,Hr),Si=new L(Cr,li),rr=new L(fi,li)}if(qe){let Cr;Cr=Pe?new L(0,0):Lr?new L(Ne[0],Ne[1]):new L(ce[0],ce[1]),Wt._rotateAround(qe,Cr),Gr._rotateAround(qe,Cr),Si._rotateAround(qe,Cr),rr._rotateAround(qe,Cr)}const Fr=new L(0,0),Fi=new L(0,0);je.push({tl:Wt,tr:Gr,bl:Si,br:rr,tex:Zt,writingMode:me.writingMode,glyphOffset:pr,sectionIndex:nt.sectionIndex,isSDF:ft,pixelOffsetTL:Fr,pixelOffsetBR:Fi,minFontScaleX:0,minFontScaleY:0})}}return je}(0,a,b,d,m,g,u,r.allowVerticalPlacement),le=r.textSizeData;let ne=null;le.kind==="source"?(ne=[to*d.layout.get("text-size").evaluate(g,{},q)],ne[0]>fs&&hr(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):le.kind==="composite"&&(ne=[to*B.compositeTextSizes[0].evaluate(g,{},q),to*B.compositeTextSizes[1].evaluate(g,{},q)],(ne[0]>fs||ne[1]>fs)&&hr(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),r.addSymbols(r.text,te,ne,b,m,g,P,e,t,w.lineStartIndex,w.lineLength,O,$,q);for(const se of C)R[se]=r.text.placedSymbolArray.length-1;return 4*te.length}function ov(r){for(const e in r)return r[e];return null}function Tf(r,e,t,a,u,d,m,g,b,w){let P=m.top,C=m.bottom,R=m.left,O=m.right;const B=m.collisionPadding;if(B&&(R-=B[0],P-=B[1],O+=B[2],C+=B[3]),b){const $=new L(R,P),q=new L(O,P),te=new L(R,C),le=new L(O,C),ne=W(b);let se=new L(0,0);w&&(se=new L(w[0],w[1])),$._rotateAround(ne,se),q._rotateAround(ne,se),te._rotateAround(ne,se),le._rotateAround(ne,se),R=Math.min($.x,q.x,te.x,le.x),O=Math.max($.x,q.x,te.x,le.x),P=Math.min($.y,q.y,te.y,le.y),C=Math.max($.y,q.y,te.y,le.y)}return r.emplaceBack(e.x,e.y,e.z,t.x,t.y,R,P,O,C,g,a,u,d),r.length-1}function fm(r){r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function S2(r,e,t,a){const u=r.compareText;if(e in u){const d=u[e];for(let m=d.length-1;m>=0;m--)if(a.dist(d[m])<t)return!0}else u[e]=[];return u[e].push(a),!1}const A2=Be([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:sv}=A2,av=Be([{name:"a_pos_3",components:3,type:"Int16"}]);var yu=Be([{name:"a_pos",type:"Int16",components:2}]);const zo=It/Math.PI/2,dm=2*vn(1,0)*zo*Math.PI,Pl=[64,32,16],Dn=-zo,On=zo,P2=[new Gi([Dn,Dn,Dn],[On,On,On]),new Gi([Dn,Dn,Dn],[0,0,On]),new Gi([0,Dn,Dn],[On,0,On]),new Gi([Dn,0,Dn],[0,On,On]),new Gi([0,0,Dn],[On,On,On])];function lv(r,e,t,a=!0){const u=Rn([],r._camera.position,r.worldSize),d=[e,t,1,1];da(d,d,r.pixelMatrixInverse),ey(d,d,1/d[3]);const m=Oi([],kn([],d,u)),g=r.globeMatrix,b=[g[12],g[13],g[14]],w=kn([],b,u),P=iu(w),C=Oi([],w),R=r.worldSize/(2*Math.PI),O=bn(C,m),B=Math.asin(R/P);if(B<Math.acos(O)){if(!a)return null;const rt=[],ze=[];Rn(rt,m,P/O),Oi(ze,kn(ze,rt,w)),Oi(m,hs(m,w,Rn(m,ze,Math.tan(B)*P)))}const $=[];new qp(u,m).closestPointOnSphere(b,R,$);const q=Oi([],Ye(g,0)),te=Oi([],Ye(g,1)),le=Oi([],Ye(g,2)),ne=bn(q,$),se=bn(te,$),me=bn(le,$),ce=he(Math.asin(-se/R));let Me=he(Math.atan2(ne,me));Me=r.center.lng+function(rt,ze){const je=(ze-rt+180)%360-180;return je<-180?je+360:je}(r.center.lng,Me);const Pe=Kn(Me),Oe=Ie(Ao(ce),0,1);return new ml(Pe,Oe)}class I2{constructor(e,t,a){this.a=kn([],e,a),this.b=kn([],t,a),this.center=a;const u=Oi([],this.a),d=Oi([],this.b);this.angle=Math.acos(bn(u,d))}}function pm(r,e){if(r.angle===0)return null;let t;return t=r.a[e]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[e]/r.a[e]/Math.sin(r.angle)-1/Math.tan(r.angle)),t<0||t>1?null:function(a,u,d,m){const g=Math.sin(d);return a*(Math.sin((1-m)*d)/g)+u*(Math.sin(m*d)/g)}(r.a[e],r.b[e],r.angle,Ie(t,0,1))+r.center[e]}function ro(r){if(r.z<=1)return P2[r.z+2*r.y+r.x];const e=mm(Ef(r));return Gi.fromPoints(e)}function cv(r,e){const t=bu(e.zoom);if(t===0)return ro(r);const a=Ef(r),u=mm(a),d=Kn(a.getWest())*e.worldSize,m=Kn(a.getEast())*e.worldSize,g=Ao(a.getNorth())*e.worldSize,b=Ao(a.getSouth())*e.worldSize,w=[d,g,0],P=[m,g,0],C=[d,b,0],R=[m,b,0],O=Bp([],e.globeMatrix);return ni(w,w,O),ni(P,P,O),ni(C,C,O),ni(R,R,O),u[0]=Xo(u[0],C,t),u[1]=Xo(u[1],R,t),u[2]=Xo(u[2],P,t),u[3]=Xo(u[3],w,t),Gi.fromPoints(u)}function uv(r,e,t,a,u){for(const d of t)ni(d,d,a),Rn(d,d,u),Vp(r,r,d),$p(e,e,d)}function M2(r,e,t){const a=e/r.worldSize,u=Number.MAX_VALUE,d=[-u,-u,-u],m=[u,u,u],g=r.globeMatrix;if(t.z<=1)return uv(m,d,ro(t).getCorners(),g,a),new Gi(m,d);const b=Ef(t),w=mm(b);if(uv(m,d,w,g,a),b.contains(r.center)){d[2]=0;const Me=r.point,Pe=[Me.x*a,Me.y*a,0];return Vp(m,m,Pe),$p(d,d,Pe),new Gi(m,d)}const P=[g[12]*a,g[13]*a,g[14]*a],C=b.getCenter(),R=Ie(r.center.lat,-85.051129,Jn),O=Ie(C.lat,-85.051129,Jn),B=Kn(r.center.lng),$=Ao(R);let q=B-Kn(C.lng);const te=$-Ao(O);q>.5?q-=1:q<-.5&&(q+=1);let le=0;Math.abs(q)>Math.abs(te)?le=q>=0?1:3:(le=te>=0?0:2,sf(P,P,[g[4]*a,g[5]*a,g[6]*a],-Math.sin(W(te>=0?b.getSouth():b.getNorth()))*zo));const ne=w[le],se=w[(le+1)%4],me=new I2(ne,se,P),ce=[pm(me,0)||ne[0],pm(me,1)||ne[1],pm(me,2)||ne[2]];return m[2]=Math.min(ne[2],se[2]),Vp(m,m,ce),$p(d,d,ce),new Gi(m,d)}function Ef({x:r,y:e,z:t}){const a=1/(1<<t),u=new nr(xn(r*a),yi((e+1)*a)),d=new nr(xn((r+1)*a),yi(e*a));return new us(u,d)}function mm(r){const e=W(r.getNorth()),t=W(r.getSouth()),a=Math.cos(e),u=Math.cos(t),d=Math.sin(e),m=Math.sin(t),g=r.getWest(),b=r.getEast();return[Il(u,m,g),Il(u,m,b),Il(a,d,b),Il(a,d,g)]}function Il(r,e,t,a=zo){return t=W(t),[r*Math.sin(t)*a,-e*a,r*Math.cos(t)*a]}function Sf(r,e,t){return Il(Math.cos(W(r)),Math.sin(W(r)),e,t)}function vu(r,e,t,a){const u=1<<t.z,d=(r/It+t.x)/u;return Sf(yi((e/It+t.y)/u),xn(d),a)}function Af({min:r,max:e}){return 16383/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}const hv=new Float64Array(16);function xu(r){const e=Af(r),t=Xg(hv,[e,e,e]);return ru(t,t,((a=[])[0]=-(u=r.min)[0],a[1]=-u[1],a[2]=-u[2],a));var a,u}function _m(r){const e=(a=r.min,(t=hv)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=a[0],t[13]=a[1],t[14]=a[2],t[15]=1,t);var t,a;const u=1/Af(r);return fa(e,e,[u,u,u])}function fv(r,e,t,a,u){const d=function(b){const w=It/(2*Math.PI);return b/(2*Math.PI)/w}(t),m=[r,e,-t/(2*Math.PI)],g=eo(new Float64Array(16));return ru(g,g,m),fa(g,g,[d,d,d]),jp(g,g,W(-u)),of(g,g,W(-a)),g}function bu(r){return We(5,6,r)}function dv(r,e){const t=Sf(e.lat,e.lng);return d=(a=Up([],function(O){const B=Sf(O._center.lat,O._center.lng);let $=Gp([],yl(0,1,0),B);const q=Qg([],-O.angle,B);$=ni($,$,q),Qg(q,-O._pitch,$);const te=Oi([],B);return Rn(te,te,O.cameraToCenterDistance/O.pixelsPerMeter*dm),ni(te,te,q),hs([],B,te)}(r),t))[0],m=a[1],g=a[2],b=(u=t)[0],w=u[1],P=u[2],R=(C=Math.sqrt(d*d+m*m+g*g)*Math.sqrt(b*b+w*w+P*P))&&bn(a,u)/C,Math.acos(Math.min(Math.max(R,-1),1));var a,u,d,m,g,b,w,P,C,R}const pv=W(85),C2=Math.cos(pv),z2=Math.sin(pv);function mv(r,e){const t=r.fovAboveCenter,a=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,u=(r._camera.position[2]*r.worldSize-a)/Math.cos(r._pitch),d=Math.sin(t)*u/Math.sin(Math.max(Math.PI/2-r._pitch-t,.01)),m=Math.sin(r._pitch)*d+u;return Math.min(1.01*m,u*(1/r._horizonShift))}function _a(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const t=Math.pow(2,-r.z),a=r.x*t,u=(r.x+1)*t,d=r.y*t,m=(r.y+1)*t,g=xn(a),b=xn(u),w=yi(d),P=yi(m),C=e.project(g,w),R=e.project(b,w),O=e.project(b,P),B=e.project(g,P);let $=Math.min(C.x,R.x,O.x,B.x),q=Math.min(C.y,R.y,O.y,B.y),te=Math.max(C.x,R.x,O.x,B.x),le=Math.max(C.y,R.y,O.y,B.y);const ne=t/16;function se(ce,Me,Pe,Oe,rt,ze){const je=(Pe+rt)/2,qe=(Oe+ze)/2,Ne=e.project(xn(je),yi(qe)),et=Math.max(0,$-Ne.x,q-Ne.y,Ne.x-te,Ne.y-le);$=Math.min($,Ne.x),te=Math.max(te,Ne.x),q=Math.min(q,Ne.y),le=Math.max(le,Ne.y),et>ne&&(se(ce,Ne,Pe,Oe,je,qe),se(Ne,Me,je,qe,rt,ze))}se(C,R,a,d,u,d),se(R,O,u,d,u,m),se(O,B,u,m,a,m),se(B,C,a,m,a,d),$-=ne,q-=ne,te+=ne,le+=ne;const me=1/Math.max(te-$,le-q);return{scale:me,x:$*me,y:q*me,x2:te*me,y2:le*me,projection:e}}const R2=eo(new Float32Array(16));class ds{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new nr(0,0)}projectTilePoint(e,t,a){return{x:e,y:t,z:0}}locationPoint(e,t,a=!0){return e._coordinatePoint(e.locationCoordinate(t),a)}pixelsPerMeter(e,t){return vn(1,e)*t}pixelSpaceConversion(e,t,a){return 1}farthestPixelDistance(e){return mv(e,e.pixelsPerMeter)}pointCoordinate(e,t,a,u){const d=e.horizonLineFromTop(!1),m=new L(t,Math.max(d,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,u))}pointCoordinate3D(e,t,a){const u=new L(t,a);if(e.elevation)return e.elevation.pointCoordinate(u);{const d=this.pointCoordinate(e,u.x,u.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const a=e.horizonLineFromTop();return t.y<a}createInversionMatrix(e,t){return R2}createTileMatrix(e,t,a){let u,d,m;const g=a.canonical,b=eo(new Float64Array(16));if(this.isReprojectedInTileSpace){const w=_a(g,this);u=1,d=w.x+a.wrap*w.scale,m=w.y,fa(b,b,[u/w.scale,u/w.scale,e.pixelsPerMeter/t])}else u=t/e.zoomScale(g.z),d=(g.x+Math.pow(2,g.z)*a.wrap)*u,m=g.y*u;return ru(b,b,[d,m,0]),fa(b,b,[u/It,u/It,1]),b}upVector(e,t,a){return[0,0,1]}upVectorScale(e,t,a){return{metersToTile:1}}}class k2 extends ds{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,a]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(W(t));this.n=(u+Math.sin(W(a)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:a,c:u,r0:d}=this,m=W(e-this.center[0]),g=W(t),b=Math.sqrt(u-2*a*Math.sin(g))/a;return{x:b*Math.sin(m*a),y:b*Math.cos(m*a)-d,z:0}}unproject(e,t){const{n:a,c:u,r0:d}=this,m=d+t;let g=Math.atan2(e,Math.abs(m))*Math.sign(m);m*a<0&&(g-=Math.PI*Math.sign(e)*Math.sign(m));const b=W(this.center[0])*a;g=mt(g,-Math.PI-b,Math.PI-b);const w=he(g/a)+this.center[0],P=Math.asin(Ie((u-(e*e+m*m)*a*a)/(2*a),-1,1)),C=Ie(he(P),-85.051129,Jn);return new nr(w,C)}}const wu=1.340264,Tu=-.081106,Eu=893e-6,Su=.003796,Pf=Math.sqrt(3)/2;class D2 extends ds{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(Pf*Math.sin(t)),u=a*a,d=u*u*u;return{x:.5*(e*Math.cos(a)/(Pf*(wu+3*Tu*u+d*(7*Eu+9*Su*u)))/Math.PI+.5),y:1-.5*(a*(wu+Tu*u+d*(Eu+Su*u))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let a=t=(2*(1-t)-1)*Math.PI,u=a*a,d=u*u*u;for(let P,C,R,O=0;O<12&&(C=a*(wu+Tu*u+d*(Eu+Su*u))-t,R=wu+3*Tu*u+d*(7*Eu+9*Su*u),P=C/R,a=Ie(a-P,-Math.PI/3,Math.PI/3),u=a*a,d=u*u*u,!(Math.abs(P)<1e-12));++O);const m=Pf*e*(wu+3*Tu*u+d*(7*Eu+9*Su*u))/Math.cos(a),g=Math.asin(Math.sin(a)/Pf),b=Ie(180*m/Math.PI,-180,180),w=Ie(180*g/Math.PI,-85.051129,Jn);return new nr(b,w)}}class O2 extends ds{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const a=360*(e-.5),u=Ie(360*(.5-t),-85.051129,Jn);return new nr(a,u)}}const Ml=Math.PI/2;function If(r){return Math.tan((Ml+r)/2)}class L2 extends ds{constructor(e){super(e),this.center=e.center||[0,30];const[t,a]=this.parallels=e.parallels||[30,30],u=W(t),d=W(a),m=Math.cos(u);this.n=u===d?Math.sin(u):Math.log(m/Math.cos(d))/Math.log(If(d)/If(u)),this.f=m*Math.pow(If(u),this.n)/this.n}project(e,t){t=W(t),e=W(e-this.center[0]);const a=1e-6,{n:u,f:d}=this;d>0?t<-Ml+a&&(t=-Ml+a):t>Ml-a&&(t=Ml-a);const m=d/Math.pow(If(t),u),g=m*Math.sin(u*e),b=d-m*Math.cos(u*e);return{x:.5*(g/Math.PI+.5),y:1-.5*(b/Math.PI+.5),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,t=(2*(1-t)-.5)*Math.PI;const{n:a,f:u}=this,d=u-t,m=Math.sign(d),g=Math.sign(a)*Math.sqrt(e*e+d*d);let b=Math.atan2(e,Math.abs(d))*m;d*a<0&&(b-=Math.PI*Math.sign(e)*m);const w=Ie(he(b/a)+this.center[0],-180,180),P=Ie(he(2*Math.atan(Math.pow(u/g,1/a))-Ml),-85.051129,Jn);return new nr(w,P)}}class _v extends ds{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:Kn(e),y:Ao(t),z:0}}unproject(e,t){const a=xn(e),u=yi(t);return new nr(a,u)}}const gv=W(Jn);class F2 extends ds{project(e,t){const a=(t=W(t))*t,u=a*a;return{x:.5*((e=W(e))*(.8707-.131979*a+u*(u*(.003971*a-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+a*(.015085+u*(.028874*a-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let a=t=(2*(1-t)-1)*Math.PI,u=25,d=0,m=a*a;do{m=a*a;const w=m*m;d=(a*(1.007226+m*(.015085+w*(.028874*m-.044475-.005916*w)))-t)/(1.007226+m*(.045255+w*(.259866*m-.311325-.005916*11*w))),a=Ie(a-d,-gv,gv)}while(Math.abs(d)>1e-6&&--u>0);m=a*a;const g=Ie(he(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),b=he(a);return new nr(g,b)}}const yv=W(Jn);class B2 extends ds{project(e,t){t=W(t),e=W(e);const a=Math.cos(t),u=2/Math.PI,d=Math.acos(a*Math.cos(e/2)),m=Math.sin(d)/d,g=.5*(e*u+2*a*Math.sin(e/2)/m)||0,b=.5*(t+Math.sin(t)/m)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,t){let a=e=(2*e-.5)*Math.PI,u=t=(2*(1-t)-1)*Math.PI,d=25;const m=1e-6;let g=0,b=0;do{const w=Math.cos(u),P=Math.sin(u),C=2*P*w,R=P*P,O=w*w,B=Math.cos(a/2),$=Math.sin(a/2),q=2*B*$,te=$*$,le=1-O*B*B,ne=le?1/le:0,se=le?Math.acos(w*B)*Math.sqrt(1/le):0,me=.5*(2*se*w*$+2*a/Math.PI)-e,ce=.5*(se*P+u)-t,Me=.5*ne*(O*te+se*w*B*R)+1/Math.PI,Pe=ne*(q*C/4-se*P*$),Oe=.125*ne*(C*$-se*P*O*q),rt=.5*ne*(R*B+se*te*w)+.5,ze=Pe*Oe-rt*Me;g=(ce*Pe-me*rt)/ze,b=(me*Oe-ce*Me)/ze,a=Ie(a-g,-Math.PI,Math.PI),u=Ie(u-b,-yv,yv)}while((Math.abs(g)>m||Math.abs(b)>m)&&--d>0);return new nr(he(a),he(u))}}class vv extends ds{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(W(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:a,cosPhi:u}=this;return{x:W(e)*u*a+.5,y:-Math.sin(W(t))/u*a+.5,z:0}}unproject(e,t){const{scale:a,cosPhi:u}=this,d=-(t-.5)/a,m=Ie(he((e-.5)/a)/u,-180,180),g=Math.asin(Ie(d*u,-1,1)),b=Ie(he(g),-85.051129,Jn);return new nr(m,b)}}class j2 extends _v{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,t,a){const u=vu(e,t,a);return ni(u,u,xu(ro(a))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,t){const a=Sf(t.lat,t.lng),u=Oi([],a),d=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude;sf(a,a,u,vn(1,0)*It*d);const m=eo(new Float64Array(16));return gl(m,e.pixelMatrix,e.globeMatrix),ni(a,a,m),new L(a[0],a[1])}pixelsPerMeter(e,t){return vn(1,0)*t}pixelSpaceConversion(e,t,a){const u=Xt(vn(1,45)*t,vn(1,e)*t,a);return this.pixelsPerMeter(e,t)/u}createTileMatrix(e,t,a){const u=_m(ro(a.canonical));return gl(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,t){const{center:a}=e,u=xu(ro(t));return of(u,u,W(a.lng)),jp(u,u,W(a.lat)),fa(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,t,a,u){return lv(e,t,a,!0)||new ml(0,0)}pointCoordinate3D(e,t,a){const u=this.pointCoordinate(e,t,a,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,t){return!lv(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(u,d){const m=u.cameraToCenterDistance,g=u._centerAltitude*d,b=u._camera,w=u._camera.forward(),P=hs([],Rn([],w,-m),[0,0,g]),C=u.worldSize/(2*Math.PI),R=[0,0,-C],O=u.width/u.height,B=Math.tan(u.fovAboveCenter),$=Rn([],b.up(),B),q=Rn([],b.right(),B*O),te=Oi([],hs([],hs([],w,$),q)),le=[];let ne;if(new qp(P,te).closestPointOnSphere(R,C,le)){const se=hs([],le,R),me=kn([],se,P);ne=Math.cos(u.fovAboveCenter)*iu(me)}else{const se=kn([],P,R),me=kn([],R,P);Oi(me,me);const ce=iu(se)-C;ne=Math.sqrt(ce*(ce+2*C));const Me=Math.acos(ne/(C+ce))-Math.acos(bn(w,me));ne*=Math.cos(Me)}return 1.01*ne}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=bu(e.zoom);if(a>0){const u=mv(e,vn(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Xt(t,u+d*(1-Math.cos(m)),Math.pow(a,10))}return t}upVector(e,t,a){return vu(t,a,e,1)}upVectorScale(e){return{metersToTile:dm*Af(ro(e))}}}function xv(r){const e=r.parallels,t=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new _v(r);case"equirectangular":return new O2(r);case"naturalEarth":return new F2(r);case"equalEarth":return new D2(r);case"winkelTripel":return new B2(r);case"albers":return t?new vv(r):new k2(r);case"lambertConformalConic":return t?new vv(r):new L2(r);case"globe":return new j2(r)}throw new Error(`Invalid projection name: ${r.name}`)}const N2=ma.VectorTileFeature.types,U2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Mf(r,e,t,a,u,d,m,g,b,w,P,C,R){const O=g?Math.min(fs,Math.round(g[0])):0,B=g?Math.min(fs,Math.round(g[1])):0;r.emplaceBack(e,t,Math.round(32*a),Math.round(32*u),d,m,(O<<1)+(b?1:0),B,16*w,16*P,256*C,256*R)}function Cf(r,e,t,a,u,d,m){r.emplaceBack(e,t,a,u,d,m)}function zf(r,e,t,a,u){r.emplaceBack(e,t,a,u),r.emplaceBack(e,t,a,u),r.emplaceBack(e,t,a,u),r.emplaceBack(e,t,a,u)}function V2(r){for(const e of r.sections)if(c(e.text))return!0;return!1}class gm{constructor(e){this.layoutVertexArray=new Tr,this.indexArray=new Ut,this.programConfigurations=e,this.segments=new Kr,this.dynamicLayoutVertexArray=new qt,this.opacityVertexArray=new cr,this.placedSymbolArray=new xg,this.globeExtVertexArray=new Ur}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,t,a,u){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Gw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Zw.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,U2,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,qw.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}pt(gm,"SymbolBuffers");class ym{constructor(e,t,a){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new a,this.segments=new Kr,this.collisionVertexArray=new Er,this.collisionVertexArrayExt=new Ir}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Hw.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Ww.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}pt(ym,"CollisionBuffers");class ps{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=eo([]),this.placementViewportMatrix=eo([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=rm(this.zoom,t["text-size"]),this.iconSizeData=rm(this.zoom,t["icon-size"]);const a=this.layers[0].layout,u=a.get("symbol-sort-key"),d=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(m=>pn[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new gm(new ca(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new gm(new ca(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Tg,this.lineVertexArray=new Eg,this.symbolInstances=new wg}calculateGlyphDependencies(e,t,a,u,d){for(let m=0;m<e.length;m++)if(t[e.charCodeAt(m)]=!0,u&&d){const g=pu[e.charAt(m)];g&&(t[g.charCodeAt(0)]=!0)}}populate(e,t,a,u){const d=this.layers[0],m=d.layout,g=this.projection.name==="globe",b=m.get("text-font"),w=m.get("text-field"),P=m.get("icon-image"),C=(w.value.kind!=="constant"||w.value.value instanceof ki&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),R=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,O=m.get("symbol-sort-key");if(this.features=[],!C&&!R)return;const B=t.iconDependencies,$=t.glyphDependencies,q=t.availableImages,te=new Q(this.zoom);for(const{feature:le,id:ne,index:se,sourceLayerIndex:me}of e){const ce=d._featureFilter.needGeometry,Me=ua(le,ce);if(!d._featureFilter.filter(te,Me,a))continue;if(ce||(Me.geometry=Po(le,a,u)),g&&le.type!==1&&a.z<=5){const ze=Me.geometry,je=.98078528056;for(let qe=0;qe<ze.length;qe++)ze[qe]=qb(ze[qe],Ne=>Ne,(Ne,et)=>bn(vu(Ne.x,Ne.y,a,1),vu(et.x,et.y,a,1))<je)}let Pe,Oe;if(C){const ze=d.getValueAndResolveTokens("text-field",Me,a,q),je=ki.factory(ze);V2(je)&&(this.hasRTLText=!0),(!this.hasRTLText||G()==="unavailable"||this.hasRTLText&&X.isParsed())&&(Pe=Yw(je,d,Me))}if(R){const ze=d.getValueAndResolveTokens("icon-image",Me,a,q);Oe=ze instanceof Di?ze:Di.fromString(ze)}if(!Pe&&!Oe)continue;const rt=this.sortFeaturesByKey?O.evaluate(Me,{},a):void 0;if(this.features.push({id:ne,text:Pe,icon:Oe,index:se,sourceLayerIndex:me,geometry:Me.geometry,properties:le.properties,type:N2[le.type],sortKey:rt}),Oe&&(B[Oe.name]=!0),Pe){const ze=b.evaluate(Me,{},a).join(","),je=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(pn.vertical)>=0;for(const qe of Pe.sections)if(qe.image)B[qe.image.name]=!0;else{const Ne=fl(Pe.toString()),et=qe.fontStack||ze,Ze=$[et]=$[et]||{};this.calculateGlyphDependencies(qe.text,Ze,je,this.allowVerticalPlacement,Ne)}}}m.get("symbol-placement")==="line"&&(this.features=function(le){const ne={},se={},me=[];let ce=0;function Me(ze){me.push(le[ze]),ce++}function Pe(ze,je,qe){const Ne=se[ze];return delete se[ze],se[je]=Ne,me[Ne].geometry[0].pop(),me[Ne].geometry[0]=me[Ne].geometry[0].concat(qe[0]),Ne}function Oe(ze,je,qe){const Ne=ne[je];return delete ne[je],ne[ze]=Ne,me[Ne].geometry[0].shift(),me[Ne].geometry[0]=qe[0].concat(me[Ne].geometry[0]),Ne}function rt(ze,je,qe){const Ne=qe?je[0][je[0].length-1]:je[0][0];return`${ze}:${Ne.x}:${Ne.y}`}for(let ze=0;ze<le.length;ze++){const je=le[ze],qe=je.geometry,Ne=je.text?je.text.toString():null;if(!Ne){Me(ze);continue}const et=rt(Ne,qe),Ze=rt(Ne,qe,!0);if(et in se&&Ze in ne&&se[et]!==ne[Ze]){const at=Oe(et,Ze,qe),kt=Pe(et,Ze,me[at].geometry);delete ne[et],delete se[Ze],se[rt(Ne,me[kt].geometry,!0)]=kt,me[at].geometry=null}else et in se?Pe(et,Ze,qe):Ze in ne?Oe(et,Ze,qe):(Me(ze),ne[et]=ce-1,se[Ze]=ce-1)}return me.filter(ze=>ze.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((le,ne)=>le.sortKey-ne.sortKey)}update(e,t,a,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,a,u),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,a,u))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=xv(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const a=this.lineVertexArray.length,u=e.segment;if(u!==void 0){let d=e.dist(t[u+1]),m=e.dist(t[u]);const g={};for(let b=u+1;b<t.length;b++)g[b]={x:t[b].x,y:t[b].y,tileUnitDistanceFromAnchor:d},b<t.length-1&&(d+=t[b+1].dist(t[b]));for(let b=u||0;b>=0;b--)g[b]={x:t[b].x,y:t[b].y,tileUnitDistanceFromAnchor:m},b>0&&(m+=t[b-1].dist(t[b]));for(let b=0;b<t.length;b++){const w=g[b];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,t,a,u,d,m,g,b,w,P,C,R,O,B){const $=e.indexArray,q=e.layoutVertexArray,te=e.globeExtVertexArray,le=e.segments.prepareSegment(4*t.length,q,$,this.canOverlap?m.sortKey:void 0),ne=this.glyphOffsetArray.length,se=le.vertexLength,me=this.allowVerticalPlacement&&g===pn.vertical?Math.PI/2:0,ce=m.text&&m.text.sections;for(let Pe=0;Pe<t.length;Pe++){const{tl:Oe,tr:rt,bl:ze,br:je,tex:qe,pixelOffsetTL:Ne,pixelOffsetBR:et,minFontScaleX:Ze,minFontScaleY:at,glyphOffset:kt,isSDF:Lt,sectionIndex:xt}=t[Pe],nt=le.vertexLength,Zt=kt[1];if(Mf(q,w.x,w.y,Oe.x,Zt+Oe.y,qe.x,qe.y,a,Lt,Ne.x,Ne.y,Ze,at),Mf(q,w.x,w.y,rt.x,Zt+rt.y,qe.x+qe.w,qe.y,a,Lt,et.x,Ne.y,Ze,at),Mf(q,w.x,w.y,ze.x,Zt+ze.y,qe.x,qe.y+qe.h,a,Lt,Ne.x,et.y,Ze,at),Mf(q,w.x,w.y,je.x,Zt+je.y,qe.x+qe.w,qe.y+qe.h,a,Lt,et.x,et.y,Ze,at),b){const Ct=b.anchor,ft=b.up;Cf(te,Ct.x,Ct.y,Ct.z,ft[0],ft[1],ft[2]),Cf(te,Ct.x,Ct.y,Ct.z,ft[0],ft[1],ft[2]),Cf(te,Ct.x,Ct.y,Ct.z,ft[0],ft[1],ft[2]),Cf(te,Ct.x,Ct.y,Ct.z,ft[0],ft[1],ft[2]),zf(e.dynamicLayoutVertexArray,Ct.x,Ct.y,Ct.z,me)}else zf(e.dynamicLayoutVertexArray,w.x,w.y,w.z,me);$.emplaceBack(nt,nt+1,nt+2),$.emplaceBack(nt+1,nt+2,nt+3),le.vertexLength+=4,le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(kt[0]),Pe!==t.length-1&&xt===t[Pe+1].sectionIndex||e.programConfigurations.populatePaintArrays(q.length,m,m.index,{},O,B,ce&&ce[xt])}const Me=b?b.anchor:w;e.placedSymbolArray.emplaceBack(Me.x,Me.y,Me.z,w.x,w.y,ne,this.glyphOffsetArray.length-ne,se,P,C,w.segment,a?a[0]:0,a?a[1]:0,u[0],u[1],g,0,!1,0,R,0)}_commitLayoutVertex(e,t,a,u,d,m,g){e.emplaceBack(t,a,u,d,m,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,t,a,u,d,m,g){const b=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),w=b.vertexLength,P=g.tileAnchorX,C=g.tileAnchorY;for(let O=0;O<4;O++)a.collisionVertexArray.emplaceBack(0,0,0,0);a.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),a.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(a.layoutVertexArray,u,d,m,P,C,new L(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,d,m,P,C,new L(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,d,m,P,C,new L(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,u,d,m,P,C,new L(e.x1,e.y2)),b.vertexLength+=4;const R=a.indexArray;R.emplaceBack(w,w+1),R.emplaceBack(w+1,w+2),R.emplaceBack(w+2,w+3),R.emplaceBack(w+3,w),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,a,u,d,m){for(let g=u;g<d;g++){const b=a.get(g),w=this.getSymbolInstanceTextSize(e,m,t,g);this._addCollisionDebugVertices(b,w,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,t,a,u,d,m){for(let g=u;g<d;g++){const b=a.get(g),w=this.getSymbolInstanceIconSize(e,t,g);this._addCollisionDebugVertices(b,w,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ym(dn,ky.members,Ti),this.iconCollisionBox=new ym(dn,ky.members,Ti);const a=bl(this.iconSizeData,e),u=bl(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const m=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(u,e,t,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(u,e,t,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(a,e,t,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(a,e,t,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(e,t,a,u){const d=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:u),m=gf(this.textSizeData,e,d)/vi;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,t,a){const u=this.icon.placedSymbolArray.get(a),d=gf(this.iconSizeData,e,u);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,t,a){e.emplaceBack(t,-a,-a),e.emplaceBack(t,a,-a),e.emplaceBack(t,a,a),e.emplaceBack(t,-a,a)}_updateTextDebugCollisionBoxes(e,t,a,u,d,m){for(let g=u;g<d;g++){const b=a.get(g),w=this.getSymbolInstanceTextSize(e,m,t,g);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,b.padding)}}_updateIconDebugCollisionBoxes(e,t,a,u,d){for(let m=u;m<d;m++){const g=a.get(m),b=this.getSymbolInstanceIconSize(e,t,m);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,g.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=bl(this.iconSizeData,e),u=bl(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const m=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(u,e,t,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(u,e,t,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(a,e,t,m.iconBoxStartIndex,m.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(a,e,t,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,a,u,d,m,g,b,w){const P={};for(let C=t;C<a;C++){const R=e.get(C);P.textBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,padding:R.padding,projectedAnchorX:R.projectedAnchorX,projectedAnchorY:R.projectedAnchorY,projectedAnchorZ:R.projectedAnchorZ,tileAnchorX:R.tileAnchorX,tileAnchorY:R.tileAnchorY},P.textFeatureIndex=R.featureIndex;break}for(let C=u;C<d;C++){const R=e.get(C);P.verticalTextBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,padding:R.padding,projectedAnchorX:R.projectedAnchorX,projectedAnchorY:R.projectedAnchorY,projectedAnchorZ:R.projectedAnchorZ,tileAnchorX:R.tileAnchorX,tileAnchorY:R.tileAnchorY},P.verticalTextFeatureIndex=R.featureIndex;break}for(let C=m;C<g;C++){const R=e.get(C);P.iconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,padding:R.padding,projectedAnchorX:R.projectedAnchorX,projectedAnchorY:R.projectedAnchorY,projectedAnchorZ:R.projectedAnchorZ,tileAnchorX:R.tileAnchorX,tileAnchorY:R.tileAnchorY},P.iconFeatureIndex=R.featureIndex;break}for(let C=b;C<w;C++){const R=e.get(C);P.verticalIconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,padding:R.padding,projectedAnchorX:R.projectedAnchorX,projectedAnchorY:R.projectedAnchorY,projectedAnchorZ:R.projectedAnchorZ,tileAnchorX:R.tileAnchorX,tileAnchorY:R.tileAnchorY},P.verticalIconFeatureIndex=R.featureIndex;break}return P}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const a=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const a=e.placedSymbolArray.get(t),u=a.vertexStartIndex+4*a.numGlyphs;for(let d=a.vertexStartIndex;d<u;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const t=Math.sin(e),a=Math.cos(e),u=[],d=[],m=[];for(let g=0;g<this.symbolInstances.length;++g){m.push(g);const b=this.symbolInstances.get(g);u.push(0|Math.round(t*b.tileAnchorX+a*b.tileAnchorY)),d.push(b.featureIndex)}return m.sort((g,b)=>u[g]-u[b]||d[b]-d[g]),m}addToSortKeyRanges(e,t){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===t?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const a=this.symbolInstances.get(t);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((u,d,m)=>{u>=0&&m.indexOf(u)===d&&this.addIndicesForPlacedSymbol(this.text,u)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}pt(ps,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ps.MAX_GLYPHS=65535,ps.addDynamicAttributes=zf;const $2=new Le({"symbol-placement":new ue(ke.layout_symbol["symbol-placement"]),"symbol-spacing":new ue(ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ue(ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ye(ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ue(ke.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ue(ke.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ue(ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new ue(ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ue(ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new ye(ke.layout_symbol["icon-size"]),"icon-text-fit":new ue(ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ue(ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new ye(ke.layout_symbol["icon-image"]),"icon-rotate":new ye(ke.layout_symbol["icon-rotate"]),"icon-padding":new ue(ke.layout_symbol["icon-padding"]),"icon-keep-upright":new ue(ke.layout_symbol["icon-keep-upright"]),"icon-offset":new ye(ke.layout_symbol["icon-offset"]),"icon-anchor":new ye(ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ue(ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ue(ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ue(ke.layout_symbol["text-rotation-alignment"]),"text-field":new ye(ke.layout_symbol["text-field"]),"text-font":new ye(ke.layout_symbol["text-font"]),"text-size":new ye(ke.layout_symbol["text-size"]),"text-max-width":new ye(ke.layout_symbol["text-max-width"]),"text-line-height":new ye(ke.layout_symbol["text-line-height"]),"text-letter-spacing":new ye(ke.layout_symbol["text-letter-spacing"]),"text-justify":new ye(ke.layout_symbol["text-justify"]),"text-radial-offset":new ye(ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ue(ke.layout_symbol["text-variable-anchor"]),"text-anchor":new ye(ke.layout_symbol["text-anchor"]),"text-max-angle":new ue(ke.layout_symbol["text-max-angle"]),"text-writing-mode":new ue(ke.layout_symbol["text-writing-mode"]),"text-rotate":new ye(ke.layout_symbol["text-rotate"]),"text-padding":new ue(ke.layout_symbol["text-padding"]),"text-keep-upright":new ue(ke.layout_symbol["text-keep-upright"]),"text-transform":new ye(ke.layout_symbol["text-transform"]),"text-offset":new ye(ke.layout_symbol["text-offset"]),"text-allow-overlap":new ue(ke.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ue(ke.layout_symbol["text-ignore-placement"]),"text-optional":new ue(ke.layout_symbol["text-optional"])});var vm={paint:new Le({"icon-opacity":new ye(ke.paint_symbol["icon-opacity"]),"icon-color":new ye(ke.paint_symbol["icon-color"]),"icon-halo-color":new ye(ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new ye(ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ye(ke.paint_symbol["icon-halo-blur"]),"icon-translate":new ue(ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new ue(ke.paint_symbol["icon-translate-anchor"]),"text-opacity":new ye(ke.paint_symbol["text-opacity"]),"text-color":new ye(ke.paint_symbol["text-color"],{runtimeType:cn,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new ye(ke.paint_symbol["text-halo-color"]),"text-halo-width":new ye(ke.paint_symbol["text-halo-width"]),"text-halo-blur":new ye(ke.paint_symbol["text-halo-blur"]),"text-translate":new ue(ke.paint_symbol["text-translate"]),"text-translate-anchor":new ue(ke.paint_symbol["text-translate-anchor"])}),layout:$2};class bv{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:qo,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}pt(bv,"FormatSectionOverride",{omit:["defaultValue"]});class Rf extends zn{constructor(e){super(e,vm)}recalculate(e,t){super.recalculate(e,t),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const u=[];for(const d of a)u.indexOf(d)<0&&u.push(d);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,a,u){const d=this.layout.get(e).evaluate(t,{},a,u),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||rl(m.value)||!d?d:function(g,b){return b.replace(/{([^{}]+)}/g,(w,P)=>P in g?String(g[P]):"")}(t.properties,d)}createBucket(e){return new ps(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of vm.paint.overridableProperties){if(!Rf.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),a=new bv(t),u=new Oc(a,t.property.specification);let d=null;d=t.value.kind==="constant"||t.value.kind==="source"?new Lc("source",u):new Qs("composite",u,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new ae(t.property,d,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,a){return!(!this.layout||t.isDataDriven()||a.isDataDriven())&&Rf.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const a=e.get("text-field"),u=vm.paint.properties[t];let d=!1;const m=g=>{for(const b of g)if(u.overrides&&u.overrides.hasOverride(b))return void(d=!0)};if(a.value.kind==="constant"&&a.value.value instanceof ki)m(a.value.value.sections);else if(a.value.kind==="source"){const g=w=>{d||(w instanceof Bs&&Zr(w.value)===Ds?m(w.value.sections):w instanceof Ns?m(w.sections):w.eachChild(g))},b=a.value;b._styleExpression&&g(b._styleExpression.expression)}return d}getProgramConfiguration(e){return new cs(this,e)}}var G2={paint:new Le({"background-color":new ue(ke.paint_background["background-color"]),"background-pattern":new Je(ke.paint_background["background-pattern"]),"background-opacity":new ue(ke.paint_background["background-opacity"])})},q2={paint:new Le({"raster-opacity":new ue(ke.paint_raster["raster-opacity"]),"raster-hue-rotate":new ue(ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ue(ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ue(ke.paint_raster["raster-brightness-max"]),"raster-saturation":new ue(ke.paint_raster["raster-saturation"]),"raster-contrast":new ue(ke.paint_raster["raster-contrast"]),"raster-resampling":new ue(ke.paint_raster["raster-resampling"]),"raster-fade-duration":new ue(ke.paint_raster["raster-fade-duration"])})};class Z2 extends zn{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var H2={paint:new Le({"sky-type":new ue(ke.paint_sky["sky-type"]),"sky-atmosphere-sun":new ue(ke.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ue(ke.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ue(ke.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ue(ke.paint_sky["sky-gradient-radius"]),"sky-gradient":new be(ke.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ue(ke.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ue(ke.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ue(ke.paint_sky["sky-opacity"])})};function xm(r,e,t){const a=[0,0,1],u=ry([]);return ny(u,u,t?-W(r)+Math.PI:W(r)),iy(u,u,-W(e)),Jg(a,a,u),Oi(a,a)}const W2={circle:class extends zn{constructor(r){super(r,Kb)}createBucket(r){return new Op(r)}queryRadius(r){const e=r;return _l("circle-radius",this,e)+_l("circle-stroke-width",this,e)+rf(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,t,a,u,d,m,g){const b=Hg(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,r.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,t)+this.paint.get("circle-stroke-width").evaluate(e,t);return oy(r,a,d,m,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,w)}getProgramIds(){return["circle"]}getProgramConfiguration(r){return new cs(this,r)}},heatmap:class extends zn{createBucket(r){return new ay(r)}constructor(r){super(r,ow),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Xp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(r){return _l("heatmap-radius",this,r)}queryIntersectsFeature(r,e,t,a,u,d,m,g){const b=this.paint.get("heatmap-radius").evaluate(e,t);return oy(r,a,d,m,g,!0,!0,new L(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(r){return new cs(this,r)}},hillshade:class extends zn{constructor(r){super(r,sw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends zn{constructor(r){super(r,Tw)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),t=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&t.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),t}getProgramConfiguration(r){return new cs(this,r)}recalculate(r,e){super.recalculate(r,e);const t=this.paint._values["fill-outline-color"];t.value.kind==="constant"&&t.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new ff(r)}queryRadius(){return rf(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,t,a,u,d){return!r.queryGeometry.isAboveHorizon&&Vg(Zg(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,r.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends zn{constructor(r){super(r,Lw)}createBucket(r){return new hu(r)}queryRadius(){return rf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(r){return new cs(this,r)}queryIntersectsFeature(r,e,t,a,u,d,m,g,b){const w=Hg(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,r.pixelToTileUnitsFactor),P=this.paint.get("fill-extrusion-height").evaluate(e,t),C=this.paint.get("fill-extrusion-base").evaluate(e,t),R=[0,0],O=g&&d.elevation,B=d.elevation?d.elevation.exaggeration():1,$=r.tile.getBucket(this);if(O&&$ instanceof hu){const le=$.centroidVertexArray,ne=b+1;if(ne<le.length){const se=le.get(ne);R[0]=se.a_centroid_pos0,R[1]=se.a_centroid_pos1}}if(R[0]===0&&R[1]===1)return!1;d.projection.name==="globe"&&(a=Sy([a],[new L(0,0),new L(It,It)],r.tileID.canonical).map(le=>le.polygon).flat());const q=function(le,ne,se,me,ce,Me,Pe,Oe,rt,ze,je){return le.projection.name==="globe"?function(qe,Ne,et,Ze,at,kt,Lt,xt,nt,Zt,Ct){const ft=[],yr=[],dr=qe.projection.upVectorScale(Ct,qe.center.lat,qe.worldSize).metersToTile,Mr=[0,0,0,1],jt=[0,0,0,1],Yt=(pr,ur,Sr,Lr)=>{pr[0]=ur,pr[1]=Sr,pr[2]=Lr,pr[3]=1},vr=Ey();et>0&&(et+=vr),Ze+=vr;for(const pr of Ne){const ur=[],Sr=[];for(const Lr of pr){const hi=Lr.x+at.x,qi=Lr.y+at.y,Wt=qe.projection.projectTilePoint(hi,qi,Ct),Gr=qe.projection.upVector(Ct,Lr.x,Lr.y);let Si=et,rr=Ze;if(Lt){const Fr=My(hi,qi,et,Ze,Lt,xt,nt,Zt);Si+=Fr.base,rr+=Fr.top}et!==0?Yt(Mr,Wt.x+Gr[0]*dr*Si,Wt.y+Gr[1]*dr*Si,Wt.z+Gr[2]*dr*Si):Yt(Mr,Wt.x,Wt.y,Wt.z),Yt(jt,Wt.x+Gr[0]*dr*rr,Wt.y+Gr[1]*dr*rr,Wt.z+Gr[2]*dr*rr),ni(Mr,Mr,kt),ni(jt,jt,kt),ur.push(mf(Mr)),Sr.push(mf(jt))}ft.push(ur),yr.push(Sr)}return[ft,yr]}(le,ne,se,me,ce,Me,Pe,Oe,rt,ze,je):Pe?function(qe,Ne,et,Ze,at,kt,Lt,xt,nt){const Zt=[],Ct=[],ft=[0,0,0,1];for(const yr of qe){const dr=[],Mr=[];for(const jt of yr){const Yt=jt.x+Ze.x,vr=jt.y+Ze.y,pr=My(Yt,vr,Ne,et,kt,Lt,xt,nt);ft[0]=Yt,ft[1]=vr,ft[2]=pr.base,ft[3]=1,da(ft,ft,at),ft[3]=Math.max(ft[3],1e-5);const ur=mf([ft[0]/ft[3],ft[1]/ft[3],ft[2]/ft[3]]);ft[0]=Yt,ft[1]=vr,ft[2]=pr.top,ft[3]=1,da(ft,ft,at),ft[3]=Math.max(ft[3],1e-5);const Sr=mf([ft[0]/ft[3],ft[1]/ft[3],ft[2]/ft[3]]);dr.push(ur),Mr.push(Sr)}Zt.push(dr),Ct.push(Mr)}return[Zt,Ct]}(ne,se,me,ce,Me,Pe,Oe,rt,ze):function(qe,Ne,et,Ze,at){const kt=[],Lt=[],xt=at[8]*Ne,nt=at[9]*Ne,Zt=at[10]*Ne,Ct=at[11]*Ne,ft=at[8]*et,yr=at[9]*et,dr=at[10]*et,Mr=at[11]*et;for(const jt of qe){const Yt=[],vr=[];for(const pr of jt){const ur=pr.x+Ze.x,Sr=pr.y+Ze.y,Lr=at[0]*ur+at[4]*Sr+at[12],hi=at[1]*ur+at[5]*Sr+at[13],qi=at[2]*ur+at[6]*Sr+at[14],Wt=at[3]*ur+at[7]*Sr+at[15],Gr=Lr+xt,Si=hi+nt,rr=qi+Zt,Fr=Math.max(Wt+Ct,1e-5),Fi=Lr+ft,Cr=hi+yr,Hr=qi+dr,fi=Math.max(Wt+Mr,1e-5),li=new L(Gr/Fr,Si/Fr);li.z=rr/Fr,Yt.push(li);const xi=new L(Fi/fi,Cr/fi);xi.z=Hr/fi,vr.push(xi)}kt.push(Yt),Lt.push(vr)}return[kt,Lt]}(ne,se,me,ce,Me)}(d,a,C,P,w,m,O?g:null,R,B,d.center.lat,r.tileID.canonical),te=r.queryGeometry;return function(le,ne,se){let me=1/0;Vg(se,ne)&&(me=Iy(se,ne[0]));for(let ce=0;ce<ne.length;ce++){const Me=ne[ce],Pe=le[ce];for(let Oe=0;Oe<Me.length-1;Oe++){const rt=Me[Oe],ze=[rt,Me[Oe+1],Pe[Oe+1],Pe[Oe],rt];Ug(se,ze)&&(me=Math.min(me,Iy(se,ze)))}}return me!==1/0&&me}(q[0],q[1],te.isPointQuery()?te.screenBounds:te.screenGeometry)}},line:class extends zn{constructor(r){super(r,Cy),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof mc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=zy.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new _f(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(r){return new cs(this,r)}queryRadius(r){const e=r,t=Ry(_l("line-width",this,e),_l("line-gap-width",this,e)),a=_l("line-offset",this,e);return t/2+Math.abs(a)+rf(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,t,a,u,d){if(r.queryGeometry.isAboveHorizon)return!1;const m=Zg(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,r.pixelToTileUnitsFactor),g=r.pixelToTileUnitsFactor/2*Ry(this.paint.get("line-width").evaluate(e,t),this.paint.get("line-gap-width").evaluate(e,t)),b=this.paint.get("line-offset").evaluate(e,t);return b&&(a=function(w,P){const C=[],R=new L(0,0);for(let O=0;O<w.length;O++){const B=w[O],$=[];for(let q=0;q<B.length;q++){const te=B[q-1],le=B[q],ne=B[q+1],se=q===0?R:le.sub(te)._unit()._perp(),me=q===B.length-1?R:ne.sub(le)._unit()._perp(),ce=se._add(me)._unit();ce._mult(1/(ce.x*me.x+ce.y*me.y)),$.push(ce._mult(P)._add(le))}C.push($)}return C}(a,b*r.pixelToTileUnitsFactor)),function(w,P,C){for(let R=0;R<P.length;R++){const O=P[R];if(w.length>=3){for(let B=0;B<O.length;B++)if(ha(w,O[B]))return!0}if(Wb(w,O,C))return!0}return!1}(m,a,g)}isTileClipped(){return!0}},symbol:Rf,background:class extends zn{constructor(r){super(r,G2)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends zn{constructor(r){super(r,q2)}getProgramIds(){return["raster"]}},sky:class extends zn{constructor(r){super(r,H2),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Xp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(r,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),u=!a,d=r.style.light,m=d.properties.get("position");return u&&d.properties.get("anchor")==="viewport"&&hr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?xm(m.azimuthal,90-m.polar,e):xm(a[0],90-a[1],e)}const t=this.paint.get("sky-gradient-center");return xm(t[0],90-t[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}}};class Au{constructor(e,t,a,u){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(t,u)}update(e,t,a){const{width:u,height:d}=e,{context:m}=this,{gl:g}=m,{HTMLImageElement:b,HTMLCanvasElement:w,HTMLVideoElement:P,ImageData:C,ImageBitmap:R}=A;if(g.bindTexture(g.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA&&(!t||t.premultiply!==!1)),a||this.size&&this.size[0]===u&&this.size[1]===d){const{x:O,y:B}=a||{x:0,y:0};e instanceof b||e instanceof w||e instanceof P||e instanceof C||R&&e instanceof R?g.texSubImage2D(g.TEXTURE_2D,0,O,B,g.RGBA,g.UNSIGNED_BYTE,e):g.texSubImage2D(g.TEXTURE_2D,0,O,B,u,d,g.RGBA,g.UNSIGNED_BYTE,e.data)}else this.size=[u,d],e instanceof b||e instanceof w||e instanceof P||e instanceof C||R&&e instanceof R?g.texImage2D(g.TEXTURE_2D,0,this.format,this.format,g.UNSIGNED_BYTE,e):g.texImage2D(g.TEXTURE_2D,0,this.format,u,d,0,this.format,g.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(t&&t.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(e,t){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.filter=e),t!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,t),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class bm{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new Io({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const a=this.getKey(e,t);return this.positions[a]}trim(){const e=this.width,t=this.height=zr(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,a){const u=[];let d=e.length%2==1?-e[e.length-1]*a:0,m=e[0]*a,g=!0;u.push({left:d,right:m,isDash:g,zeroLength:e[0]===0});let b=e[0];for(let w=1;w<e.length;w++){g=!g;const P=e[w];d=b*a,b+=P,m=b*a,u.push({left:d,right:m,isDash:g,zeroLength:P===0})}return u}addRoundDash(e,t,a){const u=t/2;for(let d=-a;d<=a;d++){const m=this.width*(this.nextRow+a+d);let g=0,b=e[g];for(let w=0;w<this.width;w++){w/b.right>1&&(b=e[++g]);const P=Math.abs(w-b.left),C=Math.abs(w-b.right),R=Math.min(P,C);let O;const B=d/a*(u+1);if(b.isDash){const $=u-Math.abs(B);O=Math.sqrt(R*R+$*$)}else O=u-Math.sqrt(R*R+B*B);this.image.data[m+w]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(e,t){for(let b=e.length-1;b>=0;--b){const w=e[b],P=e[b+1];w.zeroLength?e.splice(b,1):P&&P.isDash===w.isDash&&(P.left=w.left,e.splice(b,1))}const a=e[0],u=e[e.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);const d=this.width*this.nextRow;let m=0,g=e[m];for(let b=0;b<this.width;b++){b/g.right>1&&(g=e[++m]);const w=Math.abs(b-g.left),P=Math.abs(b-g.right),C=Math.min(w,P);this.image.data[d+b]=Math.max(0,Math.min(255,(g.isDash?C:-C)+t+128))}}addDash(e,t){const a=this.getKey(e,t);if(this.positions[a])return this.positions[a];const u=t==="round",d=u?7:0,m=2*d+1;if(this.nextRow+m>this.height)return hr("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let P=0;P<e.length;P++)e[P]<0&&(hr("Negative value is found in line dasharray, replacing values with 0"),e[P]=0),g+=e[P];if(g!==0){const P=this.width/g,C=this.getDashRanges(e,this.width,P);u?this.addRoundDash(C,P,d):this.addRegularDash(C,t==="square"?.5*P:0)}const b=this.nextRow+d;this.nextRow+=m;const w={tl:[b,d],br:[g,0]};return this.positions[a]=w,w}}pt(bm,"LineAtlas");class X2{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Q2{constructor(){this.tasks={},this.taskQueue=[],Rr(["process"],this),this.invoker=new X2(this.process),this.nextId=0}add(e,t){const a=this.nextId++,u=function({type:d,isSymbolTile:m,zoom:g}){return g=g||0,d==="message"?0:d!=="maybePrepare"||m?d!=="parseTile"||m?d==="parseTile"&&m?300-g:d==="maybePrepare"&&m?400-g:500:200-g:100-g}(t);if(u===0){oi();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[a]={fn:e,metadata:t,priority:u,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){oi();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let u=0;u<this.taskQueue.length;u++){const d=this.tasks[this.taskQueue[u]];d.priority<t&&(t=d.priority,e=u)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class wv{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const a=e[t];this._stringToNumber[a]=t,this._numberToString[t]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Y2=["tile","layer","source","sourceLayer","state"];class Tv{constructor(e,t,a,u,d){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=a,this._y=u,this.properties=e.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const t of Y2)this[t]!==void 0&&(e[t]=this[t]);return e}}const wn=32,io=33,ms=new Uint16Array(8184);for(let r=0;r<2046;r++){let e=r+2,t=0,a=0,u=0,d=0,m=0,g=0;for(1&e?u=d=m=wn:t=a=g=wn;(e>>=1)>1;){const w=t+u>>1,P=a+d>>1;1&e?(u=t,d=a,t=m,a=g):(t=u,a=d,u=m,d=g),m=w,g=P}const b=4*r;ms[b+0]=t,ms[b+1]=a,ms[b+2]=u,ms[b+3]=d}const no=new Uint16Array(2178),_s=new Uint8Array(1089),kf=new Uint16Array(1089);function Ev(r){return r===0?-.03125:r===32?.03125:0}var Sv=Be([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Av={type:2,extent:It,loadGeometry:()=>[[new L(0,0),new L(8193,0),new L(8193,8193),new L(0,8193),new L(0,0)]]};class wm{constructor(e,t,a,u,d){this.tileID=e,this.uid=Dt(),this.uses=0,this.tileSize=t,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=d,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const t=e+this.timeAdded;t<Ar.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=_a(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,d){const m={};if(!d)return m;for(const g of u){const b=g.layerIds.map(w=>d.getLayer(w)).filter(Boolean);if(b.length!==0){g.layers=b,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(w=>b.filter(P=>P.id===w)[0]));for(const w of b)m[w.id]=g}}return m}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const d=this.buckets[u];if(d instanceof ps){if(this.hasSymbolBuckets=!0,!a)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const d=this.buckets[u];if(d instanceof ps&&d.hasRTLText){this.hasRTLText=!0,X.isLoading()||X.isLoaded()||G()!=="deferred"||K();break}}this.queryPadding=0;for(const u in this.buckets){const d=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(u).queryRadius(d))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Yn}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const u=this.buckets[a];u.uploadPending()&&u.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Au(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Au(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Au(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,a,u,d,m,g,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:g,transform:m,params:d,tileTransform:this.tileTransform},e,t,a):{}}querySourceFeatures(e,t){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const u=a.loadVTLayers(),d=t?t.sourceLayer:"",m=u._geojsonTileLayer||u[d];if(!m)return;const g=ea(t&&t.filter),{z:b,x:w,y:P}=this.tileID.canonical,C={z:b,x:w,y:P};for(let R=0;R<m.length;R++){const O=m.feature(R);if(g.needGeometry){const q=ua(O,!0);if(!g.filter(new Q(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!g.filter(new Q(this.tileID.overscaledZ),O))continue;const B=a.getId(O,d),$=new Tv(O,b,w,P,B);$.tile=C,e.push($)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const a=Ci(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let u=!1;if(this.expirationTime>a)u=!1;else if(t)if(this.expirationTime<t)u=!0;else{const d=this.expirationTime-t;d?this.expirationTime=a+Math.max(d,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!t)return;const a=this.latestFeatureIndex.loadVTLayers(),u=t.style.listImages();for(const d in this.buckets){if(!t.style.hasLayer(d))continue;const m=this.buckets[d],g=m.layers[0].sourceLayer||"_geojsonTileLayer",b=a[g],w=e[g];if(!b||!w||Object.keys(w).length===0)continue;if(m.update(w,b,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),m instanceof _f||m instanceof ff){const C=t.style._getSourceCache(m.layers[0].source);t._terrain&&t._terrain.enabled&&C&&m.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(C.id,this.tileID)}const P=t&&t.style&&t.style.getLayer(d);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ar.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Ar.now()+e}setTexture(e,t){const a=t.context,u=a.gl;this.texture=t.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Au(a,e,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),a.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax))}setDependencies(e,t){const a={};for(const u of t)a[u]=!0;this.dependencies[e]=a}hasDependency(e,t){for(const a of e){const u=this.dependencies[a];if(u){for(const d of t)if(u[d])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(!t||t.name==="mercator"||this._tileDebugBuffer)return;const a=Po(Av,this.tileID.canonical,this.tileTransform)[0],u=new ot,d=new xo;for(let m=0;m<a.length;m++){const{x:g,y:b}=a[m];u.emplaceBack(g,b),d.emplaceBack(m)}d.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(d),this._tileDebugBuffer=e.createVertexBuffer(u,yu.members),this._tileDebugSegments=Kr.simpleSegment(0,0,u.length,d.length)}_makeTileBoundsBuffers(e,t){if(this._tileBoundsBuffer||!t||t.name==="mercator")return;const a=Po(Av,this.tileID.canonical,this.tileTransform)[0];let u,d;if(this.isRaster){const m=function(g,b){const w=_a(g,b),P=Math.pow(2,g.z);for(let q=0;q<io;q++)for(let te=0;te<io;te++){const le=xn((g.x+(te+Ev(te))/wn)/P),ne=yi((g.y+(q+Ev(q))/wn)/P),se=b.project(le,ne),me=q*io+te;no[2*me+0]=Math.round((se.x*w.scale-w.x)*It),no[2*me+1]=Math.round((se.y*w.scale-w.y)*It)}_s.fill(0),kf.fill(0);for(let q=2045;q>=0;q--){const te=4*q,le=ms[te+0],ne=ms[te+1],se=ms[te+2],me=ms[te+3],ce=le+se>>1,Me=ne+me>>1,Pe=ce+Me-ne,Oe=Me+le-ce,rt=ne*io+le,ze=me*io+se,je=Me*io+ce,qe=Math.hypot((no[2*rt+0]+no[2*ze+0])/2-no[2*je+0],(no[2*rt+1]+no[2*ze+1])/2-no[2*je+1])>=16;if(_s[je]=_s[je]||(qe?1:0),q<1022){const Ne=(ne+Oe>>1)*io+(le+Pe>>1),et=(me+Oe>>1)*io+(se+Pe>>1);_s[je]=_s[je]||_s[Ne]||_s[et]}}const C=new wt,R=new Ut;let O=0;function B(q,te){const le=te*io+q;return kf[le]===0&&(C.emplaceBack(no[2*le+0],no[2*le+1],q*It/wn,te*It/wn),kf[le]=++O),kf[le]-1}function $(q,te,le,ne,se,me){const ce=q+le>>1,Me=te+ne>>1;if(Math.abs(q-se)+Math.abs(te-me)>1&&_s[Me*io+ce])$(se,me,q,te,ce,Me),$(le,ne,se,me,ce,Me);else{const Pe=B(q,te),Oe=B(le,ne),rt=B(se,me);R.emplaceBack(Pe,Oe,rt)}}return $(0,0,wn,wn,wn,0),$(wn,wn,0,0,0,wn),{vertices:C,indices:R}}(this.tileID.canonical,t);u=m.vertices,d=m.indices}else{u=new wt,d=new Ut;for(const{x:g,y:b}of a)u.emplaceBack(g,b,0,0);const m=af(u.int16,void 0,4);for(let g=0;g<m.length;g+=3)d.emplaceBack(m[g],m[g+1],m[g+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,Sv.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(d),this._tileBoundsSegments=Kr.simpleSegment(0,0,u.length,d.length)}_makeGlobeTileDebugBuffers(e,t){const a=t.projection;if(!a||a.name!=="globe"||t.freezeTileCoverage)return;const u=this.tileID.canonical,d=xu(cv(u,t)),m=bu(t.zoom);let g;m>0&&(g=Bp(new Float64Array(16),t.globeMatrix));const b=(u.x+.5)/(1<<u.z)-Kn(t.center.lng);let w=0;b>.5?w=-1:b<-.5&&(w=1),this._makeGlobeTileDebugBorderBuffer(e,u,t,d,g,m,w),this._makeGlobeTileDebugTextBuffer(e,u,t,d,g,m,w)}_globePoint(e,t,a,u,d,m,g,b){let w=vu(e,t,a);if(m){const P=1<<a.z,C=[((e/It+a.x)/P+b)*u,(t/It+a.y)/P*u,0];ni(C,C,m),w=Xo(w,C,g)}return ni(w,w,d)}_makeGlobeTileDebugBorderBuffer(e,t,a,u,d,m,g){const b=new ot,w=new xo,P=new _t,C=(O,B,$,q,te)=>{const le=($-O)/(te-1),ne=(q-B)/(te-1),se=b.length;for(let me=0;me<te;me++){const ce=O+me*le,Me=B+me*ne;b.emplaceBack(ce,Me);const Pe=this._globePoint(ce,Me,t,a.worldSize,u,d,m,g);P.emplaceBack(Pe[0],Pe[1],Pe[2]),w.emplaceBack(se+me)}},R=It;C(0,0,R,0,16),C(R,0,R,R,16),C(R,R,0,R,16),C(0,R,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(w),this._tileDebugBuffer=e.createVertexBuffer(b,yu.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(P,av.members),this._tileDebugSegments=Kr.simpleSegment(0,0,b.length,w.length)}_makeGlobeTileDebugTextBuffer(e,t,a,u,d,m,g){const b=new ot,w=new Ut,P=new _t,C=25;w.reserve(32),b.reserve(C),P.reserve(C);const R=(O,B)=>C*O+B;for(let O=0;O<C;O++){const B=2048*O;for(let $=0;$<C;$++){const q=2048*$;b.emplaceBack(q,B);const te=this._globePoint(q,B,t,a.worldSize,u,d,m,g);P.emplaceBack(te[0],te[1],te[2])}}for(let O=0;O<4;O++)for(let B=0;B<4;B++){const $=R(O,B),q=R(O,B+1),te=R(O+1,B),le=R(O+1,B+1);w.emplaceBack($,q,te),w.emplaceBack(te,q,le)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(w),this._tileDebugTextBuffer=e.createVertexBuffer(b,yu.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(P,av.members),this._tileDebugTextSegments=Kr.simpleSegment(0,0,C,32)}}class K2{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,a){const u=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},Xe(this.stateChanges[e][u],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const d in this.state[e])d!==u&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const d in this.state[e][u])a[d]||(this.deletedStates[e][u][d]=null)}else for(const d in a)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][d]===null&&delete this.deletedStates[e][u][d]}removeFeatureState(e,t,a){if(this.deletedStates[e]===null)return;const u=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&t!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][a]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(a in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][a]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,t){const a=String(t),u=Xe({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const d=this.deletedStates[e][t];if(d===null)return{};for(const m in d)delete u[m]}return u}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const a={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const d={};for(const m in this.stateChanges[u])this.state[u][m]||(this.state[u][m]={}),Xe(this.state[u][m],this.stateChanges[u][m]),d[m]=this.state[u][m];a[u]=d}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const d={};if(this.deletedStates[u]===null)for(const m in this.state[u])d[m]={},this.state[u][m]={};else for(const m in this.deletedStates[u]){if(this.deletedStates[u][m]===null)this.state[u][m]={};else for(const g of Object.keys(this.deletedStates[u][m]))delete this.state[u][m][g];d[m]=this.state[u][m]}a[u]=a[u]||{},Xe(a[u],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const u in e)e[u].setFeatureState(a,t)}}class Pv{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const a=this.toIdx(e,t);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function Iv(r,e,t,a){let u=0,d=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(a[m])<1e-15){if(t[m]<r[m]||t[m]>e[m])return null}else{const g=1/a[m];let b=(r[m]-t[m])*g,w=(e[m]-t[m])*g;if(b>w){const P=b;b=w,w=P}if(b>u&&(u=b),w<d&&(d=w),u>d)return null}return u}function Mv(r,e,t,a,u,d,m,g,b,w,P){const C=a-r,R=u-e,O=d-t,B=m-r,$=g-e,q=b-t,te=P[1]*q-P[2]*$,le=P[2]*B-P[0]*q,ne=P[0]*$-P[1]*B,se=C*te+R*le+O*ne;if(Math.abs(se)<1e-15)return null;const me=1/se,ce=w[0]-r,Me=w[1]-e,Pe=w[2]-t,Oe=(ce*te+Me*le+Pe*ne)*me;if(Oe<0||Oe>1)return null;const rt=Me*O-Pe*R,ze=Pe*C-ce*O,je=ce*R-Me*C,qe=(P[0]*rt+P[1]*ze+P[2]*je)*me;return qe<0||Oe+qe>1?null:(B*rt+$*ze+q*je)*me}function Cv(r,e,t){return(r-e)/(t-e)}function zv(r,e,t,a,u,d,m,g,b){const w=1<<t,P=d-a,C=m-u,R=(r+1)/w*P+a,O=(e+0)/w*C+u,B=(e+1)/w*C+u;g[0]=(r+0)/w*P+a,g[1]=O,b[0]=R,b[1]=B}class Rv{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(d){const m=Math.ceil(Math.log2(d.dim/8)),g=[];let b=Math.ceil(Math.pow(2,m));const w=1/b,P=(O,B,$,q,te)=>{const le=q?1:0,ne=(O+1)*$-le,se=B*$,me=(B+1)*$-le;te[0]=O*$,te[1]=se,te[2]=ne,te[3]=me};let C=new Pv(b);const R=[];for(let O=0;O<b*b;O++){P(O%b,Math.floor(O/b),w,!1,R);const B=gs(R[0],R[1],d),$=gs(R[2],R[1],d),q=gs(R[2],R[3],d),te=gs(R[0],R[3],d);C.minimums.push(Math.min(B,$,q,te)),C.maximums.push(Math.max(B,$,q,te)),C.leaves.push(1)}for(g.push(C),b/=2;b>=1;b/=2){const O=g[g.length-1];C=new Pv(b);for(let B=0;B<b*b;B++){P(B%b,Math.floor(B/b),2,!0,R);const $=O.getElevation(R[0],R[1]),q=O.getElevation(R[2],R[1]),te=O.getElevation(R[2],R[3]),le=O.getElevation(R[0],R[3]),ne=O.isLeaf(R[0],R[1]),se=O.isLeaf(R[2],R[1]),me=O.isLeaf(R[2],R[3]),ce=O.isLeaf(R[0],R[3]),Me=Math.min($.min,q.min,te.min,le.min),Pe=Math.max($.max,q.max,te.max,le.max),Oe=ne&&se&&me&&ce;C.maximums.push(Pe),C.minimums.push(Me),C.leaves.push(Pe-Me<=5&&Oe?1:0)}g.push(C)}return g}(this.dem),a=t.length-1,u=t[a];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(t,0,0,a,0)}raycastRoot(e,t,a,u,d,m,g=1){return Iv([e,t,-100],[a,u,this.maximums[0]*g],d,m)}raycast(e,t,a,u,d,m,g=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,t,a,u,d,m,g);if(b==null)return null;const w=[],P=[],C=[],R=[],O=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;O.length>0;){const{idx:B,t:$,nodex:q,nodey:te,depth:le}=O.pop();if(this.leaves[B]){zv(q,te,le,e,t,a,u,C,R);const se=1<<le,me=(q+0)/se,ce=(q+1)/se,Me=(te+0)/se,Pe=(te+1)/se,Oe=gs(me,Me,this.dem)*g,rt=gs(ce,Me,this.dem)*g,ze=gs(ce,Pe,this.dem)*g,je=gs(me,Pe,this.dem)*g,qe=Mv(C[0],C[1],Oe,R[0],C[1],rt,R[0],R[1],ze,d,m),Ne=Mv(R[0],R[1],ze,C[0],R[1],je,C[0],C[1],Oe,d,m),et=Math.min(qe!==null?qe:Number.MAX_VALUE,Ne!==null?Ne:Number.MAX_VALUE);if(et!==Number.MAX_VALUE)return et;{const Ze=sf([],d,m,$);if(kv(Oe,rt,je,ze,Cv(Ze[0],C[0],R[0]),Cv(Ze[1],C[1],R[1]))>=Ze[2])return $}continue}let ne=0;for(let se=0;se<this._siblingOffset.length;se++){zv((q<<1)+this._siblingOffset[se][0],(te<<1)+this._siblingOffset[se][1],le+1,e,t,a,u,C,R),C[2]=-100,R[2]=this.maximums[this.childOffsets[B]+se]*g;const me=Iv(C,R,d,m);if(me!=null){const ce=me;w[se]=ce;let Me=!1;for(let Pe=0;Pe<ne&&!Me;Pe++)ce>=w[P[Pe]]&&(P.splice(Pe,0,se),Me=!0);Me||(P[ne]=se),ne++}}for(let se=0;se<ne;se++){const me=P[se];O.push({idx:this.childOffsets[B]+me,t:w[me],nodex:(q<<1)+this._siblingOffset[me][0],nodey:(te<<1)+this._siblingOffset[me][1],depth:le+1})}}return null}_addNode(e,t,a){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,a,u,d){if(e[u].isLeaf(t,a)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const m=u-1,g=e[m];let b=0,w=0;for(let P=0;P<this._siblingOffset.length;P++){const C=2*t+this._siblingOffset[P][0],R=2*a+this._siblingOffset[P][1],O=g.getElevation(C,R),B=g.isLeaf(C,R),$=this._addNode(O.min,O.max,B);B&&(b|=1<<P),w||(w=$)}for(let P=0;P<this._siblingOffset.length;P++)b&1<<P||this._construct(e,2*t+this._siblingOffset[P][0],2*a+this._siblingOffset[P][1],m,w+P)}}function kv(r,e,t,a,u,d){return Xt(Xt(r,t,d),Xt(e,a,d),u)}function gs(r,e,t){const a=t.dim,u=Ie(r*a-.5,0,a-1),d=Ie(e*a-.5,0,a-1),m=Math.floor(u),g=Math.floor(d),b=Math.min(m+1,a-1),w=Math.min(g+1,a-1);return kv(t.get(m,g),t.get(b,g),t.get(m,w),t.get(b,w),u-m,d-g)}const Dv={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Df{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,a,u=!1,d=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return hr(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const m=this.dim=t.height-2,g=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.encoding=a||"mapbox",this.borderReady=u,!u){for(let b=0;b<m;b++)g[this._idx(-1,b)]=g[this._idx(0,b)],g[this._idx(m,b)]=g[this._idx(m-1,b)],g[this._idx(b,-1)]=g[this._idx(b,0)],g[this._idx(b,m)]=g[this._idx(b,m-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(m,-1)]=g[this._idx(m-1,0)],g[this._idx(-1,m)]=g[this._idx(0,m-1)],g[this._idx(m,m)]=g[this._idx(m-1,m-1)],d&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Rv(this)}get(e,t,a=!1){a&&(e=Ie(e,-1,this.dim),t=Ie(t,-1,this.dim));const u=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[u],this.pixels[u+1],this.pixels[u+2])}static getUnpackVector(e){return Dv[e]}get unpackVector(){return Dv[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}_unpackMapbox(e,t,a){return(256*e*256+256*t+a)/10-1e4}_unpackTerrarium(e,t,a){return 256*e+t+a/256-32768}static pack(e,t){const a=[0,0,0,0],u=Df.getUnpackVector(t);let d=Math.floor((e+u[3])/u[2]);return a[2]=d%256,d=Math.floor(d/256),a[1]=d%256,d=Math.floor(d/256),a[0]=d,a}getPixels(){return new Ji({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=t*this.dim,d=t*this.dim+this.dim,m=a*this.dim,g=a*this.dim+this.dim;switch(t){case-1:u=d-1;break;case 1:d=u+1}switch(a){case-1:m=g-1;break;case 1:g=m+1}const b=-t*this.dim,w=-a*this.dim;for(let P=m;P<g;P++)for(let C=u;C<d;C++){const R=4*this._idx(C,P),O=4*this._idx(C+b,P+w);this.pixels[R+0]=e.pixels[O+0],this.pixels[R+1]=e.pixels[O+1],this.pixels[R+2]=e.pixels[O+2],this.pixels[R+3]=e.pixels[O+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}pt(Df,"DEMData"),pt(Rv,"DemMinMaxQuadTree",{omit:["dem"]});class J2{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,a){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const d={value:t,timeout:void 0};if(a!==void 0&&(d.timeout=setTimeout(()=>{this.remove(e,d)},a)),this.data[u].push(d),this.order.push(u),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const a=e.wrapped().key,u=t===void 0?0:this.data[a].indexOf(t),d=this.data[a][u];return this.data[a].splice(u,1),d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(d.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(e){const t=[];for(const a in this.data)for(const u of this.data[a])e(u.value)||t.push(u);for(const a of t)this.remove(a.value.tileID,a)}}class Cl{constructor(e,t,a){this.func=e,this.mask=t,this.range=a}}Cl.ReadOnly=!1,Cl.ReadWrite=!0,Cl.disabled=new Cl(519,Cl.ReadOnly,[0,1]);const Tm=7680;class Em{constructor(e,t,a,u,d,m){this.test=e,this.ref=t,this.mask=a,this.fail=u,this.depthFail=d,this.pass=m}}Em.disabled=new Em({func:519,mask:0},0,0,Tm,Tm,Tm);class oo{constructor(e,t,a){this.blendFunction=e,this.blendColor=t,this.mask=a}}oo.Replace=[1,0],oo.disabled=new oo(oo.Replace,lr.transparent,[!1,!1,!1,!1]),oo.unblended=new oo(oo.Replace,lr.transparent,[!0,!0,!0,!0]),oo.alphaBlended=new oo([1,771],lr.transparent,[!0,!0,!0,!0]);const Sm=1029,Am=2305;class Ln{constructor(e,t,a){this.enable=e,this.mode=t,this.frontFace=a}}Ln.disabled=new Ln(!1,Sm,Am),Ln.backCCW=new Ln(!0,Sm,Am),Ln.backCW=new Ln(!0,Sm,2304),Ln.frontCW=new Ln(!0,1028,2304),Ln.frontCCW=new Ln(!0,1028,Am);class ga extends Tt{constructor(e,t,a){super(),this.id=e,this._onlySymbols=a,t.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),t.on("error",()=>{this._sourceErrored=!0}),this._source=t,this._tiles={},this._cache=new J2(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new K2,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if(t.state!=="loaded"&&t.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const t in this._tiles){const a=this._tiles[t];this._source.prepareTile(a)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,a.tileID),a.upload(e),a.prepare(this.map.style.imageManager)}else for(const t in this._tiles){const a=this._tiles[t];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return Ue(this._tiles).map(e=>e.tileID).sort(Ov).map(e=>e.key)}getRenderableIds(e){const t=[];for(const a in this._tiles)this._isIdRenderable(+a,e)&&t.push(this._tiles[a]);return e?t.sort((a,u)=>{const d=a.tileID,m=u.tileID,g=new L(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),b=new L(m.canonical.x,m.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-m.overscaledZ||b.y-g.y||b.x-g.x}).map(a=>a.tileID.key):t.map(a=>a.tileID).sort(Ov).map(a=>a.key)}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=t),this._loadTile(a,this._tileLoaded.bind(this,a,e,t)))}_tileLoaded(e,t,a,u){if(u)if(e.state="errored",u.status!==404)this._source.fire(new ar(u,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const d=this.map.painter.terrain;this.update(this.transform,d.getScaledDemTileSize(),!0),d.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Ar.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new fr("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let u=0;u<t.length;u++){const d=t[u];if(e.neighboringTiles&&e.neighboringTiles[d]){const m=this.getTileByID(d);a(e,m),a(m,e)}}function a(u,d){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let m=d.tileID.canonical.x-u.tileID.canonical.x;const g=d.tileID.canonical.y-u.tileID.canonical.y,b=Math.pow(2,u.tileID.canonical.z),w=d.tileID.key;m===0&&g===0||Math.abs(g)>1||(Math.abs(m)>1&&(Math.abs(m+b)===1?m+=b:Math.abs(m-b)===1&&(m-=b)),d.dem&&u.dem&&(u.dem.backfillBorder(d.dem,m,g),u.neighboringTiles&&u.neighboringTiles[w]&&(u.neighboringTiles[w].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,a,u){for(const d in this._tiles){let m=this._tiles[d];if(u[d]||!m.hasData()||m.tileID.overscaledZ<=t||m.tileID.overscaledZ>a)continue;let g=m.tileID;for(;m&&m.tileID.overscaledZ>t+1;){const w=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[w.key],m&&m.hasData()&&(g=w)}let b=g;for(;b.overscaledZ>t;)if(b=b.scaledTo(b.overscaledZ-1),e[b.key]){u[g.key]=g;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=t?a:null}for(let a=e.overscaledZ-1;a>=t;a--){const u=e.scaledTo(a),d=this._getLoadedTile(u);if(d)return d}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const a=Math.ceil(e.width/t)+1,u=Math.ceil(e.height/t)+1,d=Math.floor(a*u*5),m=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,d):d,g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(g)}handleWrapJump(e){const t=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,t){const a={};for(const u in this._tiles){const d=this._tiles[u];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+t),a[d.tileID.key]=d}this._tiles=a;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,t,a){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let u;this.updateCacheSize(e,t),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(g=>new Li(g.canonical.z,g.wrap,g.canonical.z,g.canonical.x,g.canonical.y)):(u=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(g=>this._source.hasTile(g)))):u=[];const d=this._updateRetainedTiles(u);if(Lv(this._source.type)&&u.length!==0){const g={},b={},w=Object.keys(d);for(const C of w){const R=d[C],O=this._tiles[C];if(!O||O.fadeEndTime&&O.fadeEndTime<=Ar.now())continue;const B=this.findLoadedParent(R,Math.max(R.overscaledZ-ga.maxOverzooming,this._source.minzoom));B&&(this._addTile(B.tileID),g[B.tileID.key]=B.tileID),b[C]=R}const P=u[u.length-1].overscaledZ;for(const C in this._tiles){const R=this._tiles[C];if(d[C]||!R.hasData())continue;let O=R.tileID;for(;O.overscaledZ>P;){O=O.scaledTo(O.overscaledZ-1);const B=this._tiles[O.key];if(B&&B.hasData()&&b[O.key]){d[C]=R.tileID;break}}}for(const C in g)d[C]||(this._coveredTiles[C]=!0,d[C]=g[C])}for(const g in d)this._tiles[g].clearFadeHold();const m=function(g,b){const w=[];for(const P in g)P in b||w.push(P);return w}(this._tiles,d);for(const g of m){const b=this._tiles[g];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+g)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(e.length===0)return t;const a={},u=e.reduce((w,P)=>Math.min(w,P.overscaledZ),1/0),d=e[0].overscaledZ,m=Math.max(d-ga.maxOverzooming,this._source.minzoom),g=Math.max(d+ga.maxUnderzooming,this._source.minzoom),b={};for(const w of e){const P=this._addTile(w);t[w.key]=w,P.hasData()||u<this._source.maxzoom&&(b[w.key]=w)}this._retainLoadedChildren(b,u,g,t);for(const w of e){let P=this._tiles[w.key];if(P.hasData())continue;if(w.canonical.z>=this._source.maxzoom){const R=w.children(this._source.maxzoom)[0],O=this.getTile(R);if(O&&O.hasData()){t[R.key]=R;continue}}else{const R=w.children(this._source.maxzoom);if(t[R[0].key]&&t[R[1].key]&&t[R[2].key]&&t[R[3].key])continue}let C=P.wasRequested();for(let R=w.overscaledZ-1;R>=m;--R){const O=w.scaledTo(R);if(a[O.key]||(a[O.key]=!0,P=this.getTile(O),!P&&C&&(P=this._addTile(O)),P&&(t[O.key]=O,C=P.wasRequested(),P.hasData())))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let a,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){a=this._loadedParentTiles[u.key];break}t.push(u.key);const d=u.scaledTo(u.overscaledZ-1);if(a=this._getLoadedTile(d),a)break;u=d}for(const d of t)this._loadedParentTiles[d]=a}}_addTile(e){let t=this._tiles[e.key];if(t)return this._source.prepareTile&&this._source.prepareTile(t),t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const a=Boolean(t);if(!a){const u=this.map?this.map.painter:null;t=new wm(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,this._isRaster),this._source.prepareTile&&this._source.prepareTile(t)||this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,a||this._source.fire(new fr("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=t.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&t.state!=="reloading"?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,t,a){const u=[],d=this.transform;if(!d)return u;const m=d.projection.name==="globe",g=Kn(d.center.lng);for(const b in this._tiles){const w=this._tiles[b];if(a&&w.clearQueryDebugViz(),w.holdingForFade())continue;let P;if(m){const C=w.tileID.canonical;if(C.z===0){const R=[Math.abs(Ie(g,...Pu(C,-1))-g),Math.abs(Ie(g,...Pu(C,1))-g)];P=[0,2*R.indexOf(Math.min(...R))-1]}else{const R=[Math.abs(Ie(g,...Pu(C,-1))-g),Math.abs(Ie(g,...Pu(C,0))-g),Math.abs(Ie(g,...Pu(C,1))-g)];P=[R.indexOf(Math.min(...R))-1]}}else P=[0];for(const C of P){const R=e.containsTile(w,d,t,C);R&&u.push(R)}}return u}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of t)a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(Lv(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(t.fadeEndTime!==void 0&&t.fadeEndTime>=Ar.now())return!0}return!1}setFeatureState(e,t,a){this._state.updateState(e=e||"_geojsonTileLayer",t,a)}removeFeatureState(e,t,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,a)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,a){const u=this._tiles[e];u&&u.setDependencies(t,a)}reloadTilesForDependencies(e,t){for(const a in this._tiles)this._tiles[a].hasDependency(e,t)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,t))}_preloadTiles(e,t){const a=new Map,u=Array.isArray(e)?e:[e],d=this.map.painter.terrain,m=this.usedForTerrain&&d?d.getScaledDemTileSize():this._source.tileSize;for(const g of u){const b=g.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const w of b)a.set(w.key,w);this.usedForTerrain&&g.updateElevation(!1)}Te(Array.from(a.values()),(g,b)=>{const w=new wm(g,this._source.tileSize*g.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(w,P=>{this._source.type==="raster-dem"&&w.dem&&this._backfillDEM(w),b(P,w)})},t)}}function Ov(r,e){const t=Math.abs(2*r.wrap)-+(r.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return r.overscaledZ-e.overscaledZ||a-t||e.canonical.y-r.canonical.y||e.canonical.x-r.canonical.x}function Lv(r){return r==="raster"||r==="image"||r==="video"}function Pu(r,e){const t=1<<r.z;return[r.x/t+e,(r.x+1)/t+e]}ga.maxOverzooming=10,ga.maxUnderzooming=3;class Of{constructor(e,t,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=a}static create(e,t,a){const u=a||e.findDEMTileFor(t);if(!u||!u.dem)return;const d=u.dem,m=u.tileID,g=1<<t.canonical.z-m.canonical.z;return new Of(u,u.tileSize/It/g,[(t.canonical.x/g-m.canonical.x)*d.dim,(t.canonical.y/g-m.canonical.y)*d.dim])}tileCoordToPixel(e,t){const a=t*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(a);return new L(u,d)}getElevationAt(e,t,a,u){const d=e*this._scale+this._offset[0],m=t*this._scale+this._offset[1],g=Math.floor(d),b=Math.floor(m),w=this._dem;return u=!!u,a?Xt(Xt(w.get(g,b,u),w.get(g,b+1,u),m-b),Xt(w.get(g+1,b,u),w.get(g+1,b+1,u),m-b),d-g):w.get(g,b,u)}getElevationAtPixel(e,t,a){return this._dem.get(e,t,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*vn(1,e)*this._dem.stride}}class Fv{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ss(It,16,0),this.featureIndexArray=new Ag,this.promoteId=t}insert(e,t,a,u,d,m=0){const g=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,u,d,m);const b=this.grid;for(let w=0;w<t.length;w++){const P=t[w],C=[1/0,1/0,-1/0,-1/0];for(let R=0;R<P.length;R++){const O=P[R];C[0]=Math.min(C[0],O.x),C[1]=Math.min(C[1],O.y),C[2]=Math.max(C[2],O.x),C[3]=Math.max(C[3],O.y)}C[0]<It&&C[1]<It&&C[2]>=0&&C[3]>=0&&b.insert(g,C[0],C[1],C[2],C[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ma.VectorTile(new mu(this.rawTileData)).layers,this.sourceLayerCoder=new wv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,a,u){this.loadVTLayers();const d=e.params||{},m=ea(d.filter),g=e.tileResult,b=e.transform,w=g.bufferedTilespaceBounds,P=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(B,$,q,te)=>qg(g.bufferedTilespaceGeometry,B,$,q,te));P.sort(eT);let C=null;b.elevation&&P.length>0&&(C=Of.create(b.elevation,this.tileID));const R={};let O;for(let B=0;B<P.length;B++){const $=P[B];if($===O)continue;O=$;const q=this.featureIndexArray.get($);let te=null;this.loadMatchingFeature(R,q,m,d.layers,d.availableImages,t,a,u,(le,ne,se,me=0)=>(te||(te=Po(le,this.tileID.canonical,e.tileTransform)),ne.queryIntersectsFeature(g,le,se,te,this.z,e.transform,e.pixelPosMatrix,C,me)))}return R}loadMatchingFeature(e,t,a,u,d,m,g,b,w){const{featureIndex:P,bucketIndex:C,sourceLayerIndex:R,layoutVertexArrayOffset:O}=t,B=this.bucketLayerIDs[C];if(u&&!function(le,ne){for(let se=0;se<le.length;se++)if(ne.indexOf(le[se])>=0)return!0;return!1}(u,B))return;const $=this.sourceLayerCoder.decode(R),q=this.vtLayers[$].feature(P);if(a.needGeometry){const le=ua(q,!0);if(!a.filter(new Q(this.tileID.overscaledZ),le,this.tileID.canonical))return}else if(!a.filter(new Q(this.tileID.overscaledZ),q))return;const te=this.getId(q,$);for(let le=0;le<B.length;le++){const ne=B[le];if(u&&u.indexOf(ne)<0)continue;const se=m[ne];if(!se)continue;let me={};te!==void 0&&b&&(me=b.getState(se.sourceLayer||"_geojsonTileLayer",te));const ce=Xe({},g[ne]);ce.paint=Bv(ce.paint,se.paint,q,me,d),ce.layout=Bv(ce.layout,se.layout,q,me,d);const Me=!w||w(q,se,me,O);if(!Me)continue;const Pe=new Tv(q,this.z,this.x,this.y,te);Pe.layer=ce;let Oe=e[ne];Oe===void 0&&(Oe=e[ne]=[]),Oe.push({featureIndex:P,feature:Pe,intersectionZ:Me})}}lookupSymbolFeatures(e,t,a,u,d,m,g,b){const w={};this.loadVTLayers();const P=ea(d);for(const C of e)this.loadMatchingFeature(w,{bucketIndex:a,sourceLayerIndex:u,featureIndex:C,layoutVertexArrayOffset:0},P,m,g,b,t);return w}loadFeature(e){const{featureIndex:t,sourceLayerIndex:a}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(a),d=this.vtFeatures[u];if(d[t])return d[t];const m=this.vtLayers[u].feature(t);return d[t]=m,m}hasLayer(e){for(const t of this.bucketLayerIDs)for(const a of t)if(e===a)return!0;return!1}getId(e,t){let a=e.id;return this.promoteId&&(a=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]],typeof a=="boolean"&&(a=Number(a))),a}}function Bv(r,e,t,a,u){return xr(r,(d,m)=>{const g=e instanceof de?e.get(m):null;return g&&g.evaluate?g.evaluate(t,a,u):g})}function eT(r,e){return e-r}pt(Fv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class jv{constructor(e){const t={},a=[];for(const g in e){const b=e[g],w=t[g]={};for(const P in b.glyphs){const C=b.glyphs[+P];if(!C||C.bitmap.width===0||C.bitmap.height===0)continue;const R=C.metrics.localGlyph?2:1,O={x:0,y:0,w:C.bitmap.width+2*R,h:C.bitmap.height+2*R};a.push(O),w[P]=O}}const{w:u,h:d}=nm(a),m=new Io({width:u||1,height:d||1});for(const g in e){const b=e[g];for(const w in b.glyphs){const P=b.glyphs[+w];if(!P||P.bitmap.width===0||P.bitmap.height===0)continue;const C=t[g][w],R=P.metrics.localGlyph?2:1;Io.copy(P.bitmap,m,{x:0,y:0},{x:C.x+R,y:C.y+R},P.bitmap)}}this.image=m,this.positions=t}}pt(jv,"GlyphAtlas");class tT{constructor(e){this.tileID=new Li(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=_a(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,t,a,u,d){this.status="parsing",this.data=e,this.collisionBoxArray=new Yn;const m=new wv(Object.keys(e.layers).sort()),g=new Fv(this.tileID,this.promoteId);g.bucketLayerIDs=[];const b={},w=new bm(256,256),P={featureIndex:g,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:w,availableImages:a},C=t.familiesBySource[this.source];for(const me in C){const ce=e.layers[me];if(!ce)continue;let Me=!1,Pe=!1;for(const ze of C[me])ze[0].type==="symbol"?Me=!0:Pe=!0;if(this.isSymbolTile===!0&&!Me||this.isSymbolTile===!1&&!Pe)continue;ce.version===1&&hr(`Vector tile source "${this.source}" layer "${me}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Oe=m.encode(me),rt=[];for(let ze=0;ze<ce.length;ze++){const je=ce.feature(ze),qe=g.getId(je,me);rt.push({feature:je,id:qe,index:ze,sourceLayerIndex:Oe})}for(const ze of C[me]){const je=ze[0];this.isSymbolTile!==void 0&&je.type==="symbol"!==this.isSymbolTile||je.minzoom&&this.zoom<Math.floor(je.minzoom)||je.maxzoom&&this.zoom>=je.maxzoom||je.visibility!=="none"&&(Pm(ze,this.zoom,a),(b[je.id]=je.createBucket({index:g.bucketLayerIDs.length,layers:ze,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Oe,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:a})).populate(rt,P,this.tileID.canonical,this.tileTransform),g.bucketLayerIDs.push(ze.map(qe=>qe.id)))}}let R,O,B,$;w.trim();const q={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},te=xr(P.glyphDependencies,me=>Object.keys(me).map(Number));Object.keys(te).length?u.send("getGlyphs",{uid:this.uid,stacks:te},(me,ce)=>{R||(R=me,O=ce,se.call(this))},void 0,!1,q):O={};const le=Object.keys(P.iconDependencies);le.length?u.send("getImages",{icons:le,source:this.source,tileID:this.tileID,type:"icons"},(me,ce)=>{R||(R=me,B=ce,se.call(this))},void 0,!1,q):B={};const ne=Object.keys(P.patternDependencies);function se(){if(R)return d(R);if(O&&B&&$){const me=new jv(O),ce=new Ny(B,$);for(const Me in b){const Pe=b[Me];Pe instanceof ps?(Pm(Pe.layers,this.zoom,a),T2(Pe,O,me.positions,B,ce.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom,this.projection)):Pe.hasPattern&&(Pe instanceof _f||Pe instanceof ff||Pe instanceof hu)&&(Pm(Pe.layers,this.zoom,a),Pe.addFeatures(P,this.tileID.canonical,ce.patternPositions,a,this.tileTransform))}this.status="done",d(null,{buckets:Ue(b).filter(Me=>!Me.isEmpty()),featureIndex:g,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:me.image,lineAtlas:w,imageAtlas:ce,glyphMap:this.returnDependencies?O:null,iconMap:this.returnDependencies?B:null,glyphPositions:this.returnDependencies?me.positions:null})}}ne.length?u.send("getImages",{icons:ne,source:this.source,tileID:this.tileID,type:"patterns"},(me,ce)=>{R||(R=me,$=ce,se.call(this))},void 0,!1,q):$={},se.call(this)}}function Pm(r,e,t){const a=new Q(e);for(const u of r)u.recalculate(a,t)}class Nv{constructor(e){this.entries={},this.scheduler=e}request(e,t,a,u){const d=this.entries[e]=this.entries[e]||{callbacks:[]};if(d.result){const[m,g]=d.result;return this.scheduler?this.scheduler.add(()=>{u(m,g)},t):u(m,g),()=>{}}return d.callbacks.push(u),d.cancel||(d.cancel=a((m,g)=>{d.result=[m,g];for(const b of d.callbacks)this.scheduler?this.scheduler.add(()=>{b(m,g)},t):b(m,g);setTimeout(()=>delete this.entries[e],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(m=>m!==u),d.callbacks.length||(d.cancel(),delete this.entries[e]))}}}function Uv(r,e,t){const a=JSON.stringify(r.request);return r.data&&(this.deduped.entries[a]={result:[null,r.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},u=>{const d=Ee(r.request,(m,g,b,w)=>{m?u(m):g&&u(null,{vectorTile:t?void 0:new ma.VectorTile(new mu(g)),rawData:g,cacheControl:b,expires:w})});return()=>{d.cancel(),u()}},e)}s.ARRAY_TYPE=Ki,s.AUTH_ERR_MSG=jr,s.Aabb=Gi,s.Actor=class{constructor(r,e,t){this.target=r,this.parent=e,this.mapId=t,this.callbacks={},this.cancelCallbacks={},Rr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=oi()?r:A,this.scheduler=new Q2}send(r,e,t,a,u=!1,d){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);t&&(t.metadata=d,this.callbacks[m]=t);const g=He(this.globalScope)?void 0:[];return this.target.postMessage({id:m,type:r,hasCallback:!!t,targetMapId:a,mustQueue:u,sourceMapId:this.mapId,data:as(e,g)},g),{cancel:()=>{t&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(r){const e=r.data,t=e.id;if(t&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const a=this.cancelCallbacks[t];delete this.cancelCallbacks[t],a&&a.cancel()}else if(e.mustQueue||oi()){const a=this.callbacks[t];this.cancelCallbacks[t]=this.scheduler.add(()=>this.processTask(t,e),a&&a.metadata||{type:"message"})}else this.processTask(t,e)}processTask(r,e){if(e.type==="<response>"){const t=this.callbacks[r];delete this.callbacks[r],t&&(e.error?t(ia(e.error)):t(null,ia(e.data)))}else{const t=He(this.globalScope)?void 0:[],a=e.hasCallback?(d,m)=>{delete this.cancelCallbacks[r],this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:d?as(d):null,data:as(m,t)},t)}:d=>{},u=ia(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,u,a);else if(this.parent.getWorkerSource){const d=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,d[0],u.source)[d[1]](u,a)}else a(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.CanonicalTileID=pf,s.Color=lr,s.ColorMode=oo,s.CullFaceMode=Ln,s.DEMData=Df,s.DataConstantProperty=ue,s.DedupedRequest=Nv,s.DepthMode=Cl,s.EXTENT=It,s.Elevation=class{isDataAvailableAtPoint(r){const e=this._source();if(!e||r.y<0||r.y>1)return!1;const t=e.getSource().maxzoom,a=1<<t,u=Math.floor(r.x),d=Math.floor((r.x-u)*a),m=Math.floor(r.y*a),g=this.findDEMTileFor(new Li(t,u,t,d,m));return!(!g||!g.dem)}getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,t=!0){e==null&&(e=null);const a=this._source();if(!a||r.y<0||r.y>1)return e;const u=a.getSource().maxzoom,d=1<<u,m=Math.floor(r.x),g=r.x-m,b=new Li(u,m,u,Math.floor(g*d),Math.floor(r.y*d)),w=this.findDEMTileFor(b);if(!w||!w.dem)return e;const P=w.dem,C=1<<w.tileID.canonical.z,R=(g*C-w.tileID.canonical.x)*P.dim,O=(r.y*C-w.tileID.canonical.y)*P.dim,B=Math.floor(R),$=Math.floor(O);return(t?this.exaggeration():1)*Xt(Xt(P.get(B,$),P.get(B,$+1),O-$),Xt(P.get(B+1,$),P.get(B+1,$+1),O-$),R-B)}getAtTileOffset(r,e,t){const a=1<<r.canonical.z;return this.getAtPointOrZero(new ml(r.wrap+(r.canonical.x+e/It)/a,(r.canonical.y+t/It)/a))}getAtTileOffsetFunc(r,e,t,a){return u=>{const d=this.getAtTileOffset(r,u.x,u.y),m=a.upVector(r.canonical,u.x,u.y);return Rn(m,m,d*a.upVectorScale(r.canonical,e,t).metersToTile),m}}getForTilePoints(r,e,t,a){const u=Of.create(this,r,a);return!!u&&(e.forEach(d=>{d[2]=this.exaggeration()*u.getElevationAt(d[0],d[1],t)}),!0)}getMinMaxForTile(r){const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const t=e.dem.tree,a=e.tileID,u=1<<r.canonical.z-a.canonical.z;let d=r.canonical.x/u-a.canonical.x,m=r.canonical.y/u-a.canonical.y,g=0;for(let b=0;b<r.canonical.z-a.canonical.z&&!t.leaves[g];b++){d*=2,m*=2;const w=2*Math.floor(m)+Math.floor(d);g=t.childOffsets[g]+w,d%=1,m%=1}return{min:this.exaggeration()*t.minimums[g],max:this.exaggeration()*t.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,t){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},s.ErrorEvent=ar,s.EvaluationParameters=Q,s.Event=fr,s.Evented=Tt,s.FillExtrusionBucket=hu,s.Frustum=Hp,s.FrustumCorners=Zp,s.GLOBE_METERS_TO_ECEF=dm,s.GLOBE_RADIUS=zo,s.GLOBE_SCALE_MATCH_LATITUDE=45,s.GLOBE_ZOOM_THRESHOLD_MAX=6,s.GLOBE_ZOOM_THRESHOLD_MIN=5,s.GlobeSharedBuffers=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const r of this._wireframeSegments)r.destroy()}}_createGrid(r){const e=new ot,t=new Ut,a=65;for(let u=0;u<a;u++)for(let d=0;d<a;d++)e.emplaceBack(d,u);this._gridSegments=[];for(let u=0,d=0;u<Pl.length;u++){const m=Pl[u];for(let b=0;b<m;b++)for(let w=0;w<64;w++){const P=b*a+w;t.emplaceBack(P+1,P,P+a),t.emplaceBack(P+a,P+a+1,P+1)}const g=64*m*2;this._gridSegments.push(Kr.simpleSegment(0,d,(m+1)*a,g)),d+=g}this._gridBuffer=r.createVertexBuffer(e,yu.members),this._gridIndexBuffer=r.createIndexBuffer(t,!0)}_createPoles(r){const e=new Ut;for(let u=0;u<=64;u++)e.emplaceBack(0,u+1,u+2);this._poleIndexBuffer=r.createIndexBuffer(e,!0);const t=new gi,a=new gi;this._poleSegments=[];for(let u=0,d=0;u<5;u++){const m=360/(1<<u);t.emplaceBack(0,-zo,0,.5,0),a.emplaceBack(0,-zo,0,.5,1);for(let g=0;g<=64;g++){const b=g/64,w=Xt(0,m,b),[P,C,R]=Il(C2,z2,w,zo);t.emplaceBack(P,C,R,b,0),a.emplaceBack(P,C,R,b,1)}this._poleSegments.push(Kr.simpleSegment(d,0,66,64)),d+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(t,sv,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(a,sv,!1)}getGridBuffers(r){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[r]]}getPoleBuffers(r){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}getWirefameBuffers(r,e){if(!this._wireframeSegments){const t=new Ti,a=64,u=a+1;this._wireframeSegments=[];for(let d=0,m=0;d<Pl.length;d++){const g=Pl[d];for(let w=0;w<g;w++)for(let P=0;P<a;P++){const C=w*u+P;t.emplaceBack(C,C+1),t.emplaceBack(C,C+u),t.emplaceBack(C,C+u+1)}const b=g*a*3;this._wireframeSegments.push(Kr.simpleSegment(0,m,(g+1)*u,b)),m+=b}this._wireframeIndexBuffer=r.createIndexBuffer(t)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},s.GlyphManager=Sl,s.ImagePosition=om,s.LineAtlas=bm,s.LngLat=nr,s.LngLatBounds=us,s.LocalGlyphMode=cm,s.MAX_MERCATOR_LATITUDE=Jn,s.MercatorCoordinate=ml,s.ONE_EM=vi,s.OverscaledTileID=Li,s.Properties=Le,s.RGBAImage=Ji,s.Ray=qp,s.RequestManager=class{constructor(r,e,t){this._transformRequestFn=r,this._customAccessToken=e,this._silenceAuthErrors=!!t,this._createSkuToken()}_createSkuToken(){const r=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",or,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,e){return this._transformRequestFn&&this._transformRequestFn(r,e)||{url:r}}normalizeStyleURL(r,e){if(!ii(r))return r;const t=si(r);return t.path=`/styles/v1${t.path}`,this._makeAPIURL(t,this._customAccessToken||e)}normalizeGlyphsURL(r,e){if(!ii(r))return r;const t=si(r);return t.path=`/fonts/v1${t.path}`,this._makeAPIURL(t,this._customAccessToken||e)}normalizeSourceURL(r,e,t,a){if(!ii(r))return r;const u=si(r);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),t&&u.params.push(`language=${t}`),a&&u.params.push(`worldview=${a}`),this._makeAPIURL(u,this._customAccessToken||e)}normalizeSpriteURL(r,e,t,a){const u=si(r);return ii(r)?(u.path=`/styles/v1${u.path}/sprite${e}${t}`,this._makeAPIURL(u,this._customAccessToken||a)):(u.path+=`${e}${t}`,Ni(u))}normalizeTileURL(r,e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!ii(r))return r;const a=si(r);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||t&&a.authority!=="raster"&&t===512?"@2x":""}${ir.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${Rt.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${Rt.TILE_URL_VERSION}${a.path}`);const u=this._customAccessToken||function(d){for(const m of d){const g=m.match(/^access_token=(.*)$/);if(g)return g[1]}return null}(a.params)||Rt.ACCESS_TOKEN;return Rt.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,u)}canonicalizeTileURL(r,e){const t=si(r);if(!t.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!t.path.match(/\.[\w]+$/))return r;let a="mapbox://";t.path.match(/^\/raster\/v1\//)?a+=`raster/${t.path.replace(`/${Rt.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${t.path.replace(`/${Rt.TILE_URL_VERSION}/`,"")}`;let u=t.params;return e&&(u=u.filter(d=>!d.match(/^access_token=/))),u.length&&(a+=`?${u.join("&")}`),a}canonicalizeTileset(r,e){const t=!!e&&ii(e),a=[];for(const u of r.tiles||[])zi(u)?a.push(this.canonicalizeTileURL(u,t)):a.push(u);return a}_makeAPIURL(r,e){const t="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",a=si(Rt.API_URL);if(r.protocol=a.protocol,r.authority=a.authority,r.protocol==="http"){const u=r.params.indexOf("secure");u>=0&&r.params.splice(u,1)}if(a.path!=="/"&&(r.path=`${a.path}${r.path}`),!Rt.REQUIRE_ACCESS_TOKEN)return Ni(r);if(e=e||Rt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${t}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${t}`)}return r.params=r.params.filter(u=>u.indexOf("access_token")===-1),r.params.push(`access_token=${e||""}`),Ni(r)}},s.ResourceType=_e,s.SegmentVector=Kr,s.SourceCache=ga,s.StencilMode=Em,s.StructArrayLayout1ui2=xo,s.StructArrayLayout2f1f2i16=Mn,s.StructArrayLayout2i4=ot,s.StructArrayLayout2ui4=Ti,s.StructArrayLayout3f12=Ir,s.StructArrayLayout3ui6=Ut,s.StructArrayLayout4i8=wt,s.StructArrayLayout5f20=gi,s.Texture=Au,s.Tile=wm,s.Transitionable=ie,s.Uniform1f=Kh,s.Uniform1i=class extends Eo{constructor(r){super(r),this.current=0}set(r,e,t){this.fetchUniformLocation(r,e)&&this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},s.Uniform2f=class extends Eo{constructor(r){super(r),this.current=[0,0]}set(r,e,t){this.fetchUniformLocation(r,e)&&(t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1])))}},s.Uniform3f=class extends Eo{constructor(r){super(r),this.current=[0,0,0]}set(r,e,t){this.fetchUniformLocation(r,e)&&(t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2])))}},s.Uniform4f=kg,s.UniformColor=Dg,s.UniformMatrix2f=class extends Eo{constructor(r){super(r),this.current=Bb}set(r,e,t){if(this.fetchUniformLocation(r,e)){for(let a=0;a<4;a++)if(t[a]!==this.current[a]){this.current=t,this.gl.uniformMatrix2fv(this.location,!1,t);break}}}},s.UniformMatrix3f=class extends Eo{constructor(r){super(r),this.current=Fb}set(r,e,t){if(this.fetchUniformLocation(r,e)){for(let a=0;a<9;a++)if(t[a]!==this.current[a]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}}},s.UniformMatrix4f=class extends Eo{constructor(r){super(r),this.current=Lb}set(r,e,t){if(this.fetchUniformLocation(r,e)){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let a=1;a<16;a++)if(t[a]!==this.current[a]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}}},s.UnwrappedTileID=Py,s.ValidationError=ht,s.VectorTileWorkerSource=class extends Tt{constructor(r,e,t,a,u){super(),this.actor=r,this.layerIndex=e,this.availableImages=t,this.loadVectorData=u||Uv,this.loading={},this.loaded={},this.deduped=new Nv(r.scheduler),this.isSpriteLoaded=a,this.scheduler=r.scheduler}loadTile(r,e){const t=r.uid,a=r&&r.request,u=a&&a.collectResourceTiming,d=this.loading[t]=new tT(r);d.abort=this.loadVectorData(r,(m,g)=>{const b=!this.loading[t];if(delete this.loading[t],b||m||!g)return d.status="done",b||(this.loaded[t]=d),e(m);const w=g.rawData,P={};g.expires&&(P.expires=g.expires),g.cacheControl&&(P.cacheControl=g.cacheControl),d.vectorTile=g.vectorTile||new ma.VectorTile(new mu(w));const C=()=>{d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,(R,O)=>{if(R||!O)return e(R);const B={};if(u){const $=vt(a);$.length>0&&(B.resourceTiming=JSON.parse(JSON.stringify($)))}e(null,Xe({rawTileData:w.slice(0)},O,P,B))})};this.isSpriteLoaded?C():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(C,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom}):C()}),this.loaded=this.loaded||{},this.loaded[t]=d})}reloadTile(r,e){const t=this.loaded,a=r.uid,u=this;if(t&&t[a]){const d=t[a];d.showCollisionBoxes=r.showCollisionBoxes,d.enableTerrain=!!r.enableTerrain,d.projection=r.projection,d.tileTransform=_a(r.tileID.canonical,r.projection);const m=(g,b)=>{const w=d.reloadCallback;w&&(delete d.reloadCallback,d.parse(d.vectorTile,u.layerIndex,this.availableImages,u.actor,w)),e(g,b)};d.status==="parsing"?d.reloadCallback=m:d.status==="done"&&(d.vectorTile?d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,m):m())}}abortTile(r,e){const t=r.uid,a=this.loading[t];a&&(a.abort&&a.abort(),delete this.loading[t]),e()}removeTile(r,e){const t=this.loaded,a=r.uid;t&&t[a]&&delete t[a],e()}},s.WritingMode=pn,s.ZoomHistory=Fh,s.add=hs,s.addDynamicAttributes=zf,s.adjoint=function(r,e){var t=e[0],a=e[1],u=e[2],d=e[3],m=e[4],g=e[5],b=e[6],w=e[7],P=e[8];return r[0]=m*P-g*w,r[1]=u*w-a*P,r[2]=a*g-u*m,r[3]=g*b-d*P,r[4]=t*P-u*b,r[5]=u*d-t*g,r[6]=d*w-m*b,r[7]=a*b-t*w,r[8]=t*m-a*d,r},s.asyncAll=Te,s.bezier=De,s.bindAll=Rr,s.boundsAttributes=Sv,s.bufferConvexPolygon=function(r,e){const t=[];for(let a=0;a<r.length;a++){const u=mt(a-1,-1,r.length-1),d=mt(a+1,-1,r.length-1),m=r[a],g=r[d],b=r[u].sub(m).unit(),w=g.sub(m).unit(),P=w.angleWithSep(b.x,b.y),C=b.add(w).unit().mult(-1*e/Math.sin(P/2));t.push(m.add(C))}return t},s.cacheEntryPossiblyAdded=function(r){oe++,oe>ka&&(r.getActor().send("enforceCacheSizeLimit",Go),oe=0)},s.calculateGlobeLabelMatrix=function(r,e){const{x:t,y:a}=r.point,u=fv(t,a,r.worldSize/r._pixelsPerMercatorPixel,0,0);return gl(u,u,_m(ro(e)))},s.calculateGlobeMatrix=function(r){const{x:e,y:t}=r.point,{lng:a,lat:u}=r._center;return fv(e,t,r.worldSize,a,u)},s.calculateGlobeMercatorMatrix=function(r){const e=r.pixelsPerMeter,t=e/vn(1,r.center.lat),a=eo(new Float64Array(16));return ru(a,a,[r.point.x,r.point.y,0]),fa(a,a,[t,t,e]),Float32Array.from(a)},s.circumferenceAtLatitude=zp,s.clamp=Ie,s.clearTileCache=function(r){const e=re(),t=[];for(const a in Ri)e&&t.push(e.delete(a)),delete Ri[a];r&&Promise.all(t).catch(r).then(()=>r())},s.clipLine=Ky,s.clone=function(r){var e=new Ki(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},s.clone$1=Br,s.collisionCircleLayout=Xw,s.config=Rt,s.conjugate=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},s.create=function(){var r=new Ki(16);return Ki!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},s.create$1=Wg,s.createExpression=ts,s.createLayout=Be,s.createStyleLayer=function(r){return r.type==="custom"?new Z2(r):new W2[r.type](r)},s.cross=Gp,s.degToRad=W,s.distance=function(r,e){return Math.hypot(e[0]-r[0],e[1]-r[1],e[2]-r[2])},s.div=function(r,e,t){return r[0]=e[0]/t[0],r[1]=e[1]/t[1],r[2]=e[2]/t[2],r},s.dot=bn,s.ease=Se,s.easeCubicInOut=Ce,s.emitValidationErrors=Gc,s.endsWith=Wr,s.enforceCacheSizeLimit=function(r){for(const e in Ri)N(e),Ri[e].then(t=>{t.keys().then(a=>{for(let u=0;u<a.length-r;u++)t.delete(a[u])})})},s.evaluateSizeForFeature=gf,s.evaluateSizeForZoom=bl,s.evaluateVariableOffset=iv,s.evented=U,s.exactEquals=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},s.exactEquals$1=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]},s.exported=Ar,s.exported$1=ir,s.extend=Xe,s.extend$1=Ui,s.fillExtrusionHeightLift=Ey,s.filterObject=Ht,s.fromMat4=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},s.fromQuat=function(r,e){var t=e[0],a=e[1],u=e[2],d=e[3],m=t+t,g=a+a,b=u+u,w=t*m,P=a*m,C=a*g,R=u*m,O=u*g,B=u*b,$=d*m,q=d*g,te=d*b;return r[0]=1-C-B,r[1]=P+te,r[2]=R-q,r[3]=0,r[4]=P-te,r[5]=1-w-B,r[6]=O+$,r[7]=0,r[8]=R+q,r[9]=O-$,r[10]=1-w-C,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},s.fromRotation=function(r,e){var t=Math.sin(e),a=Math.cos(e);return r[0]=a,r[1]=t,r[2]=0,r[3]=-t,r[4]=a,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},s.fromScaling=Xg,s.furthestTileCorner=function(r){const e=Math.round((r+45+360)%360/90)%4;return ve[e]},s.getAABBPointSquareDist=function(r,e,t){let a=0;for(let u=0;u<2;++u){const d=t?t[u]:0;r[u]>d&&(a+=(r[u]-d)*(r[u]-d)),e[u]<d&&(a+=(d-e[u])*(d-e[u]))}return a},s.getAnchorAlignment=lm,s.getAnchorJustification=hm,s.getBounds=function(r){let e=1/0,t=1/0,a=-1/0,u=-1/0;for(const d of r)e=Math.min(e,d.x),t=Math.min(t,d.y),a=Math.max(a,d.x),u=Math.max(u,d.y);return{min:new L(e,t),max:new L(a,u)}},s.getColumn=Ye,s.getGridMatrix=function(r,e,t){const a=e.getNorth(),u=e.getSouth(),d=e.getWest(),m=.015625;return[0,(e.getEast()-d)*m,1<<r.z,(u-a)/Pl[t],0,r.y,a,d,m]},s.getImage=Pt,s.getJSON=function(r,e){return ge(Xe(r,{type:"json"}),e)},s.getLatitudinalLod=function(r){const e=80.051129;r=Ie(r,-80.051129,e)/e*90;const t=Math.pow(Math.abs(Math.sin(W(r))),3);return Math.round(t*(Pl.length-1))},s.getMapSessionAPI=rc,s.getPerformanceMeasurement=vt,s.getProjection=xv,s.getRTLTextPluginStatus=G,s.getReferrer=xe,s.getTilePoint=function(r,{x:e,y:t},a=0){return new L(((e-a)*r.scale-r.x)*It,(t*r.scale-r.y)*It)},s.getTileVec3=function(r,e,t=0){return yl(((e.x-t)*r.scale-r.x)*It,(e.y*r.scale-r.y)*It,Fg(e.z,e.y))},s.getVideo=function(r,e){const t=A.document.createElement("video");t.muted=!0,t.onloadstart=function(){e(null,t)};for(let a=0;a<r.length;a++){const u=A.document.createElement("source");Qe(r[a])||(t.crossOrigin="Anonymous"),u.src=r[a],t.appendChild(u)}return{cancel:()=>{}}},s.globeCenterToScreenPoint=function(r){const e=[0,0,0],t=eo(new Float64Array(16));return gl(t,r.pixelMatrix,r.globeMatrix),ni(e,e,t),new L(e[0],e[1])},s.globeDenormalizeECEF=_m,s.globeECEFOrigin=function(r,e){const t=[0,0,0];return ni(t,t,xu(ro(e.canonical))),ni(t,t,r),t},s.globeNormalizeECEF=xu,s.globePixelsToTileUnits=function(r,e){return It/(512*Math.pow(2,r))*Af(ro(e))},s.globePoleMatrixForTile=function(r,e,t){const a=eo(new Float64Array(16)),u=(e/(1<<r)-.5)*Math.PI*2;return of(a,t.globeMatrix,u),Float32Array.from(a)},s.globeTileBounds=ro,s.globeTiltAtLngLat=dv,s.globeToMercatorTransition=bu,s.globeUseCustomAntiAliasing=function(r,e,t){const a=bu(t.zoom),u=r.style.map._antialias,d=!!e.extStandardDerivatives,m=e.extStandardDerivativesForceOff||r.terrain&&r.terrain.exaggeration()>0;return a===0&&!u&&!m&&d},s.identity=eo,s.identity$1=ry,s.invert=Bp,s.isFullscreen=function(){return!!A.document.fullscreenElement||!!A.document.webkitFullscreenElement},s.isLngLatBehindGlobe=function(r,e){return dv(r,e)>Math.PI/2*1.01},s.isMapAuthenticated=function(r){return Vn.has(r)},s.isMapboxURL=ii,s.isSafariWithAntialiasingBug=function(r){const e=r.navigator?r.navigator.userAgent:null;return!!He(r)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.latFromMercatorY=yi,s.len=tw,s.length=iu,s.length$1=function(r){return Math.hypot(r[0],r[1],r[2],r[3])},s.loadVectorTile=Uv,s.makeRequest=ge,s.mapValue=function(r,e,t,a,u){return Ie((r-e)/(t-e)*(u-a)+a,a,u)},s.mercatorScale=Bg,s.mercatorXfromLng=Kn,s.mercatorYfromLat=Ao,s.mercatorZfromAltitude=vn,s.mul=Jb,s.mul$1=ew,s.multiply=gl,s.multiply$1=function(r,e,t){var a=e[0],u=e[1],d=e[2],m=e[3],g=e[4],b=e[5],w=e[6],P=e[7],C=e[8],R=t[0],O=t[1],B=t[2],$=t[3],q=t[4],te=t[5],le=t[6],ne=t[7],se=t[8];return r[0]=R*a+O*m+B*w,r[1]=R*u+O*g+B*P,r[2]=R*d+O*b+B*C,r[3]=$*a+q*m+te*w,r[4]=$*u+q*g+te*P,r[5]=$*d+q*b+te*C,r[6]=le*a+ne*m+se*w,r[7]=le*u+ne*g+se*P,r[8]=le*d+ne*b+se*C,r},s.multiply$2=Kg,s.nextPowerOfTwo=zr,s.normalize=Oi,s.normalize$1=function(r,e){var t=e[0],a=e[1],u=e[2],d=e[3],m=t*t+a*a+u*u+d*d;return m>0&&(m=1/Math.sqrt(m)),r[0]=t*m,r[1]=a*m,r[2]=u*m,r[3]=d*m,r},s.number=Xt,s.ortho=function(r,e,t,a,u,d,m){var g=1/(e-t),b=1/(a-u),w=1/(d-m);return r[0]=-2*g,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*b,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*w,r[11]=0,r[12]=(e+t)*g,r[13]=(u+a)*b,r[14]=(m+d)*w,r[15]=1,r},s.pbf=mu,s.perspective=function(r,e,t,a,u){var d,m=1/Math.tan(e/2);return r[0]=m/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=m,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,u!=null&&u!==1/0?(r[10]=(u+a)*(d=1/(a-u)),r[14]=2*u*a*d):(r[10]=-1,r[14]=-2*a),r},s.pick=function(r,e){const t={};for(let a=0;a<e.length;a++){const u=e[a];u in r&&(t[u]=r[u])}return t},s.plugin=X,s.pointGeometry=L,s.polygonContainsPoint=ha,s.polygonIntersectsBox=qg,s.polygonIntersectsPolygon=Ug,s.polygonizeBounds=function(r,e,t=0,a=!0){const u=new L(t,t),d=r.sub(u),m=e.add(u),g=[d,new L(m.x,d.y),m,new L(d.x,m.y)];return a&&g.push(d.clone()),g},s.posAttributes=yu,s.postMapLoadEvent=za,s.postTurnstileEvent=Cs,s.potpack=nm,s.prevPowerOfTwo=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log(r)/Math.LN2))},s.radToDeg=he,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.registerForPluginStateChange=function(r){return r({pluginStatus:S,pluginURL:I}),U.on("pluginStateChange",r),r},s.removeAuthState=function(r){Vn.delete(r)},s.renderColorRamp=Xp,s.resample=jg,s.rotateX=jp,s.rotateX$1=iy,s.rotateY=of,s.rotateY$1=ny,s.rotateZ=function(r,e,t){var a=Math.sin(t),u=Math.cos(t),d=e[0],m=e[1],g=e[2],b=e[3],w=e[4],P=e[5],C=e[6],R=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=d*u+w*a,r[1]=m*u+P*a,r[2]=g*u+C*a,r[3]=b*u+R*a,r[4]=w*u-d*a,r[5]=P*u-m*a,r[6]=C*u-g*a,r[7]=R*u-b*a,r},s.rotateZ$1=function(r,e,t){t*=.5;var a=e[0],u=e[1],d=e[2],m=e[3],g=Math.sin(t),b=Math.cos(t);return r[0]=a*b+u*g,r[1]=u*b-a*g,r[2]=d*b+m*g,r[3]=m*b-d*g,r},s.scale=fa,s.scale$1=ey,s.scale$2=Rn,s.scaleAndAdd=sf,s.setCacheLimits=function(r,e){Go=r,ka=e},s.setColumn=function(r,e,t){r[4*e+0]=t[0],r[4*e+1]=t[1],r[4*e+2]=t[2],r[4*e+3]=t[3]},s.setRTLTextPlugin=function(r,e,t=!1){if(S===p||S===y||S===v)throw new Error("setRTLTextPlugin cannot be called multiple times.");I=Ar.resolveURL(r),S=p,T=e,D(),t||K()},s.smoothstep=We,s.spec=ke,s.storeAuthState=function(r,e){e?Vn.add(r):Vn.delete(r)},s.sub=kn,s.subtract=Up,s.symbolSize=Qw,s.tileAABB=function(r,e,t,a,u,d,m,g,b){if(b.name==="globe")return M2(r,e,new pf(t,a,u));const w=_a({z:t,x:a,y:u},b);return new Gi([(d+w.x/w.scale)*e,e*(w.y/w.scale),m],[(d+w.x2/w.scale)*e,e*(w.y2/w.scale),g])},s.tileCornersToBounds=Ef,s.tileTransform=_a,s.transformMat3=function(r,e,t){var a=e[0],u=e[1],d=e[2];return r[0]=a*t[0]+u*t[3]+d*t[6],r[1]=a*t[1]+u*t[4]+d*t[7],r[2]=a*t[2]+u*t[5]+d*t[8],r},s.transformMat4=ni,s.transformMat4$1=da,s.transformQuat=Jg,s.transitionTileAABBinECEF=cv,s.translate=ru,s.transpose=function(r,e){if(r===e){var t=e[1],a=e[2],u=e[5];r[1]=e[3],r[2]=e[6],r[3]=t,r[5]=e[7],r[6]=a,r[7]=u}else r[0]=e[0],r[1]=e[3],r[2]=e[6],r[3]=e[1],r[4]=e[4],r[5]=e[7],r[6]=e[2],r[7]=e[5],r[8]=e[8];return r},s.triggerPluginCompletionEvent=k,s.uniqueId=Dt,s.updateGlobeVertexNormal=function(r,e,t,a,u){const d=5*e+2;r.float32[d+0]=t,r.float32[d+1]=a,r.float32[d+2]=u},s.validateCustomStyleLayer=function(r){const e=[],t=r.id;return t===void 0&&e.push({message:`layers.${t}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${t}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${t}: property "renderingMode" must be either "2d" or "3d"`}),e},s.validateFilter=r=>In(ns(r)),s.validateFog=r=>In(kh(r)),s.validateLayer=r=>In(nl(r)),s.validateLight=r=>In(Rh(r)),s.validateSource=r=>In(zh(r)),s.validateStyle=al,s.validateTerrain=r=>In(sl(r)),s.values=Ue,s.vectorTile=ma,s.version=St,s.warnOnce=hr,s.window=A,s.wrap=mt}),x(["./shared"],function(s){function A(re){if(typeof re=="number"||typeof re=="boolean"||typeof re=="string"||re==null)return JSON.stringify(re);if(Array.isArray(re)){let V="[";for(const ee of re)V+=`${A(ee)},`;return`${V}]`}let N="{";for(const V of Object.keys(re).sort())N+=`${V}:${A(re[V])},`;return`${N}}`}function M(re){let N="";for(const V of s.refProperties)N+=`/${A(re[V])}`;return N}class z{constructor(N){this.keyCache={},N&&this.replace(N)}replace(N){this._layerConfigs={},this._layers={},this.update(N,[])}update(N,V){for(const oe of N)this._layerConfigs[oe.id]=oe,(this._layers[oe.id]=s.createStyleLayer(oe)).compileFilter(),this.keyCache[oe.id]&&delete this.keyCache[oe.id];for(const oe of V)delete this.keyCache[oe],delete this._layerConfigs[oe],delete this._layers[oe];this.familiesBySource={};const ee=function(oe,_e){const we={};for(let ge=0;ge<oe.length;ge++){const Ee=_e&&_e[oe[ge].id]||M(oe[ge]);_e&&(_e[oe[ge].id]=Ee);let Ge=we[Ee];Ge||(Ge=we[Ee]=[]),Ge.push(oe[ge])}const xe=[];for(const ge in we)xe.push(we[ge]);return xe}(s.values(this._layerConfigs),this.keyCache);for(const oe of ee){const _e=oe.map(ct=>this._layers[ct.id]),we=_e[0];if(we.visibility==="none")continue;const xe=we.source||"";let ge=this.familiesBySource[xe];ge||(ge=this.familiesBySource[xe]={});const Ee=we.sourceLayer||"_geojsonTileLayer";let Ge=ge[Ee];Ge||(Ge=ge[Ee]=[]),Ge.push(_e)}}}class L{loadTile(N,V){const{uid:ee,encoding:oe,rawImageData:_e,padding:we,buildQuadTree:xe}=N,ge=s.window.ImageBitmap&&_e instanceof s.window.ImageBitmap?this.getImageData(_e,we):_e;V(null,new s.DEMData(ee,ge,oe,we<1,xe))}getImageData(N,V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(N.width,N.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=N.width,this.offscreenCanvas.height=N.height,this.offscreenCanvasContext.drawImage(N,0,0,N.width,N.height);const ee=this.offscreenCanvasContext.getImageData(-V,-V,N.width+2*V,N.height+2*V);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ee}}var F=function re(N,V){var ee,oe=N&&N.type;if(oe==="FeatureCollection")for(ee=0;ee<N.features.length;ee++)re(N.features[ee],V);else if(oe==="GeometryCollection")for(ee=0;ee<N.geometries.length;ee++)re(N.geometries[ee],V);else if(oe==="Feature")re(N.geometry,V);else if(oe==="Polygon")j(N.coordinates,V);else if(oe==="MultiPolygon")for(ee=0;ee<N.coordinates.length;ee++)j(N.coordinates[ee],V);return N};function j(re,N){if(re.length!==0){H(re[0],N);for(var V=1;V<re.length;V++)H(re[V],!N)}}function H(re,N){for(var V=0,ee=0,oe=0,_e=re.length,we=_e-1;oe<_e;we=oe++){var xe=(re[oe][0]-re[we][0])*(re[we][1]+re[oe][1]),ge=V+xe;ee+=Math.abs(V)>=Math.abs(xe)?V-ge+xe:xe-ge+V,V=ge}V+ee>=0!=!!N&&re.reverse()}const W=s.vectorTile.VectorTileFeature.prototype.toGeoJSON;class he{constructor(N){this._feature=N,this.extent=s.EXTENT,this.type=N.type,this.properties=N.tags,"id"in N&&!isNaN(N.id)&&(this.id=parseInt(N.id,10))}loadGeometry(){if(this._feature.type===1){const N=[];for(const V of this._feature.geometry)N.push([new s.pointGeometry(V[0],V[1])]);return N}{const N=[];for(const V of this._feature.geometry){const ee=[];for(const oe of V)ee.push(new s.pointGeometry(oe[0],oe[1]));N.push(ee)}return N}}toGeoJSON(N,V,ee){return W.call(this,N,V,ee)}}class ve{constructor(N){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=N.length,this._features=N}feature(N){return new he(this._features[N])}}var Ce=s.vectorTile.VectorTileFeature,De=Se;function Se(re,N){this.options=N||{},this.features=re,this.length=re.length}function Ie(re,N){this.id=typeof re.id=="number"?re.id:void 0,this.type=re.type,this.rawGeometry=re.type===1?[re.geometry]:re.geometry,this.properties=re.tags,this.extent=N||4096}Se.prototype.feature=function(re){return new Ie(this.features[re],this.options.extent)},Ie.prototype.loadGeometry=function(){var re=this.rawGeometry;this.geometry=[];for(var N=0;N<re.length;N++){for(var V=re[N],ee=[],oe=0;oe<V.length;oe++)ee.push(new s.pointGeometry(V[oe][0],V[oe][1]));this.geometry.push(ee)}return this.geometry},Ie.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var re=this.geometry,N=1/0,V=-1/0,ee=1/0,oe=-1/0,_e=0;_e<re.length;_e++)for(var we=re[_e],xe=0;xe<we.length;xe++){var ge=we[xe];N=Math.min(N,ge.x),V=Math.max(V,ge.x),ee=Math.min(ee,ge.y),oe=Math.max(oe,ge.y)}return[N,ee,V,oe]},Ie.prototype.toGeoJSON=Ce.prototype.toGeoJSON;var We=Te,mt=De;function Te(re){var N=new s.pbf;return function(V,ee){for(var oe in V.layers)ee.writeMessage(3,Ue,V.layers[oe])}(re,N),N.finish()}function Ue(re,N){var V;N.writeVarintField(15,re.version||1),N.writeStringField(1,re.name||""),N.writeVarintField(5,re.extent||4096);var ee={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<re.length;V++)ee.feature=re.feature(V),N.writeMessage(2,Xe,ee);var oe=ee.keys;for(V=0;V<oe.length;V++)N.writeStringField(3,oe[V]);var _e=ee.values;for(V=0;V<_e.length;V++)N.writeMessage(4,Kt,_e[V])}function Xe(re,N){var V=re.feature;V.id!==void 0&&N.writeVarintField(1,V.id),N.writeMessage(2,tt,re),N.writeVarintField(3,V.type),N.writeMessage(4,zr,V)}function tt(re,N){var V=re.feature,ee=re.keys,oe=re.values,_e=re.keycache,we=re.valuecache;for(var xe in V.properties){var ge=V.properties[xe],Ee=_e[xe];if(ge!==null){Ee===void 0&&(ee.push(xe),_e[xe]=Ee=ee.length-1),N.writeVarint(Ee);var Ge=typeof ge;Ge!=="string"&&Ge!=="boolean"&&Ge!=="number"&&(ge=JSON.stringify(ge));var ct=Ge+":"+ge,Qe=we[ct];Qe===void 0&&(oe.push(ge),we[ct]=Qe=oe.length-1),N.writeVarint(Qe)}}}function Dt(re,N){return(N<<3)+(7&re)}function Ft(re){return re<<1^re>>31}function zr(re,N){for(var V=re.loadGeometry(),ee=re.type,oe=0,_e=0,we=V.length,xe=0;xe<we;xe++){var ge=V[xe],Ee=1;ee===1&&(Ee=ge.length),N.writeVarint(Dt(1,Ee));for(var Ge=ee===3?ge.length-1:ge.length,ct=0;ct<Ge;ct++){ct===1&&ee!==1&&N.writeVarint(Dt(2,Ge-1));var Qe=ge[ct].x-oe,Et=ge[ct].y-_e;N.writeVarint(Ft(Qe)),N.writeVarint(Ft(Et)),oe+=Qe,_e+=Et}ee===3&&N.writeVarint(Dt(7,1))}}function Kt(re,N){var V=typeof re;V==="string"?N.writeStringField(1,re):V==="boolean"?N.writeBooleanField(7,re):V==="number"&&(re%1!=0?N.writeDoubleField(3,re):re<0?N.writeSVarintField(6,re):N.writeVarintField(5,re))}function Rr(re,N,V,ee,oe,_e){if(oe-ee<=V)return;const we=ee+oe>>1;Wr(re,N,we,ee,oe,_e%2),Rr(re,N,V,ee,we-1,_e+1),Rr(re,N,V,we+1,oe,_e+1)}function Wr(re,N,V,ee,oe,_e){for(;oe>ee;){if(oe-ee>600){const Ee=oe-ee+1,Ge=V-ee+1,ct=Math.log(Ee),Qe=.5*Math.exp(2*ct/3),Et=.5*Math.sqrt(ct*Qe*(Ee-Qe)/Ee)*(Ge-Ee/2<0?-1:1);Wr(re,N,V,Math.max(ee,Math.floor(V-Ge*Qe/Ee+Et)),Math.min(oe,Math.floor(V+(Ee-Ge)*Qe/Ee+Et)),_e)}const we=N[2*V+_e];let xe=ee,ge=oe;for(xr(re,N,ee,V),N[2*oe+_e]>we&&xr(re,N,ee,oe);xe<ge;){for(xr(re,N,xe,ge),xe++,ge--;N[2*xe+_e]<we;)xe++;for(;N[2*ge+_e]>we;)ge--}N[2*ee+_e]===we?xr(re,N,ee,ge):(ge++,xr(re,N,ge,oe)),ge<=V&&(ee=ge+1),V<=ge&&(oe=ge-1)}}function xr(re,N,V,ee){Ht(re,V,ee),Ht(N,2*V,2*ee),Ht(N,2*V+1,2*ee+1)}function Ht(re,N,V){const ee=re[N];re[N]=re[V],re[V]=ee}function Br(re,N,V,ee){const oe=re-V,_e=N-ee;return oe*oe+_e*_e}We.fromVectorTileJs=Te,We.fromGeojsonVt=function(re,N){N=N||{};var V={};for(var ee in re)V[ee]=new De(re[ee].features,N),V[ee].name=ee,V[ee].version=N.version,V[ee].extent=N.extent;return Te({layers:V})},We.GeoJSONWrapper=mt;const wr=re=>re[0],hr=re=>re[1];class kr{constructor(N,V=wr,ee=hr,oe=64,_e=Float64Array){this.nodeSize=oe,this.points=N;const we=N.length<65536?Uint16Array:Uint32Array,xe=this.ids=new we(N.length),ge=this.coords=new _e(2*N.length);for(let Ee=0;Ee<N.length;Ee++)xe[Ee]=Ee,ge[2*Ee]=V(N[Ee]),ge[2*Ee+1]=ee(N[Ee]);Rr(xe,ge,oe,0,xe.length-1,0)}range(N,V,ee,oe){return function(_e,we,xe,ge,Ee,Ge,ct){const Qe=[0,_e.length-1,0],Et=[];let At,yt;for(;Qe.length;){const Pt=Qe.pop(),Nt=Qe.pop(),sr=Qe.pop();if(Nt-sr<=ct){for(let Tt=sr;Tt<=Nt;Tt++)At=we[2*Tt],yt=we[2*Tt+1],At>=xe&&At<=Ee&&yt>=ge&&yt<=Ge&&Et.push(_e[Tt]);continue}const fr=Math.floor((sr+Nt)/2);At=we[2*fr],yt=we[2*fr+1],At>=xe&&At<=Ee&&yt>=ge&&yt<=Ge&&Et.push(_e[fr]);const ar=(Pt+1)%2;(Pt===0?xe<=At:ge<=yt)&&(Qe.push(sr),Qe.push(fr-1),Qe.push(ar)),(Pt===0?Ee>=At:Ge>=yt)&&(Qe.push(fr+1),Qe.push(Nt),Qe.push(ar))}return Et}(this.ids,this.coords,N,V,ee,oe,this.nodeSize)}within(N,V,ee){return function(oe,_e,we,xe,ge,Ee){const Ge=[0,oe.length-1,0],ct=[],Qe=ge*ge;for(;Ge.length;){const Et=Ge.pop(),At=Ge.pop(),yt=Ge.pop();if(At-yt<=Ee){for(let ar=yt;ar<=At;ar++)Br(_e[2*ar],_e[2*ar+1],we,xe)<=Qe&&ct.push(oe[ar]);continue}const Pt=Math.floor((yt+At)/2),Nt=_e[2*Pt],sr=_e[2*Pt+1];Br(Nt,sr,we,xe)<=Qe&&ct.push(oe[Pt]);const fr=(Et+1)%2;(Et===0?we-ge<=Nt:xe-ge<=sr)&&(Ge.push(yt),Ge.push(Pt-1),Ge.push(fr)),(Et===0?we+ge>=Nt:xe+ge>=sr)&&(Ge.push(Pt+1),Ge.push(At),Ge.push(fr))}return ct}(this.ids,this.coords,N,V,ee,this.nodeSize)}}const Yr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:re=>re},oi=Math.fround||(Ci=new Float32Array(1),re=>(Ci[0]=+re,Ci[0]));var Ci;class Fe{constructor(N){this.options=er(Object.create(Yr),N),this.trees=new Array(this.options.maxZoom+1)}load(N){const{log:V,minZoom:ee,maxZoom:oe,nodeSize:_e}=this.options;V&&console.time("total time");const we=`prepare ${N.length} points`;V&&console.time(we),this.points=N;let xe=[];for(let ge=0;ge<N.length;ge++)N[ge].geometry&&xe.push($e(N[ge],ge));this.trees[oe+1]=new kr(xe,mr,br,_e,Float32Array),V&&console.timeEnd(we);for(let ge=oe;ge>=ee;ge--){const Ee=+Date.now();xe=this._cluster(xe,ge),this.trees[ge]=new kr(xe,mr,br,_e,Float32Array),V&&console.log("z%d: %d clusters in %dms",ge,xe.length,+Date.now()-Ee)}return V&&console.timeEnd("total time"),this}getClusters(N,V){let ee=((N[0]+180)%360+360)%360-180;const oe=Math.max(-90,Math.min(90,N[1]));let _e=N[2]===180?180:((N[2]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,N[3]));if(N[2]-N[0]>=360)ee=-180,_e=180;else if(ee>_e){const Ge=this.getClusters([ee,oe,180,we],V),ct=this.getClusters([-180,oe,_e,we],V);return Ge.concat(ct)}const xe=this.trees[this._limitZoom(V)],ge=xe.range(vt(ee),St(we),vt(_e),St(oe)),Ee=[];for(const Ge of ge){const ct=xe.points[Ge];Ee.push(ct.numPoints?Ye(ct):this.points[ct.index])}return Ee}getChildren(N){const V=this._getOriginId(N),ee=this._getOriginZoom(N),oe="No cluster with the specified id.",_e=this.trees[ee];if(!_e)throw new Error(oe);const we=_e.points[V];if(!we)throw new Error(oe);const xe=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),ge=_e.within(we.x,we.y,xe),Ee=[];for(const Ge of ge){const ct=_e.points[Ge];ct.parentId===N&&Ee.push(ct.numPoints?Ye(ct):this.points[ct.index])}if(Ee.length===0)throw new Error(oe);return Ee}getLeaves(N,V,ee){const oe=[];return this._appendLeaves(oe,N,V=V||10,ee=ee||0,0),oe}getTile(N,V,ee){const oe=this.trees[this._limitZoom(N)],_e=Math.pow(2,N),{extent:we,radius:xe}=this.options,ge=xe/we,Ee=(ee-ge)/_e,Ge=(ee+1+ge)/_e,ct={features:[]};return this._addTileFeatures(oe.range((V-ge)/_e,Ee,(V+1+ge)/_e,Ge),oe.points,V,ee,_e,ct),V===0&&this._addTileFeatures(oe.range(1-ge/_e,Ee,1,Ge),oe.points,_e,ee,_e,ct),V===_e-1&&this._addTileFeatures(oe.range(0,Ee,ge/_e,Ge),oe.points,-1,ee,_e,ct),ct.features.length?ct:null}getClusterExpansionZoom(N){let V=this._getOriginZoom(N)-1;for(;V<=this.options.maxZoom;){const ee=this.getChildren(N);if(V++,ee.length!==1)break;N=ee[0].properties.cluster_id}return V}_appendLeaves(N,V,ee,oe,_e){const we=this.getChildren(V);for(const xe of we){const ge=xe.properties;if(ge&&ge.cluster?_e+ge.point_count<=oe?_e+=ge.point_count:_e=this._appendLeaves(N,ge.cluster_id,ee,oe,_e):_e<oe?_e++:N.push(xe),N.length===ee)break}return _e}_addTileFeatures(N,V,ee,oe,_e,we){for(const xe of N){const ge=V[xe],Ee=ge.numPoints;let Ge,ct,Qe;if(Ee)Ge=dt(ge),ct=ge.x,Qe=ge.y;else{const yt=this.points[ge.index];Ge=yt.properties,ct=vt(yt.geometry.coordinates[0]),Qe=St(yt.geometry.coordinates[1])}const Et={type:1,geometry:[[Math.round(this.options.extent*(ct*_e-ee)),Math.round(this.options.extent*(Qe*_e-oe))]],tags:Ge};let At;Ee?At=ge.id:this.options.generateId?At=ge.index:this.points[ge.index].id&&(At=this.points[ge.index].id),At!==void 0&&(Et.id=At),we.features.push(Et)}}_limitZoom(N){return Math.max(this.options.minZoom,Math.min(+N,this.options.maxZoom+1))}_cluster(N,V){const ee=[],{radius:oe,extent:_e,reduce:we,minPoints:xe}=this.options,ge=oe/(_e*Math.pow(2,V));for(let Ee=0;Ee<N.length;Ee++){const Ge=N[Ee];if(Ge.zoom<=V)continue;Ge.zoom=V;const ct=this.trees[V+1],Qe=ct.within(Ge.x,Ge.y,ge),Et=Ge.numPoints||1;let At=Et;for(const yt of Qe){const Pt=ct.points[yt];Pt.zoom>V&&(At+=Pt.numPoints||1)}if(At>Et&&At>=xe){let yt=Ge.x*Et,Pt=Ge.y*Et,Nt=we&&Et>1?this._map(Ge,!0):null;const sr=(Ee<<5)+(V+1)+this.points.length;for(const fr of Qe){const ar=ct.points[fr];if(ar.zoom<=V)continue;ar.zoom=V;const Tt=ar.numPoints||1;yt+=ar.x*Tt,Pt+=ar.y*Tt,ar.parentId=sr,we&&(Nt||(Nt=this._map(Ge,!0)),we(Nt,this._map(ar)))}Ge.parentId=sr,ee.push(He(yt/At,Pt/At,sr,At,Nt))}else if(ee.push(Ge),At>1)for(const yt of Qe){const Pt=ct.points[yt];Pt.zoom<=V||(Pt.zoom=V,ee.push(Pt))}}return ee}_getOriginId(N){return N-this.points.length>>5}_getOriginZoom(N){return(N-this.points.length)%32}_map(N,V){if(N.numPoints)return V?er({},N.properties):N.properties;const ee=this.points[N.index].properties,oe=this.options.map(ee);return V&&oe===ee?er({},oe):oe}}function He(re,N,V,ee,oe){return{x:oi(re),y:oi(N),zoom:1/0,id:V,parentId:-1,numPoints:ee,properties:oe}}function $e(re,N){const[V,ee]=re.geometry.coordinates;return{x:oi(vt(V)),y:oi(St(ee)),zoom:1/0,index:N,parentId:-1}}function Ye(re){return{type:"Feature",id:re.id,properties:dt(re),geometry:{type:"Point",coordinates:[(N=re.x,360*(N-.5)),lt(re.y)]}};var N}function dt(re){const N=re.numPoints,V=N>=1e4?`${Math.round(N/1e3)}k`:N>=1e3?Math.round(N/100)/10+"k":N;return er(er({},re.properties),{cluster:!0,cluster_id:re.id,point_count:N,point_count_abbreviated:V})}function vt(re){return re/360+.5}function St(re){const N=Math.sin(re*Math.PI/180),V=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return V<0?0:V>1?1:V}function lt(re){const N=(180-360*re)*Math.PI/180;return 360*Math.atan(Math.exp(N))/Math.PI-90}function er(re,N){for(const V in N)re[V]=N[V];return re}function mr(re){return re.x}function br(re){return re.y}function Ar(re,N,V,ee){for(var oe,_e=ee,we=V-N>>1,xe=V-N,ge=re[N],Ee=re[N+1],Ge=re[V],ct=re[V+1],Qe=N+3;Qe<V;Qe+=3){var Et=$r(re[Qe],re[Qe+1],ge,Ee,Ge,ct);if(Et>_e)oe=Qe,_e=Et;else if(Et===_e){var At=Math.abs(Qe-we);At<xe&&(oe=Qe,xe=At)}}_e>ee&&(oe-N>3&&Ar(re,N,oe,ee),re[oe+2]=_e,V-oe>3&&Ar(re,oe,V,ee))}function $r(re,N,V,ee,oe,_e){var we=oe-V,xe=_e-ee;if(we!==0||xe!==0){var ge=((re-V)*we+(N-ee)*xe)/(we*we+xe*xe);ge>1?(V=oe,ee=_e):ge>0&&(V+=we*ge,ee+=xe*ge)}return(we=re-V)*we+(xe=N-ee)*xe}function Rt(re,N,V,ee){var oe={id:re===void 0?null:re,type:N,geometry:V,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(_e){var we=_e.geometry,xe=_e.type;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")ir(_e,we);else if(xe==="Polygon"||xe==="MultiLineString")for(var ge=0;ge<we.length;ge++)ir(_e,we[ge]);else if(xe==="MultiPolygon")for(ge=0;ge<we.length;ge++)for(var Ee=0;Ee<we[ge].length;Ee++)ir(_e,we[ge][Ee])}(oe),oe}function ir(re,N){for(var V=0;V<N.length;V+=3)re.minX=Math.min(re.minX,N[V]),re.minY=Math.min(re.minY,N[V+1]),re.maxX=Math.max(re.maxX,N[V]),re.maxY=Math.max(re.maxY,N[V+1])}function Pr(re,N,V,ee){if(N.geometry){var oe=N.geometry.coordinates,_e=N.geometry.type,we=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2),xe=[],ge=N.id;if(V.promoteId?ge=N.properties[V.promoteId]:V.generateId&&(ge=ee||0),_e==="Point")ti(oe,xe);else if(_e==="MultiPoint")for(var Ee=0;Ee<oe.length;Ee++)ti(oe[Ee],xe);else if(_e==="LineString")ri(oe,xe,we,!1);else if(_e==="MultiLineString"){if(V.lineMetrics){for(Ee=0;Ee<oe.length;Ee++)ri(oe[Ee],xe=[],we,!1),re.push(Rt(ge,"LineString",xe,N.properties));return}an(oe,xe,we,!1)}else if(_e==="Polygon")an(oe,xe,we,!0);else{if(_e!=="MultiPolygon"){if(_e==="GeometryCollection"){for(Ee=0;Ee<N.geometry.geometries.length;Ee++)Pr(re,{id:ge,geometry:N.geometry.geometries[Ee],properties:N.properties},V,ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ee=0;Ee<oe.length;Ee++){var Ge=[];an(oe[Ee],Ge,we,!0),xe.push(Ge)}}re.push(Rt(ge,_e,xe,N.properties))}}function ti(re,N){N.push(Dr(re[0])),N.push(or(re[1])),N.push(0)}function ri(re,N,V,ee){for(var oe,_e,we=0,xe=0;xe<re.length;xe++){var ge=Dr(re[xe][0]),Ee=or(re[xe][1]);N.push(ge),N.push(Ee),N.push(0),xe>0&&(we+=ee?(oe*Ee-ge*_e)/2:Math.sqrt(Math.pow(ge-oe,2)+Math.pow(Ee-_e,2))),oe=ge,_e=Ee}var Ge=N.length-3;N[2]=1,Ar(N,0,Ge,V),N[Ge+2]=1,N.size=Math.abs(we),N.start=0,N.end=N.size}function an(re,N,V,ee){for(var oe=0;oe<re.length;oe++){var _e=[];ri(re[oe],_e,V,ee),N.push(_e)}}function Dr(re){return re/360+.5}function or(re){var N=Math.sin(re*Math.PI/180),V=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return V<0?0:V>1?1:V}function jr(re,N,V,ee,oe,_e,we,xe){if(ee/=N,_e>=(V/=N)&&we<ee)return re;if(we<V||_e>=ee)return null;for(var ge=[],Ee=0;Ee<re.length;Ee++){var Ge=re[Ee],ct=Ge.geometry,Qe=Ge.type,Et=oe===0?Ge.minX:Ge.minY,At=oe===0?Ge.maxX:Ge.maxY;if(Et>=V&&At<ee)ge.push(Ge);else if(!(At<V||Et>=ee)){var yt=[];if(Qe==="Point"||Qe==="MultiPoint")ii(ct,yt,V,ee,oe);else if(Qe==="LineString")zi(ct,yt,V,ee,oe,!1,xe.lineMetrics);else if(Qe==="MultiLineString")si(ct,yt,V,ee,oe,!1);else if(Qe==="Polygon")si(ct,yt,V,ee,oe,!0);else if(Qe==="MultiPolygon")for(var Pt=0;Pt<ct.length;Pt++){var Nt=[];si(ct[Pt],Nt,V,ee,oe,!0),Nt.length&&yt.push(Nt)}if(yt.length){if(xe.lineMetrics&&Qe==="LineString"){for(Pt=0;Pt<yt.length;Pt++)ge.push(Rt(Ge.id,Qe,yt[Pt],Ge.tags));continue}Qe!=="LineString"&&Qe!=="MultiLineString"||(yt.length===1?(Qe="LineString",yt=yt[0]):Qe="MultiLineString"),Qe!=="Point"&&Qe!=="MultiPoint"||(Qe=yt.length===3?"Point":"MultiPoint"),ge.push(Rt(Ge.id,Qe,yt,Ge.tags))}}}return ge.length?ge:null}function ii(re,N,V,ee,oe){for(var _e=0;_e<re.length;_e+=3){var we=re[_e+oe];we>=V&&we<=ee&&(N.push(re[_e]),N.push(re[_e+1]),N.push(re[_e+2]))}}function zi(re,N,V,ee,oe,_e,we){for(var xe,ge,Ee=gn(re),Ge=oe===0?$o:Is,ct=re.start,Qe=0;Qe<re.length-3;Qe+=3){var Et=re[Qe],At=re[Qe+1],yt=re[Qe+2],Pt=re[Qe+3],Nt=re[Qe+4],sr=oe===0?Et:At,fr=oe===0?Pt:Nt,ar=!1;we&&(xe=Math.sqrt(Math.pow(Et-Pt,2)+Math.pow(At-Nt,2))),sr<V?fr>V&&(ge=Ge(Ee,Et,At,Pt,Nt,V),we&&(Ee.start=ct+xe*ge)):sr>ee?fr<ee&&(ge=Ge(Ee,Et,At,Pt,Nt,ee),we&&(Ee.start=ct+xe*ge)):Ni(Ee,Et,At,yt),fr<V&&sr>=V&&(ge=Ge(Ee,Et,At,Pt,Nt,V),ar=!0),fr>ee&&sr<=ee&&(ge=Ge(Ee,Et,At,Pt,Nt,ee),ar=!0),!_e&&ar&&(we&&(Ee.end=ct+xe*ge),N.push(Ee),Ee=gn(re)),we&&(ct+=xe)}var Tt=re.length-3;Et=re[Tt],At=re[Tt+1],yt=re[Tt+2],(sr=oe===0?Et:At)>=V&&sr<=ee&&Ni(Ee,Et,At,yt),Tt=Ee.length-3,_e&&Tt>=3&&(Ee[Tt]!==Ee[0]||Ee[Tt+1]!==Ee[1])&&Ni(Ee,Ee[0],Ee[1],Ee[2]),Ee.length&&N.push(Ee)}function gn(re){var N=[];return N.size=re.size,N.start=re.start,N.end=re.end,N}function si(re,N,V,ee,oe,_e){for(var we=0;we<re.length;we++)zi(re[we],N,V,ee,oe,_e,!1)}function Ni(re,N,V,ee){re.push(N),re.push(V),re.push(ee)}function $o(re,N,V,ee,oe,_e){var we=(_e-N)/(ee-N);return re.push(_e),re.push(V+(oe-V)*we),re.push(1),we}function Is(re,N,V,ee,oe,_e){var we=(_e-V)/(oe-V);return re.push(N+(ee-N)*we),re.push(_e),re.push(1),we}function Ms(re,N){for(var V=[],ee=0;ee<re.length;ee++){var oe,_e=re[ee],we=_e.type;if(we==="Point"||we==="MultiPoint"||we==="LineString")oe=Cs(_e.geometry,N);else if(we==="MultiLineString"||we==="Polygon"){oe=[];for(var xe=0;xe<_e.geometry.length;xe++)oe.push(Cs(_e.geometry[xe],N))}else if(we==="MultiPolygon")for(oe=[],xe=0;xe<_e.geometry.length;xe++){for(var ge=[],Ee=0;Ee<_e.geometry[xe].length;Ee++)ge.push(Cs(_e.geometry[xe][Ee],N));oe.push(ge)}V.push(Rt(_e.id,we,oe,_e.tags))}return V}function Cs(re,N){var V=[];V.size=re.size,re.start!==void 0&&(V.start=re.start,V.end=re.end);for(var ee=0;ee<re.length;ee+=3)V.push(re[ee]+N,re[ee+1],re[ee+2]);return V}function zs(re,N){if(re.transformed)return re;var V,ee,oe,_e=1<<re.z,we=re.x,xe=re.y;for(V=0;V<re.features.length;V++){var ge=re.features[V],Ee=ge.geometry,Ge=ge.type;if(ge.geometry=[],Ge===1)for(ee=0;ee<Ee.length;ee+=2)ge.geometry.push(za(Ee[ee],Ee[ee+1],N,_e,we,xe));else for(ee=0;ee<Ee.length;ee++){var ct=[];for(oe=0;oe<Ee[ee].length;oe+=2)ct.push(za(Ee[ee][oe],Ee[ee][oe+1],N,_e,we,xe));ge.geometry.push(ct)}}return re.transformed=!0,re}function za(re,N,V,ee,oe,_e){return[Math.round(V*(re*ee-oe)),Math.round(V*(N*ee-_e))]}function Ra(re,N,V,ee,oe){for(var _e=N===oe.maxZoom?0:oe.tolerance/((1<<N)*oe.extent),we={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:V,y:ee,z:N,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},xe=0;xe<re.length;xe++){we.numFeatures++,rc(we,re[xe],_e,oe);var ge=re[xe].minX,Ee=re[xe].minY,Ge=re[xe].maxX,ct=re[xe].maxY;ge<we.minX&&(we.minX=ge),Ee<we.minY&&(we.minY=Ee),Ge>we.maxX&&(we.maxX=Ge),ct>we.maxY&&(we.maxY=ct)}return we}function rc(re,N,V,ee){var oe=N.geometry,_e=N.type,we=[];if(_e==="Point"||_e==="MultiPoint")for(var xe=0;xe<oe.length;xe+=3)we.push(oe[xe]),we.push(oe[xe+1]),re.numPoints++,re.numSimplified++;else if(_e==="LineString")Vn(we,oe,re,V,!1,!1);else if(_e==="MultiLineString"||_e==="Polygon")for(xe=0;xe<oe.length;xe++)Vn(we,oe[xe],re,V,_e==="Polygon",xe===0);else if(_e==="MultiPolygon")for(var ge=0;ge<oe.length;ge++){var Ee=oe[ge];for(xe=0;xe<Ee.length;xe++)Vn(we,Ee[xe],re,V,!0,xe===0)}if(we.length){var Ge=N.tags||null;if(_e==="LineString"&&ee.lineMetrics){for(var ct in Ge={},N.tags)Ge[ct]=N.tags[ct];Ge.mapbox_clip_start=oe.start/oe.size,Ge.mapbox_clip_end=oe.end/oe.size}var Qe={geometry:we,type:_e==="Polygon"||_e==="MultiPolygon"?3:_e==="LineString"||_e==="MultiLineString"?2:1,tags:Ge};N.id!==null&&(Qe.id=N.id),re.features.push(Qe)}}function Vn(re,N,V,ee,oe,_e){var we=ee*ee;if(ee>0&&N.size<(oe?we:ee))V.numPoints+=N.length/3;else{for(var xe=[],ge=0;ge<N.length;ge+=3)(ee===0||N[ge+2]>we)&&(V.numSimplified++,xe.push(N[ge]),xe.push(N[ge+1])),V.numPoints++;oe&&function(Ee,Ge){for(var ct=0,Qe=0,Et=Ee.length,At=Et-2;Qe<Et;At=Qe,Qe+=2)ct+=(Ee[Qe]-Ee[At])*(Ee[Qe+1]+Ee[At+1]);if(ct>0===Ge)for(Qe=0,Et=Ee.length;Qe<Et/2;Qe+=2){var yt=Ee[Qe],Pt=Ee[Qe+1];Ee[Qe]=Ee[Et-2-Qe],Ee[Qe+1]=Ee[Et-1-Qe],Ee[Et-2-Qe]=yt,Ee[Et-1-Qe]=Pt}}(xe,_e),re.push(xe)}}function Sn(re,N){var V=(N=this.options=function(oe,_e){for(var we in _e)oe[we]=_e[we];return oe}(Object.create(this.options),N)).debug;if(V&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");var ee=function(oe,_e){var we=[];if(oe.type==="FeatureCollection")for(var xe=0;xe<oe.features.length;xe++)Pr(we,oe.features[xe],_e,xe);else Pr(we,oe.type==="Feature"?oe:{geometry:oe},_e);return we}(re,N);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ee=function(oe,_e){var we=_e.buffer/_e.extent,xe=oe,ge=jr(oe,1,-1-we,we,0,-1,2,_e),Ee=jr(oe,1,1-we,2+we,0,-1,2,_e);return(ge||Ee)&&(xe=jr(oe,1,-we,1+we,0,-1,2,_e)||[],ge&&(xe=Ms(ge,1).concat(xe)),Ee&&(xe=xe.concat(Ms(Ee,-1)))),xe}(ee,N)).length&&this.splitTile(ee,0,0,0),V&&(ee.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Go(re,N,V){return 32*((1<<re)*V+N)+re}function ka(re,N){const V=re.tileID.canonical;if(!this._geoJSONIndex)return N(null,null);const ee=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!ee)return N(null,null);const oe=new ve(ee.features);let _e=We(oe);_e.byteOffset===0&&_e.byteLength===_e.buffer.byteLength||(_e=new Uint8Array(_e)),N(null,{vectorTile:oe,rawData:_e.buffer})}Sn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Sn.prototype.splitTile=function(re,N,V,ee,oe,_e,we){for(var xe=[re,N,V,ee],ge=this.options,Ee=ge.debug;xe.length;){ee=xe.pop(),V=xe.pop(),N=xe.pop(),re=xe.pop();var Ge=1<<N,ct=Go(N,V,ee),Qe=this.tiles[ct];if(!Qe&&(Ee>1&&console.time("creation"),Qe=this.tiles[ct]=Ra(re,N,V,ee,ge),this.tileCoords.push({z:N,x:V,y:ee}),Ee)){Ee>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,V,ee,Qe.numFeatures,Qe.numPoints,Qe.numSimplified),console.timeEnd("creation"));var Et="z"+N;this.stats[Et]=(this.stats[Et]||0)+1,this.total++}if(Qe.source=re,oe){if(N===ge.maxZoom||N===oe)continue;var At=1<<oe-N;if(V!==Math.floor(_e/At)||ee!==Math.floor(we/At))continue}else if(N===ge.indexMaxZoom||Qe.numPoints<=ge.indexMaxPoints)continue;if(Qe.source=null,re.length!==0){Ee>1&&console.time("clipping");var yt,Pt,Nt,sr,fr,ar,Tt=.5*ge.buffer/ge.extent,ke=.5-Tt,Ui=.5+Tt,Nr=1+Tt;yt=Pt=Nt=sr=null,fr=jr(re,Ge,V-Tt,V+Ui,0,Qe.minX,Qe.maxX,ge),ar=jr(re,Ge,V+ke,V+Nr,0,Qe.minX,Qe.maxX,ge),re=null,fr&&(yt=jr(fr,Ge,ee-Tt,ee+Ui,1,Qe.minY,Qe.maxY,ge),Pt=jr(fr,Ge,ee+ke,ee+Nr,1,Qe.minY,Qe.maxY,ge),fr=null),ar&&(Nt=jr(ar,Ge,ee-Tt,ee+Ui,1,Qe.minY,Qe.maxY,ge),sr=jr(ar,Ge,ee+ke,ee+Nr,1,Qe.minY,Qe.maxY,ge),ar=null),Ee>1&&console.timeEnd("clipping"),xe.push(yt||[],N+1,2*V,2*ee),xe.push(Pt||[],N+1,2*V,2*ee+1),xe.push(Nt||[],N+1,2*V+1,2*ee),xe.push(sr||[],N+1,2*V+1,2*ee+1)}}},Sn.prototype.getTile=function(re,N,V){var ee=this.options,oe=ee.extent,_e=ee.debug;if(re<0||re>24)return null;var we=1<<re,xe=Go(re,N=(N%we+we)%we,V);if(this.tiles[xe])return zs(this.tiles[xe],oe);_e>1&&console.log("drilling down to z%d-%d-%d",re,N,V);for(var ge,Ee=re,Ge=N,ct=V;!ge&&Ee>0;)Ee--,Ge=Math.floor(Ge/2),ct=Math.floor(ct/2),ge=this.tiles[Go(Ee,Ge,ct)];return ge&&ge.source?(_e>1&&console.log("found parent tile z%d-%d-%d",Ee,Ge,ct),_e>1&&console.time("drilling down"),this.splitTile(ge.source,Ee,Ge,ct,re,N,V),_e>1&&console.timeEnd("drilling down"),this.tiles[xe]?zs(this.tiles[xe],oe):null):null};class Ri extends s.VectorTileWorkerSource{constructor(N,V,ee,oe,_e){super(N,V,ee,oe,ka),_e&&(this.loadGeoJSON=_e)}loadData(N,V){const ee=N&&N.request,oe=ee&&ee.collectResourceTiming;this.loadGeoJSON(N,(_e,we)=>{if(_e||!we)return V(_e);if(typeof we!="object")return V(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`));{F(we,!0);try{if(N.filter){const ge=s.createExpression(N.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ge.result==="error")throw new Error(ge.value.map(Ge=>`${Ge.key}: ${Ge.message}`).join(", "));const Ee=we.features.filter(Ge=>ge.value.evaluate({zoom:0},Ge));we={type:"FeatureCollection",features:Ee}}this._geoJSONIndex=N.cluster?new Fe(function({superclusterOptions:ge,clusterProperties:Ee}){if(!Ee||!ge)return ge;const Ge={},ct={},Qe={accumulated:null,zoom:0},Et={properties:null},At=Object.keys(Ee);for(const yt of At){const[Pt,Nt]=Ee[yt],sr=s.createExpression(Nt),fr=s.createExpression(typeof Pt=="string"?[Pt,["accumulated"],["get",yt]]:Pt);Ge[yt]=sr.value,ct[yt]=fr.value}return ge.map=yt=>{Et.properties=yt;const Pt={};for(const Nt of At)Pt[Nt]=Ge[Nt].evaluate(Qe,Et);return Pt},ge.reduce=(yt,Pt)=>{Et.properties=Pt;for(const Nt of At)Qe.accumulated=yt[Nt],yt[Nt]=ct[Nt].evaluate(Qe,Et)},ge}(N)).load(we.features):function(ge,Ee){return new Sn(ge,Ee)}(we,N.geojsonVtOptions)}catch(ge){return V(ge)}this.loaded={};const xe={};if(oe){const ge=s.getPerformanceMeasurement(ee);ge&&(xe.resourceTiming={},xe.resourceTiming[N.source]=JSON.parse(JSON.stringify(ge)))}V(null,xe)}})}reloadTile(N,V){const ee=this.loaded;return ee&&ee[N.uid]?super.reloadTile(N,V):this.loadTile(N,V)}loadGeoJSON(N,V){if(N.request)s.getJSON(N.request,V);else{if(typeof N.data!="string")return V(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`));try{return V(null,JSON.parse(N.data))}catch{return V(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(N,V){try{V(null,this._geoJSONIndex.getClusterExpansionZoom(N.clusterId))}catch(ee){V(ee)}}getClusterChildren(N,V){try{V(null,this._geoJSONIndex.getChildren(N.clusterId))}catch(ee){V(ee)}}getClusterLeaves(N,V){try{V(null,this._geoJSONIndex.getLeaves(N.clusterId,N.limit,N.offset))}catch(ee){V(ee)}}}class Rs{constructor(N){this.self=N,this.actor=new s.Actor(N,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.getProjection({name:"mercator"}),this.workerSourceTypes={vector:s.VectorTileWorkerSource,geojson:Ri},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(V,ee)=>{if(this.workerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.workerSourceTypes[V]=ee},this.self.registerRTLTextPlugin=V=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=V.applyArabicShaping,s.plugin.processBidirectionalText=V.processBidirectionalText,s.plugin.processStyledBidirectionalText=V.processStyledBidirectionalText}}clearCaches(N,V,ee){delete this.layerIndexes[N],delete this.availableImages[N],delete this.workerSources[N],delete this.demWorkerSources[N],ee()}checkIfReady(N,V,ee){ee()}setReferrer(N,V){this.referrer=V}spriteLoaded(N,V){this.isSpriteLoaded[N]=V;for(const ee in this.workerSources[N]){const oe=this.workerSources[N][ee];for(const _e in oe)oe[_e]instanceof s.VectorTileWorkerSource&&(oe[_e].isSpriteLoaded=V,oe[_e].fire(new s.Event("isSpriteLoaded")))}}setImages(N,V,ee){this.availableImages[N]=V;for(const oe in this.workerSources[N]){const _e=this.workerSources[N][oe];for(const we in _e)_e[we].availableImages=V}ee()}enableTerrain(N,V,ee){this.terrain=V,ee()}setProjection(N,V){this.projections[N]=s.getProjection(V)}setLayers(N,V,ee){this.getLayerIndex(N).replace(V),ee()}updateLayers(N,V,ee){this.getLayerIndex(N).update(V.layers,V.removedIds),ee()}loadTile(N,V,ee){const oe=this.enableTerrain?s.extend({enableTerrain:this.terrain},V):V;oe.projection=this.projections[N]||this.defaultProjection,this.getWorkerSource(N,V.type,V.source).loadTile(oe,ee)}loadDEMTile(N,V,ee){const oe=this.enableTerrain?s.extend({buildQuadTree:this.terrain},V):V;this.getDEMWorkerSource(N,V.source).loadTile(oe,ee)}reloadTile(N,V,ee){const oe=this.enableTerrain?s.extend({enableTerrain:this.terrain},V):V;oe.projection=this.projections[N]||this.defaultProjection,this.getWorkerSource(N,V.type,V.source).reloadTile(oe,ee)}abortTile(N,V,ee){this.getWorkerSource(N,V.type,V.source).abortTile(V,ee)}removeTile(N,V,ee){this.getWorkerSource(N,V.type,V.source).removeTile(V,ee)}removeSource(N,V,ee){if(!this.workerSources[N]||!this.workerSources[N][V.type]||!this.workerSources[N][V.type][V.source])return;const oe=this.workerSources[N][V.type][V.source];delete this.workerSources[N][V.type][V.source],oe.removeSource!==void 0?oe.removeSource(V,ee):ee()}loadWorkerSource(N,V,ee){try{this.self.importScripts(V.url),ee()}catch(oe){ee(oe.toString())}}syncRTLPluginState(N,V,ee){try{s.plugin.setState(V);const oe=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&oe!=null){this.self.importScripts(oe);const _e=s.plugin.isParsed();ee(_e?void 0:new Error(`RTL Text Plugin failed to import scripts from ${oe}`),_e)}}catch(oe){ee(oe.toString())}}getAvailableImages(N){let V=this.availableImages[N];return V||(V=[]),V}getLayerIndex(N){let V=this.layerIndexes[N];return V||(V=this.layerIndexes[N]=new z),V}getWorkerSource(N,V,ee){return this.workerSources[N]||(this.workerSources[N]={}),this.workerSources[N][V]||(this.workerSources[N][V]={}),this.workerSources[N][V][ee]||(this.workerSources[N][V][ee]=new this.workerSourceTypes[V]({send:(oe,_e,we,xe,ge,Ee)=>{this.actor.send(oe,_e,we,N,ge,Ee)},scheduler:this.actor.scheduler},this.getLayerIndex(N),this.getAvailableImages(N),this.isSpriteLoaded[N])),this.workerSources[N][V][ee]}getDEMWorkerSource(N,V){return this.demWorkerSources[N]||(this.demWorkerSources[N]={}),this.demWorkerSources[N][V]||(this.demWorkerSources[N][V]=new L),this.demWorkerSources[N][V]}enforceCacheSizeLimit(N,V){s.enforceCacheSizeLimit(V)}getWorkerPerformanceMetrics(N,V,ee){ee(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Rs(self)),Rs}),x(["./shared"],function(s){function A(f,n){if(Array.isArray(f)){if(!Array.isArray(n)||f.length!==n.length)return!1;for(let c=0;c<f.length;c++)if(!A(f[c],n[c]))return!1;return!0}if(typeof f=="object"&&f!==null&&n!==null){if(typeof n!="object"||Object.keys(f).length!==Object.keys(n).length)return!1;for(const c in f)if(!A(f[c],n[c]))return!1;return!0}return f===n}var M=z;function z(f){return!function(n){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,y,v=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(v);try{y=new Worker(T),p=!0}catch{p=!1}return y&&y.terminate(),URL.revokeObjectURL(T),p}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var p=document.createElement("canvas");p.width=p.height=1;var y=p.getContext("2d");if(!y)return!1;var v=y.getImageData(0,0,1,1);return v&&v.width===p.width}()?(L[c=n&&n.failIfMajorPerformanceCaveat]===void 0&&(L[c]=function(p){var y,v=function(T){var S=document.createElement("canvas"),I=Object.create(z.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=T,S.getContext("webgl",I)||S.getContext("experimental-webgl",I)}(p);if(!v)return!1;try{y=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!y||v.isContextLost())&&(v.shaderSource(y,"void main() {}"),v.compileShader(y),v.getShaderParameter(y,v.COMPILE_STATUS)===!0)}(c)),L[c]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var c}(f)}var L={};function F(f,n,c){const p=s.window.document.createElement(f);return n!==void 0&&(p.className=n),c&&c.appendChild(p),p}function j(f,n,c){const p=s.window.document.createElementNS("http://www.w3.org/2000/svg",f);for(const y of Object.keys(n))p.setAttributeNS(null,y,n[y]);return c&&c.appendChild(p),p}z.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const H=s.window.document&&s.window.document.documentElement.style,W=H&&H.userSelect!==void 0?"userSelect":"WebkitUserSelect";let he;function ve(){H&&W&&(he=H[W],H[W]="none")}function Ce(){H&&W&&(H[W]=he)}function De(f){f.preventDefault(),f.stopPropagation(),s.window.removeEventListener("click",De,!0)}function Se(){s.window.addEventListener("click",De,!0),s.window.setTimeout(()=>{s.window.removeEventListener("click",De,!0)},0)}function Ie(f,n){const c=f.getBoundingClientRect();return Te(f,c,n)}function We(f,n){const c=f.getBoundingClientRect(),p=[];for(let y=0;y<n.length;y++)p.push(Te(f,c,n[y]));return p}function mt(f){return s.window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function Te(f,n,c){const p=f.offsetWidth===n.width?1:f.offsetWidth/n.width;return new s.pointGeometry((c.clientX-n.left)*p,(c.clientY-n.top)*p)}function Ue(f,n){var c=n[0],p=n[1],y=n[2],v=n[3],T=c*v-y*p;return T?(f[0]=v*(T=1/T),f[1]=-p*T,f[2]=-y*T,f[3]=c*T,f):null}function Xe(f){const{userImage:n}=f;return!!(n&&n.render&&n.render())&&(f.data.replace(new Uint8Array(n.data.buffer)),!0)}class tt extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:c,callback:p}of this.requestors)this._notify(c,p);this.requestors=[]}}hasImage(n){return!!this.getImage(n)}getImage(n){return this.images[n]}addImage(n,c){this._validate(n,c)&&(this.images[n]=c)}_validate(n,c){let p=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),p=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),p=!1),this._validateContent(c.content,c)||(this.fire(new s.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),p=!1),p}_validateStretch(n,c){if(!n)return!0;let p=0;for(const y of n){if(y[0]<p||y[1]<y[0]||c<y[1])return!1;p=y[1]}return!0}_validateContent(n,c){return!(n&&(n.length!==4||n[0]<0||c.data.width<n[0]||n[1]<0||c.data.height<n[1]||n[2]<0||c.data.width<n[2]||n[3]<0||c.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,c){c.version=this.images[n].version+1,this.images[n]=c,this.updatedImages[n]=!0}removeImage(n){const c=this.images[n];delete this.images[n],delete this.patterns[n],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,c){let p=!0;if(!this.isLoaded())for(const y of n)this.images[y]||(p=!1);this.isLoaded()||p?this._notify(n,c):this.requestors.push({ids:n,callback:c})}_notify(n,c){const p={};for(const y of n){this.images[y]||this.fire(new s.Event("styleimagemissing",{id:y}));const v=this.images[y];v?p[y]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:Boolean(v.userImage&&v.userImage.render)}:s.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,p)}getPixelSize(){const{width:n,height:c}=this.atlasImage;return{width:n,height:c}}getPattern(n){const c=this.patterns[n],p=this.getImage(n);if(!p)return null;if(c&&c.position.version===p.version)return c.position;if(c)c.position.version=p.version;else{const y={w:p.data.width+2,h:p.data.height+2,x:0,y:0},v=new s.ImagePosition(y,p);this.patterns[n]={bin:y,position:v}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const c=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(n,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const v in this.patterns)n.push(this.patterns[v].bin);const{w:c,h:p}=s.potpack(n),y=this.atlasImage;y.resize({width:c||1,height:p||1});for(const v in this.patterns){const{bin:T}=this.patterns[v],S=T.x+1,I=T.y+1,k=this.images[v].data,D=k.width,U=k.height;s.RGBAImage.copy(k,y,{x:0,y:0},{x:S,y:I},{width:D,height:U}),s.RGBAImage.copy(k,y,{x:0,y:U-1},{x:S,y:I-1},{width:D,height:1}),s.RGBAImage.copy(k,y,{x:0,y:0},{x:S,y:I+U},{width:D,height:1}),s.RGBAImage.copy(k,y,{x:D-1,y:0},{x:S-1,y:I},{width:1,height:U}),s.RGBAImage.copy(k,y,{x:0,y:0},{x:S+D,y:I},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const c of n){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const p=this.images[c];Xe(p)&&this.updateImage(c,p)}}}const Dt=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(f,n){return function([c,p,y]){const v=s.degToRad(p+90),T=s.degToRad(y);return{x:c*Math.cos(v)*Math.sin(T),y:c*Math.sin(v)*Math.sin(T),z:c*Math.cos(T),azimuthal:p,polar:y}}(f.expression.evaluate(n))}interpolate(f,n,c){return{x:s.number(f.x,n.x,c),y:s.number(f.y,n.y,c),z:s.number(f.z,n.z,c),azimuthal:s.number(f.azimuthal,n.azimuthal,c),polar:s.number(f.polar,n.polar,c)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)}),Ft="-transition";class zr extends s.Evented{constructor(n){super(),this._transitionable=new s.Transitionable(Dt),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,c={}){if(!this._validate(s.validateLight,n,c))for(const p in n){const y=n[p];s.endsWith(p,Ft)?this._transitionable.setTransition(p.slice(0,-Ft.length),y):this._transitionable.setValue(p,y)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,p){return(!p||p.validate!==!1)&&s.emitValidationErrors(this,n.call(s.validateStyle,s.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}const Kt=new s.Properties({source:new s.DataConstantProperty(s.spec.terrain.source),exaggeration:new s.DataConstantProperty(s.spec.terrain.exaggeration)}),Rr="-transition";class Wr extends s.Evented{constructor(n,c){super(),this._transitionable=new s.Transitionable(Kt),this.set(n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(n){for(const c in n){const p=n[c];s.endsWith(c,Rr)?this._transitionable.setTransition(c.slice(0,-Rr.length),p):this._transitionable.setValue(c,p)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}}function xr(f,n,c,p){const y=s.smoothstep(45,65,c),[v,T]=Ht(f,p),S=s.length(n);let I=1-Math.min(1,Math.exp((S-v)/(T-v)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*y*f.alpha}function Ht(f,n){const c=.5/Math.tan(.5*n);return[f.range[0]+c,f.range[1]+c]}const Br=new s.Properties({range:new s.DataConstantProperty(s.spec.fog.range),color:new s.DataConstantProperty(s.spec.fog.color),"high-color":new s.DataConstantProperty(s.spec.fog["high-color"]),"space-color":new s.DataConstantProperty(s.spec.fog["space-color"]),"horizon-blend":new s.DataConstantProperty(s.spec.fog["horizon-blend"]),"star-intensity":new s.DataConstantProperty(s.spec.fog["star-intensity"])}),wr="-transition";class hr extends s.Evented{constructor(n,c){super(),this._transitionable=new s.Transitionable(Br),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){const n=this._transform,c=n.projection.name==="globe",p=s.globeToMercatorTransition(n.zoom),y=this.properties.get("range"),v=[.5,3];return{range:c?[s.number(v[0],y[0],p),s.number(v[1],y[1],p)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,c={}){if(!this._validate(s.validateFog,n,c)){for(const p of Object.keys(s.spec.fog))n&&n[p]===void 0&&(n[p]=s.spec.fog[p].default);for(const p in n){const y=n[p];s.endsWith(p,wr)?this._transitionable.setTransition(p.slice(0,-wr.length),y):this._transitionable.setValue(p,y)}}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.smoothstep(45,65,n))*c.a}getOpacityAtLatLng(n,c){return this._transform.projection.supportsFog?function(p,y,v){const T=s.MercatorCoordinate.fromLngLat(y),S=v.elevation?v.elevation.getAtPointOrZero(T):0,I=[T.x,T.y,S];return s.transformMat4(I,I,v.mercatorFogMatrix),xr(p,I,v.pitch,v._fov)}(this.state,n,c):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Ht(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,p){return(!p||p.validate!==!1)&&s.emitValidationErrors(this,n.call(s.validateStyle,s.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class kr{constructor(n,c){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const p=this.workerPool.acquire(this.id);for(let y=0;y<p.length;y++){const v=new kr.Actor(p[y],c,this.id);v.name=`Worker ${y}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,c,p){s.asyncAll(this.actors,(y,v)=>{y.send(n,c,v)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Yr(f,n,c){return n*(s.EXTENT/(f.tileSize*Math.pow(2,c-f.tileID.overscaledZ)))}kr.Actor=s.Actor;class oi{constructor(n,c,p,y){this.screenBounds=n,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,y)}static createFromScreenPoints(n,c){let p,y;if(n instanceof s.pointGeometry||typeof n[0]=="number"){const v=s.pointGeometry.convert(n);p=[s.pointGeometry.convert(n)],y=c.isPointAboveHorizon(v)}else{const v=s.pointGeometry.convert(n[0]),T=s.pointGeometry.convert(n[1]);p=[v,T],y=s.polygonizeBounds(v,T).every(S=>c.isPointAboveHorizon(S))}return new oi(p,c.getCameraPoint(),y,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return s.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new s.pointGeometry(1,1)):this.screenBounds[1],y=s.polygonizeBounds(c,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<p.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?y[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(y[3]=this.cameraPoint)),s.bufferConvexPolygon(y,n)}bufferedCameraGeometryGlobe(n){const c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new s.pointGeometry(1,1)):this.screenBounds[1],y=s.polygonizeBounds(c,p,n),v=this.cameraPoint.clone();switch(3*((v.y>c.y)+(v.y>p.y))+((v.x>c.x)+(v.x>p.x))){case 0:y[0]=v,y[4]=v.clone();break;case 1:y.splice(1,0,v);break;case 2:y[1]=v;break;case 3:y.splice(4,0,v);break;case 5:y.splice(2,0,v);break;case 6:y[3]=v;break;case 7:y.splice(3,0,v);break;case 8:y[2]=v}return y}containsTile(n,c,p,y=0){const v=n.queryPadding/c._pixelsPerMercatorPixel+1,T=p?this._bufferedCameraMercator(v,c):this._bufferedScreenMercator(v,c);let S=n.tileID.wrap+(T.unwrapped?y:0);const I=T.polygon.map(Y=>s.getTilePoint(n.tileTransform,Y,S));if(!s.polygonIntersectsBox(I,0,0,s.EXTENT,s.EXTENT))return;S=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const k=this.screenGeometryMercator.polygon.map(Y=>s.getTileVec3(n.tileTransform,Y,S)),D=k.map(Y=>new s.pointGeometry(Y[0],Y[1])),U=c.getFreeCameraOptions().position||new s.MercatorCoordinate(0,0,0),G=s.getTileVec3(n.tileTransform,U,S),K=k.map(Y=>{const Z=s.sub(Y,Y,G);return s.normalize(Z,Z),new s.Ray(G,Z)}),X=Yr(n,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:D,tilespaceRays:K,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(Q=s.getBounds(I),Q.min.x=s.clamp(Q.min.x,0,s.EXTENT),Q.min.y=s.clamp(Q.min.y,0,s.EXTENT),Q.max.x=s.clamp(Q.max.x,0,s.EXTENT),Q.max.y=s.clamp(Q.max.y,0,s.EXTENT),Q),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:X};var Q}_bufferedScreenMercator(n,c){const p=He(n);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let y;return y=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),c):{polygon:this.bufferedScreenGeometry(n).map(v=>c.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[p]=y,y}}_bufferedCameraMercator(n,c){const p=He(n);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let y;return y=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),c):{polygon:this.bufferedCameraGeometry(n).map(v=>c.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[p]=y,y}}_projectAndResample(n,c){const p=function(v,T){const S=s.multiply([],T.pixelMatrix,T.globeMatrix),I=[0,-s.GLOBE_RADIUS,0,1],k=[0,s.GLOBE_RADIUS,0,1],D=[0,0,0,1];s.transformMat4$1(I,I,S),s.transformMat4$1(k,k,S),s.transformMat4$1(D,D,S);const U=new s.pointGeometry(I[0]/I[3],I[1]/I[3]),G=new s.pointGeometry(k[0]/k[3],k[1]/k[3]),K=s.polygonContainsPoint(v,U)&&I[3]<D[3],X=s.polygonContainsPoint(v,G)&&k[3]<D[3];if(!K&&!X)return null;const Q=function(de,ue,ye){for(let Ae=1;Ae<de.length;Ae++){const Je=Fe(ue.pointCoordinate3D(de[Ae-1]).x),be=Fe(ue.pointCoordinate3D(de[Ae]).x);if(ye<0){if(Je<be)return{idx:Ae,t:-Je/(be-1-Je)}}else if(be<Je)return{idx:Ae,t:(1-Je)/(be+1-Je)}}return null}(v,T,K?-1:1);if(!Q)return null;const{idx:Y,t:Z}=Q;let ie=Y>1?Ci(v.slice(0,Y),T):[],J=Y<v.length?Ci(v.slice(Y),T):[];ie=ie.map(de=>new s.pointGeometry(Fe(de.x),de.y)),J=J.map(de=>new s.pointGeometry(Fe(de.x),de.y));const pe=[...ie];pe.length===0&&pe.push(J[J.length-1]);const fe=s.number(pe[pe.length-1].y,(J.length===0?ie[0]:J[0]).y,Z);let ae;return ae=K?[new s.pointGeometry(0,fe),new s.pointGeometry(0,0),new s.pointGeometry(1,0),new s.pointGeometry(1,fe)]:[new s.pointGeometry(1,fe),new s.pointGeometry(1,1),new s.pointGeometry(0,1),new s.pointGeometry(0,fe)],pe.push(...ae),J.length===0?pe.push(ie[0]):pe.push(...J),{polygon:pe.map(de=>new s.MercatorCoordinate(de.x,de.y)),unwrapped:!1}}(n,c);if(p)return p;const y=function(v,T){let S=!1,I=-1/0,k=0;for(let U=0;U<v.length-1;U++)v[U].x>I&&(I=v[U].x,k=U);for(let U=0;U<v.length-1;U++){const G=(k+U)%(v.length-1),K=v[G],X=v[G+1];Math.abs(K.x-X.x)>.5&&(K.x<X.x?(K.x+=1,G===0&&(v[v.length-1].x+=1)):(X.x+=1,G+1===v.length-1&&(v[0].x+=1)),S=!0)}const D=s.mercatorXfromLng(T.center.lng);return S&&D<Math.abs(D-1)&&v.forEach(U=>{U.x-=1}),{polygon:v,unwrapped:S}}(Ci(n,c).map(v=>new s.pointGeometry(Fe(v.x),v.y)),c);return{polygon:y.polygon.map(v=>new s.MercatorCoordinate(v.x,v.y)),unwrapped:y.unwrapped}}}function Ci(f,n){return s.resample(f,c=>{const p=n.pointCoordinate3D(c);c.x=p.x,c.y=p.y},1/256)}function Fe(f){return f<0?1+f%1:f%1}function He(f){return 100*f|0}function $e(f,n,c,p,y){const v=function(T,S){if(T)return y(T);if(S){const I=s.pick(s.extend(S,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(I.vectorLayers=S.vector_layers,I.vectorLayerIds=I.vectorLayers.map(k=>k.id)),S.language_options&&(I.languageOptions=S.language_options),S.language&&S.language[S.id]&&(I.language=S.language[S.id]),S.worldview_options&&(I.worldviewOptions=S.worldview_options),S.worldview?I.worldview=S.worldview[S.id]:S.worldview_default&&(I.worldview=S.worldview_default),I.tiles=n.canonicalizeTileset(I,f.url),y(null,I)}};return f.url?s.getJSON(n.transformRequest(n.normalizeSourceURL(f.url,null,c,p),s.ResourceType.Source),v):s.exported.frame(()=>v(null,f))}class Ye{constructor(n,c,p){this.bounds=s.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=c||0,this.maxzoom=p||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const c=Math.pow(2,n.z),p=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*c),y=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*c),v=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*c),T=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*c);return n.x>=p&&n.x<v&&n.y>=y&&n.y<T}}class dt{constructor(n,c,p){this.context=n;const y=n.gl;this.buffer=y.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const vt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class St{constructor(n,c,p,y){this.length=c.length,this.attributes=p,this.itemSize=c.bytesPerElement,this.dynamicDraw=y,this.context=n;const v=n.gl;this.buffer=v.createBuffer(),n.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,c){for(let p=0;p<this.attributes.length;p++){const y=c.attributes[this.attributes[p].name];y!==void 0&&n.enableVertexAttribArray(y)}}setVertexAttribPointers(n,c,p){for(let y=0;y<this.attributes.length;y++){const v=this.attributes[y],T=c.attributes[v.name];T!==void 0&&n.vertexAttribPointer(T,v.components,n[vt[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class lt{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class er extends lt{getDefault(){return s.Color.transparent}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class mr extends lt{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class br extends lt{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Ar extends lt{getDefault(){return[!0,!0,!0,!0]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class $r extends lt{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Rt extends lt{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class ir extends lt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const c=this.current;(n.func!==c.func||n.ref!==c.ref||n.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Pr extends lt{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class ti extends lt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=n,this.dirty=!1}}class ri extends lt{getDefault(){return[0,1]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class an extends lt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=n,this.dirty=!1}}class Dr extends lt{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class or extends lt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.BLEND):c.disable(c.BLEND),this.current=n,this.dirty=!1}}class jr extends lt{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class ii extends lt{getDefault(){return s.Color.transparent}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class zi extends lt{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class gn extends lt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=n,this.dirty=!1}}class si extends lt{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Ni extends lt{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class $o extends lt{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class Is extends lt{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Ms extends lt{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Cs extends lt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class zs extends lt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class za extends lt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Ra extends lt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class rc extends lt{getDefault(){return null}set(n){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Vn extends lt{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class Sn extends lt{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Go extends lt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class ka extends lt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Ri extends lt{constructor(n,c){super(n),this.context=n,this.parent=c}getDefault(){return null}}class Rs extends Ri{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class re extends Ri{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class N extends re{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class V{constructor(n,c,p,y){this.context=n,this.width=c,this.height=p;const v=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new Rs(n,v),y&&(this.depthAttachment=new re(n,v))}destroy(){const n=this.context.gl,c=this.colorAttachment.get();if(c&&n.deleteTexture(c),this.depthAttachment){const p=this.depthAttachment.get();p&&n.deleteRenderbuffer(p)}n.deleteFramebuffer(this.framebuffer)}}class ee{constructor(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new er(this),this.clearDepth=new mr(this),this.clearStencil=new br(this),this.colorMask=new Ar(this),this.depthMask=new $r(this),this.stencilMask=new Rt(this),this.stencilFunc=new ir(this),this.stencilOp=new Pr(this),this.stencilTest=new ti(this),this.depthRange=new ri(this),this.depthTest=new an(this),this.depthFunc=new Dr(this),this.blend=new or(this),this.blendFunc=new jr(this),this.blendColor=new ii(this),this.blendEquation=new zi(this),this.cullFace=new gn(this),this.cullFaceSide=new si(this),this.frontFace=new Ni(this),this.program=new $o(this),this.activeTexture=new Is(this),this.viewport=new Ms(this),this.bindFramebuffer=new Cs(this),this.bindRenderbuffer=new zs(this),this.bindTexture=new za(this),this.bindVertexBuffer=new Ra(this),this.bindElementBuffer=new rc(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Vn(this),this.pixelStoreUnpack=new Sn(this),this.pixelStoreUnpackPremultiplyAlpha=new Go(this),this.pixelStoreUnpackFlipY=new ka(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=n.getExtension("OES_standard_derivatives"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,c){return new dt(this,n,c)}createVertexBuffer(n,c,p){return new St(this,n,c,p)}createRenderbuffer(n,c,p){const y=this.gl,v=y.createRenderbuffer();return this.bindRenderbuffer.set(v),y.renderbufferStorage(y.RENDERBUFFER,n,c,p),this.bindRenderbuffer.set(null),v}createFramebuffer(n,c,p){return new V(this,n,c,p)}clear({color:n,depth:c,stencil:p}){const y=this.gl;let v=0;n&&(v|=y.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(v|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),p!==void 0&&(v|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),y.clear(v)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){A(n.blendFunction,s.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class oe extends s.Evented{constructor(n,c,p,y){super(),this.id=n,this.dispatcher=p,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},c),s.extend(this,s.pick(c,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=$e(this._options,this.map._requestManager,null,null,(n,c)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new s.ErrorEvent(n)):c&&(s.extend(this,c),c.bounds&&(this.tileBounds=new Ye(c.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(c.tiles),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return s.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,c){const p=s.exported.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);n.request=s.getImage(this.map._requestManager.transformRequest(y,s.ResourceType.Tile),(v,T,S,I)=>(delete n.request,n.aborted?(n.state="unloaded",c(null)):v?(n.state="errored",c(v)):T?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:S,expires:I}),n.setTexture(T,this.map.painter),n.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),void c(null)):c(null)))}static loadTileData(n,c,p){n.setTexture(c,p)}static unloadTileData(n,c){n.texture&&c.saveTileTexture(n.texture)}abortTile(n,c){n.request&&(n.request.cancel(),delete n.request),c()}unloadTile(n,c){n.texture&&this.map.painter.saveTileTexture(n.texture),c()}hasTransition(){return!1}}let _e;function we(f,n,c,p,y,v,T,S){const I=[f,c,y,n,p,v,1,1,1],k=[T,S,1],D=s.adjoint([],I),[U,G,K]=s.transformMat3(k,k,s.transpose(D,D));return s.multiply$1(I,[U,0,0,0,G,0,0,0,K],I)}class xe extends s.Evented{constructor(n,c,p,y){super(),this.id=n,this.dispatcher=p,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=c}load(n,c){this._loaded=c||!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),(p,y)=>{if(this._loaded=!0,p)this.fire(new s.ErrorEvent(p));else if(y){const{HTMLImageElement:v}=s.window;this.image=y instanceof v?s.exported.getImageData(y):y,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading()}})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(n){this.coordinates=n,this._boundsArray=void 0;const c=n.map(s.MercatorCoordinate.fromLngLat);return this.tileID=function(p){let y=1/0,v=1/0,T=-1/0,S=-1/0;for(const U of p)y=Math.min(y,U.x),v=Math.min(v,U.y),T=Math.max(T,U.x),S=Math.max(S,U.y);const I=Math.max(T-y,S-v),k=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),D=Math.pow(2,k);return new s.CanonicalTileID(k,Math.floor((y+T)/2*D),Math.floor((v+S)/2*D))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(n){for(const I in this.tiles){const k=this.tiles[I];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture)}if(this._boundsArray)return;const c=s.tileTransform(this.tileID,this.map.transform.projection),[p,y,v,T]=this.coordinates.map(I=>{const k=c.projection.project(I[0],I[1]);return s.getTilePoint(c,k)._round()});this.perspectiveTransform=function(I,k,D,U,G,K,X,Q,Y,Z){const ie=we(0,0,I,0,0,k,I,k),J=we(D,U,G,K,X,Q,Y,Z);return s.multiply$1(J,s.adjoint(ie,ie),J),[J[6]/J[8]*I/s.EXTENT,J[7]/J[8]*k/s.EXTENT]}(this.width,this.height,p.x,p.y,y.x,y.y,T.x,T.y,v.x,v.y);const S=this._boundsArray=new s.StructArrayLayout4i8;S.emplaceBack(p.x,p.y,0,0),S.emplaceBack(y.x,y.y,s.EXTENT,0),S.emplaceBack(T.x,T.y,0,s.EXTENT),S.emplaceBack(v.x,v.y,s.EXTENT,s.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=n.createVertexBuffer(S,s.boundsAttributes.members),this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,c=n.gl;this.texture?this.texture.update(this.image):(this.texture=new s.Texture(n,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._prepareData(n)}loadTile(n,c){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},c(null)):(n.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ge={vector:class extends s.Evented{constructor(f,n,c,p){if(super(),this.id=f,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(n,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new s.DedupedRequest}load(f){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"}));const n=this.language||this.map._language,c=this.worldview||this.map._worldview;this._tileJSONRequest=$e(this._options,this.map._requestManager,n,c,(p,y)=>{this._tileJSONRequest=null,this._loaded=!0,p?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${n}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new s.ErrorEvent(p))):y&&(s.extend(this,y),y.bounds&&(this.tileBounds=new Ye(y.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(y.tiles,this.map._requestManager._customAccessToken),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),f&&f(p)})}loaded(){return this._loaded}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}onAdd(f){this.map=f,this.load()}setSourceProperty(f){this._tileJSONRequest&&this._tileJSONRequest.cancel(),f(),this.load(()=>{const n=this.map.style._getSourceCaches(this.id);for(const c of n)c.clearTiles()})}setTiles(f){return this.setSourceProperty(()=>{this._options.tiles=f}),this}setUrl(f){return this.setSourceProperty(()=>{this.url=f,this._options.url=f}),this}_setLanguage(f){return f===this.language||this.setSourceProperty(()=>{this.language=f}),this}_setWorldview(f){return f===this.worldview?this:this.worldviewOptions&&f&&!this.worldviewOptions[f]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${f}".`),this):(this.setSourceProperty(()=>{this.worldview=f}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return s.extend({},this._options)}loadTile(f,n){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(c,s.ResourceType.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:f.isSymbolTile};if(p.request.collectResourceTiming=this._collectResourceTiming,f.actor&&f.state!=="expired")f.state==="loading"?f.reloadCallback=n:f.request=f.actor.send("reloadTile",p,y.bind(this));else if(f.actor=this._tileWorkers[c]=this._tileWorkers[c]||this.dispatcher.getActor(),this.dispatcher.ready)f.request=f.actor.send("loadTile",p,y.bind(this),void 0,!0);else{const v=s.loadVectorTile.call({deduped:this._deduped},p,(T,S)=>{T||!S?y.call(this,T):(p.data={cacheControl:S.cacheControl,expires:S.expires,rawData:S.rawData.slice(0)},f.actor&&f.actor.send("loadTile",p,y.bind(this),void 0,!0))},!0);f.request={cancel:v}}function y(v,T){return delete f.request,f.aborted?n(null):v&&v.status!==404?n(v):(T&&T.resourceTiming&&(f.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&f.setExpiryData(T),f.loadVectorData(T,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id})}unloadTile(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:oe,"raster-dem":class extends oe{constructor(f,n,c,p){super(f,n,c,p),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(f,n){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(y,v){y&&(f.state="errored",n(y)),v&&(f.dem=v,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",n(null))}f.request=s.getImage(this.map._requestManager.transformRequest(c,s.ResourceType.Tile),function(y,v,T,S){if(delete f.request,f.aborted)f.state="unloaded",n(null);else if(y)f.state="errored",n(y);else if(v){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:T,expires:S});const I=s.window.ImageBitmap&&v instanceof s.window.ImageBitmap&&(_e==null&&(_e=s.window.OffscreenCanvas&&new s.window.OffscreenCanvas(1,1).getContext("2d")&&typeof s.window.createImageBitmap=="function"),_e),k=1-(v.width-s.prevPowerOfTwo(v.width))/2;k<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const D=I?v:s.exported.getImageData(v,k),U={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:D,encoding:this.encoding,padding:k};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",U,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){const n=f.canonical,c=Math.pow(2,n.z),p=(n.x-1+c)%c,y=n.x===0?f.wrap-1:f.wrap,v=(n.x+1+c)%c,T=n.x+1===c?f.wrap+1:f.wrap,S={};return S[new s.OverscaledTileID(f.overscaledZ,y,n.z,p,n.y).key]={backfilled:!1},S[new s.OverscaledTileID(f.overscaledZ,T,n.z,v,n.y).key]={backfilled:!1},n.y>0&&(S[new s.OverscaledTileID(f.overscaledZ,y,n.z,p,n.y-1).key]={backfilled:!1},S[new s.OverscaledTileID(f.overscaledZ,f.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},S[new s.OverscaledTileID(f.overscaledZ,T,n.z,v,n.y-1).key]={backfilled:!1}),n.y+1<c&&(S[new s.OverscaledTileID(f.overscaledZ,y,n.z,p,n.y+1).key]={backfilled:!1},S[new s.OverscaledTileID(f.overscaledZ,f.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},S[new s.OverscaledTileID(f.overscaledZ,T,n.z,v,n.y+1).key]={backfilled:!1}),S}unloadTile(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded"}},geojson:class extends s.Evented{constructor(f,n,c,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(p),this._data=n.data,this._options=s.extend({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const y=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*y,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*y,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:s.EXTENT,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*y,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}getClusterExpansionZoom(f,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},n),this}getClusterChildren(f,n){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},n),this}getClusterLeaves(f,n,c,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:n,offset:c},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.Event("dataloading",{dataType:"source"})),this._loaded=!1;const f=s.extend({},this.workerOptions),n=this._data;typeof n=="string"?(f.request=this.map._requestManager.transformRequest(s.exported.resolveURL(n),s.ResourceType.Source),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,f,(c,p)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new s.ErrorEvent(c));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(y.resourceTiming=p.resourceTiming[this.id]),this.fire(new s.Event("data",y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,n){const c=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(c,{type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,y)=>(delete f.request,f.unloadVectorData(),f.aborted?n(null):p?n(p):(f.loadVectorData(y,this.map.painter,c==="reloadTile"),n(null))),void 0,c==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends xe{constructor(f,n,c,p){super(f,n,c,p),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const n of f.urls)this.urls.push(this.map._requestManager.transformRequest(n,s.ResourceType.Source).url);s.getVideo(this.urls,(n,c)=>{this._loaded=!0,n?this.fire(new s.ErrorEvent(n)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const n=this.video.seekable;f<n.start(0)||f>n.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,n=f.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(f,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:xe,canvas:class extends xe{constructor(f,n,c,p){super(f,n,c,p),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(v=>typeof v!="number"))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${f}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${f}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends s.Evented{constructor(f,n,c,p){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=n,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ye(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.coveringTiles=this._coveringTiles.bind(this),s.extend(this,s.pick(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this._map=f,this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:n,y:c,z:p}=f.canonical;return this._implementation.hasTile({x:n,y:c,z:p})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,n){const{x:c,y:p,z:y}=f.tileID.canonical,v=new s.window.AbortController,T=this._implementation.loadTile({x:c,y:p,z:y},{signal:v.signal});if(!T)return this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",n(null);T.cancel=()=>v.abort(),f.request=T.then(function(S){return delete f.request,f.aborted?(f.state="unloaded",n(null)):S?function(I){return I instanceof s.window.ImageData||I instanceof s.window.ImageBitmap||I instanceof s.window.HTMLCanvasElement}(S)?(this.loadTileData(f,S),f.state="loaded",void n(null)):(f.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",n(null))}.bind(this)).catch(S=>{S.code!==20&&(f.state="errored",n(S))})}loadTileData(f,n){oe.loadTileData(f,n,this._map.painter)}unloadTileData(f){oe.unloadTileData(f,this._map.painter)}prepareTile(f){if(!this._implementation.prepareTile)return null;const{x:n,y:c,z:p}=f.tileID.canonical,y=this._implementation.prepareTile({x:n,y:c,z:p});return y?(this.loadTileData(f,y),f.state="loaded",y):null}unloadTile(f,n){if(this.unloadTileData(f),this._implementation.unloadTile){const{x:c,y:p,z:y}=f.tileID.canonical;this._implementation.unloadTile({x:c,y:p,z:y})}n()}abortTile(f,n){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_update(){this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Ee=function(f,n,c,p){const y=new ge[n.type](f,n,c,p);if(y.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${y.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],y),y};function Ge(f,n){const c=s.identity([]);return s.scale(c,c,[.5*f.width,.5*-f.height,1]),s.translate(c,c,[1,-1,0]),s.multiply(c,c,f.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(c)}function ct(f,n,c,p,y,v,T,S=!1){const I=f.tilesIn(p,T,S);I.sort(Et);const k=[];for(const U of I)k.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(n,c,f._state,U,y,v,Ge(f.transform,U.tile.tileID),S)});const D=function(U){const G={},K={};for(const X of U){const Q=X.queryResults,Y=X.wrappedTileID,Z=K[Y]=K[Y]||{};for(const ie in Q){const J=Q[ie],pe=Z[ie]=Z[ie]||{},fe=G[ie]=G[ie]||[];for(const ae of J)pe[ae.featureIndex]||(pe[ae.featureIndex]=!0,fe.push(ae))}}return G}(k);for(const U in D)D[U].forEach(G=>{const K=G.feature,X=K.layer;X&&X.type!=="background"&&X.type!=="sky"&&(K.source=X.source,X["source-layer"]&&(K.sourceLayer=X["source-layer"]),K.state=K.id!==void 0?f.getFeatureState(X["source-layer"],K.id):{})});return D}function Qe(f,n){const c=f.getRenderableIds().map(v=>f.getTileByID(v)),p=[],y={};for(let v=0;v<c.length;v++){const T=c[v],S=T.tileID.canonical.key;y[S]||(y[S]=!0,T.querySourceFeatures(p,n))}return p}function Et(f,n){const c=f.tileID,p=n.tileID;return c.overscaledZ-p.overscaledZ||c.canonical.y-p.canonical.y||c.wrap-p.wrap||c.canonical.x-p.canonical.x}function At(){return aa.workerClass!=null?new aa.workerClass:new s.window.Worker(aa.workerUrl)}const yt="mapboxgl_preloaded_worker_pool";class Pt{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Pt.workerCount;)this.workers.push(new At);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[yt]}numActive(){return Object.keys(this.active).length}}let Nt;function sr(){return Nt||(Nt=new Pt),Nt}function fr(f,n){const c={};for(const p in f)p!=="ref"&&(c[p]=f[p]);return s.refProperties.forEach(p=>{p in n&&(c[p]=n[p])}),c}function ar(f){f=f.slice();const n=Object.create(null);for(let c=0;c<f.length;c++)n[f[c].id]=f[c];for(let c=0;c<f.length;c++)"ref"in f[c]&&(f[c]=fr(f[c],n[f[c].ref]));return f}Pt.workerCount=2;const Tt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function ke(f,n,c){c.push({command:Tt.addSource,args:[f,n[f]]})}function Ui(f,n,c){n.push({command:Tt.removeSource,args:[f]}),c[f]=!0}function Nr(f,n,c,p){Ui(f,c,p),ke(f,n,c)}function $n(f,n,c){let p;for(p in f[c])if(f[c].hasOwnProperty(p)&&p!=="data"&&!A(f[c][p],n[c][p]))return!1;for(p in n[c])if(n[c].hasOwnProperty(p)&&p!=="data"&&!A(f[c][p],n[c][p]))return!1;return!0}function Da(f,n,c,p,y,v){let T;for(T in n=n||{},f=f||{})f.hasOwnProperty(T)&&(A(f[T],n[T])||c.push({command:v,args:[p,T,n[T],y]}));for(T in n)n.hasOwnProperty(T)&&!f.hasOwnProperty(T)&&(A(f[T],n[T])||c.push({command:v,args:[p,T,n[T],y]}))}function ln(f){return f.id}function Oa(f,n){return f[n.id]=n,f}class lp{constructor(n,c){this.reset(n,c)}reset(n,c){this.points=n||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=s.clamp(n,0,1);let c=1,p=this._distances[c];const y=n*this.paddedLength+this.padding;for(;p<y&&c<this._distances.length;)p=this._distances[++c];const v=c-1,T=this._distances[v],S=p-T,I=S>0?(y-T)/S:0;return this.points[v].mult(1-I).add(this.points[c].mult(I))}}class qo{constructor(n,c,p){const y=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(n/p),this.yCellCount=Math.ceil(c/p);for(let T=0;T<this.xCellCount*this.yCellCount;T++)y.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=c,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,c,p,y,v){this._forEachCell(c,p,y,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(v)}insertCircle(n,c,p,y){this._forEachCell(c-y,p-y,c+y,p+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(c),this.circles.push(p),this.circles.push(y)}_insertBoxCell(n,c,p,y,v,T){this.boxCells[v].push(T)}_insertCircleCell(n,c,p,y,v,T){this.circleCells[v].push(T)}_query(n,c,p,y,v,T){if(p<0||n>this.width||y<0||c>this.height)return!v&&[];const S=[];if(n<=0&&c<=0&&this.width<=p&&this.height<=y){if(v)return!0;for(let I=0;I<this.boxKeys.length;I++)S.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const k=this.circles[3*I],D=this.circles[3*I+1],U=this.circles[3*I+2];S.push({key:this.circleKeys[I],x1:k-U,y1:D-U,x2:k+U,y2:D+U})}return T?S.filter(T):S}return this._forEachCell(n,c,p,y,this._queryCell,S,{hitTest:v,seenUids:{box:{},circle:{}}},T),v?S.length>0:S}_queryCircle(n,c,p,y,v){const T=n-p,S=n+p,I=c-p,k=c+p;if(S<0||T>this.width||k<0||I>this.height)return!y&&[];const D=[];return this._forEachCell(T,I,S,k,this._queryCellCircle,D,{hitTest:y,circle:{x:n,y:c,radius:p},seenUids:{box:{},circle:{}}},v),y?D.length>0:D}query(n,c,p,y,v){return this._query(n,c,p,y,!1,v)}hitTest(n,c,p,y,v){return this._query(n,c,p,y,!0,v)}hitTestCircle(n,c,p,y){return this._queryCircle(n,c,p,!0,y)}_queryCell(n,c,p,y,v,T,S,I){const k=S.seenUids,D=this.boxCells[v];if(D!==null){const G=this.bboxes;for(const K of D)if(!k.box[K]){k.box[K]=!0;const X=4*K;if(n<=G[X+2]&&c<=G[X+3]&&p>=G[X+0]&&y>=G[X+1]&&(!I||I(this.boxKeys[K]))){if(S.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[K],x1:G[X],y1:G[X+1],x2:G[X+2],y2:G[X+3]})}}}const U=this.circleCells[v];if(U!==null){const G=this.circles;for(const K of U)if(!k.circle[K]){k.circle[K]=!0;const X=3*K;if(this._circleAndRectCollide(G[X],G[X+1],G[X+2],n,c,p,y)&&(!I||I(this.circleKeys[K]))){if(S.hitTest)return T.push(!0),!0;{const Q=G[X],Y=G[X+1],Z=G[X+2];T.push({key:this.circleKeys[K],x1:Q-Z,y1:Y-Z,x2:Q+Z,y2:Y+Z})}}}}}_queryCellCircle(n,c,p,y,v,T,S,I){const k=S.circle,D=S.seenUids,U=this.boxCells[v];if(U!==null){const K=this.bboxes;for(const X of U)if(!D.box[X]){D.box[X]=!0;const Q=4*X;if(this._circleAndRectCollide(k.x,k.y,k.radius,K[Q+0],K[Q+1],K[Q+2],K[Q+3])&&(!I||I(this.boxKeys[X])))return T.push(!0),!0}}const G=this.circleCells[v];if(G!==null){const K=this.circles;for(const X of G)if(!D.circle[X]){D.circle[X]=!0;const Q=3*X;if(this._circlesCollide(K[Q],K[Q+1],K[Q+2],k.x,k.y,k.radius)&&(!I||I(this.circleKeys[X])))return T.push(!0),!0}}}_forEachCell(n,c,p,y,v,T,S,I){const k=this._convertToXCellCoord(n),D=this._convertToYCellCoord(c),U=this._convertToXCellCoord(p),G=this._convertToYCellCoord(y);for(let K=k;K<=U;K++)for(let X=D;X<=G;X++)if(v.call(this,n,c,p,y,this.xCellCount*X+K,T,S,I))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,c,p,y,v,T){const S=y-n,I=v-c,k=p+T;return k*k>S*S+I*I}_circleAndRectCollide(n,c,p,y,v,T,S){const I=(T-y)/2,k=Math.abs(n-(y+I));if(k>I+p)return!1;const D=(S-v)/2,U=Math.abs(c-(v+D));if(U>D+p)return!1;if(k<=I||U<=D)return!0;const G=k-I,K=U-D;return G*G+K*K<=p*p}}const ut=Math.tan(85*Math.PI/180);function Vt(f,n,c,p,y,v,T){const S=s.create();if(c)if(v.name==="globe"){const I=s.calculateGlobeLabelMatrix(y,n);s.multiply(S,S,I)}else{const I=Ue([],T);S[0]=I[0],S[1]=I[1],S[4]=I[2],S[5]=I[3],p||s.rotateZ(S,S,y.angle)}else s.multiply(S,y.labelPlaneMatrix,f);return S}function $t(f,n,c,p,y,v,T){const S=Vt(f,n,c,p,y,v,T);return v.name==="globe"&&c||(S[2]=S[6]=S[10]=S[14]=0),S}function cn(f,n,c,p,y,v,T){if(c){if(v.name==="globe"){const S=Vt(f,n,c,p,y,v,T);return s.invert(S,S),s.multiply(S,f,S),S}{const S=s.clone(f),I=s.identity([]);return I[0]=T[0],I[1]=T[1],I[4]=T[2],I[5]=T[3],s.multiply(S,S,I),p||s.rotateZ(S,S,-y.angle),S}}return y.glCoordMatrix}function un(f,n,c=0){const p=[f.x,f.y,c,1];c?s.transformMat4$1(p,p,n):wi(p,p,n);const y=p[3];return{point:[p[0]/y,p[1]/y,p[2]/y],signedDistanceFromCamera:y}}function Ot(f,n){const c=[f[0],f[1],f[2],1];s.transformMat4$1(c,c,n);const p=c[3];return{point:[c[0]/p,c[1]/p,c[2]/p],signedDistanceFromCamera:p}}function ks(f,n){return Math.min(.5+f/n*.5,1.5)}function Ds(f,n){const c=f[0]/f[3],p=f[1]/f[3];return c>=-n[0]&&c<=n[0]&&p>=-n[1]&&p<=n[1]}function Os(f,n,c,p,y,v,T,S,I,k){const D=c.transform,U=p?f.textSizeData:f.iconSizeData,G=s.evaluateSizeForZoom(U,c.transform.zoom),K=D.projection.name==="globe",X=[256/c.width*2+1,256/c.height*2+1],Q=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;Q.clear();let Y=null;K&&(Y=p?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const Z=f.lineVertexArray,ie=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,J=c.transform.width/c.transform.height;let pe=!1;for(let fe=0;fe<ie.length;fe++){const ae=ie.get(fe);if(ae.writingMode!==s.WritingMode.vertical||pe||fe!==0&&ie.get(fe-1).writingMode===s.WritingMode.horizontal||(pe=!0),(ae.hidden||ae.writingMode===s.WritingMode.vertical)&&!pe){qn(ae.numGlyphs,Q);continue}pe=!1;const de=new s.pointGeometry(ae.tileAnchorX,ae.tileAnchorY),ue=I?I(de):[0,0,0],ye=D.projection.projectTilePoint(de.x,de.y,k.canonical),Ae=[ye.x+ue[0],ye.y+ue[1],ye.z+ue[2]],Je=[...Ae,1];if(s.transformMat4$1(Je,Je,n),!Ds(Je,X)){qn(ae.numGlyphs,Q);continue}const be=ks(c.transform.cameraToCenterDistance,Je[3]),Le=s.evaluateSizeForFeature(U,G,ae),Ve=T?Le/be:Le*be,it=un(new s.pointGeometry(Ae[0],Ae[1]),y,Ae[2]);if(it.signedDistanceFromCamera<=0){qn(ae.numGlyphs,Q);continue}let Re={};const Ke=T?null:I,Be=ah(ae,Ve,!1,S,n,y,v,f.glyphOffsetArray,Z,Q,Y,it.point,de,Re,J,Ke,D.projection,k,T);pe=Be.useVertical,Ke&&Be.needsFlipping&&(Re={}),(Be.notEnoughRoom||pe||Be.needsFlipping&&ah(ae,Ve,!0,S,n,y,v,f.glyphOffsetArray,Z,Q,Y,it.point,de,Re,J,Ke,D.projection,k,T).notEnoughRoom)&&qn(ae.numGlyphs,Q)}p?(f.text.dynamicLayoutVertexBuffer.updateData(Q),Y&&f.text.globeExtVertexBuffer.updateData(Y)):(f.icon.dynamicLayoutVertexBuffer.updateData(Q),Y&&f.icon.globeExtVertexBuffer.updateData(Y))}function Vi(f,n,c,p,y,v,T,S,I,k,D,U,G,K,X,Q){const Y=S.glyphStartIndex+S.numGlyphs,Z=S.lineStartIndex,ie=S.lineStartIndex+S.lineLength,J=n.getoffsetX(S.glyphStartIndex),pe=n.getoffsetX(Y-1),fe=Gn(f*J,c,p,y,v,T,S.segment,Z,ie,I,k,D,U,G,!0,K,X,Q);if(!fe)return null;const ae=Gn(f*pe,c,p,y,v,T,S.segment,Z,ie,I,k,D,U,G,!0,K,X,Q);return ae?{first:fe,last:ae}:null}function Or(f,n,c,p){return f.writingMode===s.WritingMode.horizontal&&Math.abs(c.y-n.y)>Math.abs(c.x-n.x)*p?{useVertical:!0}:f.writingMode===s.WritingMode.vertical?n.y<c.y?{needsFlipping:!0}:null:f.flipState!==0&&function(y,v,T){const S=(v.x-y.x)*T;return S===0||Math.abs((v.y-y.y)/S)>ut}(n,c,p)?f.flipState===1?{needsFlipping:!0}:null:n.x>c.x?{needsFlipping:!0}:null}function ah(f,n,c,p,y,v,T,S,I,k,D,U,G,K,X,Q,Y,Z,ie){const J=n/24,pe=f.lineOffsetX*J,fe=f.lineOffsetY*J;let ae;if(f.numGlyphs>1){const de=f.glyphStartIndex+f.numGlyphs,ue=f.lineStartIndex,ye=f.lineStartIndex+f.lineLength,Ae=Vi(J,S,pe,fe,c,U,G,f,I,v,K,Q,!1,Y,Z,ie);if(!Ae)return{notEnoughRoom:!0};const Je=Ot(Ae.first.point,T).point,be=Ot(Ae.last.point,T).point,Le=new s.pointGeometry(Je[0],Je[1]),Ve=new s.pointGeometry(be[0],be[1]);if(p&&!c){const it=Or(f,Le,Ve,X);if(f.flipState=it&&it.needsFlipping?1:2,it)return it}ae=[Ae.first];for(let it=f.glyphStartIndex+1;it<de-1;it++)ae.push(Gn(J*S.getoffsetX(it),pe,fe,c,U,G,f.segment,ue,ye,I,v,K,Q,!1,!1,Y,Z,ie));ae.push(Ae.last)}else{if(p&&!c){const ue=un(G,y).point,ye=f.lineStartIndex+f.segment+1,Ae=new s.pointGeometry(I.getx(ye),I.gety(ye)),Je=un(Ae,y),be=Je.signedDistanceFromCamera>0?Je.point:La(G,Ae,ue,1,y,void 0,Y,Z.canonical),Le=Or(f,new s.pointGeometry(ue[0],ue[1]),new s.pointGeometry(be[0],be[1]),X);if(f.flipState=Le&&Le.needsFlipping?1:2,Le)return Le}const de=Gn(J*S.getoffsetX(f.glyphStartIndex),pe,fe,c,U,G,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,I,v,K,Q,!1,!1,Y,Z,ie);if(!de)return{notEnoughRoom:!0};ae=[de]}if(D)for(const de of ae)s.updateGlobeVertexNormal(D,k.length+0,de.up[0],de.up[1],de.up[2]),s.updateGlobeVertexNormal(D,k.length+1,de.up[0],de.up[1],de.up[2]),s.updateGlobeVertexNormal(D,k.length+2,de.up[0],de.up[1],de.up[2]),s.updateGlobeVertexNormal(D,k.length+3,de.up[0],de.up[1],de.up[2]),s.addDynamicAttributes(k,de.point[0],de.point[1],de.point[2],de.angle);else for(const de of ae)s.addDynamicAttributes(k,de.point[0],de.point[1],de.point[2],de.angle);return{}}function Zo(f,n,c,p,y){const v=p.projectTilePoint(f.x,f.y,n);if(!y)return un(v,c,v.z);const T=y(f);return un(new s.pointGeometry(v.x+T[0],v.y+T[1]),c,v.z+T[2])}function La(f,n,c,p,y,v,T,S){const I=Zo(f.add(f.sub(n)._unit()),S,y,T,v).point,k=s.sub([],c,I);return s.scaleAndAdd([],c,k,p/s.length(k))}function Gn(f,n,c,p,y,v,T,S,I,k,D,U,G,K,X,Q,Y,Z){const ie=p?f-n:f+n;let J=ie>0?1:-1,pe=0;p&&(J*=-1,pe=Math.PI),J<0&&(pe+=Math.PI);let fe=J>0?S+T:S+T+1,ae=y,de=y,ue=0,ye=0;const Ae=Math.abs(ie),Je=[],be=[];let Le=v;const Ve=()=>{const gt=fe-J;return ue===0?v:new s.pointGeometry(k.getx(gt),k.gety(gt))},it=()=>La(Ve(),Le,de,Ae-ue+1,D,G,Q,Y.canonical);for(;ue+ye<=Ae;){if(fe+=J,fe<S||fe>=I)return null;if(de=ae,Je.push(ae),K&&be.push(Le||Ve()),ae=U[fe],ae===void 0){Le=new s.pointGeometry(k.getx(fe),k.gety(fe));const gt=Zo(Le,Y.canonical,D,Q,G);ae=gt.signedDistanceFromCamera>0?U[fe]=gt.point:it()}else Le=null;ue+=ye,ye=s.distance(de,ae)}Le=Le||new s.pointGeometry(k.getx(fe),k.gety(fe));const Re=Ve();X&&G&&(U[fe]=ae=U[fe]===void 0?ae:it(),ye=s.distance(de,ae));const Ke=(Ae-ue)/ye,Be=Le.sub(Re).mult(Ke)._add(Re),st=s.sub([],ae,de),ot=s.scaleAndAdd([],de,st,Ke);let _t=[0,0,1],wt=st[0],Mt=st[1];if(Z&&(_t=Q.upVector(Y.canonical,Be.x,Be.y),_t[0]!==0||_t[1]!==0||_t[2]!==1)){const gt=[1,0,0],zt=[0,1,0];gt[0]=_t[2],gt[1]=0,gt[2]=-_t[0],s.cross(zt,_t,gt),s.normalize(gt,gt),s.normalize(zt,zt),wt=s.dot(st,gt),Mt=s.dot(st,zt)}if(c){const gt=s.cross([],_t,st);s.normalize(gt,gt),s.scaleAndAdd(ot,ot,gt,c*J)}const qt=pe+Math.atan2(Mt,wt);return Je.push(ot),K&&be.push(Be),{point:ot,angle:qt,path:Je,tilePath:be,up:_t}}const ic=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function qn(f,n){for(let c=0;c<f;c++){const p=n.length;n.resize(p+4),n.float32.set(ic,4*p)}}function wi(f,n,c){const p=n[0],y=n[1];return f[0]=c[0]*p+c[4]*y+c[12],f[1]=c[1]*p+c[5]*y+c[13],f[3]=c[3]*p+c[7]*y+c[15],f}const lr=100;class nc{constructor(n,c,p=new qo(n.width+200,n.height+200,25),y=new qo(n.width+200,n.height+200,25)){this.transform=n,this.grid=p,this.ignoredGrid=y,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+lr,this.screenBottomBoundary=n.height+lr,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=c}placeCollisionBox(n,c,p,y,v,T,S,I){let k=p.projectedAnchorX,D=p.projectedAnchorY,U=p.projectedAnchorZ;const G=p.elevation,K=p.tileID;if(G&&K){const fe=n.getProjection().upVector(K.canonical,p.tileAnchorX,p.tileAnchorY),ae=n.getProjection().upVectorScale(K.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;k+=fe[0]*G*ae,D+=fe[1]*G*ae,U+=fe[2]*G*ae}const X=this.projectAndGetPerspectiveRatio(S,[k,D,U],p.tileID,n.projection.name==="globe"||!!G||this.transform.pitch>0,n.getProjection()),Q=T*X.perspectiveRatio,Y=(p.x1*c+y.x-p.padding)*Q+X.point.x,Z=(p.y1*c+y.y-p.padding)*Q+X.point.y,ie=(p.x2*c+y.x+p.padding)*Q+X.point.x,J=(p.y2*c+y.y+p.padding)*Q+X.point.y,pe=X.perspectiveRatio<=.55||X.occluded;return!this.isInsideGrid(Y,Z,ie,J)||!v&&this.grid.hitTest(Y,Z,ie,J,I)||pe?{box:[],offscreen:!1,occluded:X.occluded}:{box:[Y,Z,ie,J],offscreen:this.isOffscreen(Y,Z,ie,J),occluded:!1}}placeCollisionCircles(n,c,p,y,v,T,S,I,k,D,U,G,K,X,Q){const Y=[],Z=this.transform.elevation,ie=Z?Z.getAtTileOffsetFunc(Q,this.transform.center.lat,this.transform.worldSize,n.getProjection()):Re=>[0,0,0],J=new s.pointGeometry(p.tileAnchorX,p.tileAnchorY),pe=n.getProjection().projectTilePoint(p.tileAnchorX,p.tileAnchorY,Q.canonical),fe=ie(J),ae=[pe.x+fe[0],pe.y+fe[1],pe.z+fe[2]],de=n.projection.name==="globe",ue=this.projectAndGetPerspectiveRatio(S,[ae[0],ae[1],ae[2]],Q,de||!!Z||this.transform.pitch>0,n.getProjection()),{perspectiveRatio:ye}=ue,Ae=(U?T/ye:T*ye)/s.ONE_EM,Je=un(new s.pointGeometry(ae[0],ae[1]),I,ae[2]).point,be=ue.signedDistanceFromCamera>0?Vi(Ae,v,p.lineOffsetX*Ae,p.lineOffsetY*Ae,!1,Je,J,p,y,I,{},Z&&!U?ie:null,U&&!!Z,n.getProjection(),Q,U):null;let Le=!1,Ve=!1,it=!0;if(be&&!ue.occluded){const Re=.5*K*ye+X,Ke=new s.pointGeometry(-100,-100),Be=new s.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),st=new lp,ot=be.first,_t=be.last;let wt=[];for(let gt=ot.path.length-1;gt>=1;gt--)wt.push(ot.path[gt]);for(let gt=1;gt<_t.path.length;gt++)wt.push(_t.path[gt]);const Mt=2.5*Re;if(k){const gt=wt.map(Z&&!de?(zt,Qt)=>{const Tr=ie(Qt<ot.path.length-1?ot.tilePath[ot.path.length-1-Qt]:_t.tilePath[Qt-ot.path.length+2]);return zt[2]=Tr[2],Ot(zt,k)}:zt=>Ot(zt,k));wt=gt.some(zt=>zt.signedDistanceFromCamera<=0)?[]:gt.map(zt=>zt.point)}let qt=[];if(wt.length>0){const gt=wt.map(cr=>new s.pointGeometry(cr[0],cr[1]));let zt=1/0,Qt=-1/0,Tr=1/0,Ur=-1/0;for(let cr=0;cr<gt.length;cr++)zt=Math.min(zt,gt[cr].x),Tr=Math.min(Tr,gt[cr].y),Qt=Math.max(Qt,gt[cr].x),Ur=Math.max(Ur,gt[cr].y);qt=zt>=Ke.x&&Qt<=Be.x&&Tr>=Ke.y&&Ur<=Be.y?[gt]:Qt<Ke.x||zt>Be.x||Ur<Ke.y||Tr>Be.y?[]:s.clipLine([gt],Ke.x,Ke.y,Be.x,Be.y)}for(const gt of qt){st.reset(gt,.25*Re);let zt=0;zt=st.length<=.5*Re?1:Math.ceil(st.paddedLength/Mt)+1;for(let Qt=0;Qt<zt;Qt++){const Tr=Qt/Math.max(zt-1,1),Ur=st.lerp(Tr),cr=Ur.x+lr,ui=Ur.y+lr;Y.push(cr,ui,Re,0);const dn=cr-Re,Mn=ui-Re,Er=cr+Re,Ir=ui+Re;if(it=it&&this.isOffscreen(dn,Mn,Er,Ir),Ve=Ve||this.isInsideGrid(dn,Mn,Er,Ir),!c&&this.grid.hitTestCircle(cr,ui,Re,G)&&(Le=!0,!D))return{circles:[],offscreen:!1,collisionDetected:Le,occluded:!1}}}}return{circles:!D&&Le||!Ve?[]:Y,offscreen:it,collisionDetected:Le,occluded:ue.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let p=1/0,y=1/0,v=-1/0,T=-1/0;for(const D of n){const U=new s.pointGeometry(D.x+lr,D.y+lr);p=Math.min(p,U.x),y=Math.min(y,U.y),v=Math.max(v,U.x),T=Math.max(T,U.y),c.push(U)}const S=this.grid.query(p,y,v,T).concat(this.ignoredGrid.query(p,y,v,T)),I={},k={};for(const D of S){const U=D.key;if(I[U.bucketInstanceId]===void 0&&(I[U.bucketInstanceId]={}),I[U.bucketInstanceId][U.featureIndex])continue;const G=[new s.pointGeometry(D.x1,D.y1),new s.pointGeometry(D.x2,D.y1),new s.pointGeometry(D.x2,D.y2),new s.pointGeometry(D.x1,D.y2)];s.polygonIntersectsPolygon(c,G)&&(I[U.bucketInstanceId][U.featureIndex]=!0,k[U.bucketInstanceId]===void 0&&(k[U.bucketInstanceId]=[]),k[U.bucketInstanceId].push(U.featureIndex))}return k}insertCollisionBox(n,c,p,y,v){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:y,collisionGroupID:v},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,c,p,y,v){const T=c?this.ignoredGrid:this.grid,S={bucketInstanceId:p,featureIndex:y,collisionGroupID:v};for(let I=0;I<n.length;I+=4)T.insertCircle(S,n[I],n[I+1],n[I+2])}projectAndGetPerspectiveRatio(n,c,p,y,v){const T=[c[0],c[1],c[2],1];let S=!1;if(c[2]||this.transform.pitch>0){s.transformMat4$1(T,T,n);const I=v.name==="globe";this.fogState&&p&&!I&&(S=function(k,D,U,G,K,X){const Q=X.calculateFogTileMatrix(K),Y=[D,U,G];return s.transformMat4(Y,Y,Q),xr(k,Y,X.pitch,X._fov)}(this.fogState,c[0],c[1],c[2],p.toUnwrapped(),this.transform)>.9)}else wi(T,T,n);return{point:new s.pointGeometry((T[0]/T[3]+1)/2*this.transform.width+lr,(-T[1]/T[3]+1)/2*this.transform.height+lr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(v)/T[3]*.5,1.5),signedDistanceFromCamera:T[3],occluded:y&&T[2]>T[3]||S}}isOffscreen(n,c,p,y){return p<lr||n>=this.screenRightBoundary||y<lr||c>this.screenBottomBoundary}isInsideGrid(n,c,p,y){return p>=0&&n<this.gridRightBoundary&&y>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const n=s.identity([]);return s.translate(n,n,[-100,-100,0]),n}}function Ls(f,n,c){const p=n.createTileMatrix(f,f.worldSize,c.toUnwrapped());return s.multiply(new Float32Array(16),f.projMatrix,p)}function ki(f,n,c){if(n.projection.name===c.projection.name)return f.projMatrix;const p=c.clone();return p.setProjection(n.projection),Ls(p,n.getProjection(),f)}function Di(f,n,c){return n.name===c.projection.name?f.projMatrix:Ls(c,n,f)}class oc{constructor(n,c,p,y){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?c:-c))):y&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Zn{constructor(n,c,p,y,v,T=!1){this.text=new oc(n?n.text:null,c,p,v),this.icon=new oc(n?n.icon:null,c,y,v),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Zr{constructor(n,c,p,y=!1){this.text=n,this.icon=c,this.skipFade=p,this.clipped=y}}class Fs{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class sc{constructor(n,c,p,y,v){this.bucketInstanceId=n,this.featureIndex=c,this.sourceLayerIndex=p,this.bucketIndex=y,this.tileID=v}}class Bs{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const c=++this.maxGroupID;this.collisionGroups[n]={ID:c,predicate:p=>p.collisionGroupID===c}}return this.collisionGroups[n]}}function ai(f,n,c,p,y){const{horizontalAlign:v,verticalAlign:T}=s.getAnchorAlignment(f),S=-(v-.5)*n,I=-(T-.5)*c,k=s.evaluateVariableOffset(f,p);return new s.pointGeometry(S+k[0]*y,I+k[1]*y)}function js(f,n,c,p,y){const v=new s.pointGeometry(f,n);return c&&v._rotate(p?y:-y),v}class ac{constructor(n,c,p,y,v){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new nc(this.transform,v),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Bs(p),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,c,p,y){const v=p.getBucket(c),T=p.latestFeatureIndex;if(!v||!T||c.id!==v.layerIds[0])return;const S=v.layers[0].layout,I=p.collisionBoxArray,k=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),D=p.tileSize/s.EXTENT,U=p.tileID.toUnwrapped();this.transform.setProjection(v.projection);const G=(K=p.tileID,X=v.getProjection(),Q=this.transform,X.name===this.projection?Q.calculateProjMatrix(K.toUnwrapped()):Ls(Q,X,K));var K,X,Q;const Y=S.get("text-pitch-alignment")==="map",Z=S.get("text-rotation-alignment")==="map";c.compileFilter();const ie=c.dynamicFilter(),J=c.dynamicFilterNeedsFeature(),pe=this.transform.calculatePixelsToTileUnitsMatrix(p),fe=$t(G,p.tileID.canonical,Y,Z,this.transform,v.getProjection(),pe);let ae=null;if(Y){const ye=cn(G,p.tileID.canonical,Y,Z,this.transform,v.getProjection(),pe);ae=s.multiply([],this.transform.labelPlaneMatrix,ye)}let de=null;ie&&p.latestFeatureIndex&&(de={unwrappedTileID:U,dynamicFilter:ie,dynamicFilterNeedsFeature:J,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new sc(v.bucketInstanceId,T,v.sourceLayerIndex,v.index,p.tileID);const ue={bucket:v,layout:S,posMatrix:G,textLabelPlaneMatrix:fe,labelToScreenMatrix:ae,clippingData:de,scale:k,textPixelRatio:D,holdingForFade:p.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.evaluateSizeForZoom(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(y)for(const ye of v.sortKeyRanges){const{sortKey:Ae,symbolInstanceStart:Je,symbolInstanceEnd:be}=ye;n.push({sortKey:Ae,symbolInstanceStart:Je,symbolInstanceEnd:be,parameters:ue})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:ue})}attemptAnchorPlacement(n,c,p,y,v,T,S,I,k,D,U,G,K,X,Q,Y,Z,ie){const J=[G.textOffset0,G.textOffset1],pe=ai(n,p,y,J,v),fe=this.collisionIndex.placeCollisionBox(X,v,c,js(pe.x,pe.y,T,S,this.transform.angle),U,I,k,D.predicate);if((!Y||this.collisionIndex.placeCollisionBox(X,X.getSymbolInstanceIconSize(ie,this.transform.zoom,K),Y,js(pe.x,pe.y,T,S,this.transform.angle),U,I,k,D.predicate).box.length!==0)&&fe.box.length>0){let ae;return this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(ae=this.prevPlacement.variableOffsets[G.crossTileID].anchor),this.variableOffsets[G.crossTileID]={textOffset:J,width:p,height:y,anchor:n,textScale:v,prevAnchor:ae},this.markUsedJustification(X,n,G,Q),X.allowVerticalPlacement&&(this.markUsedOrientation(X,Q,G),this.placedOrientations[G.crossTileID]=Q),{shift:pe,placedGlyphBoxes:fe}}}placeLayerBucketPart(n,c,p,y){const{bucket:v,layout:T,posMatrix:S,textLabelPlaneMatrix:I,labelToScreenMatrix:k,clippingData:D,textPixelRatio:U,holdingForFade:G,collisionBoxArray:K,partiallyEvaluatedTextSize:X,partiallyEvaluatedIconSize:Q,collisionGroup:Y}=n.parameters,Z=T.get("text-optional"),ie=T.get("icon-optional"),J=T.get("text-allow-overlap"),pe=T.get("icon-allow-overlap"),fe=T.get("text-rotation-alignment")==="map",ae=T.get("text-pitch-alignment")==="map",de=T.get("icon-text-fit")!=="none",ue=T.get("symbol-z-order")==="viewport-y";this.transform.setProjection(v.projection);let ye=J&&(pe||!v.hasIconData()||ie),Ae=pe&&(J||!v.hasTextData()||Z);!v.collisionArrays&&K&&v.deserializeCollisionBoxes(K),p&&y&&v.updateCollisionDebugBuffers(this.transform.zoom,K);const Je=(be,Le,Ve)=>{if(D){const Er={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ir=null;if(D.dynamicFilterNeedsFeature){const Ut=this.retainedQueryData[v.bucketInstanceId];Ir=D.featureIndex.loadFeature({featureIndex:be.featureIndex,bucketIndex:Ut.bucketIndex,sourceLayerIndex:Ut.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,D.dynamicFilter)(Er,Ir,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new s.pointGeometry(be.tileAnchorX,be.tileAnchorY),this.transform.calculateDistanceTileData(D.unwrappedTileID)))return this.placements[be.crossTileID]=new Zr(!1,!1,!1,!0),void(c[be.crossTileID]=!0)}if(c[be.crossTileID])return;if(G)return void(this.placements[be.crossTileID]=new Zr(!1,!1,!1));let it=!1,Re=!1,Ke=!0,Be=!1,st=!1,ot=null,_t={box:null,offscreen:null,occluded:null},wt={box:null,offscreen:null,occluded:null},Mt=null,qt=null,gt=null,zt=0,Qt=0,Tr=0;Ve.textFeatureIndex?zt=Ve.textFeatureIndex:be.useRuntimeCollisionCircles&&(zt=be.featureIndex),Ve.verticalTextFeatureIndex&&(Qt=Ve.verticalTextFeatureIndex);const Ur=Er=>{Er.tileID=this.retainedQueryData[v.bucketInstanceId].tileID,(this.transform.elevation||Er.elevation)&&(Er.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[v.bucketInstanceId].tileID,Er.tileAnchorX,Er.tileAnchorY):0)},cr=Ve.textBox;if(cr){Ur(cr);const Er=Ut=>{let Xr=s.WritingMode.horizontal;if(v.allowVerticalPlacement&&!Ut&&this.prevPlacement){const _i=this.prevPlacement.placedOrientations[be.crossTileID];_i&&(this.placedOrientations[be.crossTileID]=_i,Xr=_i,this.markUsedOrientation(v,Xr,be))}return Xr},Ir=(Ut,Xr)=>{if(v.allowVerticalPlacement&&be.numVerticalGlyphVertices>0&&Ve.verticalTextBox){for(const _i of v.writingModes)if(_i===s.WritingMode.vertical?(_t=Xr(),wt=_t):_t=Ut(),_t&&_t.box&&_t.box.length)break}else _t=Ut()};if(T.get("text-variable-anchor")){let Ut=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[be.crossTileID]){const _r=this.prevPlacement.variableOffsets[be.crossTileID];Ut.indexOf(_r.anchor)>0&&(Ut=Ut.filter(gi=>gi!==_r.anchor),Ut.unshift(_r.anchor))}const Xr=(_r,gi,vo)=>{const Ti=v.getSymbolInstanceTextSize(X,be,this.transform.zoom,Le),xo=(_r.x2-_r.x1)*Ti+2*_r.padding,bo=(_r.y2-_r.y1)*Ti+2*_r.padding,wo=de&&!pe?gi:null;wo&&Ur(wo);let Ei={box:[],offscreen:!1,occluded:!1};const To=J?2*Ut.length:Ut.length;for(let Yn=0;Yn<To;++Yn){const la=this.attemptAnchorPlacement(Ut[Yn%Ut.length],_r,xo,bo,Ti,fe,ae,U,S,Y,Yn>=Ut.length,be,Le,v,vo,wo,X,Q);if(la&&(Ei=la.placedGlyphBoxes,Ei&&Ei.box&&Ei.box.length)){it=!0,ot=la.shift;break}}return Ei};Ir(()=>Xr(cr,Ve.iconBox,s.WritingMode.horizontal),()=>{const _r=Ve.verticalTextBox;return _r&&Ur(_r),v.allowVerticalPlacement&&!(_t&&_t.box&&_t.box.length)&&be.numVerticalGlyphVertices>0&&_r?Xr(_r,Ve.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),_t&&(it=_t.box,Ke=_t.offscreen,Be=_t.occluded);const _i=Er(_t&&_t.box);if(!it&&this.prevPlacement){const _r=this.prevPlacement.variableOffsets[be.crossTileID];_r&&(this.variableOffsets[be.crossTileID]=_r,this.markUsedJustification(v,_r.anchor,be,_i))}}else{const Ut=(Xr,_i)=>{const _r=v.getSymbolInstanceTextSize(X,be,this.transform.zoom,Le),gi=this.collisionIndex.placeCollisionBox(v,_r,Xr,new s.pointGeometry(0,0),J,U,S,Y.predicate);return gi&&gi.box&&gi.box.length&&(this.markUsedOrientation(v,_i,be),this.placedOrientations[be.crossTileID]=_i),gi};Ir(()=>Ut(cr,s.WritingMode.horizontal),()=>{const Xr=Ve.verticalTextBox;return v.allowVerticalPlacement&&be.numVerticalGlyphVertices>0&&Xr?(Ur(Xr),Ut(Xr,s.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Er(_t&&_t.box&&_t.box.length)}}if(Mt=_t,it=Mt&&Mt.box&&Mt.box.length>0,Ke=Mt&&Mt.offscreen,Be=Mt&&Mt.occluded,be.useRuntimeCollisionCircles){const Er=v.text.placedSymbolArray.get(be.centerJustifiedTextSymbolIndex>=0?be.centerJustifiedTextSymbolIndex:be.verticalPlacedTextSymbolIndex),Ir=s.evaluateSizeForFeature(v.textSizeData,X,Er),Ut=T.get("text-padding");qt=this.collisionIndex.placeCollisionCircles(v,J,Er,v.lineVertexArray,v.glyphOffsetArray,Ir,S,I,k,p,ae,Y.predicate,be.collisionCircleDiameter*Ir/s.ONE_EM,Ut,this.retainedQueryData[v.bucketInstanceId].tileID),it=J||qt.circles.length>0&&!qt.collisionDetected,Ke=Ke&&qt.offscreen,Be=qt.occluded}if(Ve.iconFeatureIndex&&(Tr=Ve.iconFeatureIndex),Ve.iconBox){const Er=Ir=>{Ur(Ir);const Ut=de&&ot?js(ot.x,ot.y,fe,ae,this.transform.angle):new s.pointGeometry(0,0),Xr=v.getSymbolInstanceIconSize(Q,this.transform.zoom,Le);return this.collisionIndex.placeCollisionBox(v,Xr,Ir,Ut,pe,U,S,Y.predicate)};wt&&wt.box&&wt.box.length&&Ve.verticalIconBox?(gt=Er(Ve.verticalIconBox),Re=gt.box.length>0):(gt=Er(Ve.iconBox),Re=gt.box.length>0),Ke=Ke&&gt.offscreen,st=gt.occluded}const ui=Z||be.numHorizontalGlyphVertices===0&&be.numVerticalGlyphVertices===0,dn=ie||be.numIconVertices===0;if(ui||dn?dn?ui||(Re=Re&&it):it=Re&&it:Re=it=Re&&it,it&&Mt&&Mt.box&&this.collisionIndex.insertCollisionBox(Mt.box,T.get("text-ignore-placement"),v.bucketInstanceId,wt&&wt.box&&Qt?Qt:zt,Y.ID),Re&&gt&&this.collisionIndex.insertCollisionBox(gt.box,T.get("icon-ignore-placement"),v.bucketInstanceId,Tr,Y.ID),qt&&(it&&this.collisionIndex.insertCollisionCircles(qt.circles,T.get("text-ignore-placement"),v.bucketInstanceId,zt,Y.ID),p)){const Er=v.bucketInstanceId;let Ir=this.collisionCircleArrays[Er];Ir===void 0&&(Ir=this.collisionCircleArrays[Er]=new Fs);for(let Ut=0;Ut<qt.circles.length;Ut+=4)Ir.circles.push(qt.circles[Ut+0]),Ir.circles.push(qt.circles[Ut+1]),Ir.circles.push(qt.circles[Ut+2]),Ir.circles.push(qt.collisionDetected?1:0)}const Mn=v.projection.name!=="globe";ye=ye&&(Mn||!Be),Ae=Ae&&(Mn||!st),this.placements[be.crossTileID]=new Zr(it||ye,Re||Ae,Ke||v.justReloaded),c[be.crossTileID]=!0};if(ue){const be=v.getSortedSymbolIndexes(this.transform.angle);for(let Le=be.length-1;Le>=0;--Le){const Ve=be[Le];Je(v.symbolInstances.get(Ve),Ve,v.collisionArrays[Ve])}}else for(let be=n.symbolInstanceStart;be<n.symbolInstanceEnd;be++)Je(v.symbolInstances.get(be),be,v.collisionArrays[be]);if(p&&v.bucketInstanceId in this.collisionCircleArrays){const be=this.collisionCircleArrays[v.bucketInstanceId];s.invert(be.invProjMatrix,S),be.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(n,c,p,y){let v;v=y===s.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[s.getAnchorJustification(c)];const T=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const S of T)S>=0&&(n.text.placedSymbolArray.get(S).crossTileID=v>=0&&S!==v?0:p.crossTileID)}markUsedOrientation(n,c,p){const y=c===s.WritingMode.horizontal||c===s.WritingMode.horizontalOnly?c:0,v=c===s.WritingMode.vertical?c:0,T=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const S of T)n.text.placedSymbolArray.get(S).placedOrientation=y;p.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let p=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const y=c?c.symbolFadeChange(n):1,v=c?c.opacities:{},T=c?c.variableOffsets:{},S=c?c.placedOrientations:{};for(const I in this.placements){const k=this.placements[I],D=v[I];D?(this.opacities[I]=new Zn(D,y,k.text,k.icon,null,k.clipped),p=p||k.text!==D.text.placed||k.icon!==D.icon.placed):(this.opacities[I]=new Zn(null,y,k.text,k.icon,k.skipFade,k.clipped),p=p||k.text||k.icon)}for(const I in v){const k=v[I];if(!this.opacities[I]){const D=new Zn(k,y,!1,!1);D.isHidden()||(this.opacities[I]=D,p=p||k.text.placed||k.icon.placed)}}for(const I in T)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=T[I]);for(const I in S)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=S[I]);p?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:n)}updateLayerOpacities(n,c){const p={};for(const y of c){const v=y.getBucket(n);v&&y.latestFeatureIndex&&n.id===v.layerIds[0]&&this.updateBucketOpacities(v,p,y.collisionBoxArray)}}updateBucketOpacities(n,c,p){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const y=n.layers[0].layout,v=!!n.layers[0].dynamicFilter(),T=new Zn(null,0,!1,!1,!0),S=y.get("text-allow-overlap"),I=y.get("icon-allow-overlap"),k=y.get("text-variable-anchor"),D=y.get("text-rotation-alignment")==="map",U=y.get("text-pitch-alignment")==="map",G=y.get("icon-text-fit")!=="none",K=new Zn(null,0,S&&(I||!n.hasIconData()||y.get("icon-optional")),I&&(S||!n.hasTextData()||y.get("text-optional")),!0);!n.collisionArrays&&p&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(p);const X=(Y,Z,ie)=>{for(let J=0;J<Z/4;J++)Y.opacityVertexArray.emplaceBack(ie)};let Q=0;for(let Y=0;Y<n.symbolInstances.length;Y++){const Z=n.symbolInstances.get(Y),{numHorizontalGlyphVertices:ie,numVerticalGlyphVertices:J,crossTileID:pe}=Z;let fe=this.opacities[pe];c[pe]?fe=T:fe||(fe=K,this.opacities[pe]=fe),c[pe]=!0;const ae=ie>0||J>0,de=Z.numIconVertices>0,ue=this.placedOrientations[Z.crossTileID],ye=ue===s.WritingMode.vertical,Ae=ue===s.WritingMode.horizontal||ue===s.WritingMode.horizontalOnly;if(!ae&&!de||fe.isHidden()||Q++,ae){const Je=mo(fe.text);X(n.text,ie,ye?hn:Je),X(n.text,J,Ae?hn:Je);const be=fe.text.isHidden();[Z.rightJustifiedTextSymbolIndex,Z.centerJustifiedTextSymbolIndex,Z.leftJustifiedTextSymbolIndex].forEach(it=>{it>=0&&(n.text.placedSymbolArray.get(it).hidden=be||ye?1:0)}),Z.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(Z.verticalPlacedTextSymbolIndex).hidden=be||Ae?1:0);const Le=this.variableOffsets[Z.crossTileID];Le&&this.markUsedJustification(n,Le.anchor,Z,ue);const Ve=this.placedOrientations[Z.crossTileID];Ve&&(this.markUsedJustification(n,"left",Z,Ve),this.markUsedOrientation(n,Ve,Z))}if(de){const Je=mo(fe.icon);Z.placedIconSymbolIndex>=0&&(X(n.icon,Z.numIconVertices,ye?hn:Je),n.icon.placedSymbolArray.get(Z.placedIconSymbolIndex).hidden=fe.icon.isHidden()),Z.verticalPlacedIconSymbolIndex>=0&&(X(n.icon,Z.numVerticalIconVertices,Ae?hn:Je),n.icon.placedSymbolArray.get(Z.verticalPlacedIconSymbolIndex).hidden=fe.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Je=n.collisionArrays[Y];if(Je){let be=new s.pointGeometry(0,0),Le=!0;if(Je.textBox||Je.verticalTextBox){if(k){const it=this.variableOffsets[pe];it?(be=ai(it.anchor,it.width,it.height,it.textOffset,it.textScale),D&&be._rotate(U?this.transform.angle:-this.transform.angle)):Le=!1}v&&(Le=!fe.clipped),Je.textBox&&Xi(n.textCollisionBox.collisionVertexArray,fe.text.placed,!Le||ye,be.x,be.y),Je.verticalTextBox&&Xi(n.textCollisionBox.collisionVertexArray,fe.text.placed,!Le||Ae,be.x,be.y)}const Ve=Le&&Boolean(!Ae&&Je.verticalIconBox);Je.iconBox&&Xi(n.iconCollisionBox.collisionVertexArray,fe.icon.placed,Ve,G?be.x:0,G?be.y:0),Je.verticalIconBox&&Xi(n.iconCollisionBox.collisionVertexArray,fe.icon.placed,!Ve,G?be.x:0,G?be.y:0)}}}if(n.fullyClipped=Q===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const Y=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=Y.invProjMatrix,n.placementViewportMatrix=Y.viewportMatrix,n.collisionCircleArray=Y.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,c){const p=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*p>n}setStale(){this.stale=!0}}function Xi(f,n,c,p,y){f.emplaceBack(n?1:0,c?1:0,p||0,y||0),f.emplaceBack(n?1:0,c?1:0,p||0,y||0),f.emplaceBack(n?1:0,c?1:0,p||0,y||0),f.emplaceBack(n?1:0,c?1:0,p||0,y||0)}const Ns=Math.pow(2,25),Fa=Math.pow(2,24),cp=Math.pow(2,17),lc=Math.pow(2,16),Ho=Math.pow(2,9),up=Math.pow(2,8),lh=Math.pow(2,1);function mo(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const n=f.placed?1:0,c=Math.floor(127*f.opacity);return c*Ns+n*Fa+c*cp+n*lc+c*Ho+n*up+c*lh+n}const hn=0;class Ba{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,c,p,y,v){const T=this._bucketParts;for(;this._currentTileIndex<n.length;)if(c.getBucketParts(T,y,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((S,I)=>S.sortKey-I.sortKey));this._currentPartIndex<T.length;){const S=T[this._currentPartIndex];if(c.placeLayerBucketPart(S,this._seenCrossTileIDs,p,S.symbolInstanceStart===0),this._currentPartIndex++,v())return!0}return!1}}class Hn{constructor(n,c,p,y,v,T,S,I){this.placement=new ac(n,v,T,S,I),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(n,c,p){const y=s.exported.now(),v=()=>{const T=s.exported.now()-y;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){const T=c[n[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=S)&&(!T.maxzoom||T.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Ba(T)),this._inProgressLayer.continuePlacement(p[T.source],this.placement,this._showCollisionBoxes,T,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const cc=512/s.EXTENT/2;class ja{constructor(n,c,p){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let y=0;y<c.length;y++){const v=c.get(y),T=v.key;this.indexedSymbolInstances[T]||(this.indexedSymbolInstances[T]=[]),this.indexedSymbolInstances[T].push({crossTileID:v.crossTileID,coord:this.getScaledCoordinates(v,n)})}}getScaledCoordinates(n,c){const p=cc/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*s.EXTENT+n.tileAnchorX)*p),y:Math.floor((c.canonical.y*s.EXTENT+n.tileAnchorY)*p)}}findMatches(n,c,p){const y=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let v=0;v<n.length;v++){const T=n.get(v);if(T.crossTileID)continue;const S=this.indexedSymbolInstances[T.key];if(!S)continue;const I=this.getScaledCoordinates(T,c);for(const k of S)if(Math.abs(k.coord.x-I.x)<=y&&Math.abs(k.coord.y-I.y)<=y&&!p[k.crossTileID]){p[k.crossTileID]=!0,T.crossTileID=k.crossTileID;break}}}}class hp{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class fp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const c=Math.round((n-this.lng)/360);if(c!==0)for(const p in this.indexes){const y=this.indexes[p],v={};for(const T in y){const S=y[T];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+c),v[S.tileID.key]=S}this.indexes[p]=v}this.lng=n}addBucket(n,c,p){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let v=0;v<c.symbolInstances.length;v++)c.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const y=this.usedCrossTileIDs[n.overscaledZ];for(const v in this.indexes){const T=this.indexes[v];if(Number(v)>n.overscaledZ)for(const S in T){const I=T[S];I.tileID.isChildOf(n)&&I.findMatches(c.symbolInstances,n,y)}else{const S=T[n.scaledTo(Number(v)).key];S&&S.findMatches(c.symbolInstances,n,y)}}for(let v=0;v<c.symbolInstances.length;v++){const T=c.symbolInstances.get(v);T.crossTileID||(T.crossTileID=p.generate(),y[T.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new ja(n,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(n,c){for(const p in c.indexedSymbolInstances)for(const y of c.indexedSymbolInstances[p])delete this.usedCrossTileIDs[n][y.crossTileID]}removeStaleBuckets(n){let c=!1;for(const p in this.indexes){const y=this.indexes[p];for(const v in y)n[y[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,y[v]),delete y[v],c=!0)}return c}}class Na{constructor(){this.layerIndexes={},this.crossTileIDs=new hp,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,c,p,y){let v=this.layerIndexes[n.id];v===void 0&&(v=this.layerIndexes[n.id]=new fp);let T=!1;const S={};y.name!=="globe"&&v.handleWrapJump(p);for(const I of c){const k=I.getBucket(n);k&&n.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(I.tileID,k,this.crossTileIDs)&&(T=!0),S[k.bucketInstanceId]=!0)}return v.removeStaleBuckets(S)&&(T=!0),T}pruneUnusedLayers(n){const c={};n.forEach(p=>{c[p]=!0});for(const p in this.layerIndexes)c[p]||delete this.layerIndexes[p]}}const Ua=(f,n)=>s.emitValidationErrors(f,n&&n.filter(c=>c.identifier!=="source.canvas")),ch=s.pick(Tt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),dp=s.pick(Tt,["setCenter","setZoom","setBearing","setPitch"]),uh={version:8,layers:[],sources:{}},pp={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Qi extends s.Evented{constructor(n,c={}){super(),this.map=n,this.dispatcher=new kr(sr(),this),this.imageManager=new tt,this.imageManager.setEventedParent(this),this.glyphManager=new s.GlyphManager(n._requestManager,c.localFontFamily?s.LocalGlyphMode.all:c.localIdeographFontFamily?s.LocalGlyphMode.ideographs:s.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.lineAtlas=new s.LineAtlas(256,512),this.crossTileSymbolIndex=new Na,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new s.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const p=this;this._rtlTextPluginCallback=Qi.registerForPluginStateChange(y=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(v,T)=>{if(s.triggerPluginCompletionEvent(v),T&&T.every(S=>S))for(const S in p._sourceCaches){const I=p._sourceCaches[S],k=I.getSource().type;k!=="vector"&&k!=="geojson"||I.reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const v=this.getSource(y.sourceId);if(v&&v.vectorLayerIds)for(const T in this._layers){const S=this._layers[T];S.source===v.id&&this._validateLayer(S)}})}loadURL(n,c={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const p=typeof c.validate=="boolean"?c.validate:!s.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,c.accessToken);const y=this.map._requestManager.transformRequest(n,s.ResourceType.Style);this._request=s.getJSON(y,(v,T)=>{this._request=null,v?this.fire(new s.ErrorEvent(v)):T&&this._load(T,p)})}loadJSON(n,c={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame(()=>{this._request=null,this._load(n,c.validate!==!1)})}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(uh,!1)}_updateLayerCount(n,c){const p=c?1:-1;n.is3D()&&(this._num3DLayers+=p),n.type==="circle"&&(this._numCircleLayers+=p),n.type==="symbol"&&(this._numSymbolLayers+=p)}_load(n,c){if(c&&Ua(this,s.validateStyle(n)))return;this._loaded=!0,this.stylesheet=s.clone$1(n),this._updateMapProjection();for(const y in n.sources)this.addSource(y,n.sources[y],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const p=ar(this.stylesheet.layers);this._order=p.map(y=>y.id),this._layers={},this._serializedLayers={};for(let y of p)y=s.createStyleLayer(y),y.setEventedParent(this,{layer:{id:y.id}}),this._layers[y.id]=y,this._serializedLayers[y.id]=y.serialize(),this._updateLayerCount(y,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new zr(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(n){this._spriteRequest=function(c,p,y){let v,T,S;const I=s.exported.devicePixelRatio>1?"@2x":"";let k=s.getJSON(p.transformRequest(p.normalizeSpriteURL(c,I,".json"),s.ResourceType.SpriteJSON),(G,K)=>{k=null,S||(S=G,v=K,U())}),D=s.getImage(p.transformRequest(p.normalizeSpriteURL(c,I,".png"),s.ResourceType.SpriteImage),(G,K)=>{D=null,S||(S=G,T=K,U())});function U(){if(S)y(S);else if(v&&T){const G=s.exported.getImageData(T),K={};for(const X in v){const{width:Q,height:Y,x:Z,y:ie,sdf:J,pixelRatio:pe,stretchX:fe,stretchY:ae,content:de}=v[X],ue=new s.RGBAImage({width:Q,height:Y});s.RGBAImage.copy(G,ue,{x:Z,y:ie},{x:0,y:0},{width:Q,height:Y}),K[X]={data:ue,pixelRatio:pe,sdf:J,stretchX:fe,stretchY:ae,content:de}}y(null,K)}}return{cancel(){k&&(k.cancel(),k=null),D&&(D.cancel(),D=null)}}}(n,this.map._requestManager,(c,p)=>{if(this._spriteRequest=null,c)this.fire(new s.ErrorEvent(c));else if(p)for(const y in p)this.imageManager.addImage(y,p[y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new s.Event("data",{dataType:"style"}))})}_validateLayer(n){const c=this.getSource(n.source);if(!c)return;const p=n.sourceLayer;p&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(p)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${c.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const c=[];for(const p of n){const y=this._layers[p];y.type!=="custom"&&c.push(y.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&pp[n.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const c=this._changed;if(this._changed){const y=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(y.length||v.length)&&this._updateWorkerLayers(y,v);for(const T in this._updatedSources){const S=this._updatedSources[T];S==="reload"?this._reloadSource(T):S==="clear"&&this._clearSource(T)}this._updateTilesForChangedImages();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const p={};for(const y in this._sourceCaches){const v=this._sourceCaches[y];p[y]=v.used,v.used=!1}for(const y of this._order){const v=this._layers[y];if(v.recalculate(n,this._availableImages),!v.isHidden(n.zoom)){const S=this._getLayerSourceCache(v);S&&(S.used=!0)}const T=this.map.painter;if(T){const S=v.getProgramIds();if(!S)continue;const I=v.getProgramConfiguration(n.zoom);for(const k of S)T.useProgram(k,I)}}for(const y in p){const v=this._sourceCaches[y];p[y]!==v.used&&v.getSource().fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:v.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),Ua(this,s.validateStyle(n)))return!1;(n=s.clone$1(n)).layers=ar(n.layers);const c=function(y,v){if(!y)return[{command:Tt.setStyle,args:[v]}];let T=[];try{if(!A(y.version,v.version))return[{command:Tt.setStyle,args:[v]}];A(y.center,v.center)||T.push({command:Tt.setCenter,args:[v.center]}),A(y.zoom,v.zoom)||T.push({command:Tt.setZoom,args:[v.zoom]}),A(y.bearing,v.bearing)||T.push({command:Tt.setBearing,args:[v.bearing]}),A(y.pitch,v.pitch)||T.push({command:Tt.setPitch,args:[v.pitch]}),A(y.sprite,v.sprite)||T.push({command:Tt.setSprite,args:[v.sprite]}),A(y.glyphs,v.glyphs)||T.push({command:Tt.setGlyphs,args:[v.glyphs]}),A(y.transition,v.transition)||T.push({command:Tt.setTransition,args:[v.transition]}),A(y.light,v.light)||T.push({command:Tt.setLight,args:[v.light]}),A(y.fog,v.fog)||T.push({command:Tt.setFog,args:[v.fog]}),A(y.projection,v.projection)||T.push({command:Tt.setProjection,args:[v.projection]});const S={},I=[];(function(U,G,K,X){let Q;for(Q in G=G||{},U=U||{})U.hasOwnProperty(Q)&&(G.hasOwnProperty(Q)||Ui(Q,K,X));for(Q in G)G.hasOwnProperty(Q)&&(U.hasOwnProperty(Q)?A(U[Q],G[Q])||(U[Q].type==="geojson"&&G[Q].type==="geojson"&&$n(U,G,Q)?K.push({command:Tt.setGeoJSONSourceData,args:[Q,G[Q].data]}):Nr(Q,G,K,X)):ke(Q,G,K))})(y.sources,v.sources,I,S);const k=[];y.layers&&y.layers.forEach(U=>{U.source&&S[U.source]?T.push({command:Tt.removeLayer,args:[U.id]}):k.push(U)});let D=y.terrain;D&&S[D.source]&&(T.push({command:Tt.setTerrain,args:[void 0]}),D=void 0),T=T.concat(I),A(D,v.terrain)||T.push({command:Tt.setTerrain,args:[v.terrain]}),function(U,G,K){G=G||[];const X=(U=U||[]).map(ln),Q=G.map(ln),Y=U.reduce(Oa,{}),Z=G.reduce(Oa,{}),ie=X.slice(),J=Object.create(null);let pe,fe,ae,de,ue,ye,Ae;for(pe=0,fe=0;pe<X.length;pe++)ae=X[pe],Z.hasOwnProperty(ae)?fe++:(K.push({command:Tt.removeLayer,args:[ae]}),ie.splice(ie.indexOf(ae,fe),1));for(pe=0,fe=0;pe<Q.length;pe++)ae=Q[Q.length-1-pe],ie[ie.length-1-pe]!==ae&&(Y.hasOwnProperty(ae)?(K.push({command:Tt.removeLayer,args:[ae]}),ie.splice(ie.lastIndexOf(ae,ie.length-fe),1)):fe++,ye=ie[ie.length-pe],K.push({command:Tt.addLayer,args:[Z[ae],ye]}),ie.splice(ie.length-pe,0,ae),J[ae]=!0);for(pe=0;pe<Q.length;pe++)if(ae=Q[pe],de=Y[ae],ue=Z[ae],!J[ae]&&!A(de,ue))if(A(de.source,ue.source)&&A(de["source-layer"],ue["source-layer"])&&A(de.type,ue.type)){for(Ae in Da(de.layout,ue.layout,K,ae,null,Tt.setLayoutProperty),Da(de.paint,ue.paint,K,ae,null,Tt.setPaintProperty),A(de.filter,ue.filter)||K.push({command:Tt.setFilter,args:[ae,ue.filter]}),A(de.minzoom,ue.minzoom)&&A(de.maxzoom,ue.maxzoom)||K.push({command:Tt.setLayerZoomRange,args:[ae,ue.minzoom,ue.maxzoom]}),de)de.hasOwnProperty(Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&(Ae.indexOf("paint.")===0?Da(de[Ae],ue[Ae],K,ae,Ae.slice(6),Tt.setPaintProperty):A(de[Ae],ue[Ae])||K.push({command:Tt.setLayerProperty,args:[ae,Ae,ue[Ae]]}));for(Ae in ue)ue.hasOwnProperty(Ae)&&!de.hasOwnProperty(Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&(Ae.indexOf("paint.")===0?Da(de[Ae],ue[Ae],K,ae,Ae.slice(6),Tt.setPaintProperty):A(de[Ae],ue[Ae])||K.push({command:Tt.setLayerProperty,args:[ae,Ae,ue[Ae]]}))}else K.push({command:Tt.removeLayer,args:[ae]}),ye=ie[ie.lastIndexOf(ae)+1],K.push({command:Tt.addLayer,args:[ue,ye]})}(k,v.layers,T)}catch(S){console.warn("Unable to compute style diff:",S),T=[{command:Tt.setStyle,args:[v]}]}return T}(this.serialize(),n).filter(y=>!(y.command in dp));if(c.length===0)return!1;const p=c.filter(y=>!(y.command in ch));if(p.length>0)throw new Error(`Unimplemented: ${p.map(y=>y.command).join(", ")}.`);return c.forEach(y=>{y.command!=="setTransition"&&y.command!=="setProjection"&&this[y.command].apply(this,y.args)}),this.stylesheet=n,this._updateMapProjection(),!0}addImage(n,c){return this.getImage(n)?this.fire(new s.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,c),this._afterImageUpdated(n),this)}updateImage(n,c){this.imageManager.updateImage(n,c)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n),this._afterImageUpdated(n),this):this.fire(new s.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,c,p={}){if(this._checkLoaded(),this.getSource(n)!==void 0)throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(s.validateSource,`sources.${n}`,c,null,p))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const y=Ee(n,c,this.dispatcher,this);y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(n),source:y.serialize(),sourceId:n}));const v=T=>{const S=(T?"symbol:":"other:")+n,I=this._sourceCaches[S]=new s.SourceCache(S,y,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[n]=I,I.style=this,I.onAdd(this.map)};v(!1),c.type!=="vector"&&c.type!=="geojson"||v(!0),y.onAdd&&y.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const c=this.getSource(n);if(!c)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===n)return this.fire(new s.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new s.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const p=this._getSourceCaches(n);for(const y of p)delete this._sourceCaches[y.id],delete this._updatedSources[y.id],y.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles();return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(n,c){this._checkLoaded(),this.getSource(n).setData(c),this._changed=!0}getSource(n){const c=this._getSourceCache(n);return c&&c.getSource()}addLayer(n,c,p={}){this._checkLoaded();const y=n.id;if(this.getLayer(y))return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${y}" already exists on this map`)));let v;if(n.type==="custom"){if(Ua(this,s.validateCustomStyleLayer(n)))return;v=s.createStyleLayer(n)}else{if(typeof n.source=="object"&&(this.addSource(y,n.source),n=s.clone$1(n),n=s.extend(n,{source:y})),this._validate(s.validateLayer,`layers.${y}`,n,{arrayIndex:-1},p))return;v=s.createStyleLayer(n),this._validateLayer(v),v.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}const T=c?this._order.indexOf(c):this._order.length;if(c&&T===-1)return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(T,0,y),this._layerOrderChanged=!0,this._layers[y]=v;const S=this._getLayerSourceCache(v);if(this._removedLayers[y]&&v.source&&S&&v.type!=="custom"){const I=this._removedLayers[y];delete this._removedLayers[y],I.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",S.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,c){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===c)return;const p=this._order.indexOf(n);this._order.splice(p,1);const y=c?this._order.indexOf(c):this._order.length;c&&y===-1?this.fire(new s.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(y,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const c=this._layers[n];if(!c)return void this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const p=this._order.indexOf(n);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=c,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const c in this._layers)if(this._layers[c].type===n)return!0;return!1}setLayerZoomRange(n,c,p){this._checkLoaded();const y=this.getLayer(n);y?y.minzoom===c&&y.maxzoom===p||(c!=null&&(y.minzoom=c),p!=null&&(y.maxzoom=p),this._updateLayer(y)):this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,c,p={}){this._checkLoaded();const y=this.getLayer(n);if(y){if(!A(y.filter,c))return c==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(s.validateFilter,`layers.${y.id}.filter`,c,{layerType:y.type},p)||(y.filter=s.clone$1(c),this._updateLayer(y)))}else this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){const c=this.getLayer(n);return c&&s.clone$1(c.filter)}setLayoutProperty(n,c,p,y={}){this._checkLoaded();const v=this.getLayer(n);v?A(v.getLayoutProperty(c),p)||(v.setLayoutProperty(c,p,y),this._updateLayer(v)):this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,c){const p=this.getLayer(n);if(p)return p.getLayoutProperty(c);this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,c,p,y={}){this._checkLoaded();const v=this.getLayer(n);v?A(v.getPaintProperty(c),p)||(v.setPaintProperty(c,p,y)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,c){const p=this.getLayer(n);return p&&p.getPaintProperty(c)}setFeatureState(n,c){this._checkLoaded();const p=n.source,y=n.sourceLayer,v=this.getSource(p);if(!v)return void this.fire(new s.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const T=v.type;if(T==="geojson"&&y)return void this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!y)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(p);for(const I of S)I.setFeatureState(y,n.id,c)}removeFeatureState(n,c){this._checkLoaded();const p=n.source,y=this.getSource(p);if(!y)return void this.fire(new s.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const v=y.type,T=v==="vector"?n.sourceLayer:void 0;if(v==="vector"&&!T)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(p);for(const I of S)I.removeFeatureState(T,n.id,c)}getFeatureState(n){this._checkLoaded();const c=n.source,p=n.sourceLayer,y=this.getSource(c);if(y){if(y.type!=="vector"||p)return n.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(p,n.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const c in this._sourceCaches){const p=this._sourceCaches[c].getSource();n[p.id]||(n[p.id]=p.serialize())}return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},c=>c!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0;const c=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&c&&c.getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",c.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const c=T=>this._layers[T].type==="fill-extrusion",p={},y=[];for(let T=this._order.length-1;T>=0;T--){const S=this._order[T];if(c(S)){p[S]=T;for(const I of n){const k=I[S];if(k)for(const D of k)y.push(D)}}}y.sort((T,S)=>S.intersectionZ-T.intersectionZ);const v=[];for(let T=this._order.length-1;T>=0;T--){const S=this._order[T];if(c(S))for(let I=y.length-1;I>=0;I--){const k=y[I].feature;if(p[k.layer.id]<T)break;v.push(k),y.pop()}else for(const I of n){const k=I[S];if(k)for(const D of k)v.push(D.feature)}}return v}queryRenderedFeatures(n,c,p){c&&c.filter&&this._validate(s.validateFilter,"queryRenderedFeatures.filter",c.filter,null,c);const y={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const I of c.layers){const k=this._layers[I];if(!k)return this.fire(new s.ErrorEvent(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];y[k.source]=!0}}const v=[];c.availableImages=this._availableImages;const T=c&&c.layers?c.layers.some(I=>{const k=this.getLayer(I);return k&&k.is3D()}):this.has3DLayers(),S=oi.createFromScreenPoints(n,p);for(const I in this._sourceCaches){const k=this._sourceCaches[I].getSource().id;c.layers&&!y[k]||v.push(ct(this._sourceCaches[I],this._layers,this._serializedLayers,S,c,p,T,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(I,k,D,U,G,K,X){const Q={},Y=K.queryRenderedSymbols(U),Z=[];for(const ie of Object.keys(Y).map(Number))Z.push(X[ie]);Z.sort(Et);for(const ie of Z){const J=ie.featureIndex.lookupSymbolFeatures(Y[ie.bucketInstanceId],k,ie.bucketIndex,ie.sourceLayerIndex,G.filter,G.layers,G.availableImages,I);for(const pe in J){const fe=Q[pe]=Q[pe]||[],ae=J[pe];ae.sort((de,ue)=>{const ye=ie.featureSortOrder;if(ye){const Ae=ye.indexOf(de.featureIndex);return ye.indexOf(ue.featureIndex)-Ae}return ue.featureIndex-de.featureIndex});for(const de of ae)fe.push(de)}}for(const ie in Q)Q[ie].forEach(J=>{const pe=J.feature,fe=D(I[ie]).getFeatureState(pe.layer["source-layer"],pe.id);pe.source=pe.layer.source,pe.layer["source-layer"]&&(pe.sourceLayer=pe.layer["source-layer"]),pe.state=fe});return Q}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(n,c){c&&c.filter&&this._validate(s.validateFilter,"querySourceFeatures.filter",c.filter,null,c);const p=this._getSourceCaches(n);let y=[];for(const v of p)y=y.concat(Qe(v,c));return y}addSourceType(n,c,p){return Qi.getSourceType(n)?p(new Error(`A source type called "${n}" already exists.`)):(Qi.setSourceType(n,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:c.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(n,c={}){this._checkLoaded();const p=this.light.getLight();let y=!1;for(const T in n)if(!A(n[T],p[T])){y=!0;break}if(!y)return;const v=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(n,c),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,c=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(c===1){if(typeof n.source=="object"){const p="terrain-dem-src";this.addSource(p,n.source),n=s.clone$1(n),n=s.extend(n,{source:p})}if(this._validate(s.validateTerrain,"terrain",n))return}if(!this.terrain||this.terrain&&c!==this.terrain.drapeRenderMode)this._createTerrain(n,c);else{const p=this.terrain,y=p.get();for(const v of Object.keys(s.spec.terrain))!n.hasOwnProperty(v)&&s.spec.terrain[v].default&&(n[v]=s.spec.terrain[v].default);for(const v in n)if(!A(n[v],y[v])){p.set(n),this.stylesheet.terrain=n;const T=this._setTransitionParameters({duration:0});p.updateTransitions(T);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const c=this.fog=new hr(n,this.map.transform);this.stylesheet.fog=n;const p=this._setTransitionParameters({duration:0});c.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,p=c.get();Object.keys(n).length===0&&c.set(n);for(const y in n)if(!A(n[y],p[y])){c.set(n),this.stylesheet.fog=n;const v=this._setTransitionParameters({duration:0});c.updateTransitions(v);break}}else this._createFog(n);this._markersNeedUpdate=!0}_setTransitionParameters(n){return{now:s.exported.now(),transition:s.extend(n,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(p=>this.isLayerDraped(this._layers[p])),c=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...c)}_createTerrain(n,c){const p=this.terrain=new Wr(n,c);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const y=this._setTransitionParameters({duration:0});p.updateTransitions(y)}_force3DLayerUpdate(){for(const n in this._layers){const c=this._layers[n];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const c=this._layers[n];c.type==="symbol"&&this._updateLayer(c)}}_validate(n,c,p,y,v={}){return(!v||v.validate!==!1)&&Ua(this,n.call(s.validateStyle,s.extend({key:c,style:this.serialize(),value:p,styleSpec:s.spec},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const c=this._getSourceCaches(n);for(const p of c)p.clearTiles()}_reloadSource(n){const c=this._getSourceCaches(n);for(const p of c)p.resume(),p.reload()}_updateSources(n){for(const c in this._sourceCaches)this._sourceCaches[c].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const c=this._sourceCaches[n];c.resume(),c.reload()}}_updatePlacement(n,c,p,y,v=!1){let T=!1,S=!1;const I={};for(const k of this._order){const D=this._layers[k];if(D.type!=="symbol")continue;if(!I[D.source]){const G=this._getLayerSourceCache(D);if(!G)continue;I[D.source]=G.getRenderableIds(!0).map(K=>G.getTileByID(K)).sort((K,X)=>X.tileID.overscaledZ-K.tileID.overscaledZ||(K.tileID.isLessThan(X.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(D,I[D.source],n.center.lng,n.projection);T=T||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),v=v||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new s.Event("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),n.zoom))&&(this.pauseablePlacement=new Hn(n,this._order,v,c,p,y,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),S=!0),T&&this.pauseablePlacement.placement.setStale()),S||T)for(const k of this._order){const D=this._layers[k];D.type==="symbol"&&this.placement.updateLayerOpacities(D,I[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,c,p){this.imageManager.getImages(c.icons,p),this._updateTilesForChangedImages();const y=v=>{v&&v.setDependencies(c.tileID.key,c.type,c.icons)};y(this._otherSourceCaches[c.source]),y(this._symbolSourceCaches[c.source])}getGlyphs(n,c,p){this.glyphManager.getGlyphs(c.stacks,p)}getResource(n,c,p){return s.makeRequest(c,p)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const c=[];return this._otherSourceCaches[n]&&c.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&c.push(this._symbolSourceCaches[n]),c}_isSourceCacheLoaded(n){const c=this._getSourceCaches(n);return c.length===0?(this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${n}'`))),!1):c.every(p=>p.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Qi.getSourceType=function(f){return ge[f]},Qi.setSourceType=function(f,n){ge[f]=n},Qi.registerForPluginStateChange=s.registerForPluginStateChange;var uc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,hc="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",fc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,dc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Wo=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Va={},_o={};const Wn=[];go(uc,Wn),go(fc,Wn),go(dc,Wn),go(Wo,Wn),Va=Jt("",fc),_o=Jt(Wo,dc);const Us=Jt(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),$a=uc,Ga=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var qa={background:Jt(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Jt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Jt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Jt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Jt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Jt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Jt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Jt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Jt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Jt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Jt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Jt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Jt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Jt(`uniform lowp vec3 u_lightpos;varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
void main() {vec4 color=v_color;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color_normal(color.xyz,normalize(v_normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying highp vec3 v_normal;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;vec3 pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_normal=normal;v_depth=gl_Position.w;
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Jt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Jt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Jt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Jt(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
highp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);
#else
vec4 out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Jt(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Jt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Jt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Jt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Jt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Jt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Jt(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Jt(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,hc),skyboxGradient:Jt(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,hc),skyboxCapture:Jt(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Jt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
vec4 color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;
#ifdef GLOBE_POLES
vec3 up_vector=normalize(globe_pos)*u_tile_up_scale;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Jt(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);
#ifdef PROJECTION_GLOBE_VIEW
float globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
float horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function go(f,n){const c=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of c)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=p.split(" ");for(const v of y)n.includes(v)||n.push(v)}}function Jt(f,n){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),y={},v=[...Wn];return go(f,v),go(n,v),{fragmentSource:f=f.replace(c,(T,S,I,k,D)=>(y[D]=!0,S==="define"?`
#ifndef HAS_UNIFORM_u_${D}
varying ${I} ${k} ${D};
#else
uniform ${I} ${k} u_${D};
#endif
`:`
#ifdef HAS_UNIFORM_u_${D}
    ${I} ${k} ${D} = u_${D};
#endif
`)),vertexSource:n=n.replace(c,(T,S,I,k,D)=>{const U=k==="float"?"vec2":"vec4",G=D.match(/color/)?"color":U;return y[D]?S==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
attribute ${I} ${U} a_${D};
varying ${I} ${k} ${D};
#else
uniform ${I} ${k} u_${D};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = a_${D};
#else
    ${I} ${k} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = unpack_mix_${G}(a_${D}, u_${D}_t);
#else
    ${I} ${k} ${D} = u_${D};
#endif
`:S==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
attribute ${I} ${U} a_${D};
#else
uniform ${I} ${k} u_${D};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${I} ${k} ${D} = a_${D};
#else
    ${I} ${k} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${I} ${k} ${D} = unpack_mix_${G}(a_${D}, u_${D}_t);
#else
    ${I} ${k} ${D} = u_${D};
#endif
`}),staticAttributes:p,usedDefines:v}}class Za{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,c,p,y,v,T,S){this.context=n;let I=this.boundPaintVertexBuffers.length!==y.length;for(let D=0;!I&&D<y.length;D++)this.boundPaintVertexBuffers[D]!==y[D]&&(I=!0);let k=this.boundDynamicVertexBuffers.length!==S.length;for(let D=0;!k&&D<S.length;D++)this.boundDynamicVertexBuffers[D]!==S[D]&&(k=!0);if(!n.extVertexArrayObject||!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==p||I||k||this.boundIndexBuffer!==v||this.boundVertexOffset!==T)this.freshBind(c,p,y,v,T,S);else{n.bindVertexArrayOES.set(this.vao);for(const D of S)D&&D.bind();v&&v.dynamicDraw&&v.bind()}}freshBind(n,c,p,y,v,T){let S;const I=n.numAttributes,k=this.context,D=k.gl;if(k.extVertexArrayObject)this.vao&&this.destroy(),this.vao=k.extVertexArrayObject.createVertexArrayOES(),k.bindVertexArrayOES.set(this.vao),S=0,this.boundProgram=n,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=y,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=T;else{S=k.currentNumAttributes||0;for(let U=I;U<S;U++)D.disableVertexAttribArray(U)}c.enableAttributes(D,n),c.bind(),c.setVertexAttribPointers(D,n,v);for(const U of p)U.enableAttributes(D,n),U.bind(),U.setVertexAttribPointers(D,n,v);for(const U of T)U&&(U.enableAttributes(D,n),U.bind(),U.setVertexAttribPointers(D,n,v));y&&y.bind(),k.currentNumAttributes=I}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function pc(f,n){const c=Math.pow(2,n.canonical.z),p=n.canonical.y;return[new s.MercatorCoordinate(0,p/c).toLngLat().lat,new s.MercatorCoordinate(0,(p+1)/c).toLngLat().lat]}function mc(f,n,c,p,y,v,T){const S=f.context,I=S.gl,k=c.fbo;if(!k)return;f.prepareDrawTile();const D=f.useProgram("hillshade");S.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,k.colorAttachment.get());const U=((Q,Y,Z,ie)=>{const J=Z.paint.get("hillshade-shadow-color"),pe=Z.paint.get("hillshade-highlight-color"),fe=Z.paint.get("hillshade-accent-color");let ae=Z.paint.get("hillshade-illumination-direction")*(Math.PI/180);Z.paint.get("hillshade-illumination-anchor")==="viewport"&&(ae-=Q.transform.angle);const de=!Q.options.moving;return{u_matrix:ie||Q.transform.calculateProjMatrix(Y.tileID.toUnwrapped(),de),u_image:0,u_latrange:pc(0,Y.tileID),u_light:[Z.paint.get("hillshade-exaggeration"),ae],u_shadow:J,u_highlight:pe,u_accent:fe}})(f,c,p,f.terrain?n.projMatrix:null);f.prepareDrawProgram(S,D,n.toUnwrapped());const{tileBoundsBuffer:G,tileBoundsIndexBuffer:K,tileBoundsSegments:X}=f.getTileBoundsBuffers(c);D.draw(S,I.TRIANGLES,y,v,T,s.CullFaceMode.disabled,U,p.id,G,K,X)}function Xt(f,n,c){if(!n.needsDEMTextureUpload)return;const p=f.context,y=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||f.getTileTexture(c.stride);const v=c.getPixels();n.demTexture?n.demTexture.update(v,{premultiply:!1}):n.demTexture=new s.Texture(p,v,y.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Xo(f,n,c,p,y,v){const T=f.context,S=T.gl;if(!n.dem)return;const I=n.dem;if(T.activeTexture.set(S.TEXTURE1),Xt(f,n,I),!n.demTexture)return;n.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const k=I.dim;T.activeTexture.set(S.TEXTURE0);let D=n.fbo;if(!D){const X=new s.Texture(T,{width:k,height:k,data:null},S.RGBA);X.bind(S.LINEAR,S.CLAMP_TO_EDGE),D=n.fbo=T.createFramebuffer(k,k,!0),D.colorAttachment.set(X.texture)}T.bindFramebuffer.set(D.framebuffer),T.viewport.set([0,0,k,k]);const{tileBoundsBuffer:U,tileBoundsIndexBuffer:G,tileBoundsSegments:K}=f.getMercatorTileBoundsBuffers();f.useProgram("hillshadePrepare").draw(T,S.TRIANGLES,p,y,v,s.CullFaceMode.disabled,((X,Q)=>{const Y=Q.stride,Z=s.create();return s.ortho(Z,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(Z,Z,[0,-s.EXTENT,0]),{u_matrix:Z,u_image:1,u_dimension:[Y,Y],u_zoom:X.overscaledZ,u_unpack:Q.unpackVector}})(n.tileID,I),c.id,U,G,K),n.needsHillshadePrepare=!1}const Vs=f=>({u_matrix:new s.UniformMatrix4f(f),u_image0:new s.Uniform1i(f),u_skirt_height:new s.Uniform1f(f)}),_c=(f,n)=>({u_matrix:f,u_image0:0,u_skirt_height:n}),gc=(f,n,c,p,y,v,T,S,I,k,D,U,G,K)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:c,u_zoom_transition:y,u_merc_center:v,u_image0:0,u_frustum_tl:T,u_frustum_tr:S,u_frustum_br:I,u_frustum_bl:k,u_globe_pos:D,u_globe_radius:U,u_viewport:G,u_grid_matrix:K?Float32Array.from(K):new Float32Array(9)});function yc(f,n){return f!=null&&n!=null&&!(!f.hasData()||!n.hasData())&&f.demTexture!=null&&n.demTexture!=null&&f.tileID.key!==n.tileID.key}const Xn=new class{constructor(){this.operations={}}newMorphing(f,n,c,p,y){if(f in this.operations){const v=this.operations[f];v.to.tileID.key!==c.tileID.key&&(v.queued=c)}else this.operations[f]={startTime:p,phase:0,duration:y,from:n,to:c,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const n=this.operations[f];return{from:n.from,to:n.to,phase:n.phase}}update(f){for(const n in this.operations){const c=this.operations[n];for(c.phase=(f-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,f)){delete this.operations[n];break}}}_nextOp(f,n){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=n,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},$s={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function mp(f,n){const c=1<<f.z;return!n&&(f.x===0||f.x===c-1)||f.y===0||f.y===c-1}const vc=f=>({u_matrix:f});function Ha(f,n,c,p,y){if(y>0){const v=s.exported.now(),T=(v-f.timeAdded)/y,S=n?(v-n.timeAdded)/y:-1,I=c.getSource(),k=p.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),D=!n||Math.abs(n.tileID.overscaledZ-k)>Math.abs(f.tileID.overscaledZ-k),U=D&&f.refreshedUponExpiration?1:s.clamp(D?T:1-S,0,1);return f.refreshedUponExpiration&&T>=1&&(f.refreshedUponExpiration=!1),n?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class xc extends s.SourceCache{constructor(n){const c={type:"raster-dem",maxzoom:n.transform.maxZoom},p=new kr(sr(),null),y=Ee("mock-dem",c,p,n.style);super("mock-dem",y,!1),y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,c){n.state="loaded",c(null)}}class bc extends s.SourceCache{constructor(n){const c=Ee("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new kr(sr(),null),n.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,c,p){if(n.freezeTileCoverage)return;this.transform=n;const y=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,T)=>{if(v[T.key]="",!this._tiles[T.key]){const S=new s.Tile(T,this._source.tileSize*T.overscaleFactor(),n.tileZoom);S.state="loaded",this._tiles[T.key]=S}return v},{});for(const v in this._tiles)v in y||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(n){const c=this.proxyCachedFBO[n];if(c!==void 0){const p=Object.values(c);this.renderCachePool.push(...p),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Wa extends s.OverscaledTileID{constructor(n,c,p){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=c,this.projMatrix=p}}class hh extends s.Elevation{constructor(n,c){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,y,v]=function(I){const k=new s.StructArrayLayout4i8,D=new s.StructArrayLayout3ui6,U=131;k.reserve(17161),D.reserve(33800);const G=s.EXTENT/128,K=s.EXTENT+G/2,X=K+G;for(let Y=-G;Y<X;Y+=G)for(let Z=-G;Z<X;Z+=G){const ie=Z<0||Z>K||Y<0||Y>K?24575:0,J=s.clamp(Math.round(Z),0,s.EXTENT),pe=s.clamp(Math.round(Y),0,s.EXTENT);k.emplaceBack(J+ie,pe,J,pe)}const Q=(Y,Z)=>{const ie=Z*U+Y;D.emplaceBack(ie+1,ie,ie+U),D.emplaceBack(ie+U,ie+U+1,ie+1)};for(let Y=1;Y<129;Y++)for(let Z=1;Z<129;Z++)Q(Z,Y);return[0,129].forEach(Y=>{for(let Z=0;Z<130;Z++)Q(Z,Y),Q(Y,Z)}),[k,D,32768]}(),T=n.context;this.gridBuffer=T.createVertexBuffer(p,s.boundsAttributes.members),this.gridIndexBuffer=T.createIndexBuffer(y),this.gridSegments=s.SegmentVector.simpleSegment(0,0,p.length,y.length),this.gridNoSkirtSegments=s.SegmentVector.simpleSegment(0,0,p.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new bc(c.map),this.orthoMatrix=s.create(),s.ortho(this.orthoMatrix,0,s.EXTENT,0,s.EXTENT,0,1);const S=T.gl;this._overlapStencilMode=new s.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new xc(c.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency()}update(n,c,p){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const y=n.terrain.properties;this.sourceCache=n.terrain.drapeRenderMode===0?this._mockSourceCache:n._getSourceCache(y.get("source")),this._exaggeration=y.get("exaggeration");const v=()=>{this.sourceCache.used&&s.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const T=this.getScaledDemTileSize();this.sourceCache.update(c,T,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),c.updateElevation(!p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||n.efficiency!==100&&s.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=c.getIds().map(I=>{const k=c.getTileByID(I).tileID;return k.projMatrix=p.calculateProjMatrix(k.toUnwrapped()),k});(function(I,k){const D=k.transform.pointCoordinate(k.transform.getCameraPoint()),U=new s.pointGeometry(D.x,D.y);I.sort((G,K)=>{if(K.overscaledZ-G.overscaledZ)return K.overscaledZ-G.overscaledZ;const X=new s.pointGeometry(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),Q=new s.pointGeometry(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),Y=U.mult(1<<G.canonical.z);return Y.x-=.5,Y.y-=.5,Y.distSqr(X)-Y.distSqr(Q)})})(y,this.painter),this._previousZoom=p.zoom;const v=this.proxyToSource||{};this.proxyToSource={},y.forEach(I=>{this.proxyToSource[I.key]={}}),this.terrainTileForTile={};const T=this._style._sourceCaches;for(const I in T){const k=T[I];if(!k.used||(k!==this.sourceCache&&this.resetTileLookupCache(k.id),this._setupProxiedCoordsForOrtho(k,n[I],v),k.usedForTerrain))continue;const D=n[I];k.getSource().reparseOverscaled&&this._assignTerrainTiles(D)}this.proxiedCoords[c.id]=y.map(I=>new Wa(I,I.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1,this._updateTimestamp=s.exported.now();const S={};this._visibleDemTiles=[];for(const I of this.proxyCoords){const k=this.terrainTileForTile[I.key];if(!k)continue;const D=k.tileID.key;D in S||(this._visibleDemTiles.push(k),S[D]=D)}}_assignTerrainTiles(n){this._initializing||n.forEach(c=>{if(this.terrainTileForTile[c.key])return;const p=this._findTileCoveringTileID(c,this.sourceCache);p&&(this.terrainTileForTile[c.key]=p)})}_prepareDEMTextures(){const n=this.painter.context,c=n.gl;for(const p in this.terrainTileForTile){const y=this.terrainTileForTile[p],v=y.dem;!v||y.demTexture&&!y.needsDEMTextureUpload||(n.activeTexture.set(c.TEXTURE1),Xt(this.painter,y,v))}}_prepareDemTileUniforms(n,c,p,y){if(!c||c.demTexture==null)return!1;const v=n.tileID.canonical,T=Math.pow(2,c.tileID.canonical.z-v.z),S=y||"";return p[`u_dem_tl${S}`]=[v.x*T%1,v.y*T%1],p[`u_dem_scale${S}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,c=n.gl;if(!this._emptyDepthBufferTexture){const p=new s.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.Texture(n,p,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const c=this._visibleDemTiles.reduce((p,y)=>{if(!y.dem)return p;const v=y.dem.tree.minimums[0];return v>0&&n++,p+v},0);return n?c/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,c=n.gl;n.activeTexture.set(c.TEXTURE2);const p=this._getLoadedAreaMinimum(),y=new s.RGBAImage({width:1,height:1},new Uint8Array(s.DEMData.pack(p,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(y,{premultiply:!1}):v=this._emptyDEMTexture=new s.Texture(n,y,c.RGBA,{premultiply:!1}),v}setupElevationDraw(n,c,p){const y=this.painter.context,v=y.gl,T=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:s.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var S;T.u_dem_size=this.sourceCache.getSource().tileSize,T.u_exaggeration=this.exaggeration();const I=this.painter.transform,k=I.projection,D=n.tileID.canonical;T.u_tile_tl_up=k.upVector(D,0,0),T.u_tile_tr_up=k.upVector(D,s.EXTENT,0),T.u_tile_br_up=k.upVector(D,s.EXTENT,s.EXTENT),T.u_tile_bl_up=k.upVector(D,0,s.EXTENT),T.u_tile_up_scale=p&&p.useDenormalizedUpVectorScale?s.GLOBE_METERS_TO_ECEF:k.upVectorScale(D,I.center.lat,I.worldSize).metersToTile;let U=null,G=null,K=1;if(p&&p.morphing&&this._useVertexMorphing){const X=p.morphing.srcDemTile,Q=p.morphing.dstDemTile;K=p.morphing.phase,X&&Q&&(this._prepareDemTileUniforms(n,X,T,"_prev")&&(G=X),this._prepareDemTileUniforms(n,Q,T)&&(U=Q))}if(G&&U?(y.activeTexture.set(v.TEXTURE2),U.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),y.activeTexture.set(v.TEXTURE4),G.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),T.u_dem_lerp=K):(U=this.terrainTileForTile[n.tileID.key],y.activeTexture.set(v.TEXTURE2),(this._prepareDemTileUniforms(n,U,T)?U.demTexture:this.emptyDEMTexture).bind(v.NEAREST,v.CLAMP_TO_EDGE)),y.activeTexture.set(v.TEXTURE3),p&&p.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),this._depthFBO&&(T.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),T.u_depth_size_inv=[1,1]),p&&p.useMeterToDem&&U){const X=(1<<U.tileID.canonical.z)*s.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=X}p&&p.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),c.setTerrainUniformValues(y,T)}renderToBackBuffer(n){const c=this.painter,p=this.painter.context;n.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(y,v,T,S,I){if(y.transform.projection.name==="globe")(function(k,D,U,G,K){const X=k.context,Q=X.gl;let Y,Z;const ie=k.options.showTerrainWireframe?2:0,J=k.transform,pe=s.globeUseCustomAntiAliasing(k,X,J),fe=(it,Re)=>{if(Z===it)return;const Ke=[$s[it],"PROJECTION_GLOBE_VIEW"];pe&&Ke.push("CUSTOM_ANTIALIASING"),Re&&Ke.push($s[ie]),Y=k.useProgram("globeRaster",null,Ke),Z=it},ae=k.colorModeForRenderPass(),de=new s.DepthMode(Q.LEQUAL,s.DepthMode.ReadWrite,k.depthRangeFor3D);Xn.update(K);const ue=s.calculateGlobeMercatorMatrix(J),ye=[s.mercatorXfromLng(J.center.lng),s.mercatorYfromLat(J.center.lat)],Ae=ie?[!1,!0]:[!1],Je=k.globeSharedBuffers,be=[J.width*s.exported.devicePixelRatio,J.height*s.exported.devicePixelRatio],Le=Float32Array.from(J.globeMatrix),Ve={useDenormalizedUpVectorScale:!0};if(Ae.forEach(it=>{Z=-1;const Re=it?Q.LINES:Q.TRIANGLES;for(const Ke of G){const Be=U.getTile(Ke),st=s.StencilMode.disabled,ot=D.prevTerrainTileForTile[Ke.key],_t=D.terrainTileForTile[Ke.key];yc(ot,_t)&&Xn.newMorphing(Ke.key,ot,_t,K,250),X.activeTexture.set(Q.TEXTURE0),Be.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const wt=Xn.getMorphValuesForProxy(Ke.key),Mt=wt?1:0;wt&&s.extend$1(Ve,{morphing:{srcDemTile:wt.from,dstDemTile:wt.to,phase:s.easeCubicInOut(wt.phase)}});const qt=s.tileCornersToBounds(Ke.canonical),gt=s.getLatitudinalLod(qt.getCenter().lat),zt=s.getGridMatrix(Ke.canonical,qt,gt),Qt=s.globeNormalizeECEF(s.globeTileBounds(Ke.canonical)),Tr=gc(J.projMatrix,Le,ue,Qt,s.globeToMercatorTransition(J.zoom),ye,J.frustumCorners.TL,J.frustumCorners.TR,J.frustumCorners.BR,J.frustumCorners.BL,J.globeCenterInViewSpace,J.globeRadius,be,zt);if(fe(Mt,it),D.setupElevationDraw(Be,Y,Ve),k.prepareDrawProgram(X,Y,Ke.toUnwrapped()),Je){const[Ur,cr,ui]=it?Je.getWirefameBuffers(k.context,gt):Je.getGridBuffers(gt);Y.draw(X,Re,de,st,ae,s.CullFaceMode.backCCW,Tr,"globe_raster",Ur,cr,ui)}}}),Je){const it=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];pe&&it.push("CUSTOM_ANTIALIASING"),Y=k.useProgram("globeRaster",null,it);for(const Re of G){const{x:Ke,y:Be,z:st}=Re.canonical,ot=Be===0,_t=Be===(1<<st)-1,[wt,Mt,qt,gt]=Je.getPoleBuffers(st);if(gt&&(ot||_t)){const zt=U.getTile(Re);X.activeTexture.set(Q.TEXTURE0),zt.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);let Qt=s.globePoleMatrixForTile(st,Ke,J);const Tr=s.globeNormalizeECEF(s.globeTileBounds(Re.canonical)),Ur=(cr,ui)=>cr.draw(X,Q.TRIANGLES,de,s.StencilMode.disabled,ae,s.CullFaceMode.disabled,gc(J.projMatrix,Qt,Qt,Tr,0,ye,J.frustumCorners.TL,J.frustumCorners.TR,J.frustumCorners.BR,J.frustumCorners.BL,J.globeCenterInViewSpace,J.globeRadius,be),"globe_pole_raster",ui,qt,gt);D.setupElevationDraw(zt,Y,Ve),k.prepareDrawProgram(X,Y,Re.toUnwrapped()),ot&&Ur(Y,wt),_t&&(Qt=s.scale(s.create(),Qt,[1,-1,1]),Ur(Y,Mt))}}}})(y,v,T,S,I);else{const k=y.context,D=k.gl;let U,G;const K=y.options.showTerrainWireframe?2:0,X=(J,pe)=>{if(G===J)return;const fe=[$s[J]];pe&&fe.push($s[K]),U=y.useProgram("terrainRaster",null,fe),G=J},Q=y.colorModeForRenderPass(),Y=new s.DepthMode(D.LEQUAL,s.DepthMode.ReadWrite,y.depthRangeFor3D);Xn.update(I);const Z=y.transform,ie=6*Math.pow(1.5,22-Z.zoom)*v.exaggeration();(K?[!1,!0]:[!1]).forEach(J=>{G=-1;const pe=J?D.LINES:D.TRIANGLES,[fe,ae]=J?v.getWirefameBuffer():[v.gridIndexBuffer,v.gridSegments];for(const de of S){const ue=T.getTile(de),ye=s.StencilMode.disabled,Ae=v.prevTerrainTileForTile[de.key],Je=v.terrainTileForTile[de.key];yc(Ae,Je)&&Xn.newMorphing(de.key,Ae,Je,I,250),k.activeTexture.set(D.TEXTURE0),ue.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST);const be=Xn.getMorphValuesForProxy(de.key),Le=be?1:0;let Ve;be&&(Ve={morphing:{srcDemTile:be.from,dstDemTile:be.to,phase:s.easeCubicInOut(be.phase)}});const it=_c(de.projMatrix,mp(de.canonical,Z.renderWorldCopies)?ie/10:ie);X(Le,J),v.setupElevationDraw(ue,U,Ve),y.prepareDrawProgram(k,U,de.toUnwrapped()),U.draw(k,pe,Y,ye,Q,s.CullFaceMode.backCCW,it,"terrain_raster",v.gridBuffer,fe,ae)}})}}(c,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const c=this.painter,p=this.painter.context,y=this.proxySourceCache,v=this.proxiedCoords[y.id],T=this._drapedRenderBatches.shift(),S=[],I=c.style.order;let k=0;for(const D of v){const U=y.getTileByID(D.proxyTileKey),G=y.proxyCachedFBO[D.key]?y.proxyCachedFBO[D.key][n]:void 0,K=G!==void 0?y.renderCache[G]:this.pool[k++],X=G!==void 0;if(U.texture=K.tex,X&&!K.dirty){S.push(U.tileID);continue}let Q;p.bindFramebuffer.set(K.fb.framebuffer),this.renderedToTile=!1,K.dirty&&(p.clear({color:s.Color.transparent,stencil:0}),K.dirty=!1);for(let Y=T.start;Y<=T.end;++Y){const Z=c.style._layers[I[Y]];if(Z.isHidden(c.transform.zoom))continue;const ie=c.style._getLayerSourceCache(Z),J=ie?this.proxyToSource[D.key][ie.id]:[D];if(!J)continue;const pe=J;p.viewport.set([0,0,K.fb.width,K.fb.height]),Q!==(ie?ie.id:null)&&(this._setupStencil(K,J,Z,ie),Q=ie?ie.id:null),c.renderLayer(c,ie,Z,pe)}this.renderedToTile?(K.dirty=!0,S.push(U.tileID)):X||--k,k===5&&(k=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),T.end+1}postRender(){}renderCacheEfficiency(n){const c=n.order.length;if(c===0)return{efficiency:100};let p,y=0,v=0,T=!1;for(let S=0;S<c;++S){const I=n._layers[n.order[S]];this._style.isLayerDraped(I)?(T&&++y,++v):T||(T=!0,p=I.id)}return v===0?{efficiency:100}:{efficiency:100*(1-y/v),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{n=Math.min(n,c.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,c,p){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const T=v.tileID,S=1<<T.overscaledZ,{x:I,y:k}=T.canonical,D=I/S,U=(I+1)/S,G=k/S,K=(k+1)/S;return{minx:D,miny:G,maxx:U,maxy:K,t:v.dem.tree.raycastRoot(D,G,U,K,n,c,p),tile:v}});y.sort((v,T)=>(v.t!==null?v.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const v of y){if(v.t==null)return null;const T=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,n,c,p);if(T!=null)return T}return null}_createFBO(){const n=this.painter.context,c=n.gl,p=this.drapeBufferSize;n.activeTexture.set(c.TEXTURE0);const y=new s.Texture(n,{width:p[0],height:p[1],data:null},c.RGBA);y.bind(c.LINEAR,c.CLAMP_TO_EDGE);const v=n.createFramebuffer(p[0],p[1],!1);return v.colorAttachment.set(y.texture),v.depthAttachment=new N(n,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:v,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const c=this._style._layers[n],p=c.isHidden(this.painter.transform.zoom),y=c.getCrossfadeParameters(),v=!!y&&y.t!==1,T=c.hasTransition();return c.type!=="custom"&&!p&&(v||T)})}_clearRasterFadeFromRenderCache(){let n=!1;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c]._source instanceof oe){n=!0;break}if(n)for(let c=0;c<this._style.order.length;++c){const p=this._style._layers[this._style.order[c]],y=p.isHidden(this.painter.transform.zoom),v=this._style._getLayerSourceCache(p);if(p.type!=="raster"||y||!v)continue;const T=p.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const I=this.proxyToSource[S.key][v.id];if(I)for(const k of I){const D=Ha(v.getTile(k),v.findLoadedParent(k,0),v,this.painter.transform,T);(D.opacity!==1||D.mix!==0)&&this._clearRenderCacheForTile(v.id,k)}}}}_setupDrapedRenderBatches(){const n=this._style.order,c=n.length;if(c===0)return;const p=[];let y,v=0,T=this._style._layers[n[v]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++v<c;)T=this._style._layers[n[v]];for(;v<c;++v){const S=this._style._layers[n[v]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?y===void 0&&(y=v):y!==void 0&&(p.push({start:y,end:v-1}),y=void 0))}y!==void 0&&p.push({start:y,end:v-1}),this._drapedRenderBatches=p}_setupRenderCache(n){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const T=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let S=0;S<T.length;++S){const I=Object.values(T[S]);c.renderCachePool.push(...I)}}return}this._clearRasterFadeFromRenderCache();const p=this.proxyCoords,y=this._tilesDirty;for(let T=p.length-1;T>=0;T--){const S=p[T];if(c.getTileByID(S.key),c.proxyCachedFBO[S.key]!==void 0){const I=n[S.key],k=this.proxyToSource[S.key];let D=0;for(const U in k){const G=k[U],K=I[U];if(!K||K.length!==G.length||G.some((X,Q)=>X!==K[Q]||y[U]&&y[U].hasOwnProperty(X.key))){D=-1;break}++D}for(const U in c.proxyCachedFBO[S.key])c.renderCache[c.proxyCachedFBO[S.key][U]].dirty=D<0||D!==Object.values(I).length}}const v=[...this._drapedRenderBatches];v.sort((T,S)=>S.end-S.start-(T.end-T.start));for(const T of v)for(const S of p){if(c.proxyCachedFBO[S.key])continue;let I=c.renderCachePool.pop();I===void 0&&c.renderCache.length<50&&(I=c.renderCache.length,c.renderCache.push(this._createFBO())),I!==void 0&&(c.proxyCachedFBO[S.key]={},c.proxyCachedFBO[S.key][T.start]=I,c.renderCache[I].dirty=!0)}this._tilesDirty={}}_setupStencil(n,c,p,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,T=v.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let S;if(p.isTileClipped())S=c.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):s.StencilMode.disabled}_renderTileClippingMasks(n,c){const p=this.painter,y=this.painter.context,v=y.gl;p._tileClippingMaskIDs={},y.setColorMode(s.ColorMode.disabled),y.setDepthMode(s.DepthMode.disabled);const T=p.useProgram("clippingMask");for(const S of n){const I=p._tileClippingMaskIDs[S.key]=--c;T.draw(y,v.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:v.ALWAYS,mask:0},I,255,v.KEEP,v.KEEP,v.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,vc(S.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(n){const c=this.painter.transform;if(n.x<0||n.x>c.width||n.y<0||n.y>c.height)return null;const p=[n.x,n.y,1,1];s.transformMat4$1(p,p,c.pixelMatrixInverse),s.scale$1(p,p,1/p[3]),p[0]/=c.worldSize,p[1]/=c.worldSize;const y=c._camera.position,v=s.mercatorZfromAltitude(1,c.center.lat),T=[y[0],y[1],y[2]/v,0],S=s.subtract([],p.slice(0,3),T);s.normalize(S,S);const I=this.raycast(T,S,this._exaggeration);return I!==null&&I?(s.scaleAndAdd(T,T,S,I),T[3]=T[2],T[2]*=v,T):null}drawDepth(){const n=this.painter,c=n.context,p=this.proxySourceCache,y=Math.ceil(n.width),v=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===y&&this._depthFBO.height===v||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const T=c.gl,S=c.createFramebuffer(y,v,!0);c.activeTexture.set(T.TEXTURE0);const I=new s.Texture(c,{width:y,height:v,data:null},T.RGBA);I.bind(T.NEAREST,T.CLAMP_TO_EDGE),S.colorAttachment.set(I.texture);const k=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,y,v);S.depthAttachment.set(k),this._depthFBO=S,this._depthTexture=I}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,y,v]),function(T,S,I,k){if(T.transform.projection.name==="globe")return;const D=T.context,U=D.gl;D.clear({depth:1});const G=T.useProgram("terrainDepth"),K=new s.DepthMode(U.LESS,s.DepthMode.ReadWrite,T.depthRangeFor3D);for(const X of k){const Q=I.getTile(X),Y=_c(X.projMatrix,0);S.setupElevationDraw(Q,G),G.draw(D,U.TRIANGLES,K,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.backCCW,Y,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(n,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,c,p){if(n.getSource()instanceof xe)return this._setupProxiedCoordsForImageSource(n,c,p);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const y=this.proxiedCoords[n.id]=[],v=this.proxyCoords;for(let S=0;S<v.length;S++){const I=v[S],k=this._findTileCoveringTileID(I,n);if(k){const D=this._createProxiedId(I,k,p[I.key]&&p[I.key][n.id]);y.push(D),this.proxyToSource[I.key][n.id]=[D]}}let T=!1;for(let S=0;S<c.length;S++){const I=n.getTile(c[S]);if(!I||!I.hasData())continue;const k=this._findTileCoveringTileID(I.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==I.tileID.canonical.z){const D=this.proxyToSource[k.tileID.key][n.id],U=this._createProxiedId(k.tileID,I,p[k.tileID.key]&&p[k.tileID.key][n.id]);D?D.splice(D.length-1,0,U):this.proxyToSource[k.tileID.key][n.id]=[U],y.push(U),T=!0}}this._sourceTilesOverlap[n.id]=T}_setupProxiedCoordsForImageSource(n,c,p){if(!n.getSource().loaded())return;const y=this.proxiedCoords[n.id]=[],v=this.proxyCoords,T=n.getSource(),S=new s.pointGeometry(T.tileID.x,T.tileID.y)._div(1<<T.tileID.z),I=T.coordinates.map(s.MercatorCoordinate.fromLngLat).reduce((D,U)=>(D.min.x=Math.min(D.min.x,U.x-S.x),D.min.y=Math.min(D.min.y,U.y-S.y),D.max.x=Math.max(D.max.x,U.x-S.x),D.max.y=Math.max(D.max.y,U.y-S.y),D),{min:new s.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(D,U)=>{const G=D.wrap+D.canonical.x/(1<<D.canonical.z),K=D.canonical.y/(1<<D.canonical.z),X=s.EXTENT/(1<<D.canonical.z),Q=U.wrap+U.canonical.x/(1<<U.canonical.z),Y=U.canonical.y/(1<<U.canonical.z);return G+X<Q+I.min.x||G>Q+I.max.x||K+X<Y+I.min.y||K>Y+I.max.y};for(let D=0;D<v.length;D++){const U=v[D];for(let G=0;G<c.length;G++){const K=n.getTile(c[G]);if(!K||!K.hasData()||k(U,K.tileID))continue;const X=this._createProxiedId(U,K,p[U.key]&&p[U.key][n.id]),Q=this.proxyToSource[U.key][n.id];Q?Q.push(X):this.proxyToSource[U.key][n.id]=[X],y.push(X)}}}_createProxiedId(n,c,p){let y=this.orthoMatrix;if(p){const v=p.find(T=>T.key===c.tileID.key);if(v)return v}if(c.tileID.key!==n.key){const v=n.canonical.z-c.tileID.canonical.z;let T,S,I;y=s.create();const k=c.tileID.wrap-n.wrap<<n.overscaledZ;v>0?(T=s.EXTENT>>v,S=T*((c.tileID.canonical.x<<v)-n.canonical.x+k),I=T*((c.tileID.canonical.y<<v)-n.canonical.y)):(T=s.EXTENT<<-v,S=s.EXTENT*(c.tileID.canonical.x-(n.canonical.x+k<<-v)),I=s.EXTENT*(c.tileID.canonical.y-(n.canonical.y<<-v))),s.ortho(y,0,T,0,T,0,1),s.translate(y,y,[S,I,0])}return new Wa(c.tileID,n.key,y)}_findTileCoveringTileID(n,c){let p=c.getTile(n);if(p&&p.hasData())return p;const y=this._findCoveringTileCache[c.id],v=y[n.key];if(p=v?c.getTileByID(v):null,p&&p.hasData()||v===null)return p;let T=p?p.tileID:n,S=T.overscaledZ;const I=c.getSource().minzoom,k=[];if(!v){const U=c.getSource().maxzoom;if(n.canonical.z>=U){const G=n.canonical.z-U;c.getSource().reparseOverscaled?(S=Math.max(n.canonical.z+2,c.transform.tileZoom),T=new s.OverscaledTileID(S,n.wrap,U,n.canonical.x>>G,n.canonical.y>>G)):G!==0&&(S=U,T=new s.OverscaledTileID(S,n.wrap,U,n.canonical.x>>G,n.canonical.y>>G))}T.key!==n.key&&(k.push(T.key),p=c.getTile(T))}const D=U=>{k.forEach(G=>{y[G]=U}),k.length=0};for(S-=1;S>=I&&(!p||!p.hasData());S--){p&&D(p.tileID.key);const U=T.calculateScaledKey(S);if(p=c.getTileByID(U),p&&p.hasData())break;const G=y[U];if(G===null)break;G===void 0?k.push(U):p=c.getTileByID(G)}return D(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,c){let p=this._tilesDirty[n];p||(p=this._tilesDirty[n]={}),p[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(c){let p=0;const y=new s.StructArrayLayout2ui4,v=131;for(let T=1;T<129;T++){for(let S=1;S<129;S++)p=T*v+S,y.emplaceBack(p,p+1),y.emplaceBack(p,p+v),y.emplaceBack(p+1,p+v),T===128&&y.emplaceBack(p+v,p+v+1);y.emplaceBack(p+1,p+1+v)}return y}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=s.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class wc{static cacheKey(n,c,p,y){let v=`${c}${y?y.cacheKey:""}`;for(const T of p)n.usedDefines.includes(T)&&(v+=`/${T}`);return v}constructor(n,c,p,y,v,T){const S=n.gl;this.program=S.createProgram();const I=function(Y){const Z=[];for(let ie=0;ie<Y.length;ie++){if(Y[ie]===null)continue;const J=Y[ie].split(" ");Z.push(J.pop())}return Z}(p.staticAttributes),k=y?y.getBinderAttributes():[],D=I.concat(k);let U=y?y.defines():[];U=U.concat(T.map(Y=>`#define ${Y}`));const G=U.concat(n.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(Ga):Ga,Ga,$a,Us.fragmentSource,_o.fragmentSource,p.fragmentSource).join(`
`),K=U.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,$a,Us.vertexSource,_o.vertexSource,Va.vertexSource,p.vertexSource).join(`
`),X=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(X,G),S.compileShader(X),S.attachShader(this.program,X);const Q=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(Q,K),S.compileShader(Q),S.attachShader(this.program,Q),this.attributes={},this.numAttributes=D.length;for(let Y=0;Y<this.numAttributes;Y++)D[Y]&&(S.bindAttribLocation(this.program,Y,D[Y]),this.attributes[D[Y]]=Y);S.linkProgram(this.program),S.deleteShader(Q),S.deleteShader(X),this.fixedUniforms=v(n),this.binderUniforms=y?y.getUniforms(n):[],T.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=(Y=>({u_dem:new s.Uniform1i(Y),u_dem_prev:new s.Uniform1i(Y),u_dem_unpack:new s.Uniform4f(Y),u_dem_tl:new s.Uniform2f(Y),u_dem_scale:new s.Uniform1f(Y),u_dem_tl_prev:new s.Uniform2f(Y),u_dem_scale_prev:new s.Uniform1f(Y),u_dem_size:new s.Uniform1f(Y),u_dem_lerp:new s.Uniform1f(Y),u_exaggeration:new s.Uniform1f(Y),u_depth:new s.Uniform1i(Y),u_depth_size_inv:new s.Uniform2f(Y),u_meter_to_dem:new s.Uniform1f(Y),u_label_plane_matrix_inv:new s.UniformMatrix4f(Y),u_tile_tl_up:new s.Uniform3f(Y),u_tile_tr_up:new s.Uniform3f(Y),u_tile_br_up:new s.Uniform3f(Y),u_tile_bl_up:new s.Uniform3f(Y),u_tile_up_scale:new s.Uniform1f(Y)}))(n)),T.indexOf("FOG")!==-1&&(this.fogUniforms=(Y=>({u_fog_matrix:new s.UniformMatrix4f(Y),u_fog_range:new s.Uniform2f(Y),u_fog_color:new s.Uniform4f(Y),u_fog_horizon_blend:new s.Uniform1f(Y),u_fog_temporal_offset:new s.Uniform1f(Y),u_frustum_tl:new s.Uniform3f(Y),u_frustum_tr:new s.Uniform3f(Y),u_frustum_br:new s.Uniform3f(Y),u_frustum_bl:new s.Uniform3f(Y),u_globe_pos:new s.Uniform3f(Y),u_globe_radius:new s.Uniform1f(Y),u_globe_transition:new s.Uniform1f(Y),u_is_globe:new s.Uniform1i(Y),u_viewport:new s.Uniform2f(Y)}))(n))}}setTerrainUniformValues(n,c){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in c)p[y].set(this.program,y,c[y])}}setFogUniformValues(n,c){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in c)p[y].set(this.program,y,c[y])}}draw(n,c,p,y,v,T,S,I,k,D,U,G,K,X,Q){const Y=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(p),n.setStencilMode(y),n.setColorMode(v),n.setCullFace(T);for(const ie of Object.keys(this.fixedUniforms))this.fixedUniforms[ie].set(this.program,ie,S[ie]);X&&X.setUniforms(this.program,n,this.binderUniforms,G,{zoom:K});const Z={[Y.LINES]:2,[Y.TRIANGLES]:3,[Y.LINE_STRIP]:1}[c];for(const ie of U.get()){const J=ie.vaos||(ie.vaos={});(J[I]||(J[I]=new Za)).bind(n,this,k,X?X.getPaintVertexBuffers():[],D,ie.vertexOffset,Q||[]),Y.drawElements(c,ie.primitiveLength*Z,Y.UNSIGNED_SHORT,ie.primitiveOffset*Z*2)}}}function fh(f,n,c){const p=1/Yr(c,1,n.transform.tileZoom),y=Math.pow(2,c.tileID.overscaledZ),v=c.tileSize*Math.pow(2,n.transform.tileZoom)/y,T=v*(c.tileID.canonical.x+c.tileID.wrap*y),S=v*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[p,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[T>>16,S>>16],u_pixel_coord_lower:[65535&T,65535&S]}}const Gs=s.create(),Qo=(f,n,c,p,y,v,T,S,I,k,D)=>{const U=n.style.light,G=U.properties.get("position"),K=[G.x,G.y,G.z],X=s.create$1();U.properties.get("anchor")==="viewport"&&(s.fromRotation(X,-n.transform.angle),s.transformMat3(K,K,X));const Q=U.properties.get("color"),Y=n.transform,Z={u_matrix:f,u_lightpos:K,u_lightintensity:U.properties.get("intensity"),u_lightcolor:[Q.r,Q.g,Q.b],u_vertical_gradient:+c,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Gs,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:y,u_edge_radius:v};return Y.projection.name==="globe"&&(Z.u_tile_id=[T.canonical.x,T.canonical.y,1<<T.canonical.z],Z.u_zoom_transition=I,Z.u_inv_rot_matrix=D,Z.u_merc_center=k,Z.u_up_dir=Y.projection.upVector(new s.CanonicalTileID(0,0,0),k[0]*s.EXTENT,k[1]*s.EXTENT),Z.u_height_lift=S),Z},dh=(f,n,c,p,y,v,T,S,I,k,D,U,G)=>{const K=Qo(f,n,c,p,y,v,T,k,D,U,G),X={u_height_factor:-Math.pow(2,T.overscaledZ)/I.tileSize/8};return s.extend(K,fh(S,n,I),X)},qs=f=>({u_matrix:f}),Xa=(f,n,c,p)=>s.extend(qs(f),fh(c,n,p)),yn=(f,n)=>({u_matrix:f,u_world:n}),Tc=(f,n,c,p,y)=>s.extend(Xa(f,n,c,p),{u_world:y}),ph=s.create(),Ec=(f,n,c,p,y,v)=>{const T=f.transform,S=T.projection.name==="globe";let I;if(v.paint.get("circle-pitch-alignment")==="map")if(S){const D=s.globePixelsToTileUnits(T.zoom,n.canonical)*T._pixelsPerMercatorPixel;I=Float32Array.from([D,0,0,D])}else I=T.calculatePixelsToTileUnitsMatrix(c);else I=new Float32Array([T.pixelsToGLUnits[0],0,0,T.pixelsToGLUnits[1]]);const k={u_camera_to_center_distance:T.cameraToCenterDistance,u_matrix:f.translatePosMatrix(n.projMatrix,c,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_device_pixel_ratio:s.exported.devicePixelRatio,u_extrude_scale:I,u_inv_rot_matrix:ph,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){k.u_inv_rot_matrix=p,k.u_merc_center=y,k.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],k.u_zoom_transition=s.globeToMercatorTransition(T.zoom);const D=y[0]*s.EXTENT,U=y[1]*s.EXTENT;k.u_up_dir=T.projection.upVector(new s.CanonicalTileID(0,0,0),D,U)}return k},mh=f=>{const n=[];return f.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),f.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n},Sc=(f,n,c,p)=>{const y=s.EXTENT/c.tileSize;return{u_matrix:f,u_camera_to_center_distance:n.getCameraToCenterDistance(p),u_extrude_scale:[n.pixelsToGLUnits[0]/y,n.pixelsToGLUnits[1]/y]}},_h=(f,n,c=1)=>({u_matrix:f,u_color:n,u_overlay:0,u_overlay_scale:c}),Ac=s.create(),_p=(f,n,c,p,y,v,T)=>{const S=f.transform,I=S.projection.name==="globe",k=I?s.globePixelsToTileUnits(S.zoom,n.canonical)*S._pixelsPerMercatorPixel:Yr(c,1,v),D={u_matrix:n.projMatrix,u_extrude_scale:k,u_intensity:T,u_inv_rot_matrix:Ac,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){D.u_inv_rot_matrix=p,D.u_merc_center=y,D.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],D.u_zoom_transition=s.globeToMercatorTransition(S.zoom);const U=y[0]*s.EXTENT,G=y[1]*s.EXTENT;D.u_up_dir=S.projection.upVector(new s.CanonicalTileID(0,0,0),U,G)}return D},Qa=(f,n,c,p,y,v,T,S)=>{const I=f.transform,k=I.calculatePixelsToTileUnitsMatrix(n),D={u_matrix:gh(f,n,c,y),u_pixels_to_tile_units:k,u_device_pixel_ratio:T,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:v,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:S};if(Ka(c)){const U=Ya(n,f.transform);D.u_texsize=n.lineAtlasTexture.size,D.u_scale=[U,p.fromScale,p.toScale],D.u_mix=p.t}return D},gp=(f,n,c,p,y,v)=>{const T=f.transform,S=Ya(n,T);return{u_matrix:gh(f,n,c,y),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:T.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:v,u_image:0,u_scale:[S,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Ya(f,n){return 1/Yr(f,1,n.tileZoom)}function gh(f,n,c,p){return f.translatePosMatrix(p||n.tileID.projMatrix,n,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}function Ka(f){const n=f.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}const yp=(f,n,c,p,y,v)=>{return{u_matrix:f,u_tl_parent:n,u_scale_parent:c,u_fade_t:p.mix,u_opacity:p.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(S=y.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(T=y.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:Ja(y.paint.get("raster-hue-rotate")),u_perspective_transform:v};var T,S};function Ja(f){f*=Math.PI/180;const n=Math.sin(f),c=Math.cos(f);return[(2*c+1)/3,(-Math.sqrt(3)*n-c+1)/3,(Math.sqrt(3)*n-c+1)/3]}const yh=s.create(),Pc=(f,n,c,p,y,v,T,S,I,k,D,U,G,K,X,Q)=>{const Y=y.transform,Z={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:Y.cameraToCenterDistance,u_rotate_symbol:+c,u_aspect_ratio:Y.width/Y.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:T,u_coord_matrix:S,u_is_text:+I,u_pitch_with_map:+p,u_texsize:k,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:yh,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:yh,u_up_vector:[0,-1,0]};return Q.name==="globe"&&(Z.u_tile_id=[D.canonical.x,D.canonical.y,1<<D.canonical.z],Z.u_zoom_transition=U,Z.u_inv_rot_matrix=K,Z.u_merc_center=G,Z.u_camera_forward=Y._camera.forward(),Z.u_ecef_origin=s.globeECEFOrigin(Y.globeMatrix,D.toUnwrapped()),Z.u_tile_matrix=Float32Array.from(Y.globeMatrix),Z.u_up_vector=X),Z},Ic=(f,n,c,p,y,v,T,S,I,k,D,U,G,K,X,Q,Y)=>s.extend(Pc(f,n,c,p,y,v,T,S,I,k,U,G,K,X,Q,Y),{u_gamma_scale:p?y.transform.cameraToCenterDistance*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:s.exported.devicePixelRatio,u_is_halo:+D}),Yo=(f,n,c,p,y,v,T,S,I,k,D,U,G,K,X,Q)=>s.extend(Ic(f,n,c,p,y,v,T,S,!0,I,!0,D,U,G,K,X,Q),{u_texsize_icon:k,u_texture_icon:1}),vp=(f,n,c)=>({u_matrix:f,u_opacity:n,u_color:c}),xp=(f,n,c,p,y,v)=>s.extend(function(T,S,I,k){const D=I.imageManager.getPattern(T.from.toString()),U=I.imageManager.getPattern(T.to.toString()),{width:G,height:K}=I.imageManager.getPixelSize(),X=Math.pow(2,k.tileID.overscaledZ),Q=k.tileSize*Math.pow(2,I.transform.tileZoom)/X,Y=Q*(k.tileID.canonical.x+k.tileID.wrap*X),Z=Q*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:D.tl,u_pattern_br_a:D.br,u_pattern_tl_b:U.tl,u_pattern_br_b:U.br,u_texsize:[G,K],u_mix:S.t,u_pattern_size_a:D.displaySize,u_pattern_size_b:U.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/Yr(k,1,I.transform.tileZoom),u_pixel_coord_upper:[Y>>16,Z>>16],u_pixel_coord_lower:[65535&Y,65535&Z]}}(p,v,c,y),{u_matrix:f,u_opacity:n}),bp={fillExtrusion:f=>({u_matrix:new s.UniformMatrix4f(f),u_lightpos:new s.Uniform3f(f),u_lightintensity:new s.Uniform1f(f),u_lightcolor:new s.Uniform3f(f),u_vertical_gradient:new s.Uniform1f(f),u_opacity:new s.Uniform1f(f),u_edge_radius:new s.Uniform1f(f),u_ao:new s.Uniform2f(f),u_tile_id:new s.Uniform3f(f),u_zoom_transition:new s.Uniform1f(f),u_inv_rot_matrix:new s.UniformMatrix4f(f),u_merc_center:new s.Uniform2f(f),u_up_dir:new s.Uniform3f(f),u_height_lift:new s.Uniform1f(f)}),fillExtrusionPattern:f=>({u_matrix:new s.UniformMatrix4f(f),u_lightpos:new s.Uniform3f(f),u_lightintensity:new s.Uniform1f(f),u_lightcolor:new s.Uniform3f(f),u_vertical_gradient:new s.Uniform1f(f),u_height_factor:new s.Uniform1f(f),u_edge_radius:new s.Uniform1f(f),u_ao:new s.Uniform2f(f),u_tile_id:new s.Uniform3f(f),u_zoom_transition:new s.Uniform1f(f),u_inv_rot_matrix:new s.UniformMatrix4f(f),u_merc_center:new s.Uniform2f(f),u_up_dir:new s.Uniform3f(f),u_height_lift:new s.Uniform1f(f),u_image:new s.Uniform1i(f),u_texsize:new s.Uniform2f(f),u_pixel_coord_upper:new s.Uniform2f(f),u_pixel_coord_lower:new s.Uniform2f(f),u_scale:new s.Uniform3f(f),u_fade:new s.Uniform1f(f),u_opacity:new s.Uniform1f(f)}),fill:f=>({u_matrix:new s.UniformMatrix4f(f)}),fillPattern:f=>({u_matrix:new s.UniformMatrix4f(f),u_image:new s.Uniform1i(f),u_texsize:new s.Uniform2f(f),u_pixel_coord_upper:new s.Uniform2f(f),u_pixel_coord_lower:new s.Uniform2f(f),u_scale:new s.Uniform3f(f),u_fade:new s.Uniform1f(f)}),fillOutline:f=>({u_matrix:new s.UniformMatrix4f(f),u_world:new s.Uniform2f(f)}),fillOutlinePattern:f=>({u_matrix:new s.UniformMatrix4f(f),u_world:new s.Uniform2f(f),u_image:new s.Uniform1i(f),u_texsize:new s.Uniform2f(f),u_pixel_coord_upper:new s.Uniform2f(f),u_pixel_coord_lower:new s.Uniform2f(f),u_scale:new s.Uniform3f(f),u_fade:new s.Uniform1f(f)}),circle:f=>({u_camera_to_center_distance:new s.Uniform1f(f),u_extrude_scale:new s.UniformMatrix2f(f),u_device_pixel_ratio:new s.Uniform1f(f),u_matrix:new s.UniformMatrix4f(f),u_inv_rot_matrix:new s.UniformMatrix4f(f),u_merc_center:new s.Uniform2f(f),u_tile_id:new s.Uniform3f(f),u_zoom_transition:new s.Uniform1f(f),u_up_dir:new s.Uniform3f(f)}),collisionBox:f=>({u_matrix:new s.UniformMatrix4f(f),u_camera_to_center_distance:new s.Uniform1f(f),u_extrude_scale:new s.Uniform2f(f)}),collisionCircle:f=>({u_matrix:new s.UniformMatrix4f(f),u_inv_matrix:new s.UniformMatrix4f(f),u_camera_to_center_distance:new s.Uniform1f(f),u_viewport_size:new s.Uniform2f(f)}),debug:f=>({u_color:new s.UniformColor(f),u_matrix:new s.UniformMatrix4f(f),u_overlay:new s.Uniform1i(f),u_overlay_scale:new s.Uniform1f(f)}),clippingMask:f=>({u_matrix:new s.UniformMatrix4f(f)}),heatmap:f=>({u_extrude_scale:new s.Uniform1f(f),u_intensity:new s.Uniform1f(f),u_matrix:new s.UniformMatrix4f(f),u_inv_rot_matrix:new s.UniformMatrix4f(f),u_merc_center:new s.Uniform2f(f),u_tile_id:new s.Uniform3f(f),u_zoom_transition:new s.Uniform1f(f),u_up_dir:new s.Uniform3f(f)}),heatmapTexture:f=>({u_image:new s.Uniform1i(f),u_color_ramp:new s.Uniform1i(f),u_opacity:new s.Uniform1f(f)}),hillshade:f=>({u_matrix:new s.UniformMatrix4f(f),u_image:new s.Uniform1i(f),u_latrange:new s.Uniform2f(f),u_light:new s.Uniform2f(f),u_shadow:new s.UniformColor(f),u_highlight:new s.UniformColor(f),u_accent:new s.UniformColor(f)}),hillshadePrepare:f=>({u_matrix:new s.UniformMatrix4f(f),u_image:new s.Uniform1i(f),u_dimension:new s.Uniform2f(f),u_zoom:new s.Uniform1f(f),u_unpack:new s.Uniform4f(f)}),line:f=>({u_matrix:new s.UniformMatrix4f(f),u_pixels_to_tile_units:new s.UniformMatrix2f(f),u_device_pixel_ratio:new s.Uniform1f(f),u_units_to_pixels:new s.Uniform2f(f),u_dash_image:new s.Uniform1i(f),u_gradient_image:new s.Uniform1i(f),u_image_height:new s.Uniform1f(f),u_texsize:new s.Uniform2f(f),u_scale:new s.Uniform3f(f),u_mix:new s.Uniform1f(f),u_alpha_discard_threshold:new s.Uniform1f(f),u_trim_offset:new s.Uniform2f(f)}),linePattern:f=>({u_matrix:new s.UniformMatrix4f(f),u_texsize:new s.Uniform2f(f),u_pixels_to_tile_units:new s.UniformMatrix2f(f),u_device_pixel_ratio:new s.Uniform1f(f),u_image:new s.Uniform1i(f),u_units_to_pixels:new s.Uniform2f(f),u_scale:new s.Uniform3f(f),u_fade:new s.Uniform1f(f),u_alpha_discard_threshold:new s.Uniform1f(f)}),raster:f=>({u_matrix:new s.UniformMatrix4f(f),u_tl_parent:new s.Uniform2f(f),u_scale_parent:new s.Uniform1f(f),u_fade_t:new s.Uniform1f(f),u_opacity:new s.Uniform1f(f),u_image0:new s.Uniform1i(f),u_image1:new s.Uniform1i(f),u_brightness_low:new s.Uniform1f(f),u_brightness_high:new s.Uniform1f(f),u_saturation_factor:new s.Uniform1f(f),u_contrast_factor:new s.Uniform1f(f),u_spin_weights:new s.Uniform3f(f),u_perspective_transform:new s.Uniform2f(f)}),symbolIcon:f=>({u_is_size_zoom_constant:new s.Uniform1i(f),u_is_size_feature_constant:new s.Uniform1i(f),u_size_t:new s.Uniform1f(f),u_size:new s.Uniform1f(f),u_camera_to_center_distance:new s.Uniform1f(f),u_rotate_symbol:new s.Uniform1i(f),u_aspect_ratio:new s.Uniform1f(f),u_fade_change:new s.Uniform1f(f),u_matrix:new s.UniformMatrix4f(f),u_label_plane_matrix:new s.UniformMatrix4f(f),u_coord_matrix:new s.UniformMatrix4f(f),u_is_text:new s.Uniform1i(f),u_pitch_with_map:new s.Uniform1i(f),u_texsize:new s.Uniform2f(f),u_tile_id:new s.Uniform3f(f),u_zoom_transition:new s.Uniform1f(f),u_inv_rot_matrix:new s.UniformMatrix4f(f),u_merc_center:new s.Uniform2f(f),u_camera_forward:new s.Uniform3f(f),u_tile_matrix:new s.UniformMatrix4f(f),u_up_vector:new s.Uniform3f(f),u_ecef_origin:new s.Uniform3f(f),u_texture:new s.Uniform1i(f)}),symbolSDF:f=>({u_is_size_zoom_constant:new s.Uniform1i(f),u_is_size_feature_constant:new s.Uniform1i(f),u_size_t:new s.Uniform1f(f),u_size:new s.Uniform1f(f),u_camera_to_center_distance:new s.Uniform1f(f),u_rotate_symbol:new s.Uniform1i(f),u_aspect_ratio:new s.Uniform1f(f),u_fade_change:new s.Uniform1f(f),u_matrix:new s.UniformMatrix4f(f),u_label_plane_matrix:new s.UniformMatrix4f(f),u_coord_matrix:new s.UniformMatrix4f(f),u_is_text:new s.Uniform1i(f),u_pitch_with_map:new s.Uniform1i(f),u_texsize:new s.Uniform2f(f),u_texture:new s.Uniform1i(f),u_gamma_scale:new s.Uniform1f(f),u_device_pixel_ratio:new s.Uniform1f(f),u_tile_id:new s.Uniform3f(f),u_zoom_transition:new s.Uniform1f(f),u_inv_rot_matrix:new s.UniformMatrix4f(f),u_merc_center:new s.Uniform2f(f),u_camera_forward:new s.Uniform3f(f),u_tile_matrix:new s.UniformMatrix4f(f),u_up_vector:new s.Uniform3f(f),u_ecef_origin:new s.Uniform3f(f),u_is_halo:new s.Uniform1i(f)}),symbolTextAndIcon:f=>({u_is_size_zoom_constant:new s.Uniform1i(f),u_is_size_feature_constant:new s.Uniform1i(f),u_size_t:new s.Uniform1f(f),u_size:new s.Uniform1f(f),u_camera_to_center_distance:new s.Uniform1f(f),u_rotate_symbol:new s.Uniform1i(f),u_aspect_ratio:new s.Uniform1f(f),u_fade_change:new s.Uniform1f(f),u_matrix:new s.UniformMatrix4f(f),u_label_plane_matrix:new s.UniformMatrix4f(f),u_coord_matrix:new s.UniformMatrix4f(f),u_is_text:new s.Uniform1i(f),u_pitch_with_map:new s.Uniform1i(f),u_texsize:new s.Uniform2f(f),u_texsize_icon:new s.Uniform2f(f),u_texture:new s.Uniform1i(f),u_texture_icon:new s.Uniform1i(f),u_gamma_scale:new s.Uniform1f(f),u_device_pixel_ratio:new s.Uniform1f(f),u_is_halo:new s.Uniform1i(f)}),background:f=>({u_matrix:new s.UniformMatrix4f(f),u_opacity:new s.Uniform1f(f),u_color:new s.UniformColor(f)}),backgroundPattern:f=>({u_matrix:new s.UniformMatrix4f(f),u_opacity:new s.Uniform1f(f),u_image:new s.Uniform1i(f),u_pattern_tl_a:new s.Uniform2f(f),u_pattern_br_a:new s.Uniform2f(f),u_pattern_tl_b:new s.Uniform2f(f),u_pattern_br_b:new s.Uniform2f(f),u_texsize:new s.Uniform2f(f),u_mix:new s.Uniform1f(f),u_pattern_size_a:new s.Uniform2f(f),u_pattern_size_b:new s.Uniform2f(f),u_scale_a:new s.Uniform1f(f),u_scale_b:new s.Uniform1f(f),u_pixel_coord_upper:new s.Uniform2f(f),u_pixel_coord_lower:new s.Uniform2f(f),u_tile_units_to_pixels:new s.Uniform1f(f)}),terrainRaster:Vs,terrainDepth:Vs,skybox:f=>({u_matrix:new s.UniformMatrix4f(f),u_sun_direction:new s.Uniform3f(f),u_cubemap:new s.Uniform1i(f),u_opacity:new s.Uniform1f(f),u_temporal_offset:new s.Uniform1f(f)}),skyboxGradient:f=>({u_matrix:new s.UniformMatrix4f(f),u_color_ramp:new s.Uniform1i(f),u_center_direction:new s.Uniform3f(f),u_radius:new s.Uniform1f(f),u_opacity:new s.Uniform1f(f),u_temporal_offset:new s.Uniform1f(f)}),skyboxCapture:f=>({u_matrix_3f:new s.UniformMatrix3f(f),u_sun_direction:new s.Uniform3f(f),u_sun_intensity:new s.Uniform1f(f),u_color_tint_r:new s.Uniform4f(f),u_color_tint_m:new s.Uniform4f(f),u_luminance:new s.Uniform1f(f)}),globeRaster:f=>({u_proj_matrix:new s.UniformMatrix4f(f),u_globe_matrix:new s.UniformMatrix4f(f),u_normalize_matrix:new s.UniformMatrix4f(f),u_merc_matrix:new s.UniformMatrix4f(f),u_zoom_transition:new s.Uniform1f(f),u_merc_center:new s.Uniform2f(f),u_image0:new s.Uniform1i(f),u_grid_matrix:new s.UniformMatrix3f(f),u_frustum_tl:new s.Uniform3f(f),u_frustum_tr:new s.Uniform3f(f),u_frustum_br:new s.Uniform3f(f),u_frustum_bl:new s.Uniform3f(f),u_globe_pos:new s.Uniform3f(f),u_globe_radius:new s.Uniform1f(f),u_viewport:new s.Uniform2f(f)}),globeAtmosphere:f=>({u_frustum_tl:new s.Uniform3f(f),u_frustum_tr:new s.Uniform3f(f),u_frustum_br:new s.Uniform3f(f),u_frustum_bl:new s.Uniform3f(f),u_horizon:new s.Uniform1f(f),u_transition:new s.Uniform1f(f),u_fadeout_range:new s.Uniform1f(f),u_color:new s.Uniform4f(f),u_high_color:new s.Uniform4f(f),u_space_color:new s.Uniform4f(f),u_star_intensity:new s.Uniform1f(f),u_star_density:new s.Uniform1f(f),u_star_size:new s.Uniform1f(f),u_temporal_offset:new s.Uniform1f(f),u_horizon_angle:new s.Uniform1f(f),u_rotation_matrix:new s.UniformMatrix4f(f)})};let el;function vh(f,n,c,p,y,v,T){const S=f.context,I=S.gl,k=f.transform,D=f.useProgram("collisionBox"),U=[];let G=0,K=0;for(let pe=0;pe<p.length;pe++){const fe=p[pe],ae=n.getTile(fe),de=ae.getBucket(c);if(!de)continue;const ue=ki(fe,de,k);let ye=ue;y[0]===0&&y[1]===0||(ye=f.translatePosMatrix(ue,ae,y,v));const Ae=T?de.textCollisionBox:de.iconCollisionBox,Je=de.collisionCircleArray;if(Je.length>0){const be=s.create(),Le=ye;s.mul(be,de.placementInvProjMatrix,k.glCoordMatrix),s.mul(be,be,de.placementViewportMatrix),U.push({circleArray:Je,circleOffset:K,transform:Le,invTransform:be,projection:de.getProjection()}),G+=Je.length/4,K=G}Ae&&(f.terrain&&f.terrain.setupElevationDraw(ae,D),D.draw(S,I.LINES,s.DepthMode.disabled,s.StencilMode.disabled,f.colorModeForRenderPass(),s.CullFaceMode.disabled,Sc(ye,k,ae,de.getProjection()),c.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,null,k.zoom,null,[Ae.collisionVertexBuffer,Ae.collisionVertexBufferExt]))}if(!T||!U.length)return;const X=f.useProgram("collisionCircle"),Q=new s.StructArrayLayout2f1f2i16;Q.resize(4*G),Q._trim();let Y=0;for(const pe of U)for(let fe=0;fe<pe.circleArray.length/4;fe++){const ae=4*fe,de=pe.circleArray[ae+0],ue=pe.circleArray[ae+1],ye=pe.circleArray[ae+2],Ae=pe.circleArray[ae+3];Q.emplace(Y++,de,ue,ye,Ae,0),Q.emplace(Y++,de,ue,ye,Ae,1),Q.emplace(Y++,de,ue,ye,Ae,2),Q.emplace(Y++,de,ue,ye,Ae,3)}(!el||el.length<2*G)&&(el=function(pe){const fe=2*pe,ae=new s.StructArrayLayout3ui6;ae.resize(fe),ae._trim();for(let de=0;de<fe;de++){const ue=6*de;ae.uint16[ue+0]=4*de+0,ae.uint16[ue+1]=4*de+1,ae.uint16[ue+2]=4*de+2,ae.uint16[ue+3]=4*de+2,ae.uint16[ue+4]=4*de+3,ae.uint16[ue+5]=4*de+0}return ae}(G));const Z=S.createIndexBuffer(el,!0),ie=S.createVertexBuffer(Q,s.collisionCircleLayout.members,!0);for(const pe of U){const fe={u_matrix:pe.transform,u_inv_matrix:pe.invTransform,u_camera_to_center_distance:(J=k).getCameraToCenterDistance(pe.projection),u_viewport_size:[J.width,J.height]};X.draw(S,I.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,f.colorModeForRenderPass(),s.CullFaceMode.disabled,fe,c.id,ie,Z,s.SegmentVector.simpleSegment(0,2*pe.circleOffset,pe.circleArray.length,pe.circleArray.length/2),null,k.zoom)}var J;ie.destroy(),Z.destroy()}const xh=s.create();function Mc(f,n,c,p,y,v){const{horizontalAlign:T,verticalAlign:S}=s.getAnchorAlignment(f),I=-(T-.5)*n,k=-(S-.5)*c,D=s.evaluateVariableOffset(f,p);return new s.pointGeometry((I/y+D[0])*v,(k/y+D[1])*v)}function Cc(f,n,c,p,y,v,T,S,I,k,D){const U=f.text.placedSymbolArray,G=f.text.dynamicLayoutVertexArray,K=f.icon.dynamicLayoutVertexArray,X={},Q=Di(S,f.getProjection(),v),Y=v.elevation,Z=f.getProjection().upVectorScale(S.canonical,v.center.lat,v.worldSize);G.clear();for(let ie=0;ie<U.length;ie++){const J=U.get(ie),pe=f.allowVerticalPlacement&&!J.placedOrientation,fe=J.hidden||!J.crossTileID||pe?null:p[J.crossTileID];if(fe){const ae=new s.pointGeometry(J.tileAnchorX,J.tileAnchorY),de=f.getProjection().upVector(S.canonical,ae.x,ae.y),ue=Y?Y.getAtTileOffset(S,ae.x,ae.y):0,ye=Ot([J.projectedAnchorX+ue*de[0]*Z.metersToTile,J.projectedAnchorY+ue*de[1]*Z.metersToTile,J.projectedAnchorZ+ue*de[2]*Z.metersToTile],c?Q:T),Ae=ks(v.getCameraToCenterDistance(f.getProjection()),ye.signedDistanceFromCamera);let Je=y.evaluateSizeForFeature(f.textSizeData,k,J)*Ae/s.ONE_EM;c&&(Je*=f.tilePixelRatio/I);const{width:be,height:Le,anchor:Ve,textOffset:it,textScale:Re}=fe,Ke=Mc(Ve,be,Le,it,Re,Je);let Be;if(c){const ot=ae.add(Ke),{x:_t,y:wt,z:Mt}=f.getProjection().projectTilePoint(ot.x,ot.y,S.canonical);Be=Ot([_t+ue*de[0]*Z.metersToTile,wt+ue*de[1]*Z.metersToTile,Mt+ue*de[2]*Z.metersToTile],T).point}else{const ot=n?Ke.rotate(-v.angle):Ke;Be=[ye.point[0]+ot.x,ye.point[1]+ot.y,0]}const st=f.allowVerticalPlacement&&J.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let ot=0;ot<J.numGlyphs;ot++)s.addDynamicAttributes(G,Be[0],Be[1],Be[2],st);D&&J.associatedIconIndex>=0&&(X[J.associatedIconIndex]={shiftedAnchor:Be,angle:st})}else qn(J.numGlyphs,G)}if(D){K.clear();const ie=f.icon.placedSymbolArray;for(let J=0;J<ie.length;J++){const pe=ie.get(J);if(pe.hidden)qn(pe.numGlyphs,K);else{const fe=X[J];if(fe)for(let ae=0;ae<pe.numGlyphs;ae++)s.addDynamicAttributes(K,fe.shiftedAnchor[0],fe.shiftedAnchor[1],fe.shiftedAnchor[2],fe.angle);else qn(pe.numGlyphs,K)}}f.icon.dynamicLayoutVertexBuffer.updateData(K)}f.text.dynamicLayoutVertexBuffer.updateData(G)}function bh(f,n,c){return c.iconsInText&&n?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function zc(f,n,c,p,y,v,T,S,I,k,D,U){const G=f.context,K=G.gl,X=f.transform,Q=S==="map",Y=I==="map",Z=Q&&c.layout.get("symbol-placement")!=="point",ie=Q&&!Y&&!Z,J=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let pe=!1;const fe=f.depthModeForSublayer(0,s.DepthMode.ReadOnly),ae=[s.mercatorXfromLng(X.center.lng),s.mercatorYfromLat(X.center.lat)],de=c.layout.get("text-variable-anchor"),ue=X.projection.name==="globe",ye=[],Ae=[0,-1,0];let Je=Ae;!ue&&!X.mercatorFromTransition||Q||(Je=function(be){const Le=be._camera.getWorldToCamera(be.worldSize,1),Ve=s.multiply([],Le,be.globeMatrix);s.invert(Ve,Ve);const it=[0,0,0],Re=[0,1,0,0];return s.transformMat4$1(Re,Re,Ve),it[0]=Re[0],it[1]=Re[1],it[2]=Re[2],s.normalize(it,it),it}(X));for(const be of p){const Le=n.getTile(be),Ve=Le.getBucket(c);if(!Ve||Ve.projection.name==="mercator"&&ue)continue;const it=y?Ve.text:Ve.icon;if(!it||Ve.fullyClipped||!it.segments.get().length)continue;const Re=it.programConfigurations.get(c.id),Ke=y||Ve.sdfIcons,Be=y?Ve.textSizeData:Ve.iconSizeData,st=Y||X.pitch!==0,ot=s.evaluateSizeForZoom(Be,X.zoom);let _t,wt,Mt,qt,gt=[0,0],zt=null;if(y){if(wt=Le.glyphAtlasTexture,Mt=K.LINEAR,_t=Le.glyphAtlasTexture.size,Ve.iconsInText){gt=Le.imageAtlasTexture.size,zt=Le.imageAtlasTexture;const Ei=Be.kind==="composite"||Be.kind==="camera";qt=st||f.options.rotating||f.options.zooming||Ei?K.LINEAR:K.NEAREST}}else{const Ei=c.layout.get("icon-size").constantOr(0)!==1||Ve.iconsNeedLinear;wt=Le.imageAtlasTexture,Mt=Ke||f.options.rotating||f.options.zooming||Ei||st?K.LINEAR:K.NEAREST,_t=Le.imageAtlasTexture.size}const Qt=Ve.projection.name==="globe",Tr=Qt?Je:Ae,Ur=Qt?s.globeToMercatorTransition(X.zoom):0,cr=Di(be,Ve.getProjection(),X),ui=X.calculatePixelsToTileUnitsMatrix(Le),dn=Vt(cr,Le.tileID.canonical,Y,Q,X,Ve.getProjection(),ui),Mn=f.terrain&&Y&&Z?s.invert(s.create(),dn):xh,Er=cn(cr,Le.tileID.canonical,Y,Q,X,Ve.getProjection(),ui),Ir=de&&Ve.hasTextData(),Ut=c.layout.get("icon-text-fit")!=="none"&&Ir&&Ve.hasIconData();if(Z){const Ei=X.elevation,To=Ei?Ei.getAtTileOffsetFunc(be,X.center.lat,X.worldSize,Ve.getProjection()):la=>[0,0,0],Yn=$t(cr,Le.tileID.canonical,Y,Q,X,Ve.getProjection(),ui);Os(Ve,cr,f,y,Yn,Er,Y,k,To,be)}const Xr=Z||y&&de||Ut,_i=f.translatePosMatrix(cr,Le,v,T),_r=Xr?xh:dn,gi=f.translatePosMatrix(Er,Le,v,T,!0),vo=Ve.getProjection().createInversionMatrix(X,be.canonical),Ti=[];f.terrain&&Y&&Ti.push("PITCH_WITH_MAP_TERRAIN"),Qt&&Ti.push("PROJECTION_GLOBE_VIEW"),Xr&&Ti.push("PROJECTED_POS_ON_VIEWPORT");const xo=Ke&&c.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let bo;bo=Ke?Ve.iconsInText?Yo(Be.kind,ot,ie,Y,f,_i,_r,gi,_t,gt,be,Ur,ae,vo,Tr,Ve.getProjection()):Ic(Be.kind,ot,ie,Y,f,_i,_r,gi,y,_t,!0,be,Ur,ae,vo,Tr,Ve.getProjection()):Pc(Be.kind,ot,ie,Y,f,_i,_r,gi,y,_t,be,Ur,ae,vo,Tr,Ve.getProjection());const wo={program:f.useProgram(bh(Ke,y,Ve),Re,Ti),buffers:it,uniformValues:bo,atlasTexture:wt,atlasTextureIcon:zt,atlasInterpolation:Mt,atlasInterpolationIcon:qt,isSDF:Ke,hasHalo:xo,tile:Le,labelPlaneMatrixInv:Mn};if(J&&Ve.canOverlap){pe=!0;const Ei=it.segments.get();for(const To of Ei)ye.push({segments:new s.SegmentVector([To]),sortKey:To.sortKey,state:wo})}else ye.push({segments:it.segments,sortKey:0,state:wo})}pe&&ye.sort((be,Le)=>be.sortKey-Le.sortKey);for(const be of ye){const Le=be.state;if(f.terrain&&f.terrain.setupElevationDraw(Le.tile,Le.program,{useDepthForOcclusion:!ue,labelPlaneMatrixInv:Le.labelPlaneMatrixInv}),G.activeTexture.set(K.TEXTURE0),Le.atlasTexture.bind(Le.atlasInterpolation,K.CLAMP_TO_EDGE),Le.atlasTextureIcon&&(G.activeTexture.set(K.TEXTURE1),Le.atlasTextureIcon&&Le.atlasTextureIcon.bind(Le.atlasInterpolationIcon,K.CLAMP_TO_EDGE)),Le.isSDF){const Ve=Le.uniformValues;Le.hasHalo&&(Ve.u_is_halo=1,Rc(Le.buffers,be.segments,c,f,Le.program,fe,D,U,Ve)),Ve.u_is_halo=0}Rc(Le.buffers,be.segments,c,f,Le.program,fe,D,U,Le.uniformValues)}}function Rc(f,n,c,p,y,v,T,S,I){const k=p.context,D=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.globeExtVertexBuffer];y.draw(k,k.gl.TRIANGLES,v,T,S,s.CullFaceMode.disabled,I,c.id,f.layoutVertexBuffer,f.indexBuffer,n,c.paint,p.transform.zoom,f.programConfigurations.get(c.id),D)}function tl(f,n,c,p,y,v,T){const S=f.context.gl,I=c.paint.get("fill-pattern"),k=I&&I.constantOr(1),D=c.getCrossfadeParameters();let U,G,K,X,Q;T?(G=k&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=S.LINES):(G=k?"fillPattern":"fill",U=S.TRIANGLES);for(const Y of p){const Z=n.getTile(Y);if(k&&!Z.patternsLoaded())continue;const ie=Z.getBucket(c);if(!ie)continue;f.prepareDrawTile();const J=ie.programConfigurations.get(c.id),pe=f.useProgram(G,J);k&&(f.context.activeTexture.set(S.TEXTURE0),Z.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),J.updatePaintBuffers(D));const fe=I.constantOr(null);if(fe&&Z.imageAtlas){const de=Z.imageAtlas,ue=de.patternPositions[fe.to.toString()],ye=de.patternPositions[fe.from.toString()];ue&&ye&&J.setConstantPatternPositions(ue,ye)}const ae=f.translatePosMatrix(Y.projMatrix,Z,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(T){X=ie.indexBuffer2,Q=ie.segments2;const de=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];K=G==="fillOutlinePattern"&&k?Tc(ae,f,D,Z,de):yn(ae,de)}else X=ie.indexBuffer,Q=ie.segments,K=k?Xa(ae,f,D,Z):qs(ae);f.prepareDrawProgram(f.context,pe,Y.toUnwrapped()),pe.draw(f.context,U,y,f.stencilModeForClipping(Y),v,s.CullFaceMode.disabled,K,c.id,ie.layoutVertexBuffer,X,Q,c.paint,f.transform.zoom,J)}}function An(f,n,c,p,y,v,T){const S=f.context,I=S.gl,k=f.transform,D=c.paint.get("fill-extrusion-pattern"),U=D.constantOr(1),G=c.getCrossfadeParameters(),K=c.paint.get("fill-extrusion-opacity"),X=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),c.paint.get("fill-extrusion-ambient-occlusion-radius")],Q=c.layout.get("fill-extrusion-edge-radius"),Y=k.projection.name==="globe"?s.fillExtrusionHeightLift():0,Z=k.projection.name==="globe",ie=Z?s.globeToMercatorTransition(k.zoom):0,J=[s.mercatorXfromLng(k.center.lng),s.mercatorYfromLat(k.center.lat)],pe=[];Z&&(pe.push("PROJECTION_GLOBE_VIEW"),f.style.terrainSetForDrapingOnly()&&pe.push("TERRAIN")),X[0]>0&&pe.push("FAUX_AO");for(const fe of p){const ae=n.getTile(fe),de=ae.getBucket(c);if(!de||de.projection.name!==k.projection.name)continue;const ue=de.programConfigurations.get(c.id),ye=f.useProgram(U?"fillExtrusionPattern":"fillExtrusion",ue,pe);if(f.terrain){const Re=f.terrain;if(f.style.terrainSetForDrapingOnly())Re.setupElevationDraw(ae,ye,{useMeterToDem:!0});else{if(!de.enableTerrain)continue;if(Re.setupElevationDraw(ae,ye,{useMeterToDem:!0}),Zs(S,n,fe,de,c,Re),!de.centroidVertexBuffer){const Ke=ye.attributes.a_centroid_pos;Ke!==void 0&&I.vertexAttrib2f(Ke,0,0)}}}U&&(f.context.activeTexture.set(I.TEXTURE0),ae.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),ue.updatePaintBuffers(G));const Ae=D.constantOr(null);if(Ae&&ae.imageAtlas){const Re=ae.imageAtlas,Ke=Re.patternPositions[Ae.to.toString()],Be=Re.patternPositions[Ae.from.toString()];Ke&&Be&&ue.setConstantPatternPositions(Ke,Be)}const Je=f.translatePosMatrix(fe.projMatrix,ae,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),be=k.projection.createInversionMatrix(k,fe.canonical),Le=c.paint.get("fill-extrusion-vertical-gradient"),Ve=U?dh(Je,f,Le,K,X,Q,fe,G,ae,Y,ie,J,be):Qo(Je,f,Le,K,X,Q,fe,Y,ie,J,be);f.prepareDrawProgram(S,ye,fe.toUnwrapped());const it=[];f.terrain&&it.push(de.centroidVertexBuffer),Z&&it.push(de.layoutVertexExtBuffer),ye.draw(S,S.gl.TRIANGLES,y,v,T,s.CullFaceMode.backCCW,Ve,c.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,c.paint,f.transform.zoom,ue,it)}}function Zs(f,n,c,p,y,v){const T=[Z=>{let ie=Z.canonical.x-1,J=Z.wrap;return ie<0&&(ie=(1<<Z.canonical.z)-1,J--),new s.OverscaledTileID(Z.overscaledZ,J,Z.canonical.z,ie,Z.canonical.y)},Z=>{let ie=Z.canonical.x+1,J=Z.wrap;return ie===1<<Z.canonical.z&&(ie=0,J++),new s.OverscaledTileID(Z.overscaledZ,J,Z.canonical.z,ie,Z.canonical.y)},Z=>new s.OverscaledTileID(Z.overscaledZ,Z.wrap,Z.canonical.z,Z.canonical.x,(Z.canonical.y===0?1<<Z.canonical.z:Z.canonical.y)-1),Z=>new s.OverscaledTileID(Z.overscaledZ,Z.wrap,Z.canonical.z,Z.canonical.x,Z.canonical.y===(1<<Z.canonical.z)-1?0:Z.canonical.y+1)],S=Z=>{const ie=n.getSource().minzoom,J=fe=>{const ae=n.getTileByID(fe);if(ae&&ae.hasData())return ae.getBucket(y)},pe=[0,-1,1];for(const fe of pe){if(Z.overscaledZ+fe<ie)continue;const ae=J(Z.calculateScaledKey(Z.overscaledZ+fe));if(ae)return ae}},I=[0,0,0],k=(Z,ie)=>(I[0]=Math.min(Z.min.y,ie.min.y),I[1]=Math.max(Z.max.y,ie.max.y),I[2]=s.EXTENT-ie.min.x>Z.max.x?ie.min.x-s.EXTENT:Z.max.x,I),D=(Z,ie)=>(I[0]=Math.min(Z.min.x,ie.min.x),I[1]=Math.max(Z.max.x,ie.max.x),I[2]=s.EXTENT-ie.min.y>Z.max.y?ie.min.y-s.EXTENT:Z.max.y,I),U=[(Z,ie)=>k(Z,ie),(Z,ie)=>k(ie,Z),(Z,ie)=>D(Z,ie),(Z,ie)=>D(ie,Z)],G=new s.pointGeometry(0,0);let K,X,Q;const Y=(Z,ie,J,pe,fe)=>{const ae=[[pe?J:Z,pe?Z:J,0],[pe?J:ie,pe?ie:J,0]],de=fe<0?s.EXTENT+fe:fe,ue=[pe?de:(Z+ie)/2,pe?(Z+ie)/2:de,0];return J===0&&fe<0||J!==0&&fe>0?v.getForTilePoints(Q,[ue],!0,X):ae.push(ue),v.getForTilePoints(c,ae,!0,K),Math.max(ae[0][2],ae[1][2],ue[2])/v.exaggeration()};for(let Z=0;Z<4;Z++){const ie=(Z<2?1:5)-Z,J=p.borders[Z];if(J.length===0)continue;const pe=Q=T[Z](c),fe=S(pe);if(!(fe&&fe instanceof s.FillExtrusionBucket&&fe.enableTerrain)||p.borderDoneWithNeighborZ[Z]===fe.canonical.z&&fe.borderDoneWithNeighborZ[ie]===p.canonical.z||(X=v.findDEMTileFor(pe),!X||!X.dem))continue;if(!K){const ye=v.findDEMTileFor(c);if(!ye||!ye.dem)return;K=ye}const ae=fe.borders[ie];let de=0;const ue=fe.borderDoneWithNeighborZ[ie]!==p.canonical.z;if(p.canonical.z===fe.canonical.z){for(let ye=0;ye<J.length;ye++){const Ae=p.featuresOnBorder[J[ye]],Je=Ae.borders[Z];let be;for(;de<ae.length&&(be=fe.featuresOnBorder[ae[de]],!(be.borders[ie][1]>Je[0]+3));)ue&&fe.encodeCentroid(void 0,be,!1),de++;if(be&&de<ae.length){const Le=de;let Ve=0;for(;!(be.borders[ie][0]>Je[1]-3)&&(Ve++,++de!==ae.length);)be=fe.featuresOnBorder[ae[de]];if(be=fe.featuresOnBorder[ae[Le]],Ae.intersectsCount()>1||be.intersectsCount()>1||Ve!==1){Ve!==1&&(de=Le),p.encodeCentroid(void 0,Ae,!1),ue&&fe.encodeCentroid(void 0,be,!1);continue}const it=U[Z](Ae,be),Re=Z%2?s.EXTENT-1:0;G.x=Y(it[0],Math.min(s.EXTENT-1,it[1]),Re,Z<2,it[2]),G.y=0,p.encodeCentroid(G,Ae,!1),ue&&fe.encodeCentroid(G,be,!1)}else p.encodeCentroid(void 0,Ae,!1)}p.borderDoneWithNeighborZ[Z]=fe.canonical.z,p.needsCentroidUpdate=!0,ue&&(fe.borderDoneWithNeighborZ[ie]=p.canonical.z,fe.needsCentroidUpdate=!0)}else{for(const ye of J)p.encodeCentroid(void 0,p.featuresOnBorder[ye],!1);if(ue){for(const ye of ae)fe.encodeCentroid(void 0,fe.featuresOnBorder[ye],!1);fe.borderDoneWithNeighborZ[ie]=p.canonical.z,fe.needsCentroidUpdate=!0}p.borderDoneWithNeighborZ[Z]=fe.canonical.z,p.needsCentroidUpdate=!0}}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(f)}const wh=new s.Color(1,0,0,1),Ko=new s.Color(0,1,0,1),Jo=new s.Color(0,0,1,1),Th=new s.Color(1,0,1,1),kc=new s.Color(0,1,1,1);function tr(f,n,c){const p=f.context,y=f.transform,v=p.gl,T=y.projection.name==="globe",S=T?["PROJECTION_GLOBE_VIEW"]:null;let I=c.projMatrix;if(T&&s.globeToMercatorTransition(y.zoom)>0){const Ae=s.transitionTileAABBinECEF(c.canonical,y),Je=s.globeDenormalizeECEF(Ae);I=s.multiply(new Float32Array(16),y.globeMatrix,Je),s.multiply(I,y.projMatrix,I)}const k=f.useProgram("debug",null,S),D=n.getTileByID(c.key);f.terrain&&f.terrain.setupElevationDraw(D,k);const U=s.DepthMode.disabled,G=s.StencilMode.disabled,K=f.colorModeForRenderPass(),X="$debug";p.activeTexture.set(v.TEXTURE0),f.emptyTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),T?D._makeGlobeTileDebugBuffers(f.context,y):D._makeDebugTileBoundsBuffers(f.context,y.projection);const Q=D._tileDebugBuffer||f.debugBuffer,Y=D._tileDebugIndexBuffer||f.debugIndexBuffer,Z=D._tileDebugSegments||f.debugSegments;k.draw(p,v.LINE_STRIP,U,G,K,s.CullFaceMode.disabled,_h(I,s.Color.red),X,Q,Y,Z,null,null,null,[D._globeTileDebugBorderBuffer]);const ie=D.latestRawTileData,J=Math.floor((ie&&ie.byteLength||0)/1024),pe=n.getTile(c).tileSize,fe=512/Math.min(pe,512)*(c.overscaledZ/y.zoom)*.5;let ae=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(ae+=` => ${c.overscaledZ}`),ae+=` ${J}kb`,function(Ae,Je){Ae.initDebugOverlayCanvas();const be=Ae.debugOverlayCanvas,Le=Ae.context.gl,Ve=Ae.debugOverlayCanvas.getContext("2d");Ve.clearRect(0,0,be.width,be.height),Ve.shadowColor="white",Ve.shadowBlur=2,Ve.lineWidth=1.5,Ve.strokeStyle="white",Ve.textBaseline="top",Ve.font="bold 36px Open Sans, sans-serif",Ve.fillText(Je,5,5),Ve.strokeText(Je,5,5),Ae.debugOverlayTexture.update(be),Ae.debugOverlayTexture.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)}(f,ae);const de=D._tileDebugTextBuffer||f.debugBuffer,ue=D._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,ye=D._tileDebugTextSegments||f.debugSegments;k.draw(p,v.TRIANGLES,U,G,s.ColorMode.alphaBlended,s.CullFaceMode.disabled,_h(I,s.Color.transparent,fe),X,de,ue,ye,null,null,null,[D._globeTileDebugTextBuffer])}function Hs(f,n,c,p){Ws(f,0,n+c/2,f.transform.width,c,p)}function Eh(f,n,c,p){Ws(f,n-c/2,0,c,f.transform.height,p)}function Ws(f,n,c,p,y,v){const T=f.context,S=T.gl;S.enable(S.SCISSOR_TEST),S.scissor(n*s.exported.devicePixelRatio,c*s.exported.devicePixelRatio,p*s.exported.devicePixelRatio,y*s.exported.devicePixelRatio),T.clear({color:v}),S.disable(S.SCISSOR_TEST)}const Xs=s.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:wp}=Xs;function Qn(f,n,c,p){f.emplaceBack(n,c,p)}class Dc{constructor(n){this.vertexArray=new s.StructArrayLayout3f12,this.indices=new s.StructArrayLayout3ui6,Qn(this.vertexArray,-1,-1,1),Qn(this.vertexArray,1,-1,1),Qn(this.vertexArray,-1,1,1),Qn(this.vertexArray,1,1,1),Qn(this.vertexArray,-1,-1,-1),Qn(this.vertexArray,1,-1,-1),Qn(this.vertexArray,-1,1,-1),Qn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,wp),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=s.SegmentVector.simpleSegment(0,0,36,12)}}function es(f,n,c,p,y,v){const T=f.gl,S=n.paint.get("sky-atmosphere-color"),I=n.paint.get("sky-atmosphere-halo-color"),k=n.paint.get("sky-atmosphere-sun-intensity"),D=((U,G,K,X,Q)=>({u_matrix_3f:U,u_sun_direction:G,u_sun_intensity:K,u_color_tint_r:[X.r,X.g,X.b,X.a],u_color_tint_m:[Q.r,Q.g,Q.b,Q.a],u_luminance:5e-5}))(s.fromMat4(s.create$1(),p),y,k,S,I);T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+v,n.skyboxTexture,0),c.draw(f,T.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.frontCW,D,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const Oc=s.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class rl{constructor(n){const c=new s.StructArrayLayout5f20;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const p=new s.StructArrayLayout3ui6;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(c,Oc.members),this.indexBuffer=n.createIndexBuffer(p),this.segments=s.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ts={symbol:function(f,n,c,p,y){if(f.renderPass!=="translucent")return;const v=s.StencilMode.disabled,T=f.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(S,I,k,D,U,G,K){const X=I.transform,Q=U==="map",Y=G==="map";for(const Z of S){const ie=D.getTile(Z),J=ie.getBucket(k);if(!J||!J.text||!J.text.segments.get().length)continue;const pe=s.evaluateSizeForZoom(J.textSizeData,X.zoom),fe=Di(Z,J.getProjection(),X),ae=X.calculatePixelsToTileUnitsMatrix(ie),de=Vt(fe,ie.tileID.canonical,Y,Q,X,J.getProjection(),ae),ue=k.layout.get("icon-text-fit")!=="none"&&J.hasIconData();if(pe){const ye=Math.pow(2,X.zoom-ie.tileID.overscaledZ);Cc(J,Q,Y,K,s.symbolSize,X,de,Z,ye,pe,ue)}}}(p,f,c,n,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),y),c.paint.get("icon-opacity").constantOr(1)!==0&&zc(f,n,c,p,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),v,T),c.paint.get("text-opacity").constantOr(1)!==0&&zc(f,n,c,p,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),v,T),n.map.showCollisionBoxes&&(vh(f,n,c,p,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),vh(f,n,c,p,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(f,n,c,p){if(f.renderPass!=="translucent")return;const y=c.paint.get("circle-opacity"),v=c.paint.get("circle-stroke-width"),T=c.paint.get("circle-stroke-opacity"),S=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(y.constantOr(1)===0&&(v.constantOr(1)===0||T.constantOr(1)===0))return;const I=f.context,k=I.gl,D=f.transform,U=f.depthModeForSublayer(0,s.DepthMode.ReadOnly),G=s.StencilMode.disabled,K=f.colorModeForRenderPass(),X=D.projection.name==="globe",Q=[s.mercatorXfromLng(D.center.lng),s.mercatorYfromLat(D.center.lat)],Y=[];for(let ie=0;ie<p.length;ie++){const J=p[ie],pe=n.getTile(J),fe=pe.getBucket(c);if(!fe||fe.projection.name!==D.projection.name)continue;const ae=fe.programConfigurations.get(c.id),de=mh(c);X&&de.push("PROJECTION_GLOBE_VIEW");const ue=f.useProgram("circle",ae,de),ye=fe.layoutVertexBuffer,Ae=fe.globeExtVertexBuffer,Je=fe.indexBuffer,be=D.projection.createInversionMatrix(D,J.canonical),Le={programConfiguration:ae,program:ue,layoutVertexBuffer:ye,globeExtVertexBuffer:Ae,indexBuffer:Je,uniformValues:Ec(f,J,pe,be,Q,c),tile:pe};if(S){const Ve=fe.segments.get();for(const it of Ve)Y.push({segments:new s.SegmentVector([it]),sortKey:it.sortKey,state:Le})}else Y.push({segments:fe.segments,sortKey:0,state:Le})}S&&Y.sort((ie,J)=>ie.sortKey-J.sortKey);const Z={useDepthForOcclusion:!X};for(const ie of Y){const{programConfiguration:J,program:pe,layoutVertexBuffer:fe,globeExtVertexBuffer:ae,indexBuffer:de,uniformValues:ue,tile:ye}=ie.state,Ae=ie.segments;f.terrain&&f.terrain.setupElevationDraw(ye,pe,Z),f.prepareDrawProgram(I,pe,ye.tileID.toUnwrapped()),pe.draw(I,k.TRIANGLES,U,G,K,s.CullFaceMode.disabled,ue,c.id,fe,de,Ae,c.paint,D.zoom,J,[ae])}},heatmap:function(f,n,c,p){if(c.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const y=f.context,v=y.gl,T=s.StencilMode.disabled,S=new s.ColorMode([v.ONE,v.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(K,X,Q,Y){const Z=K.gl,ie=X.width*Y,J=X.height*Y;K.activeTexture.set(Z.TEXTURE1),K.viewport.set([0,0,ie,J]);let pe=Q.heatmapFbo;if(!pe||pe&&(pe.width!==ie||pe.height!==J)){pe&&pe.destroy();const fe=Z.createTexture();Z.bindTexture(Z.TEXTURE_2D,fe),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,Z.LINEAR),pe=Q.heatmapFbo=K.createFramebuffer(ie,J,!1),function(ae,de,ue,ye,Ae,Je){const be=ae.gl;be.texImage2D(be.TEXTURE_2D,0,be.RGBA,Ae,Je,0,be.RGBA,ae.extRenderToTextureHalfFloat?ae.extTextureHalfFloat.HALF_FLOAT_OES:be.UNSIGNED_BYTE,null),ye.colorAttachment.set(ue)}(K,0,fe,pe,ie,J)}else Z.bindTexture(Z.TEXTURE_2D,pe.colorAttachment.get()),K.bindFramebuffer.set(pe.framebuffer)})(y,f,c,f.transform.projection.name==="globe"?.5:.25),y.clear({color:s.Color.transparent});const I=f.transform,k=I.projection.name==="globe",D=k?["PROJECTION_GLOBE_VIEW"]:null,U=k?s.CullFaceMode.frontCCW:s.CullFaceMode.disabled,G=[s.mercatorXfromLng(I.center.lng),s.mercatorYfromLat(I.center.lat)];for(let K=0;K<p.length;K++){const X=p[K];if(n.hasRenderableParent(X))continue;const Q=n.getTile(X),Y=Q.getBucket(c);if(!Y||Y.projection.name!==I.projection.name)continue;const Z=Y.programConfigurations.get(c.id),ie=f.useProgram("heatmap",Z,D),{zoom:J}=f.transform;f.terrain&&f.terrain.setupElevationDraw(Q,ie),f.prepareDrawProgram(y,ie,X.toUnwrapped());const pe=I.projection.createInversionMatrix(I,X.canonical);ie.draw(y,v.TRIANGLES,s.DepthMode.disabled,T,S,U,_p(f,X,Q,pe,G,J,c.paint.get("heatmap-intensity")),c.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,c.paint,f.transform.zoom,Z,k?[Y.globeExtVertexBuffer]:null)}y.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(y,v){const T=y.context,S=T.gl,I=v.heatmapFbo;if(!I)return;T.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,I.colorAttachment.get()),T.activeTexture.set(S.TEXTURE1);let k=v.colorRampTexture;k||(k=v.colorRampTexture=new s.Texture(T,v.colorRamp,S.RGBA)),k.bind(S.LINEAR,S.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(T,S.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,y.colorModeForRenderPass(),s.CullFaceMode.disabled,((D,U,G,K)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,v),v.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,v.paint,y.transform.zoom)}(f,c))},line:function(f,n,c,p){if(f.renderPass!=="translucent")return;const y=c.paint.get("line-opacity"),v=c.paint.get("line-width");if(y.constantOr(1)===0||v.constantOr(1)===0)return;const T=f.depthModeForSublayer(0,s.DepthMode.ReadOnly),S=f.colorModeForRenderPass(),I=f.terrain&&f.terrain.renderingToTexture?1:s.exported.devicePixelRatio,k=c.paint.get("line-dasharray"),D=k.constantOr(1),U=c.layout.get("line-cap"),G=c.paint.get("line-pattern"),K=G.constantOr(1),X=c.paint.get("line-gradient"),Q=c.getCrossfadeParameters(),Y=K?"linePattern":"line",Z=f.context,ie=Z.gl,J=(fe=>{const ae=[];Ka(fe)&&ae.push("RENDER_LINE_DASH"),fe.paint.get("line-gradient")&&ae.push("RENDER_LINE_GRADIENT");const de=fe.paint.get("line-trim-offset");de[0]===0&&de[1]===0||ae.push("RENDER_LINE_TRIM_OFFSET");const ue=fe.paint.get("line-pattern").constantOr(1),ye=fe.paint.get("line-opacity").constantOr(1)!==1;return!ue&&ye&&ae.push("RENDER_LINE_ALPHA_DISCARD"),ae})(c);let pe=J.includes("RENDER_LINE_ALPHA_DISCARD");f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(pe=!1);for(const fe of p){const ae=n.getTile(fe);if(K&&!ae.patternsLoaded())continue;const de=ae.getBucket(c);if(!de)continue;f.prepareDrawTile();const ue=de.programConfigurations.get(c.id),ye=f.useProgram(Y,ue,J),Ae=G.constantOr(null);if(Ae&&ae.imageAtlas){const Be=ae.imageAtlas,st=Be.patternPositions[Ae.to.toString()],ot=Be.patternPositions[Ae.from.toString()];st&&ot&&ue.setConstantPatternPositions(st,ot)}const Je=k.constantOr(null),be=U.constantOr(null);if(!K&&Je&&be&&ae.lineAtlas){const Be=ae.lineAtlas,st=Be.getDash(Je.to,be),ot=Be.getDash(Je.from,be);st&&ot&&ue.setConstantPatternPositions(st,ot)}let[Le,Ve]=c.paint.get("line-trim-offset");if(be==="round"||be==="square"){const Be=1;Le!==Ve&&(Le===0&&(Le-=Be),Ve===1&&(Ve+=Be))}const it=f.terrain?fe.projMatrix:null,Re=K?gp(f,ae,c,Q,it,I):Qa(f,ae,c,Q,it,de.lineClipsArray.length,I,[Le,Ve]);if(X){const Be=de.gradients[c.id];let st=Be.texture;if(c.gradientVersion!==Be.version){let ot=256;if(c.stepInterpolant){const _t=n.getSource().maxzoom,wt=fe.canonical.z===_t?Math.ceil(1<<f.transform.maxZoom-fe.canonical.z):1;ot=s.clamp(s.nextPowerOfTwo(de.maxLineLength/s.EXTENT*1024*wt),256,Z.maxTextureSize)}Be.gradient=s.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:ot,image:Be.gradient||void 0,clips:de.lineClipsArray}),Be.texture?Be.texture.update(Be.gradient):Be.texture=new s.Texture(Z,Be.gradient,ie.RGBA),Be.version=c.gradientVersion,st=Be.texture}Z.activeTexture.set(ie.TEXTURE1),st.bind(c.stepInterpolant?ie.NEAREST:ie.LINEAR,ie.CLAMP_TO_EDGE)}D&&(Z.activeTexture.set(ie.TEXTURE0),ae.lineAtlasTexture.bind(ie.LINEAR,ie.REPEAT),ue.updatePaintBuffers(Q)),K&&(Z.activeTexture.set(ie.TEXTURE0),ae.imageAtlasTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),ue.updatePaintBuffers(Q)),f.prepareDrawProgram(Z,ye,fe.toUnwrapped());const Ke=Be=>{ye.draw(Z,ie.TRIANGLES,T,Be,S,s.CullFaceMode.disabled,Re,c.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,c.paint,f.transform.zoom,ue,[de.layoutVertexBuffer2])};if(pe){const Be=f.stencilModeForClipping(fe).ref;Be===0&&f.terrain&&Z.clear({stencil:0});const st={func:ie.EQUAL,mask:255};Re.u_alpha_discard_threshold=.8,Ke(new s.StencilMode(st,Be,255,ie.KEEP,ie.KEEP,ie.INVERT)),Re.u_alpha_discard_threshold=0,Ke(new s.StencilMode(st,Be,255,ie.KEEP,ie.KEEP,ie.KEEP))}else Ke(f.stencilModeForClipping(fe))}pe&&(f.resetStencilClippingMasks(),f.terrain&&Z.clear({stencil:0}))},fill:function(f,n,c,p){const y=c.paint.get("fill-color"),v=c.paint.get("fill-opacity");if(v.constantOr(1)===0)return;const T=f.colorModeForRenderPass(),S=c.paint.get("fill-pattern"),I=f.opaquePassEnabledForLayer()&&!S.constantOr(1)&&y.constantOr(s.Color.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===I){const k=f.depthModeForSublayer(1,f.renderPass==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly);tl(f,n,c,p,k,T,!1)}if(f.renderPass==="translucent"&&c.paint.get("fill-antialias")){const k=f.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,s.DepthMode.ReadOnly);tl(f,n,c,p,k,T,!0)}},"fill-extrusion":function(f,n,c,p){const y=c.paint.get("fill-extrusion-opacity");if(y!==0&&f.renderPass==="translucent"){const v=new s.DepthMode(f.context.gl.LEQUAL,s.DepthMode.ReadWrite,f.depthRangeFor3D);if(y!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))An(f,n,c,p,v,s.StencilMode.disabled,s.ColorMode.disabled),An(f,n,c,p,v,f.stencilModeFor3D(),f.colorModeForRenderPass()),f.resetStencilClippingMasks();else{const T=f.colorModeForRenderPass();An(f,n,c,p,v,s.StencilMode.disabled,T)}}},hillshade:function(f,n,c,p){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const y=f.context,v=f.depthModeForSublayer(0,s.DepthMode.ReadOnly),T=f.colorModeForRenderPass(),S=f.terrain&&f.terrain.renderingToTexture,[I,k]=f.renderPass!=="translucent"||S?[{},p]:f.stencilConfigForOverlap(p);for(const D of k){const U=n.getTile(D);if(U.needsHillshadePrepare&&f.renderPass==="offscreen")Xo(f,U,c,v,s.StencilMode.disabled,T);else if(f.renderPass==="translucent"){const G=S&&f.terrain?f.terrain.stencilModeForRTTOverlap(D):I[D.overscaledZ];mc(f,D,U,c,v,G,T)}}y.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,n,c,p,y,v){if(f.renderPass!=="translucent"||c.paint.get("raster-opacity")===0||!p.length)return;const T=f.context,S=T.gl,I=n.getSource(),k=f.useProgram("raster"),D=f.colorModeForRenderPass(),U=f.terrain&&f.terrain.renderingToTexture,[G,K]=I instanceof xe||U?[{},p]:f.stencilConfigForOverlap(p),X=K[K.length-1].overscaledZ,Q=!f.options.moving;for(const Y of K){const Z=U?s.DepthMode.disabled:f.depthModeForSublayer(Y.overscaledZ-X,c.paint.get("raster-opacity")===1?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly,S.LESS),ie=Y.toUnwrapped(),J=n.getTile(Y);if(U&&(!J||!J.hasData()))continue;const pe=U?Y.projMatrix:f.transform.calculateProjMatrix(ie,Q),fe=f.terrain&&U?f.terrain.stencilModeForRTTOverlap(Y):G[Y.overscaledZ],ae=v?0:c.paint.get("raster-fade-duration");J.registerFadeDuration(ae);const de=n.findLoadedParent(Y,0),ue=Ha(J,de,n,f.transform,ae);let ye,Ae;f.terrain&&f.terrain.prepareDrawTile();const Je=c.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;T.activeTexture.set(S.TEXTURE0),J.texture.bind(Je,S.CLAMP_TO_EDGE),T.activeTexture.set(S.TEXTURE1),de?(de.texture.bind(Je,S.CLAMP_TO_EDGE),ye=Math.pow(2,de.tileID.overscaledZ-J.tileID.overscaledZ),Ae=[J.tileID.canonical.x*ye%1,J.tileID.canonical.y*ye%1]):J.texture.bind(Je,S.CLAMP_TO_EDGE);const be=yp(pe,Ae||[0,0],ye||1,ue,c,I instanceof xe?I.perspectiveTransform:[0,0]);if(f.prepareDrawProgram(T,k,ie),I instanceof xe)I.boundsBuffer&&I.boundsSegments&&k.draw(T,S.TRIANGLES,Z,s.StencilMode.disabled,D,s.CullFaceMode.disabled,be,c.id,I.boundsBuffer,f.quadTriangleIndexBuffer,I.boundsSegments);else{const{tileBoundsBuffer:Le,tileBoundsIndexBuffer:Ve,tileBoundsSegments:it}=f.getTileBoundsBuffers(J);k.draw(T,S.TRIANGLES,Z,fe,D,s.CullFaceMode.disabled,be,c.id,Le,Ve,it)}}f.resetStencilClippingMasks()},background:function(f,n,c,p){const y=c.paint.get("background-color"),v=c.paint.get("background-opacity");if(v===0)return;const T=f.context,S=T.gl,I=f.transform,k=I.tileSize,D=c.paint.get("background-pattern");if(f.isPatternMissing(D))return;const U=!D&&y.a===1&&v===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==U)return;const G=s.StencilMode.disabled,K=f.depthModeForSublayer(0,U==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly),X=f.colorModeForRenderPass(),Q=f.useProgram(D?"backgroundPattern":"background");let Y,Z=p;Z||(Y=f.getBackgroundTiles(),Z=Object.values(Y).map(J=>J.tileID)),D&&(T.activeTexture.set(S.TEXTURE0),f.imageManager.bind(f.context));const ie=c.getCrossfadeParameters();for(const J of Z){const pe=J.toUnwrapped(),fe=p?J.projMatrix:f.transform.calculateProjMatrix(pe);f.prepareDrawTile();const ae=n?n.getTile(J):Y?Y[J.key]:new s.Tile(J,k,I.zoom,f),de=D?xp(fe,v,f,D,{tileID:J,tileSize:k},ie):vp(fe,v,y);f.prepareDrawProgram(T,Q,pe);const{tileBoundsBuffer:ue,tileBoundsIndexBuffer:ye,tileBoundsSegments:Ae}=f.getTileBoundsBuffers(ae);Q.draw(T,S.TRIANGLES,K,G,X,s.CullFaceMode.disabled,de,c.id,ue,ye,Ae)}},sky:function(f,n,c){const p=f.transform,y=p.projection.name==="mercator"||p.projection.name==="globe"?1:s.smoothstep(7,8,p.zoom),v=c.paint.get("sky-opacity")*y;if(v===0)return;const T=f.context,S=c.paint.get("sky-type"),I=new s.DepthMode(T.gl.LEQUAL,s.DepthMode.ReadOnly,[0,1]),k=f.frameCounter/1e3%1;S==="atmosphere"?f.renderPass==="offscreen"?c.needsSkyboxCapture(f)&&(function(D,U,G,K){const X=D.context,Q=X.gl;let Y=U.skyboxFbo;if(!Y){Y=U.skyboxFbo=X.createFramebuffer(32,32,!1),U.skyboxGeometry=new Dc(X),U.skyboxTexture=X.gl.createTexture(),Q.bindTexture(Q.TEXTURE_CUBE_MAP,U.skyboxTexture),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MAG_FILTER,Q.LINEAR);for(let pe=0;pe<6;++pe)Q.texImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+pe,0,Q.RGBA,32,32,0,Q.RGBA,Q.UNSIGNED_BYTE,null)}X.bindFramebuffer.set(Y.framebuffer),X.viewport.set([0,0,32,32]);const Z=U.getCenter(D,!0),ie=D.useProgram("skyboxCapture"),J=new Float64Array(16);s.identity(J),s.rotateY(J,J,.5*-Math.PI),es(X,U,ie,J,Z,0),s.identity(J),s.rotateY(J,J,.5*Math.PI),es(X,U,ie,J,Z,1),s.identity(J),s.rotateX(J,J,.5*-Math.PI),es(X,U,ie,J,Z,2),s.identity(J),s.rotateX(J,J,.5*Math.PI),es(X,U,ie,J,Z,3),s.identity(J),es(X,U,ie,J,Z,4),s.identity(J),s.rotateY(J,J,Math.PI),es(X,U,ie,J,Z,5),X.viewport.set([0,0,D.width,D.height])}(f,c),c.markSkyboxValid(f)):f.renderPass==="sky"&&function(D,U,G,K,X){const Q=D.context,Y=Q.gl,Z=D.transform,ie=D.useProgram("skybox");Q.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_CUBE_MAP,U.skyboxTexture);const J=((pe,fe,ae,de,ue)=>({u_matrix:pe,u_sun_direction:fe,u_cubemap:0,u_opacity:de,u_temporal_offset:ue}))(Z.skyboxMatrix,U.getCenter(D,!1),0,K,X);D.prepareDrawProgram(Q,ie),ie.draw(Q,Y.TRIANGLES,G,s.StencilMode.disabled,D.colorModeForRenderPass(),s.CullFaceMode.backCW,J,"skybox",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(f,c,I,v,k):S==="gradient"&&f.renderPass==="sky"&&function(D,U,G,K,X){const Q=D.context,Y=Q.gl,Z=D.transform,ie=D.useProgram("skyboxGradient");U.skyboxGeometry||(U.skyboxGeometry=new Dc(Q)),Q.activeTexture.set(Y.TEXTURE0);let J=U.colorRampTexture;J||(J=U.colorRampTexture=new s.Texture(Q,U.colorRamp,Y.RGBA)),J.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const pe=((fe,ae,de,ue,ye)=>({u_matrix:fe,u_color_ramp:0,u_center_direction:ae,u_radius:s.degToRad(de),u_opacity:ue,u_temporal_offset:ye}))(Z.skyboxMatrix,U.getCenter(D,!1),U.paint.get("sky-gradient-radius"),K,X);D.prepareDrawProgram(Q,ie),ie.draw(Q,Y.TRIANGLES,G,s.StencilMode.disabled,D.colorModeForRenderPass(),s.CullFaceMode.backCW,pe,"skyboxGradient",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(f,c,I,v,k)},debug:function(f,n,c){for(let p=0;p<c.length;p++)tr(f,n,c[p])},custom:function(f,n,c){const p=f.context,y=c.implementation;if(f.transform.projection.unsupportedLayers&&f.transform.projection.unsupportedLayers.includes("custom"))s.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(f.renderPass==="offscreen"){const v=y.prerender;v&&(f.setCustomLayerDefaults(),p.setColorMode(f.colorModeForRenderPass()),v.call(y,p.gl,f.transform.customLayerMatrix()),p.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),p.setColorMode(f.colorModeForRenderPass()),p.setStencilMode(s.StencilMode.disabled);const v=y.renderingMode==="3d"?new s.DepthMode(f.context.gl.LEQUAL,s.DepthMode.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,s.DepthMode.ReadOnly);p.setDepthMode(v),y.render(p.gl,f.transform.customLayerMatrix()),p.setDirty(),f.setBaseState(),p.bindFramebuffer.set(null)}}};class Lc{constructor(n,c){this.context=new ee(n),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=s.SourceCache.maxUnderzooming+s.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Na,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,c){const p=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new hh(this,n));const y=this._terrain;this.transform.elevation=p?y:null,y.update(n,this.transform,c)}_updateFog(n){const c=n.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,y]=c.getFovAdjustedRange(this.transform._fov);if(p>y)return void(this.transform.fogCullDistSq=null);const v=p+.78*(y-p);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,c){if(this.width=n*s.exported.devicePixelRatio,this.height=c*s.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._layers[p].resize()}setup(){const n=this.context,c=new s.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(s.EXTENT,0),c.emplaceBack(0,s.EXTENT),c.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(c,s.posAttributes.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const p=new s.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(s.EXTENT,0),p.emplaceBack(0,s.EXTENT),p.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=n.createVertexBuffer(p,s.posAttributes.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const y=new s.StructArrayLayout2i4;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(y,s.posAttributes.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const v=new s.StructArrayLayout4i8;v.emplaceBack(0,0,0,0),v.emplaceBack(s.EXTENT,0,s.EXTENT,0),v.emplaceBack(0,s.EXTENT,0,s.EXTENT),v.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(v,s.boundsAttributes.members),this.mercatorBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const T=new s.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(T);const S=new s.StructArrayLayout1ui2;for(const k of[0,1,3,2,0])S.emplaceBack(k);this.debugIndexBuffer=n.createIndexBuffer(S),this.emptyTexture=new s.Texture(n,new s.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=s.create();const I=this.context.gl;this.stencilClearMode=new s.StencilMode({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.loadTimeStamps.push(s.window.performance.now()),this.atmosphereBuffer=new rl(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,c=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,c.TRIANGLES,s.DepthMode.disabled,this.stencilClearMode,s.ColorMode.disabled,s.CullFaceMode.disabled,vc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,c,p){if(!c||this.currentStencilSource===c.id||!n.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const I of p)if(this._tileClippingMaskIDs[I.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=c.id;const y=this.context,v=y.gl;this.nextStencilID+p.length>256&&this.clearStencil(),y.setColorMode(s.ColorMode.disabled),y.setDepthMode(s.DepthMode.disabled);const T=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of p){const I=c.getTile(S),k=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:D,tileBoundsIndexBuffer:U,tileBoundsSegments:G}=this.getTileBoundsBuffers(I);T.draw(y,v.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:v.ALWAYS,mask:0},k,255,v.KEEP,v.KEEP,v.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,vc(S.projMatrix),"$clipping",D,U,G)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,c=this.context.gl;return new s.StencilMode({func:c.NOTEQUAL,mask:255},n,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const c=this.context.gl;return new s.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(n){const c=this.context.gl,p=n.sort((T,S)=>S.overscaledZ-T.overscaledZ),y=p[p.length-1].overscaledZ,v=p[0].overscaledZ-y+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const T={};for(let S=0;S<v;S++)T[S+y]=new s.StencilMode({func:c.GEQUAL,mask:255},S+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=v,[T,p]}return[{[y]:s.StencilMode.disabled},p]}colorModeForRenderPass(){const n=this.context.gl;if(this._showOverdrawInspector){const c=1/8;return new s.ColorMode([n.CONSTANT_COLOR,n.ONE],new s.Color(c,c,c,0),[!0,!0,!0,!0])}return this.renderPass==="opaque"?s.ColorMode.unblended:s.ColorMode.alphaBlended}depthModeForSublayer(n,c,p){if(!this.opaquePassEnabledForLayer())return s.DepthMode.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new s.DepthMode(p||this.context.gl.LEQUAL,c,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,c){this.style=n,this.options=c,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const p=this.style.order,y=this.style._sourceCaches;for(const I in y){const k=y[I];k.used&&k.prepare(this.context)}const v={},T={},S={};for(const I in y){const k=y[I];v[I]=k.getVisibleCoordinates(),T[I]=v[I].slice().reverse(),S[I]=k.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<p.length;I++)if(this.style._layers[p[I]].is3D()){this.opaquePassCutoff=I;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.GlobeSharedBuffers(this.context)),s.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const I of p){const k=this.style._layers[I],D=n._getLayerSourceCache(k);if(!k.hasOffscreenPass()||k.isHidden(this.transform.zoom))continue;const U=D?T[D.id]:void 0;(k.type==="custom"||k.isSky()||U&&U.length)&&this.renderLayer(this,D,k,U)}if(this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:c.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[p[this.currentLayer]],k=n._getLayerSourceCache(I);if(I.isSky())continue;const D=k?T[k.id]:void 0;this._renderTileClippingMasks(I,k,D),this.renderLayer(this,k,I,D)}if(this.style.fog&&this.transform.projection.supportsFog&&function(I,k){const D=I.context,U=D.gl,G=I.transform,K=new s.DepthMode(U.LEQUAL,s.DepthMode.ReadOnly,[0,1]),X=I.useProgram("globeAtmosphere",null,G.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Q=s.globeToMercatorTransition(G.zoom),Y=k.properties.get("color").toArray01(),Z=k.properties.get("high-color").toArray01(),ie=k.properties.get("space-color").toArray01PremultipliedAlpha(),J=s.identity$1([]);s.rotateY$1(J,J,-s.degToRad(G._center.lng)),s.rotateX$1(J,J,s.degToRad(G._center.lat)),s.rotateZ$1(J,J,G.angle),s.rotateX$1(J,J,-G._pitch);const pe=s.fromQuat(new Float32Array(16),J),fe=s.mapValue(k.properties.get("star-intensity"),0,1,0,.25),ae=5e-4,de=s.mapValue(k.properties.get("horizon-blend"),0,1,ae,.25),ue=s.globeUseCustomAntiAliasing(I,D,G)&&de===ae?G.worldSize/(2*Math.PI*1.025)-1:G.globeRadius,ye=I.frameCounter/1e3%1,Ae=s.length(G.globeCenterInViewSpace),Je=Math.sqrt(Math.pow(Ae,2)-Math.pow(ue,2)),be=Math.acos(Je/Ae),Le=((it,Re,Ke,Be,st,ot,_t,wt,Mt,qt,gt,zt,Qt,Tr)=>({u_frustum_tl:it,u_frustum_tr:Re,u_frustum_br:Ke,u_frustum_bl:Be,u_horizon:st,u_transition:ot,u_fadeout_range:_t,u_color:wt,u_high_color:Mt,u_space_color:qt,u_star_intensity:gt,u_star_size:5*s.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:zt,u_horizon_angle:Qt,u_rotation_matrix:Tr}))(G.frustumCorners.TL,G.frustumCorners.TR,G.frustumCorners.BR,G.frustumCorners.BL,G.frustumCorners.horizon,Q,de,Y,Z,ie,fe,ye,be,pe);I.prepareDrawProgram(D,X);const Ve=I.atmosphereBuffer;Ve&&X.draw(D,U.TRIANGLES,K,s.StencilMode.disabled,s.ColorMode.alphaBlended,s.CullFaceMode.backCW,Le,"skybox",Ve.vertexBuffer,Ve.indexBuffer,Ve.segments)}(this,this.style.fog),this.renderPass="sky",(s.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const I=this.style._layers[p[this.currentLayer]],k=n._getLayerSourceCache(I);I.isSky()&&this.renderLayer(this,k,I,k?T[k.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){const I=this.style._layers[p[this.currentLayer]],k=n._getLayerSourceCache(I);if(I.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(I)){if(I.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const D=k?(I.type==="symbol"?S:T)[k.id]:void 0;this._renderTileClippingMasks(I,k,k?v[k.id]:void 0),this.renderLayer(this,k,I,D),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let I=null;s.values(this.style._layers).forEach(k=>{const D=n._getLayerSourceCache(k);D&&!k.isHidden(this.transform.zoom)&&(!I||I.getSource().maxzoom<D.getSource().maxzoom)&&(I=D)}),I&&this.options.showTileBoundaries&&ts.debug(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const k=I.transform.padding;Hs(I,I.transform.height-(k.top||0),3,wh),Hs(I,k.bottom||0,3,Ko),Eh(I,k.left||0,3,Jo),Eh(I,I.transform.width-(k.right||0),3,Th);const D=I.transform.centerPoint;(function(U,G,K,X){Ws(U,G-1,K-10,2,20,X),Ws(U,G-10,K-1,20,2,X)})(I,D.x,I.transform.height-D.y,kc)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(s.window.performance.now()),this.saveCanvasCopy())}}renderLayer(n,c,p,y){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||y&&y.length)&&(this.id=p.id,this.gpuTimingStart(p),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(p.type)||ts[p.type](n,c,p,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let p=this.gpuTimers[n.id];p||(p=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),p.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,c=n.createQueryEXT();this.deferredRenderGpuTimeQueries.push(c),n.beginQueryEXT(n.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const c={};for(const p in n){const y=n[p],v=this.context.extTimerQuery,T=v.getQueryObjectEXT(y.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(y.query),c[p]=T}return c}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.extTimerQuery;let p=0;for(const y of n)p+=c.getQueryObjectEXT(y,c.QUERY_RESULT_EXT)/1e6,c.deleteQueryEXT(y);return p}translatePosMatrix(n,c,p,y,v){if(!p[0]&&!p[1])return n;const T=v?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(T){const k=Math.sin(T),D=Math.cos(T);p=[p[0]*D-p[1]*k,p[0]*k+p[1]*D]}const S=[v?p[0]:Yr(c,p[0],this.transform.zoom),v?p[1]:Yr(c,p[1],this.transform.zoom),0],I=new Float32Array(16);return s.translate(I,n,S),I}saveTileTexture(n){const c=this._tileTextures[n.size[0]];c?c.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const c=this._tileTextures[n];return c&&c.length>0?c.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const c=this.imageManager.getPattern(n.from.toString()),p=this.imageManager.getPattern(n.to.toString());return!c||!p}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,c=this.style&&this.style.fog,p=[];return this.terrain&&!this.terrain.renderingToTexture&&p.push("TERRAIN"),c&&!n&&c.getOpacity(this.transform.pitch)!==0&&p.push("FOG"),n&&p.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&p.push("OVERDRAW_INSPECTOR"),p}useProgram(n,c,p){this.cache=this.cache||{};const y=p||[],v=this.currentGlobalDefines().concat(y),T=wc.cacheKey(qa[n],n,v,c);return this.cache[T]||(this.cache[T]=new wc(this.context,n,qa[n],c,bp[n],v)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(n,c,p){if(this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const v=y.getOpacity(this.transform.pitch),T=((S,I,k,D,U,G,K,X,Q,Y,Z)=>{const ie=S.transform,J=I.properties.get("color").toArray01();J[3]=D;const pe=S.frameCounter/1e3%1;return{u_fog_matrix:k?ie.calculateFogTileMatrix(k):S.identityMat,u_fog_range:I.getFovAdjustedRange(ie._fov),u_fog_color:J,u_fog_horizon_blend:I.properties.get("horizon-blend"),u_fog_temporal_offset:pe,u_frustum_tl:U,u_frustum_tr:G,u_frustum_br:K,u_frustum_bl:X,u_globe_pos:Q,u_globe_radius:Y,u_viewport:Z,u_globe_transition:s.globeToMercatorTransition(ie.zoom),u_is_globe:+(ie.projection.name==="globe")}})(this,y,p,v,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.exported.devicePixelRatio,this.transform.height*s.exported.devicePixelRatio]);c.setFogUniformValues(n,T)}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const n=this.context.gl,c=n.createTexture();return n.bindTexture(n.TEXTURE_2D,c),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,c=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const y of p)c[y.key]=n[y.key]||new s.Tile(y,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class Qs{constructor(n=0,c=0,p=0,y=0){if(isNaN(n)||n<0||isNaN(c)||c<0||isNaN(p)||p<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=c,this.left=p,this.right=y}interpolate(n,c,p){return c.top!=null&&n.top!=null&&(this.top=s.number(n.top,c.top,p)),c.bottom!=null&&n.bottom!=null&&(this.bottom=s.number(n.bottom,c.bottom,p)),c.left!=null&&n.left!=null&&(this.left=s.number(n.left,c.left,p)),c.right!=null&&n.right!=null&&(this.right=s.number(n.right,c.right,p)),this}getCenter(n,c){const p=s.clamp((this.left+n-this.right)/2,0,n),y=s.clamp((this.top+c-this.bottom)/2,0,c);return new s.pointGeometry(p,y)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Qs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Fc(f,n){const c=s.getColumn(f,3);s.fromQuat(f,n),s.setColumn(f,3,c)}function rs(f,n){const c=s.identity$1([]);return s.rotateZ$1(c,c,-n),s.rotateX$1(c,c,-f),c}function is(f,n){const c=[f[0],f[1],0],p=[n[0],n[1],0];if(s.length(c)>=1e-15){const T=s.normalize([],c);s.scale$2(p,T,s.dot(p,T)),n[0]=p[0],n[1]=p[1]}const y=s.cross([],n,f);if(s.len(y)<1e-15)return null;const v=Math.atan2(-y[1],y[0]);return rs(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),v)}class ht{constructor(n,c){this.position=n,this.orientation=c}get position(){return this._position}set position(n){if(n){const c=n instanceof s.MercatorCoordinate?n:new s.MercatorCoordinate(n[0],n[1],n[2]);this._renderWorldCopies&&(c.x=s.wrap(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(n,c){if(this.orientation=null,!this.position)return;const p=this._elevation?this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(n)):0,y=this.position,v=s.MercatorCoordinate.fromLngLat(n,p),T=[v.x-y.x,v.y-y.y,v.z-y.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=is(T,c)}setPitchBearing(n,c){this.orientation=rs(s.degToRad(n),s.degToRad(-c))}}class $i{constructor(n,c){this._transform=s.identity([]),this.orientation=c,this.position=n}get mercatorPosition(){const n=this.position;return new s.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=s.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var c;n&&s.setColumn(this._transform,3,[(c=n)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||s.identity$1([]),n&&Fc(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,c){this._orientation=rs(n,c),Fc(this._transform,this._orientation)}forward(){const n=s.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=s.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=s.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,c){const p=new Float64Array(16);return s.invert(p,this.getWorldToCamera(n,c)),p}getWorldToCameraPosition(n,c,p){const y=this.position;s.scale$2(y,y,-n);const v=new Float64Array(16);return s.fromScaling(v,[p,p,p]),s.translate(v,v,y),v[10]*=c,v}getWorldToCamera(n,c){const p=new Float64Array(16),y=new Float64Array(4),v=this.position;return s.conjugate(y,this._orientation),s.scale$2(v,v,-n),s.fromQuat(p,y),s.translate(p,p,v),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=c,p[9]*=c,p[10]*=c,p[11]*=c,p}getCameraToClipPerspective(n,c,p,y){const v=new Float64Array(16);return s.perspective(v,n,c,p,y),v}getDistanceToElevation(n){const c=n===0?0:s.mercatorZfromAltitude(n,this.position[1]),p=this.forward();return(c-this.position[2])/p[2]}clone(){return new $i([...this.position],[...this.orientation])}}function Bc(f,n){const c=Ys(f.projection,f.zoom,f.width,f.height),p=function(v,T,S,I,k){const D=new s.LngLat(S.lng-180*fn,S.lat),U=new s.LngLat(S.lng+180*fn,S.lat),G=v.project(D.lng,D.lat),K=v.project(U.lng,U.lat),X=-Math.atan2(K.y-G.y,K.x-G.x),Q=s.MercatorCoordinate.fromLngLat(S);Q.y=s.clamp(Q.y,-.999975,.999975);const Y=Q.toLngLat(),Z=v.project(Y.lng,Y.lat),ie=s.MercatorCoordinate.fromLngLat(Y);ie.x+=fn;const J=ie.toLngLat(),pe=v.project(J.lng,J.lat),fe=Ks(pe.x-Z.x,pe.y-Z.y,X),ae=s.MercatorCoordinate.fromLngLat(Y);ae.y+=fn;const de=ae.toLngLat(),ue=v.project(de.lng,de.lat),ye=Ks(ue.x-Z.x,ue.y-Z.y,X),Ae=Math.abs(fe.x)/Math.abs(ye.y),Je=s.identity([]);s.rotateZ(Je,Je,-X*(1-(k?0:I)));const be=s.identity([]);return s.scale(be,be,[1,1-(1-Ae)*I,1]),be[4]=-ye.x/ye.y*I,s.rotateZ(be,be,X),s.multiply(be,Je,be),be}(f.projection,0,f.center,c,n),y=jc(f);return s.scale(p,p,[y,y,1]),p}function jc(f){const n=f.projection,c=Ys(f.projection,f.zoom,f.width,f.height),p=Nc(n,f.center),y=Nc(n,s.LngLat.convert(n.center));return Math.pow(2,p*c+(1-c)*y)}function Ys(f,n,c,p,y=1/0){const v=f.range;if(!v)return 0;const T=Math.min(y,Math.max(c,p)),S=Math.log(T/1024)/Math.LN2;return s.smoothstep(v[0]+S,v[1]+S,n)}const fn=1/4e4;function Nc(f,n){const c=s.clamp(n.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),p=new s.LngLat(n.lng-180*fn,c),y=new s.LngLat(n.lng+180*fn,c),v=f.project(p.lng,c),T=f.project(y.lng,c),S=s.MercatorCoordinate.fromLngLat(p),I=s.MercatorCoordinate.fromLngLat(y),k=T.x-v.x,D=T.y-v.y,U=I.x-S.x,G=I.y-S.y,K=Math.sqrt((U*U+G*G)/(k*k+D*D));return Math.log(K)/Math.LN2}function Ks(f,n,c){const p=Math.cos(c),y=Math.sin(c);return{x:f*p-n*y,y:f*y+n*p}}class Js{constructor(n,c,p,y,v,T,S){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=n||0,this._maxZoom=c||22,this._minPitch=p==null?0:p,this._maxPitch=y==null?60:y,this.setProjection(T),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Qs,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new $i,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const n=new Js(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(n){const c=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||c)&&this._updateCameraOnTerrain(),(n||c)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return s.pick(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=s.getProjection(this.projectionOptions);const p=!A(c,this.getProjection());return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.getProjection({name:"mercator"});const c=n!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.pointGeometry(this.width,this.height)}get bearing(){return s.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const c=-n*Math.PI/180;var p;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(p=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(y,v,T){var S=v[0],I=v[1],k=v[2],D=v[3],U=Math.sin(T),G=Math.cos(T);y[0]=S*G+k*U,y[1]=I*G+D*U,y[2]=S*-U+k*G,y[3]=I*-U+D*G}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const c=s.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const c=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;this._centerAltitude=n.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=n.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let y=0,v=0;for(let T=0;T<c.length;T++){const S=new s.pointGeometry(c[T][0]*this.width,p+c[T][1]*(this.height-p)),I=n.pointCoordinate(S);if(!I)continue;const k=1/Math.hypot(I[0]-this._camera.position[0],I[1]-this._camera.position[1]);y+=I[3]*k,v+=k}return v===0?NaN:y/v}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*c,y=this._mercatorZfromZoom(n),v=this._mercatorZfromZoom(this._maxZoom),T=Math.max(y-p,v);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let p;p=n.z<this._camera.position[2]?[c.x,c.y,c.z]:[n.x,n.y,n.z];const y=s.length(s.sub([],this._camera.position,p));return s.clamp(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let c=!1;if(n.orientation&&!s.exactEquals(n.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(n.orientation)),n.position){const p=[n.position.x,n.position.y,n.position.z];s.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,c=new ht;return c.position=new s.MercatorCoordinate(n[0],n[1],n[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(n){if(!s.length$1(n))return!1;s.normalize$1(n,n);const c=s.transformQuat([],[0,0,-1],n),p=s.transformQuat([],[0,-1,0],n);if(p[2]<0)return!1;const y=is(c,p);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(n){const c=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;n[2]=s.clamp(n[2],y/p,y/c),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,c,p){this._unmodified=!1,this._edgeInsets.interpolate(n,c,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const c=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(n){const c=[new s.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const p=this.pointCoordinate(new s.pointGeometry(0,0)),y=this.pointCoordinate(new s.pointGeometry(this.width,0)),v=this.pointCoordinate(new s.pointGeometry(this.width,this.height)),T=this.pointCoordinate(new s.pointGeometry(0,this.height)),S=Math.floor(Math.min(p.x,y.x,v.x,T.x)),I=Math.floor(Math.max(p.x,y.x,v.x,T.x)),k=1;for(let D=S-k;D<=I+k;D++)D!==0&&c.push(new s.UnwrappedTileID(D,n))}return c}coveringTiles(n){let c=this.coveringZoomLevel(n);const p=c,y=this.elevation&&!n.isTerrainDEM,v=this.projection.name==="mercator";if(n.minzoom!==void 0&&c<n.minzoom)return[];n.maxzoom!==void 0&&c>n.maxzoom&&(c=n.maxzoom);const T=this.locationCoordinate(this.center),S=this.center.lat,I=1<<c,k=[I*T.x,I*T.y,0],D=this.projection.name==="globe",U=!D,G=s.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,U),K=D?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),X=I*s.mercatorZfromAltitude(1,this.center.lat),Q=this._camera.position[2]/s.mercatorZfromAltitude(1,this.center.lat),Y=[I*K.x,I*K.y,Q*(U?1:X)],Z=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),ie=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?c:0,J=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,pe=n.isTerrainDEM?-J:this._elevation?this._elevation.getMinElevationBelowMSL():0,fe=this.projection.isReprojectedInTileSpace?jc(this):1,ae=Re=>{const Ke=1/4e4,Be=new s.MercatorCoordinate(Re.x+Ke,Re.y,Re.z),st=new s.MercatorCoordinate(Re.x,Re.y+Ke,Re.z),ot=Re.toLngLat(),_t=Be.toLngLat(),wt=st.toLngLat(),Mt=this.locationCoordinate(ot),qt=this.locationCoordinate(_t),gt=this.locationCoordinate(wt),zt=Math.hypot(qt.x-Mt.x,qt.y-Mt.y),Qt=Math.hypot(gt.x-Mt.x,gt.y-Mt.y);return Math.sqrt(zt*Qt)*fe/Ke},de=Re=>{const Ke=J,Be=pe;return{aabb:s.tileAABB(this,I,0,0,0,Re,Be,Ke,this.projection),zoom:0,x:0,y:0,minZ:Be,maxZ:Ke,wrap:Re,fullyVisible:!1}},ue=[];let ye=[];const Ae=c,Je=n.reparseOverscaled?p:c,be=Re=>Re*Re,Le=be((Q-this._centerAltitude)*X),Ve=Re=>{if(!this._elevation||!Re.tileID||!v)return;const Ke=this._elevation.getMinMaxForTile(Re.tileID),Be=Re.aabb;Ke?(Be.min[2]=Ke.min,Be.max[2]=Ke.max,Be.center[2]=(Be.min[2]+Be.max[2])/2):(Re.shouldSplit=it(Re),Re.shouldSplit||(Be.min[2]=Be.max[2]=Be.center[2]=this._centerAltitude))},it=Re=>{if(Re.zoom<ie)return!0;if(Re.zoom===Ae)return!1;if(Re.shouldSplit!=null)return Re.shouldSplit;const Ke=Re.aabb.distanceX(Y),Be=Re.aabb.distanceY(Y);let st=Le,ot=1;if(D){st=be(Re.aabb.distanceZ(Y));const wt=Math.pow(2,Re.zoom),Mt=s.latFromMercatorY((Re.y+1)/wt),qt=s.latFromMercatorY(Re.y/wt),gt=Math.min(Math.max(S,Mt),qt),zt=s.circumferenceAtLatitude(gt)/s.circumferenceAtLatitude(S);if(ot=gt===S?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,zt/this._mercatorScaleRatio),this.zoom<=s.GLOBE_ZOOM_THRESHOLD_MIN&&Re.zoom===Ae-1&&zt>=.9)return!0}else if(y&&(st=be(Re.aabb.distanceZ(Y)*X)),this.projection.isReprojectedInTileSpace&&p<=5){const wt=Math.pow(2,Re.zoom),Mt=ae(new s.MercatorCoordinate((Re.x+.5)/wt,(Re.y+.5)/wt));ot=Mt>.85?1:Mt}const _t=Ke*Ke+Be*Be+st;return _t<be((1<<Ae-Re.zoom)*Z*ot*((wt,Mt)=>{if(Mt*be(.707)<wt)return 1;const qt=Math.sqrt(Mt/wt);return qt/(1.4144271570014144+(Math.pow(1.1,qt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(st,Le),_t))};if(this.renderWorldCopies)for(let Re=1;Re<=3;Re++)ue.push(de(-Re)),ue.push(de(Re));for(ue.push(de(0));ue.length>0;){const Re=ue.pop(),Ke=Re.x,Be=Re.y;let st=Re.fullyVisible;if(!st){const ot=Re.aabb.intersects(G);if(ot===0)continue;st=ot===2}if(Re.zoom!==Ae&&it(Re))for(let ot=0;ot<4;ot++){const _t=(Ke<<1)+ot%2,wt=(Be<<1)+(ot>>1),Mt={aabb:v?Re.aabb.quadrant(ot):s.tileAABB(this,I,Re.zoom+1,_t,wt,Re.wrap,Re.minZ,Re.maxZ,this.projection),zoom:Re.zoom+1,x:_t,y:wt,wrap:Re.wrap,fullyVisible:st,tileID:void 0,shouldSplit:void 0,minZ:Re.minZ,maxZ:Re.maxZ};y&&!D&&(Mt.tileID=new s.OverscaledTileID(Re.zoom+1===Ae?Je:Re.zoom+1,Re.wrap,Re.zoom+1,_t,wt),Ve(Mt)),ue.push(Mt)}else{const ot=Re.zoom===Ae?Je:Re.zoom;if(n.minzoom&&n.minzoom>ot)continue;const _t=k[0]-(.5+Ke+(Re.wrap<<Re.zoom))*(1<<c-Re.zoom),wt=k[1]-.5-Be,Mt=Re.tileID?Re.tileID:new s.OverscaledTileID(ot,Re.wrap,Re.zoom,Ke,Be);ye.push({tileID:Mt,distanceSq:_t*_t+wt*wt})}}if(this.fogCullDistSq){const Re=this.fogCullDistSq,Ke=this.horizonLineFromTop();ye=ye.filter(Be=>{const st=[0,0,0,1],ot=[s.EXTENT,s.EXTENT,0,1],_t=this.calculateFogTileMatrix(Be.tileID.toUnwrapped());s.transformMat4$1(st,st,_t),s.transformMat4$1(ot,ot,_t);const wt=s.getAABBPointSquareDist(st,ot);if(wt===0)return!0;let Mt=!1;const qt=this._elevation;if(qt&&wt>Re&&Ke!==0){const gt=this.calculateProjMatrix(Be.tileID.toUnwrapped());let zt;n.isTerrainDEM||(zt=qt.getMinMaxForTile(Be.tileID)),zt||(zt={min:pe,max:J});const Qt=s.furthestTileCorner(this.rotation),Tr=[Qt[0]*s.EXTENT,Qt[1]*s.EXTENT,zt.max];s.transformMat4(Tr,Tr,gt),Mt=(1-Tr[1])*this.height*.5<Ke}return wt<Re||Mt})}return ye.sort((Re,Ke)=>Re.distanceSq-Ke.distanceSq).map(Re=>Re.tileID)}resize(n,c){this.width=n,this.height=c,this.pixelsToGLUnits=[2/n,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const c=s.clamp(n.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),p=this.projection.project(n.lng,c);return new s.pointGeometry(p.x*this.worldSize,p.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(n,c){let p,y;const v=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;p=(c.x-v.x)/S,y=(c.y-v.y)/S}else{const S=this.pointCoordinate(c),I=this.pointCoordinate(v);p=S.x-I.x,y=S.y-I.y}const T=this.locationCoordinate(n);this.setLocation(new s.MercatorCoordinate(T.x-p,T.y-y))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,c){const p=c?s.mercatorZfromAltitude(c,n.lat):void 0,y=this.projection.project(n.lng,n.lat);return new s.MercatorCoordinate(y.x,y.y,p)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,c){const p=c!=null?c:this._centerAltitude,y=[n.x,n.y,0,1],v=[n.x,n.y,1,1];s.transformMat4$1(y,y,this.pixelMatrixInverse),s.transformMat4$1(v,v,this.pixelMatrixInverse);const T=v[3];s.scale$1(y,y,1/y[3]),s.scale$1(v,v,1/T);const S=y[2],I=v[2];return{p0:y,p1:v,t:S===I?0:(p-S)/(I-S)}}screenPointToMercatorRay(n){const c=[n.x,n.y,0,1],p=[n.x,n.y,1,1];return s.transformMat4$1(c,c,this.pixelMatrixInverse),s.transformMat4$1(p,p,this.pixelMatrixInverse),s.scale$1(c,c,1/c[3]),s.scale$1(p,p,1/p[3]),c[2]=s.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,p[2]=s.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,s.scale$1(c,c,1/this.worldSize),s.scale$1(p,p,1/this.worldSize),new s.Ray([c[0],c[1],c[2]],s.normalize([],s.sub([],p,c)))}rayIntersectionCoordinate(n){const{p0:c,p1:p,t:y}=n,v=s.mercatorZfromAltitude(c[2],this._center.lat),T=s.mercatorZfromAltitude(p[2],this._center.lat);return new s.MercatorCoordinate(s.number(c[0],p[0],y)/this.worldSize,s.number(c[1],p[1],y)/this.worldSize,s.number(v,T,y))}pointCoordinate(n,c=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,c)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let c=this.projection.pointCoordinate3D(this,n.x,n.y);if(c)return new s.MercatorCoordinate(c[0],c[1],c[2]);let p=0,y=this.horizonLineFromTop();if(n.y>y)return this.pointCoordinate(n);const v=.02*y,T=n.clone();for(let S=0;S<10&&y-p>v;S++){T.y=s.number(p,y,.66);const I=this.projection.pointCoordinate3D(this,T.x,T.y);I?(y=T.y,c=I):p=T.y}return c?new s.MercatorCoordinate(c[0],c[1],c[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}_coordinatePoint(n,c){const p=c&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,y=[n.x*this.worldSize,n.y*this.worldSize,p+n.toAltitude(),1];return s.transformMat4$1(y,y,this.pixelMatrix),y[3]>0?new s.pointGeometry(y[0]/y[3],y[1]/y[3]):new s.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(n,c){const p=new s.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),y=new s.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),v=new s.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),T=new s.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let S=this.pointCoordinate(p,n),I=this.pointCoordinate(y,n);const k=this.pointCoordinate(v,c),D=this.pointCoordinate(T,c),U=(G,K)=>(K.y-G.y)/(K.x-G.x);return S.y>1&&I.y>=0?S=new s.MercatorCoordinate((1-D.y)/U(D,S)+D.x,1):S.y<0&&I.y<=1&&(S=new s.MercatorCoordinate(-D.y/U(D,S)+D.x,0)),I.y>1&&S.y>=0?I=new s.MercatorCoordinate((1-k.y)/U(k,I)+k.x,1):I.y<0&&S.y<=1&&(I=new s.MercatorCoordinate(-k.y/U(k,I)+k.x,0)),new s.LngLatBounds().extend(this.coordinateLocation(S)).extend(this.coordinateLocation(I)).extend(this.coordinateLocation(D)).extend(this.coordinateLocation(k))}_getBounds3D(){const n=this.elevation;if(!n.visibleDemTiles.length)return this._getBounds(0,0);const c=n.visibleDemTiles.reduce((p,y)=>{if(y.dem){const v=y.dem.tree;p.min=Math.min(p.min,v.minimums[0]),p.max=Math.max(p.max,v.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBounds(c.min*n.exaggeration(),c.max*n.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(n=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-c*(1-this._horizonShift);return n?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-s.MAX_MERCATOR_LATITUDE,this.maxLat=s.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=s.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=s.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=s.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,c){return this.projection.createTileMatrix(this,c,n)}calculateDistanceTileData(n){const c=n.key,p=this._distanceTileDataCache;if(p[c])return p[c];const y=n.canonical,v=1/this.height,T=this.cameraWorldSize/this.zoomScale(y.z),S=(y.x+Math.pow(2,y.z)*n.wrap)*T,I=y.y*T,k=this.point,D=this.angle,U=Math.sin(-D),G=-Math.cos(-D);return p[c]={bearing:[U,G],center:[(k.x-S)*v,(k.y-I)*v],scale:T/s.EXTENT*v},p[c]}calculateFogTileMatrix(n){const c=n.key,p=this._fogTileMatrixCache;if(p[c])return p[c];const y=this.projection.createTileMatrix(this,this.cameraWorldSize,n);return s.multiply(y,this.worldToFogMatrix,y),p[c]=new Float32Array(y),p[c]}calculateProjMatrix(n,c=!1){const p=n.key,y=c?this._alignedProjMatrixCache:this._projMatrixCache;if(y[p])return y[p];const v=this.calculatePosMatrix(n,this.worldSize);return s.multiply(v,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.alignedProjMatrix:this.projMatrix,v),y[p]=new Float32Array(v),y[p]}calculatePixelsToTileUnitsMatrix(n){const c=n.tileID.key,p=this._pixelsToTileUnitsCache;if(p[c])return p[c];const y=function(v,T){const{scale:S}=v.tileTransform,I=S*s.EXTENT/(v.tileSize*Math.pow(2,T.zoom-v.tileID.overscaledZ+v.tileID.canonical.z));return k=new Float32Array(4),G=(D=T.inverseAdjustmentMatrix)[1],K=D[2],X=D[3],Y=(U=[I,I])[1],k[0]=D[0]*(Q=U[0]),k[1]=G*Q,k[2]=K*Y,k[3]=X*Y,k;var k,D,U,G,K,X,Q,Y}(n,this);return p[c]=y,p[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const c=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(c),y=this._camera.forward(),v=s.mercatorZfromAltitude(1,this._center.lat);p[2]/=v,y[2]/=v,s.normalize(y,y);const T=n.raycast(p,y,n.exaggeration());if(T){const S=s.scaleAndAdd([],p,y,T),I=new s.MercatorCoordinate(S[0],S[1],s.mercatorZfromAltitude(S[2],s.latFromMercatorY(S[1]))),k=(I.z+s.length([I.x-p[0],I.y-p[1],I.z-p[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(k),this._centerAltitude=I.toAltitude(),this._center=this.coordinateLocation(I),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const n=this._elevation;this._updateCameraState();const c=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(c),y=n.getAtPointOrZero(new s.MercatorCoordinate(...p)),v=this._minimumHeightOverTerrain()*Math.cos(s.degToRad(this._maxPitch)),T=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*y;if(T<v){const S=this.locationCoordinate(this._center,this._centerAltitude),I=[S.x-p[0],S.y-p[1],S.z-p[2]],k=s.length(I);I[2]-=(v-T)/this._pixelsPerMercatorPixel;const D=s.length(I);if(D===0)return;s.scale$2(I,I,k/D*this._pixelsPerMercatorPixel),this._camera.position=[S.x-I[0],S.y-I[1],S.z*this._pixelsPerMercatorPixel-I[2]],this._camera.orientation=is(I,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const G=this.center;return G.lat=s.clamp(G.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(G.lng=s.clamp(G.lng,this.minLng,this.maxLng)),this.center=G,void(this._constraining=!1)}const c=this._unmodified,{x:p,y}=this.point;let v=0,T=p,S=y;const I=this.width/2,k=this.height/2,D=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(y-k<D&&(S=D+k),y+k>U&&(S=U-k),U-D<this.height&&(v=Math.max(v,this.height/(U-D)),S=(U+D)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const G=this.worldMinX*this.scale,K=this.worldMaxX*this.scale,X=this.worldSize/2-(G+K)/2;T=(p+X+this.worldSize)%this.worldSize-X,T-I<G&&(T=G+I),T+I>K&&(T=K-I),K-G<this.width&&(v=Math.max(v,this.width/(K-G)),T=(K+G)/2)}T===p&&S===y||(this.center=this.unproject(new s.pointGeometry(T,S))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCameraAltitude(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,c=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.mercatorZfromAltitude(1,this.center.lat)/s.mercatorZfromAltitude(1,s.GLOBE_SCALE_MATCH_LATITUDE));const p=Ys(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?c:1),v=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);v[8]=2*-n.x/this.width,v[9]=2*n.y/this.height;let T=s.mul([],v,y);if(this.projection.isReprojectedInTileSpace){const fe=this.locationCoordinate(this.center),ae=s.identity([]);s.translate(ae,ae,[fe.x*this.worldSize,fe.y*this.worldSize,0]),s.multiply(ae,ae,Bc(this)),s.translate(ae,ae,[-fe.x*this.worldSize,-fe.y*this.worldSize,0]),s.multiply(T,T,ae),this.inverseAdjustmentMatrix=function(de){const ue=Bc(de,!0);return Ue([],[ue[0],ue[1],ue[4],ue[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=s.scale([],T,[this.worldSize,this.worldSize,this.worldSize/c,1]),this.projMatrix=T,this.invProjMatrix=s.invert(new Float64Array(16),this.projMatrix);const S=s.invert([],v);this.frustumCorners=s.FrustumCorners.fromInvProjectionMatrix(S,this.horizonLineFromTop(),this.height);const I=new Float32Array(16);s.identity(I),s.scale(I,I,[1,-1,1]),s.rotateX(I,I,this._pitch),s.rotateZ(I,I,this.angle);const k=s.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),D=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;k[8]=2*-n.x/this.width,k[9]=2*(n.y+D)/this.height,this.skyboxMatrix=s.multiply(I,k,I);const U=this.point,G=U.x,K=U.y,X=this.width%2/2,Q=this.height%2/2,Y=Math.cos(this.angle),Z=Math.sin(this.angle),ie=G-Math.round(G)+Y*X+Z*Q,J=K-Math.round(K)+Y*Q+Z*X,pe=new Float64Array(T);if(s.translate(pe,pe,[ie>.5?ie-1:ie,J>.5?J-1:J,0]),this.alignedProjMatrix=pe,T=s.create(),s.scale(T,T,[this.width/2,-this.height/2,1]),s.translate(T,T,[1,-1,0]),this.labelPlaneMatrix=T,T=s.create(),s.scale(T,T,[1,-1,1]),s.translate(T,T,[-1,-1,0]),s.scale(T,T,[2/this.width,2/this.height,1]),this.glCoordMatrix=T,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},T=s.invert(new Float64Array(16),this.pixelMatrix),!T)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=T,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.calculateGlobeMatrix(this);const fe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.transformMat4(fe,fe,y),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=T;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSize,c=this.cameraPixelsPerMeter,p=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,v=[n,n,c];s.scale$2(v,v,y),s.scale$2(p,p,-1),s.multiply$2(p,p,v);const T=s.create();s.translate(T,T,p),s.scale(T,T,v),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,c,y)}_computeCameraPosition(n){const c=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),y=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-n/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-p[0]*v,y.y/this.worldSize-p[1]*v,n/this.worldSize*this._centerAltitude-p[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=n[2];let y=1;p>0&&(y=Math.min((c-this._camera.position[2])/p,1)),this._camera.position=s.scaleAndAdd([],this._camera.position,n,y),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const n=this._camera.position,c=this._camera.forward(),{pitch:p,bearing:y}=this._camera.getPitchBearing(),v=s.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.degToRad(this._maxPitch)),S=Math.max((n[2]-v)/Math.cos(p),T),I=this._zoomFromMercatorZ(S);s.scaleAndAdd(n,n,c,S),this._pitch=s.clamp(p,s.degToRad(this.minPitch),s.degToRad(this.maxPitch)),this.angle=s.wrap(y,-Math.PI,Math.PI),this._setZoom(s.clamp(I,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,c){const p=Math.min(n.x,c.x),y=Math.max(n.x,c.x),v=Math.min(n.y,c.y),T=Math.max(n.y,c.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new s.pointGeometry(p,v),new s.pointGeometry(y,T),new s.pointGeometry(p,T),new s.pointGeometry(y,v)],I=this.renderWorldCopies?-3:0,k=this.renderWorldCopies?4:1;for(const D of S){const U=this.pointRayIntersection(D);if(U.t<0)return!0;const G=this.rayIntersectionCoordinate(U);if(G.x<I||G.y<0||G.x>k||G.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.pointGeometry(0,0),new s.pointGeometry(this.width,this.height))}zoomDeltaToMovement(n,c){const p=s.length(s.sub([],this._camera.position,n)),y=this._zoomFromMercatorZ(p)+c;return p-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const n=function(c,p){const y=[c[0],c[1],c[2],1];s.transformMat4$1(y,y,p);const v=Math.max(y[3],1e-6);return[y[0]/v,y[1]/v,y[2]/v,v]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.pointGeometry(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.pointGeometry(0,n))}}getCameraToCenterDistance(n){const c=Ys(n,this.zoom,this.width,this.height,1024),p=n.pixelSpaceConversion(this.center.lat,this.worldSize,c);return .5/Math.tan(.5*this._fov)*this.height*p}}function ea(f,n){let c=!1,p=null;const y=()=>{p=null,c&&(f(),p=setTimeout(y,n),c=!1)};return()=>(c=!0,p||y(),p)}class Sh{constructor(n){this._hashName=n&&encodeURIComponent(n),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ea(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,s.window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),s.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const c=Uc(n);if(this._hashName){const p=this._hashName;let y=!1;const v=s.window.location.hash.slice(1).split("&").map(T=>{const S=T.split("=")[0];return S===p?(y=!0,`${S}=${c}`):T}).filter(T=>T);return y||v.push(`${p}=${c}`),`#${v.join("&")}`}return`#${c}`}_getCurrentHash(){const n=s.window.location.hash.replace("#","");if(this._hashName){let c;return n.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(c=p)}),(c&&c[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(p=>isNaN(p))){const p=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(c[3]||0):n.getBearing();return n.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:p,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=s.window.location.href.replace(/(#.+)?$/,this.getHashString());s.window.history.replaceState(s.window.history.state,null,n)}}function Uc(f,n){const c=f.getCenter(),p=Math.round(100*f.getZoom())/100,y=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,y),T=Math.round(c.lng*v)/v,S=Math.round(c.lat*v)/v,I=f.getBearing(),k=f.getPitch();let D=n?`/${T}/${S}/${p}`:`${p}/${S}/${T}`;return(I||k)&&(D+="/"+Math.round(10*I)/10),k&&(D+=`/${Math.round(k)}`),D}const Pn={linearity:.3,easing:s.bezier(0,0,.3,1)},Tp=s.extend({deceleration:2500,maxSpeed:1400},Pn),Ep=s.extend({deceleration:20,maxSpeed:1400},Pn),Ah=s.extend({deceleration:1e3,maxSpeed:360},Pn),il=s.extend({deceleration:1e3,maxSpeed:90},Pn);class Vc{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,c=s.exported.now();for(;n.length>0&&c-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new s.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)c.zoom+=v.zoomDelta||0,c.bearing+=v.bearingDelta||0,c.pitch+=v.pitchDelta||0,v.panDelta&&c.pan._add(v.panDelta),v.around&&(c.around=v.around),v.pinchAround&&(c.pinchAround=v.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(c.pan.mag()){const v=ra(c.pan.mag(),p,s.extend({},Tp,n||{}));y.offset=c.pan.mult(v.amount/c.pan.mag()),y.center=this._map.transform.center,ta(y,v)}if(c.zoom){const v=ra(c.zoom,p,Ep);y.zoom=this._map.transform.zoom+v.amount,ta(y,v)}if(c.bearing){const v=ra(c.bearing,p,Ah);y.bearing=this._map.transform.bearing+s.clamp(v.amount,-179,179),ta(y,v)}if(c.pitch){const v=ra(c.pitch,p,il);y.pitch=this._map.transform.pitch+v.amount,ta(y,v)}if(y.zoom||y.bearing){const v=c.pinchAround===void 0?c.around:c.pinchAround;y.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function ta(f,n){(!f.duration||f.duration<n.duration)&&(f.duration=n.duration,f.easing=n.easing)}function ra(f,n,c){const{maxSpeed:p,linearity:y,deceleration:v}=c,T=s.clamp(f*y/(n/1e3),-p,p),S=Math.abs(T)/(v*y);return{easing:c.easing,duration:1e3*S,amount:T*(S/2)}}class mi extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,p,y={}){const v=Ie(c.getCanvasContainer(),p),T=c.unproject(v);super(n,s.extend({point:v,lngLat:T,originalEvent:p},y)),this._defaultPrevented=!1,this.target=c}}class ns extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,p){const y=n==="touchend"?p.changedTouches:p.touches,v=We(c.getCanvasContainer(),y),T=v.map(I=>c.unproject(I)),S=v.reduce((I,k,D,U)=>I.add(k.div(U.length)),new s.pointGeometry(0,0));super(n,{points:v,point:S,lngLats:T,lngLat:c.unproject(S),originalEvent:p}),this._defaultPrevented=!1}}class Ph extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,p){super(n,{originalEvent:p}),this._defaultPrevented=!1}}class Ih{constructor(n,c){this._map=n,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new Ph(n.type,this._map,n))}mousedown(n,c){return this._mousedownPos=c,this._firePreventable(new mi(n.type,this._map,n))}mouseup(n){this._map.fire(new mi(n.type,this._map,n))}preclick(n){const c=s.extend({},n);c.type="preclick",this._map.fire(new mi(c.type,this._map,c))}click(n,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(n),this._map.fire(new mi(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new mi(n.type,this._map,n))}mouseover(n){this._map.fire(new mi(n.type,this._map,n))}mouseout(n){this._map.fire(new mi(n.type,this._map,n))}touchstart(n){return this._firePreventable(new ns(n.type,this._map,n))}touchmove(n){this._map.fire(new ns(n.type,this._map,n))}touchend(n){this._map.fire(new ns(n.type,this._map,n))}touchcancel(n){this._map.fire(new ns(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Mh{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new mi(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new mi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new mi(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ch{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,c){this.isEnabled()&&n.shiftKey&&n.button===0&&(ve(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(n,c){if(!this._active)return;const p=c;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=p,this._box||(this._box=F("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const v=Math.min(y.x,p.x),T=Math.max(y.x,p.x),S=Math.min(y.y,p.y),I=Math.max(y.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${v}px,${S}px)`,this._box.style.width=T-v+"px",this._box.style.height=I-S+"px")})}mouseupWindow(n,c){if(!this._active||n.button!==0)return;const p=this._startPos,y=c;if(this.reset(),Se(),p.x!==y.x||p.y!==y.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:v=>v.fitScreenCoordinates(p,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ce(),delete this._startPos,delete this._lastPos}_fireEvent(n,c){return this._map.fire(new s.Event(n,{originalEvent:c}))}}function nl(f,n){const c={};for(let p=0;p<f.length;p++)c[f[p].identifier]=n[p];return c}class os{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,c,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),p.length===this.numTouches&&(this.centroid=function(y){const v=new s.pointGeometry(0,0);for(const T of y)v._add(T);return v.div(y.length)}(c),this.touches=nl(p,c)))}touchmove(n,c,p){if(this.aborted||!this.centroid)return;const y=nl(p,c);for(const v in this.touches){const T=this.touches[v],S=y[v];(!S||S.dist(T)>30)&&(this.aborted=!0)}}touchend(n,c,p){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class ol{constructor(n){this.singleTap=new os(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,c,p){this.singleTap.touchstart(n,c,p)}touchmove(n,c,p){this.singleTap.touchmove(n,c,p)}touchend(n,c,p){const y=this.singleTap.touchend(n,c,p);if(y){const v=n.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(y)<30;if(v&&T||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class zh{constructor(){this._zoomIn=new ol({numTouches:1,numTaps:2}),this._zoomOut=new ol({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,c,p){this._zoomIn.touchstart(n,c,p),this._zoomOut.touchstart(n,c,p)}touchmove(n,c,p){this._zoomIn.touchmove(n,c,p),this._zoomOut.touchmove(n,c,p)}touchend(n,c,p){const y=this._zoomIn.touchend(n,c,p),v=this._zoomOut.touchend(n,c,p);return y?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(y)},{originalEvent:n})}):v?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(v)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Rh={0:1,2:2};class sl{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,c){return!1}_move(n,c){return{}}mousedown(n,c){if(this._lastPoint)return;const p=mt(n);this._correctButton(n,p)&&(this._lastPoint=c,this._eventButton=p)}mousemoveWindow(n,c){const p=this._lastPoint;if(p){if(n.preventDefault(),this._eventButton!=null&&function(y,v){const T=Rh[v];return y.buttons===void 0||(y.buttons&T)!==T}(n,this._eventButton))this.reset();else if(this._moved||!(c.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(p,c)}}mouseupWindow(n){this._lastPoint&&mt(n)===this._eventButton&&(this._moved&&Se(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class kh extends sl{mousedown(n,c){super.mousedown(n,c),this._lastPoint&&(this._active=!0)}_correctButton(n,c){return c===0&&!n.ctrlKey}_move(n,c){return{around:c,panDelta:c.sub(n)}}}class $c extends sl{_correctButton(n,c){return c===0&&n.ctrlKey||c===2}_move(n,c){const p=.8*(c.x-n.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(n){n.preventDefault()}}class ci extends sl{_correctButton(n,c){return c===0&&n.ctrlKey||c===2}_move(n,c){const p=-.5*(c.y-n.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(n){n.preventDefault()}}class Sp{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),s.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.pointGeometry(0,0)}touchstart(n,c,p){return this._calculateTransform(n,c,p)}touchmove(n,c,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!s.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,c,p)}}touchend(n,c,p){this._calculateTransform(n,c,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,c,p){p.length>0&&(this._active=!0);const y=nl(p,c),v=new s.pointGeometry(0,0),T=new s.pointGeometry(0,0);let S=0;for(const k in y){const D=y[k],U=this._touches[k];U&&(v._add(D),T._add(D.sub(U)),S++,y[k]=D)}if(this._touches=y,S<this._minTouches||!T.mag())return;const I=T.div(S);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(S),panDelta:I}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=F("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class al{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,c,p){return{}}touchstart(n,c,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([c[0],c[1]]))}touchmove(n,c,p){const y=this._firstTwoTouches;if(!y)return;n.preventDefault();const[v,T]=y,S=ll(p,c,v),I=ll(p,c,T);if(!S||!I)return;const k=this._aroundCenter?null:S.add(I).div(2);return this._move([S,I],k,n)}touchend(n,c,p){if(!this._firstTwoTouches)return;const[y,v]=this._firstTwoTouches,T=ll(p,c,y),S=ll(p,c,v);T&&S||(this._active&&Se(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ll(f,n,c){for(let p=0;p<f.length;p++)if(f[p].identifier===c)return n[p]}function Dh(f,n){return Math.log(f/n)/Math.LN2}class In extends al{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,c){const p=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Dh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Dh(this._distance,p),pinchAround:c}}}function Gc(f,n){return 180*f.angleWith(n)/Math.PI}class ss extends al{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,c){const p=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Gc(this._vector,p),pinchAround:c}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const c=25/(Math.PI*this._minDiameter)*360,p=Gc(n,this._startVector);return Math.abs(p)<c}}function Yi(f){return Math.abs(f.y)>Math.abs(f.x)}class cl extends al{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Yi(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,c,p){const y=this._lastPoints;if(!y)return;const v=n[0].sub(y[0]),T=n[1].sub(y[1]);return this._map._cooperativeGestures&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(v,T,p.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(v.y+T.y)/2*-.5})}gestureBeginsVertically(n,c,p){if(this._valid!==void 0)return this._valid;const y=n.mag()>=2,v=c.mag()>=2;if(!y&&!v)return;if(!y||!v)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const T=n.y>0==c.y>0;return Yi(n)&&Yi(c)&&T}}const pt={panStep:100,bearingStep:15,pitchStep:10};class Oh{constructor(){const n=pt;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let c=0,p=0,y=0,v=0,T=0;switch(n.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:n.shiftKey?p=-1:(n.preventDefault(),v=-1);break;case 39:n.shiftKey?p=1:(n.preventDefault(),v=1);break;case 38:n.shiftKey?y=1:(n.preventDefault(),T=-1);break;case 40:n.shiftKey?y=-1:(n.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(p=0,y=0),{cameraAnimation:S=>{const I=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:Lh,zoom:c?Math.round(I)+c*(n.shiftKey?2:1):I,bearing:S.getBearing()+p*this._bearingStep,pitch:S.getPitch()+y*this._pitchStep,offset:[-v*this._panStep,-T*this._panStep],center:S.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Lh(f){return f*(2-f)}const as=4.000244140625;class ia{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||s.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=n.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const p=s.exported.now(),y=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,c!==0&&c%as==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(y*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),n.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=n,this._delta-=c,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Ie(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform,c=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>as?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&k!==0&&(k=1/k);const D=c(),U=Math.pow(2,D),G=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(G*k))),this._type==="wheel"&&(this._startZoom=D,this._easing=this._smoothOutEasing(200)),this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:c(),y=this._startZoom,v=this._easing;let T,S=!1;if(this._type==="wheel"&&y&&v){const I=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),k=v(I);T=s.number(y,p,k),I<1?this._frameId||(this._frameId=!0):S=!0}else T=p,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:T-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let c=s.ease;if(this._prevEase){const p=this._prevEase,y=(s.exported.now()-p.start)/p.duration,v=p.easing(y+.01)-p.easing(y),T=.27/Math.sqrt(v*v+1e-4)*.01,S=Math.sqrt(.0729-T*T);c=s.bezier(T,S,.25,1)}return this._prevEase={start:s.exported.now(),duration:n,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=F("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(s.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Fh{constructor(n,c){this._clickZoom=n,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Bh{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,c){return n.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(n.shiftKey?-1:1),around:p.unproject(c)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jh{constructor(){this._tap=new ol({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,c,p){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=c[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(n,c,p))}touchmove(n,c,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const y=c[0],v=y.y-this._swipePoint.y;return this._swipePoint=y,n.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(n,c,p)}touchend(n,c,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(n,c,p)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nh{constructor(n,c,p){this._el=n,this._mousePan=c,this._touchPan=p}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Uh{constructor(n,c,p){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=c,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Vh{constructor(n,c,p,y){this._el=n,this._touchZoom=c,this._touchRotate=p,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const na=f=>f.zoom||f.drag||f.pitch||f.rotate;class ul extends s.Event{}class qc{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,c){const p=s.sub([],c,n);this.radius=s.length(p[2]<0?s.div([],p,this.constants):[p[0],p[1],0])}projectRay(n){s.div(n,n,this.constants),s.normalize(n,n),s.mul$1(n,n,this.constants);const c=s.scale$2([],n,this.radius);if(c[2]>0){const p=s.scale$2([],[0,0,1],s.dot(c,[0,0,1])),y=s.scale$2([],s.normalize([],[c[0],c[1],0]),this.radius),v=s.add([],c,s.scale$2([],s.sub([],s.add([],y,p),c),2));c[0]=v[0],c[1]=v[1]}return c}}function yo(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class $h{constructor(n,c){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Vc(n),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new qc,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),s.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[s.window,"blur",void 0]];for(const[y,v,T]of this._listeners)y.addEventListener(v,y===s.window.document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[n,c,p]of this._listeners)n.removeEventListener(c,n===s.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(n){const c=this._map,p=c.getCanvasContainer();this._add("mapEvent",new Ih(c,n));const y=c.boxZoom=new Ch(c,n);this._add("boxZoom",y);const v=new zh,T=new Bh;c.doubleClickZoom=new Fh(T,v),this._add("tapZoom",v),this._add("clickZoom",T);const S=new jh;this._add("tapDragZoom",S);const I=c.touchPitch=new cl(c);this._add("touchPitch",I);const k=new $c(n),D=new ci(n);c.dragRotate=new Uh(n,k,D),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]);const U=new kh(n),G=new Sp(c,n);c.dragPan=new Nh(p,U,G),this._add("mousePan",U),this._add("touchPan",G,["touchZoom","touchRotate"]);const K=new ss,X=new In;c.touchZoomRotate=new Vh(p,X,K,S),this._add("touchRotate",K,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Mh(c));const Q=c.scrollZoom=new ia(c,this);this._add("scrollZoom",Q,["mousePan"]);const Y=c.keyboard=new Oh;this._add("keyboard",Y);for(const Z of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[Z]&&c[Z].enable(n[Z])}_add(n,c,p){this._handlers.push({handlerName:n,handler:c,allowed:p}),this._handlersById[n]=c}stop(n){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!na(this._eventsInProgress)||this.isZooming()}_blockedByActive(n,c,p){for(const y in n)if(y!==p&&(!c||c.indexOf(y)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const c=[];for(const p of n)this._el.contains(p.target)&&c.push(p);return c}handleEvent(n,c){this._updatingCamera=!0;const p=n.type==="renderFrame",y=p?void 0:n,v={needsRenderFrame:!1},T={},S={},I=n.touches?this._getMapTouches(n.touches):void 0,k=I?We(this._el,I):p?void 0:Ie(this._el,n);for(const{handlerName:G,handler:K,allowed:X}of this._handlers){if(!K.isEnabled())continue;let Q;this._blockedByActive(S,X,G)?K.reset():K[c||n.type]&&(Q=K[c||n.type](n,k,I),this.mergeHandlerResult(v,T,Q,G,y),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()),(Q||K.isActive())&&(S[G]=K)}const D={};for(const G in this._previousActiveHandlers)S[G]||(D[G]=y);this._previousActiveHandlers=S,(Object.keys(D).length||yo(v))&&(this._changes.push([v,T,D]),this._triggerRenderFrame()),(Object.keys(S).length||yo(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=v;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(n,c,p,y,v){if(!p)return;s.extend(n,p);const T={handlerName:y,originalEvent:p.originalEvent||v};p.zoomDelta!==void 0&&(c.zoom=T),p.panDelta!==void 0&&(c.drag=T),p.pitchDelta!==void 0&&(c.pitch=T),p.bearingDelta!==void 0&&(c.rotate=T)}_applyChanges(){const n={},c={},p={};for(const[y,v,T]of this._changes)y.panDelta&&(n.panDelta=(n.panDelta||new s.pointGeometry(0,0))._add(y.panDelta)),y.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(n.around=y.around),y.aroundCoord!==void 0&&(n.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(n.pinchAround=y.pinchAround),y.noInertia&&(n.noInertia=y.noInertia),s.extend(c,v),s.extend(p,T);this._updateMapTransform(n,c,p),this._changes=[]}_updateMapTransform(n,c,p){const y=this._map,v=y.transform,T=ie=>[ie.x,ie.y,ie.z];if((ie=>{const J=this._eventsInProgress.drag;return J&&!this._handlersById[J.handlerName].isActive()})()&&!yo(n)){const ie=v.zoom;v.cameraElevationReference="sea",v.recenterOnTerrain(),v.cameraElevationReference="ground",ie!==v.zoom&&this._map._update(!0)}if(!yo(n))return void this._fireEvents(c,p,!0);let{panDelta:S,zoomDelta:I,bearingDelta:k,pitchDelta:D,around:U,aroundCoord:G,pinchAround:K}=n;K!==void 0&&(U=K),(ie=>c.drag&&!this._eventsInProgress.drag)()&&U&&(this._dragOrigin=T(v.pointCoordinate3D(U)),this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",y._stop(!0),U=U||y.transform.centerPoint,k&&(v.bearing+=k),D&&(v.pitch+=D),v._updateCameraState();const X=[0,0,0];if(S)if(v.projection.name==="mercator"){const ie=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(U).dir),J=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(U.sub(S)).dir);X[0]=J[0]-ie[0],X[1]=J[1]-ie[1]}else{const ie=v.pointCoordinate(U);if(v.projection.name==="globe"){S=S.rotate(-v.angle);const J=v._pixelsPerMercatorPixel/v.worldSize;X[0]=-S.x*s.mercatorScale(s.latFromMercatorY(ie.y))*J,X[1]=-S.y*s.mercatorScale(v.center.lat)*J}else{const J=v.pointCoordinate(U.sub(S));ie&&J&&(X[0]=J.x-ie.x,X[1]=J.y-ie.y)}}const Q=v.zoom,Y=[0,0,0];if(I){const ie=T(G||v.pointCoordinate3D(U)),J={dir:s.normalize([],s.sub([],ie,v._camera.position))};if(J.dir[2]<0){const pe=v.zoomDeltaToMovement(ie,I);s.scale$2(Y,J.dir,pe)}}const Z=s.add(X,X,Y);v._translateCameraConstrained(Z),I&&Math.abs(v.zoom-Q)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(c,p,!0)}_fireEvents(n,c,p){const y=na(this._eventsInProgress),v=na(n),T={};for(const D in n){const{originalEvent:U}=n[D];this._eventsInProgress[D]||(T[`${D}start`]=U),this._eventsInProgress[D]=n[D]}!y&&v&&this._fireEvent("movestart",v.originalEvent);for(const D in T)this._fireEvent(D,T[D]);v&&this._fireEvent("move",v.originalEvent);for(const D in n){const{originalEvent:U}=n[D];this._fireEvent(D,U)}const S={};let I;for(const D in this._eventsInProgress){const{handlerName:U,originalEvent:G}=this._eventsInProgress[D];this._handlersById[U].isActive()||(delete this._eventsInProgress[D],I=c[U]||G,S[`${D}end`]=I)}for(const D in S)this._fireEvent(D,S[D]);const k=na(this._eventsInProgress);if(p&&(y||v)&&!k){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;D?(U(D.bearing||this._map.getBearing())&&(D.bearing=0),this._map.easeTo(D,{originalEvent:I})):(this._map.fire(new s.Event("moveend",{originalEvent:I})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,c){this._map.fire(new s.Event(n,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new ul("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Zc="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Gh extends s.Evented{constructor(n,c){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=c.bearingSnap,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,c){return this.jumpTo({center:n},c)}panBy(n,c,p){return n=s.pointGeometry.convert(n).mult(-1),this.panTo(this.transform.center,s.extend({offset:n},c),p)}panTo(n,c,p){return this.easeTo(s.extend({center:n},c),p)}getZoom(){return this.transform.zoom}setZoom(n,c){return this.jumpTo({zoom:n},c),this}zoomTo(n,c,p){return this.easeTo(s.extend({zoom:n},c),p)}zoomIn(n,c){return this.zoomTo(this.getZoom()+1,n,c),this}zoomOut(n,c){return this.zoomTo(this.getZoom()-1,n,c),this}getBearing(){return this.transform.bearing}setBearing(n,c){return this.jumpTo({bearing:n},c),this}getPadding(){return this.transform.padding}setPadding(n,c){return this.jumpTo({padding:n},c),this}rotateTo(n,c,p){return this.easeTo(s.extend({bearing:n},c),p)}resetNorth(n,c){return this.rotateTo(0,s.extend({duration:1e3},n),c),this}resetNorthPitch(n,c){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},n),c),this}snapToNorth(n,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,c):this}getPitch(){return this.transform.pitch}setPitch(n,c){return this.jumpTo({pitch:n},c),this}cameraForBounds(n,c){this.transform.projection.name==="globe"&&s.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),n=s.LngLatBounds.convert(n);const p=c&&c.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),p,c)}_extendCameraOptions(n){const c={top:0,bottom:0,right:0,left:0};if(typeof(n=s.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=="number"){const p=n.padding;n.padding={top:p,bottom:p,right:p,left:p}}return n.padding=s.extend(c,n.padding),n}_cameraForBoxAndBearing(n,c,p,y){const v=this._extendCameraOptions(y),T=this.transform,S=T.padding,I=T.project(s.LngLat.convert(n)),k=T.project(s.LngLat.convert(c)),D=new s.pointGeometry(I.x,k.y),U=new s.pointGeometry(k.x,I.y),G=-s.degToRad(p),K=I.rotate(G),X=k.rotate(G),Q=D.rotate(G),Y=U.rotate(G),Z=new s.pointGeometry(Math.max(K.x,X.x,Q.x,Y.x),Math.max(K.y,X.y,Q.y,Y.y)),ie=new s.pointGeometry(Math.min(K.x,X.x,Q.x,Y.x),Math.min(K.y,X.y,Q.y,Y.y)),J=Z.sub(ie),pe=(T.width-((S.left||0)+(S.right||0)+v.padding.left+v.padding.right))/J.x,fe=(T.height-((S.top||0)+(S.bottom||0)+v.padding.top+v.padding.bottom))/J.y;if(fe<0||pe<0)return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ae=Math.min(T.scaleZoom(T.scale*Math.min(pe,fe)),v.maxZoom),de=typeof v.offset.x=="number"&&typeof v.offset.y=="number"?new s.pointGeometry(v.offset.x,v.offset.y):s.pointGeometry.convert(v.offset),ue=new s.pointGeometry((v.padding.left-v.padding.right)/2,(v.padding.top-v.padding.bottom)/2).rotate(p*Math.PI/180),ye=de.add(ue).mult(T.scale/T.zoomScale(ae));return{center:T.unproject(I.add(k).div(2).sub(ye)),zoom:ae,bearing:p}}_cameraForBox(n,c,p,y,v){const T=this._extendCameraOptions(v);p=p||0,y=y||0,n=s.LngLat.convert(n),c=s.LngLat.convert(c);const S=this.transform.clone();S.padding=T.padding;const I=this.getFreeCameraOptions(),k=new s.LngLat(.5*(n.lng+c.lng),.5*(n.lat+c.lat)),D=.5*(p+y);if(S._camera.position[2]<s.mercatorZfromAltitude(D,k.lat))return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");I.lookAtPoint(k),S.setFreeCameraOptions(I);const U=s.MercatorCoordinate.fromLngLat(n),G=s.MercatorCoordinate.fromLngLat(c),K=S.pointRayIntersection(S.centerPoint,D),X=[(Q=S.rayIntersectionCoordinate(K)).x,Q.y,Q.z];var Q;const Y=S.screenPointToMercatorRay(S.centerPoint),Z=S.projection.name!=="globe";let ie,J=0;do{const pe=Math.floor(S.zoom),fe=1<<pe,ae=Math.min(fe*U.x,fe*G.x),de=Math.min(fe*U.y,fe*G.y),ue=Math.max(fe*U.x,fe*G.x),ye=Math.max(fe*U.y,fe*G.y),Ae=new s.Aabb([ae,de,p],[ue,ye,y]),Je=s.Frustum.fromInvProjectionMatrix(S.invProjMatrix,S.worldSize,pe,Z);if(Ae.intersects(Je)!==2){ie&&(S._camera.position=s.scaleAndAdd([],S._camera.position,Y.dir,-ie),S._updateStateFromCamera());break}const be=s.sub([],S._camera.position,X);ie=.5*s.length(be),S._camera.position=s.scaleAndAdd([],S._camera.position,Y.dir,ie);try{S._updateStateFromCamera()}catch{return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++J<10);return{center:S.center,zoom:S.zoom,bearing:S.bearing,pitch:S.pitch}}fitBounds(n,c,p){return this.transform.projection.name==="globe"&&s.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(n,c),c,p)}_raycastElevationBox(n,c){const p=this.transform.elevation;if(!p)return;const y=new s.pointGeometry(n.x,c.y),v=new s.pointGeometry(c.x,n.y),T=p.pointCoordinate(n);if(!T)return;const S=p.pointCoordinate(c);if(!S)return;const I=p.pointCoordinate(y);if(!I)return;const k=p.pointCoordinate(v);if(!k)return;const D=new s.MercatorCoordinate(T[0],T[1]).toLngLat(),U=new s.MercatorCoordinate(S[0],S[1]).toLngLat(),G=new s.MercatorCoordinate(I[0],I[1]).toLngLat(),K=new s.MercatorCoordinate(k[0],k[1]).toLngLat(),X=Math.min(D.lng,Math.min(U.lng,Math.min(G.lng,K.lng))),Q=Math.min(D.lat,Math.min(U.lat,Math.min(G.lat,K.lat))),Y=Math.max(D.lng,Math.max(U.lng,Math.max(G.lng,K.lng))),Z=Math.max(D.lat,Math.max(U.lat,Math.max(G.lat,K.lat))),ie=Math.min(T[3],Math.min(S[3],Math.min(I[3],k[3]))),J=Math.max(T[3],Math.max(S[3],Math.max(I[3],k[3])));return{minLngLat:new s.LngLat(X,Q),maxLngLat:new s.LngLat(Y,Z),minAltitude:ie,maxAltitude:J}}fitScreenCoordinates(n,c,p,y,v){let T,S,I,k;this.transform.projection.name==="globe"&&s.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const D=s.pointGeometry.convert(n),U=s.pointGeometry.convert(c),G=this._raycastElevationBox(D,U);if(G)T=G.minLngLat,S=G.maxLngLat,I=G.minAltitude,k=G.maxAltitude;else{if(this.transform.anyCornerOffEdge(D,U))return this;T=this.transform.pointLocation(D),S=this.transform.pointLocation(U)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(s.pointGeometry.convert(n)),this.transform.pointLocation(s.pointGeometry.convert(c)),p,y):this._cameraForBox(T,S,I,k,y),y,v)}_fitInternal(n,c,p){return n?(delete(c=s.extend(n,c)).padding,c.linear?this.easeTo(c,p):this.flyTo(c,p)):this}jumpTo(n,c){this.stop();const p=n.preloadOnly?this.transform.clone():this.transform;let y=!1,v=!1,T=!1;return"zoom"in n&&p.zoom!==+n.zoom&&(y=!0,p.zoom=+n.zoom),n.center!==void 0&&(p.center=s.LngLat.convert(n.center)),"bearing"in n&&p.bearing!==+n.bearing&&(v=!0,p.bearing=+n.bearing),"pitch"in n&&p.pitch!==+n.pitch&&(T=!0,p.pitch=+n.pitch),n.padding==null||p.isPaddingEqual(n.padding)||(p.padding=n.padding),n.preloadOnly?(this._preloadTiles(p),this):(this.fire(new s.Event("movestart",c)).fire(new s.Event("move",c)),y&&this.fire(new s.Event("zoomstart",c)).fire(new s.Event("zoom",c)).fire(new s.Event("zoomend",c)),v&&this.fire(new s.Event("rotatestart",c)).fire(new s.Event("rotate",c)).fire(new s.Event("rotateend",c)),T&&this.fire(new s.Event("pitchstart",c)).fire(new s.Event("pitch",c)).fire(new s.Event("pitchend",c)),this.fire(new s.Event("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.warnOnce(Zc),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,c){const p=this.transform;if(!p.projection.supportsFreeCamera)return s.warnOnce(Zc),this;this.stop();const y=p.zoom,v=p.pitch,T=p.bearing;p.setFreeCameraOptions(n);const S=y!==p.zoom,I=v!==p.pitch,k=T!==p.bearing;return this.fire(new s.Event("movestart",c)).fire(new s.Event("move",c)),S&&this.fire(new s.Event("zoomstart",c)).fire(new s.Event("zoom",c)).fire(new s.Event("zoomend",c)),k&&this.fire(new s.Event("rotatestart",c)).fire(new s.Event("rotate",c)).fire(new s.Event("rotateend",c)),I&&this.fire(new s.Event("pitchstart",c)).fire(new s.Event("pitch",c)).fire(new s.Event("pitchend",c)),this.fire(new s.Event("moveend",c)),this}easeTo(n,c){this._stop(!1,n.easeId),((n=s.extend({offset:[0,0],duration:500,easing:s.ease},n)).animate===!1||!n.essential&&s.exported.prefersReducedMotion)&&(n.duration=0);const p=this.transform,y=this.getZoom(),v=this.getBearing(),T=this.getPitch(),S=this.getPadding(),I="zoom"in n?+n.zoom:y,k="bearing"in n?this._normalizeBearing(n.bearing,v):v,D="pitch"in n?+n.pitch:T,U="padding"in n?n.padding:p.padding,G=s.pointGeometry.convert(n.offset);let K,X,Q;if(p.projection.name==="globe"){const ye=s.MercatorCoordinate.fromLngLat(p.center),Ae=G.rotate(-p.angle);ye.x+=Ae.x/p.worldSize,ye.y+=Ae.y/p.worldSize;const Je=ye.toLngLat(),be=s.LngLat.convert(n.center||Je);this._normalizeCenter(be),K=p.centerPoint.add(Ae),X=new s.pointGeometry(ye.x,ye.y).mult(p.worldSize),Q=new s.pointGeometry(s.mercatorXfromLng(be.lng),s.mercatorYfromLat(be.lat)).mult(p.worldSize).sub(X)}else{K=p.centerPoint.add(G);const ye=p.pointLocation(K),Ae=s.LngLat.convert(n.center||ye);this._normalizeCenter(Ae),X=p.project(ye),Q=p.project(Ae).sub(X)}const Y=p.zoomScale(I-y);let Z,ie;n.around&&(Z=s.LngLat.convert(n.around),ie=p.locationPoint(Z));const J=this._zooming||I!==y,pe=this._rotating||v!==k,fe=this._pitching||D!==T,ae=!p.isPaddingEqual(U),de=ye=>Ae=>{if(J&&(ye.zoom=s.number(y,I,Ae)),pe&&(ye.bearing=s.number(v,k,Ae)),fe&&(ye.pitch=s.number(T,D,Ae)),ae&&(ye.interpolatePadding(S,U,Ae),K=ye.centerPoint.add(G)),Z)ye.setLocationAtPoint(Z,ie);else{const Je=ye.zoomScale(ye.zoom-y),be=I>y?Math.min(2,Y):Math.max(.5,Y),Le=Math.pow(be,1-Ae),Ve=ye.unproject(X.add(Q.mult(Ae*Le)).mult(Je));ye.setLocationAtPoint(ye.renderWorldCopies?Ve.wrap():Ve,K)}return n.preloadOnly||this._fireMoveEvents(c),ye};if(n.preloadOnly){const ye=this._emulate(de,n.duration,p);return this._preloadTiles(ye),this}const ue={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=J,this._rotating=pe,this._pitching=fe,this._padding=ae,this._easeId=n.easeId,this._prepareEase(c,n.noMoveStart,ue),this._ease(de(p),ye=>{p.recenterOnTerrain(),this._afterEase(c,ye)},n),this}_prepareEase(n,c,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||p.moving||this.fire(new s.Event("movestart",n)),this._zooming&&!p.zooming&&this.fire(new s.Event("zoomstart",n)),this._rotating&&!p.rotating&&this.fire(new s.Event("rotatestart",n)),this._pitching&&!p.pitching&&this.fire(new s.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new s.Event("move",n)),this._zooming&&this.fire(new s.Event("zoom",n)),this._rotating&&this.fire(new s.Event("rotate",n)),this._pitching&&this.fire(new s.Event("pitch",n))}_afterEase(n,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,y=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new s.Event("zoomend",n)),y&&this.fire(new s.Event("rotateend",n)),v&&this.fire(new s.Event("pitchend",n)),this.fire(new s.Event("moveend",n))}flyTo(n,c){if(!n.essential&&s.exported.prefersReducedMotion){const st=s.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(st,c)}this.stop(),n=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},n);const p=this.transform,y=this.getZoom(),v=this.getBearing(),T=this.getPitch(),S=this.getPadding(),I="zoom"in n?s.clamp(+n.zoom,p.minZoom,p.maxZoom):y,k="bearing"in n?this._normalizeBearing(n.bearing,v):v,D="pitch"in n?+n.pitch:T,U="padding"in n?n.padding:p.padding,G=p.zoomScale(I-y),K=s.pointGeometry.convert(n.offset);let X=p.centerPoint.add(K);const Q=p.pointLocation(X),Y=s.LngLat.convert(n.center||Q);this._normalizeCenter(Y);const Z=p.project(Q),ie=p.project(Y).sub(Z);let J=n.curve;const pe=Math.max(p.width,p.height),fe=pe/G,ae=ie.mag();if("minZoom"in n){const st=s.clamp(Math.min(n.minZoom,y,I),p.minZoom,p.maxZoom),ot=pe/p.zoomScale(st-y);J=Math.sqrt(ot/ae*2)}const de=J*J;function ue(st){const ot=(fe*fe-pe*pe+(st?-1:1)*de*de*ae*ae)/(2*(st?fe:pe)*de*ae);return Math.log(Math.sqrt(ot*ot+1)-ot)}function ye(st){return(Math.exp(st)-Math.exp(-st))/2}function Ae(st){return(Math.exp(st)+Math.exp(-st))/2}const Je=ue(0);let be=function(st){return Ae(Je)/Ae(Je+J*st)},Le=function(st){return pe*((Ae(Je)*(ye(ot=Je+J*st)/Ae(ot))-ye(Je))/de)/ae;var ot},Ve=(ue(1)-Je)/J;if(Math.abs(ae)<1e-6||!isFinite(Ve)){if(Math.abs(pe-fe)<1e-6)return this.easeTo(n,c);const st=fe<pe?-1:1;Ve=Math.abs(Math.log(fe/pe))/J,Le=function(){return 0},be=function(ot){return Math.exp(st*J*ot)}}n.duration="duration"in n?+n.duration:1e3*Ve/("screenSpeed"in n?+n.screenSpeed/J:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const it=v!==k,Re=D!==T,Ke=!p.isPaddingEqual(U),Be=st=>ot=>{const _t=ot*Ve,wt=1/be(_t);st.zoom=ot===1?I:y+st.scaleZoom(wt),it&&(st.bearing=s.number(v,k,ot)),Re&&(st.pitch=s.number(T,D,ot)),Ke&&(st.interpolatePadding(S,U,ot),X=st.centerPoint.add(K));const Mt=ot===1?Y:st.unproject(Z.add(ie.mult(Le(_t))).mult(wt));return st.setLocationAtPoint(st.renderWorldCopies?Mt.wrap():Mt,X),st._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(c),st};if(n.preloadOnly){const st=this._emulate(Be,n.duration,p);return this._preloadTiles(st),this}return this._zooming=!0,this._rotating=it,this._pitching=Re,this._padding=Ke,this._prepareEase(c,!1),this._ease(Be(p),()=>this._afterEase(c),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,c)}if(!n){const p=this.handlers;p&&p.stop(!1)}return this}_ease(n,c,p){p.animate===!1||p.duration===0?(n(1),c()):(this._easeStart=s.exported.now(),this._easeOptions=p,this._onEaseFrame=n,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,c){n=s.wrap(n,-180,180);const p=Math.abs(n-c);return Math.abs(n-360-c)<p&&(n-=360),Math.abs(n+360-c)<p&&(n+=360),n}_normalizeCenter(n){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const p=n.lng-c.center.lng;n.lng+=p>180?-360:p<-180?360:0}_emulate(n,c,p){const y=Math.ceil(15*c/1e3),v=[],T=n(p.clone());for(let S=0;S<=y;S++){const I=T(S/y);v.push(I.clone())}return v}}class Hc{constructor(n={}){this.options=n,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const c=this.options&&this.options.compact;return this._map=n,this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=F("button","mapboxgl-ctrl-attrib-button",this._container),F("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=F("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,c){const p=this._map._getUIString(`AttributionControl.${c}`);n.setAttribute("aria-label",p),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(n){const p=c.reduce((y,v,T)=>(v.value&&(y+=`${v.key}=${v.value}${T<c.length-1?"&":""}`),y),"?");n.href=`${s.config.FEEDBACK_URL}/${p}#${Uc(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const c=this._map.style._sourceCaches;for(const y in c){const v=c[y];if(v.used){const T=v.getSource();T.attribution&&n.indexOf(T.attribution)<0&&n.push(T.attribution)}}n.sort((y,v)=>y.length-v.length),n=n.filter((y,v)=>{for(let T=v+1;T<n.length;T++)if(n[T].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const p=n.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,n.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Wc{constructor(){s.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=F("div","mapboxgl-ctrl");const c=F("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const c in n){const p=n[c].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const c=n[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Xc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const c=++this._id;return this._queue.push({callback:n,id:c,cancelled:!1}),c}remove(n){const c=this._currentlyRunning,p=c?this._queue.concat(c):this._queue;for(const y of p)if(y.id===n)return void(y.cancelled=!0)}run(n=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const p of c)if(!p.cancelled&&(p.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Qc(f,n,c){if(f=new s.LngLat(f.lng,f.lat),n){const p=new s.LngLat(f.lng-360,f.lat),y=new s.LngLat(f.lng+360,f.lat),v=360*Math.ceil(Math.abs(f.lng-c.center.lng)/360),T=c.locationPoint(f).distSqr(n),S=n.x<0||n.y<0||n.x>c.width||n.y>c.height;c.locationPoint(p).distSqr(n)<T&&(S||Math.abs(p.lng-c.center.lng)<v)?f=p:c.locationPoint(y).distSqr(n)<T&&(S||Math.abs(y.lng-c.center.lng)<v)&&(f=y)}for(;Math.abs(f.lng-c.center.lng)>180;){const p=c.locationPoint(f);if(p.x>=0&&p.y>=0&&p.x<=c.width&&p.y<=c.height)break;f.lng>c.center.lng?f.lng-=360:f.lng+=360}return f}const oa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class hl extends s.Evented{constructor(n,c){if(super(),(n instanceof s.window.HTMLElement||c)&&(n=s.extend({element:n},c)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),n&&n.element)this._element=n.element,this._offset=s.pointGeometry.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=F("div");const y=41,v=27,T=j("svg",{display:"block",height:y*this._scale+"px",width:v*this._scale+"px",viewBox:`0 0 ${v} ${y}`},this._element),S=j("radialGradient",{id:"shadowGradient"},j("defs",{},T));j("stop",{offset:"10%","stop-opacity":.4},S),j("stop",{offset:"100%","stop-opacity":.05},S),j("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},T),j("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},T),j("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},T),j("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},T),this._offset=s.pointGeometry.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});const p=this._element.classList;for(const y in oa)p.remove(`mapboxgl-marker-anchor-${y}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=s.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const c=38.1,p=13.5,y=Math.sqrt(Math.pow(p,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-c],"bottom-left":[y,-1*(c-p+y)],"bottom-right":[-y,-1*(c-p+y)],left:[p,-1*(c-p)],right:[-p,-1*(c-p)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const c=n.code,p=n.charCode||n.keyCode;c!=="Space"&&c!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(n){const c=n.originalEvent.target,p=this._element;this._popup&&(c===p||p.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map;if(!n)return!1;const c=n.unproject(this._pos),p=n.getFreeCameraOptions();if(!p.position)return!1;const y=p.position.toLngLat();return y.distanceTo(c)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const c=this._pos;if(!c||c.x<0||c.x>n.transform.width||c.y<0||c.y>n.transform.height)return void this._clearFadeTimer();const p=n.unproject(c);let y;n._showingGlobe()&&s.isLngLatBehindGlobe(n.transform,this._lngLat)?y=0:(y=1-n._queryFogOpacity(p),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(y*=.2)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${oa[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const n=this._pos,c=this._map,p=this.getPitchAlignment();if(!c||!n||p!=="map")return"";if(!c._showingGlobe()){const I=c.getPitch();return I?`rotateX(${I}deg)`:""}const y=s.radToDeg(s.globeTiltAtLngLat(c.transform,this._lngLat)),v=n.sub(s.globeCenterToScreenPoint(c.transform)),T=Math.abs(v.x)+Math.abs(v.y);if(T===0)return"";const S=y/T;return`rotateX(${-v.y*S}deg) rotateY(${v.x*S}deg)`}_calculateZTransform(){const n=this._pos,c=this._map;if(!c||!n)return"";let p=0;const y=this.getRotationAlignment();if(y==="map")if(c._showingGlobe()){const v=c.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),T=c.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);p=s.radToDeg(Math.atan2(T.y,T.x))-90}else p=-c.getBearing();else if(y==="horizon"){const v=s.smoothstep(4,6,c.getZoom()),T=s.globeCenterToScreenPoint(c.transform);T.y+=v*c.transform.height;const S=n.sub(T),I=s.radToDeg(Math.atan2(S.y,S.x));p=(I>90?I-270:I+90)*(1-v)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(n){s.window.cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=Qc(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),n===!0?this._updateFrameId=s.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=s.pointGeometry.convert(n),this._update(),this}_onMove(n){const c=this._map;if(c){if(!this._isDragging){const p=this._clickTolerance||c._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(n){const c=this._map;c&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos),this._pointerdownPos=n.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const c=this._map;return c&&(n?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}}class qh{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const c=s.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,c,p){this._start=this.getValue(c),this._end=n,this._startTime=c,this._endTime=c+p}}const Zh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Hh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function sa(f){f.parentNode&&f.parentNode.removeChild(f)}const Wh={showCompass:!0,showZoom:!0,visualizePitch:!1};class Yc{constructor(n,c,p=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new $c({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,p&&(this.mousePitch=new ci({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(n,c){this.mouseRotate.mousedown(n,c),this.mousePitch&&this.mousePitch.mousedown(n,c),ve()}move(n,c){const p=this.map,y=this.mouseRotate.mousemoveWindow(n,c),v=y&&y.bearingDelta;if(v&&p.setBearing(p.getBearing()+v),this.mousePitch){const T=this.mousePitch.mousemoveWindow(n,c),S=T&&T.pitchDelta;S&&p.setPitch(p.getPitch()+S)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ce(),s.window.removeEventListener("mousemove",this.mousemove),s.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(s.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Ie(this.element,n)),s.window.addEventListener("mousemove",this.mousemove),s.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Ie(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=We(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=We(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Xh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Kc={maxWidth:100,unit:"metric"};function Jc(f,n,c){const p=fl(n),y=p/n,v={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[c];this._map._requestDomTask(()=>{this._container.style.width=f*y+"px",this._container.innerHTML=`${p}&nbsp;${v}`})}function fl(f){const n=Math.pow(10,`${Math.floor(f)}`.length-1);let c=f/n;return c=c>=10?10:c>=5?5:c>=3?3:c>=2?2:c>=1?1:function(p){const y=Math.pow(10,Math.ceil(-Math.log(p)/Math.LN10));return Math.round(p*y)/y}(c),n*c}const Ap={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Pp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function dl(f=new s.pointGeometry(0,0),n="bottom"){if(typeof f=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(n){case"top":return new s.pointGeometry(0,f);case"top-left":return new s.pointGeometry(c,c);case"top-right":return new s.pointGeometry(-c,c);case"bottom":return new s.pointGeometry(0,-f);case"bottom-left":return new s.pointGeometry(c,-c);case"bottom-right":return new s.pointGeometry(-c,-c);case"left":return new s.pointGeometry(f,0);case"right":return new s.pointGeometry(-f,0)}return new s.pointGeometry(0,0)}return f instanceof s.pointGeometry||Array.isArray(f)?s.pointGeometry.convert(f):s.pointGeometry.convert(f[n]||[0,0])}const aa={version:s.version,supported:M,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends Gh{constructor(f){if((f=s.extend({},Hh,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&s.isSafariWithAntialiasingBug(s.window)&&(f.antialias=!1,s.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Js(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._optimizeForTerrain=f.optimizeForTerrain,this._language=f.language==="auto"?s.window.navigator.language:f.language,this._worldview=f.worldview,this._renderTaskQueue=new Xc,this._domRenderTaskQueue=new Xc,this._controls=[],this._markers=[],this._mapId=s.uniqueId(),this._locale=s.extend({},Zh,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new qh(0),this._useExplicitProjection=!1,this._requestManager=new s.RequestManager(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,typeof f.container=="string"){if(this._container=s.window.document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof s.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&s.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1),s.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new $h(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this._hash=f.hash&&new Sh(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,s.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),f.attributionControl&&this.addControl(new Hc({customAttribution:f.customAttribution})),this._logoControl=new Wc,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new s.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new s.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(f,n){if(n===void 0&&(n=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=f.onAdd(this);this._controls.push(f);const p=this._controlPositions[n];return n.indexOf("bottom")!==-1?p.insertBefore(c,p.firstChild):p.appendChild(c),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(f);return n>-1&&this._controls.splice(n,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new s.Event("movestart",f)).fire(new s.Event("move",f)),this.fire(new s.Event("resize",f)),n&&this.fire(new s.Event("moveend",f)),this}getBounds(){return this.transform.projection.name==="globe"&&s.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(s.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=f==null?-2:f)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f==null?22:f)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f==null?0:f)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f==null?85:f)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}getLanguage(){return this._language}setLanguage(f){if(this._language=f==="auto"?s.window.navigator.language:f,this.style)for(const n in this.style._sourceCaches){const c=this.style._sourceCaches[n]._source;c._setLanguage&&c._setLanguage(this._language)}for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){if(this._worldview=f,this.style)for(const n in this.style._sourceCaches){const c=this.style._sourceCaches[n]._source;c._setWorldview&&c._setWorldview(f)}return this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,n=f.projection.name;let c;n==="globe"&&f.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?(f.setMercatorFromTransition(),c=!0):n==="mercator"&&f.zoom<s.GLOBE_ZOOM_THRESHOLD_MAX&&(f.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,n){return this._updateProjection(f||n||{name:"mercator"})}_updateProjection(f){let n;if(n=f.name==="globe"&&this.transform.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),n){this.painter.clearBackgroundTiles();for(const c in this.style._sourceCaches)this.style._sourceCaches[c].clearTiles();this._update(!0)}return this}project(f){return this.transform.locationPoint3D(s.LngLat.convert(f))}unproject(f){return this.transform.pointLocation3D(s.pointGeometry.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(f,n,c){if(f==="mouseenter"||f==="mouseover"){let p=!1;const y=T=>{const S=n.filter(k=>this.getLayer(k)),I=S.length?this.queryRenderedFeatures(T.point,{layers:S}):[];I.length?p||(p=!0,c.call(this,new mi(f,this,T.originalEvent,{features:I}))):p=!1},v=()=>{p=!1};return{layers:new Set(n),listener:c,delegates:{mousemove:y,mouseout:v}}}if(f==="mouseleave"||f==="mouseout"){let p=!1;const y=T=>{const S=n.filter(I=>this.getLayer(I));(S.length?this.queryRenderedFeatures(T.point,{layers:S}):[]).length?p=!0:p&&(p=!1,c.call(this,new mi(f,this,T.originalEvent)))},v=T=>{p&&(p=!1,c.call(this,new mi(f,this,T.originalEvent)))};return{layers:new Set(n),listener:c,delegates:{mousemove:y,mouseout:v}}}{const p=y=>{const v=n.filter(S=>this.getLayer(S)),T=v.length?this.queryRenderedFeatures(y.point,{layers:v}):[];T.length&&(y.features=T,c.call(this,y),delete y.features)};return{layers:new Set(n),listener:c,delegates:{[f]:p}}}}on(f,n,c){if(c===void 0)return super.on(f,n);Array.isArray(n)||(n=[n]);const p=this._createDelegatedListener(f,n,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(const y in p.delegates)this.on(y,p.delegates[y]);return this}once(f,n,c){if(c===void 0)return super.once(f,n);Array.isArray(n)||(n=[n]);const p=this._createDelegatedListener(f,n,c);for(const y in p.delegates)this.once(y,p.delegates[y]);return this}off(f,n,c){if(c===void 0)return super.off(f,n);n=new Set(Array.isArray(n)?n:[n]);const p=(v,T)=>{if(v.size!==T.size)return!1;for(const S of v)if(!T.has(S))return!1;return!0},y=this._delegatedListeners?this._delegatedListeners[f]:void 0;return y&&(v=>{for(let T=0;T<v.length;T++){const S=v[T];if(S.listener===c&&p(S.layers,n)){for(const I in S.delegates)this.off(I,S.delegates[I]);return v.splice(T,1),this}}})(y),this}queryRenderedFeatures(f,n){return this.style?(n!==void 0||f===void 0||f instanceof s.pointGeometry||Array.isArray(f)||(n=f,f=void 0),this.style.queryRenderedFeatures(f=f||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(f,n){return this.style.querySourceFeatures(f,n)}queryTerrainElevation(f,n){const c=this.transform.elevation;return c?(n=s.extend({},{exaggerated:!0},n),c.getAtPoint(s.MercatorCoordinate.fromLngLat(f),null,n.exaggerated)):null}setStyle(f,n){return(n=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&f?(this._diffStyle(f,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(f,n))}_getUIString(f){const n=this._locale[f];if(n==null)throw new Error(`Missing UI string '${f}'`);return n}_updateStyle(f,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f&&(this.style=new Qi(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f):this.style.loadJSON(f)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Qi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,n){if(typeof f=="string"){const c=this._requestManager.normalizeStyleURL(f),p=this._requestManager.transformRequest(c,s.ResourceType.Style);s.getJSON(p,(y,v)=>{y?this.fire(new s.ErrorEvent(y)):v&&this._updateDiff(v,n)})}else typeof f=="object"&&this._updateDiff(f,n)}_updateDiff(f,n){try{this.style.setState(f)&&this._update(!0)}catch(c){s.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(f,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.warnOnce("There is no style added to the map."),!1)}addSource(f,n){return this._lazyInitEmptyStyle(),this.style.addSource(f,n),this._update(!0)}isSourceLoaded(f){return!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){const f=this.style&&this.style._sourceCaches;for(const n in f){const c=f[n]._tiles;for(const p in c){const y=c[p];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}addSourceType(f,n,c){this._lazyInitEmptyStyle(),this.style.addSourceType(f,n,c)}removeSource(f){return this.style.removeSource(f),this._updateTerrain(),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,n,{pixelRatio:c=1,sdf:p=!1,stretchX:y,stretchY:v,content:T}={}){if(this._lazyInitEmptyStyle(),n instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&n instanceof s.window.ImageBitmap){const{width:S,height:I,data:k}=s.exported.getImageData(n);this.style.addImage(f,{data:new s.RGBAImage({width:S,height:I},k),pixelRatio:c,stretchX:y,stretchY:v,content:T,sdf:p,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:I}=n,k=n;this.style.addImage(f,{data:new s.RGBAImage({width:S,height:I},new Uint8Array(k.data)),pixelRatio:c,stretchX:y,stretchY:v,content:T,sdf:p,version:0,userImage:k}),k.onAdd&&k.onAdd(this,f)}}updateImage(f,n){const c=this.style.getImage(f);if(!c)return void this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=n instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&n instanceof s.window.ImageBitmap?s.exported.getImageData(n):n,{width:y,height:v}=p;y!==void 0&&v!==void 0?y===c.data.width&&v===c.data.height?(c.data.replace(p.data,!(n instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&n instanceof s.window.ImageBitmap)),this.style.updateImage(f,c)):this.fire(new s.ErrorEvent(new Error(`The width and height of the updated image (${y}, ${v})
                must be that same as the previous version of the image
                (${c.data.width}, ${c.data.height})`))):this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,n){s.getImage(this._requestManager.transformRequest(f,s.ResourceType.Image),(c,p)=>{n(c,p instanceof s.window.HTMLImageElement?s.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(f,n){return this._lazyInitEmptyStyle(),this.style.addLayer(f,n),this._update(!0)}moveLayer(f,n){return this.style.moveLayer(f,n),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,n,c){return this.style.setLayerZoomRange(f,n,c),this._update(!0)}setFilter(f,n,c={}){return this.style.setFilter(f,n,c),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,n,c,p={}){return this.style.setPaintProperty(f,n,c,p),this._update(!0)}getPaintProperty(f,n){return this.style.getPaintProperty(f,n)}setLayoutProperty(f,n,c,p={}){return this.style.setLayoutProperty(f,n,c,p),this._update(!0)}getLayoutProperty(f,n){return this.style.getLayoutProperty(f,n)}setLight(f,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.LngLat.convert(f),this.transform):0}setFeatureState(f,n){return this.style.setFeatureState(f,n),this._update()}removeFeatureState(f,n){return this.style.removeFeatureState(f,n),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let c,p,y,v=this._container;for(;v&&(!p||!y);){const T=s.window.getComputedStyle(v).transform;T&&T!=="none"&&(c=T.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(p=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(y=c[3])),v=v.parentElement}this._containerWidth=p?Math.abs(f/p):f,this._containerHeight=y?Math.abs(n/y):n}_detectMissingCSS(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=F("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=F("div","mapboxgl-canvas-container",f);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=F("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=F("div","mapboxgl-control-container",f),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{p[y]=F("div",`mapboxgl-ctrl-${y}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,n){const c=s.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(f),this._canvas.height=c*Math.ceil(n),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${n}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const n=this._markers.indexOf(f);n!==-1&&this._markers.splice(n,1)}_setupPainter(){const f=s.extend({},M.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);n?(s.storeAuthState(n,!0),this.painter=new Lc(n,this.transform),this.on("data",c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.exported$1.testSupport(n)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let n;const c=this.painter.context.extTimerQuery,p=s.exported.now();if(this.listens("gpu-timing-frame")&&(n=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();let y=!1;const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const I=this.transform.zoom,k=this.transform.pitch,D=s.exported.now();this.style.zoomHistory.update(I,D);const U=new s.EvaluationParameters(I,{now:D,fadeDuration:v,pitch:k,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),G=U.crossFadingFactor();G===1&&G===this._crossFadingFactor||(y=!0,this._crossFadingFactor=G),this.style.update(U)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(p),this.style._updateSources(this.transform),this._forceMarkerUpdate()):T=this._updateAverageElevation(p),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&(this.style.hasTransitions()||y)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const I=s.exported.now()-p;c.endQueryEXT(c.TIME_ELAPSED_EXT,n),setTimeout(()=>{const k=c.getQueryObjectEXT(n,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(n),this.fire(new s.Event("gpu-timing-frame",{cpuTime:I,gpuTime:k})),s.window.performance.mark("frame-gpu",{startTime:p,detail:{gpuTime:k}})},50)}if(this.listens("gpu-timing-layer")){const I=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(I);this.fire(new s.Event("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){const I=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const k=this.painter.queryGpuTimeDeferredRender(I);this.fire(new s.Event("gpu-timing-deferred-render",{gpuTime:k}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(S||this._repaint)this.triggerRepaint();else{const I=!this.isMoving()&&this.loaded();if(I&&(T=this._updateAverageElevation(p,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),I&&(this.fire(new s.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new s.Event("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const f of this._markers)f._update()}_updateAverageElevation(f,n=!1){const c=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);if((n||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const p=this.transform.averageElevation;let y=this.transform.sampleAverageElevation(),v=!1;this.transform.elevation&&(v=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=f;const T=Math.abs(p-y);if(T>1){if(this._isInitialLoad||v)return this._averageElevation.jumpTo(y),c(y);this._averageElevation.easeTo(y,f,300)}else if(T>1e-4)return this._averageElevation.jumpTo(y),c(y)}return!!this._averageElevation.isEasing(f)&&c(this._averageElevation.getValue(f))}_authenticate(){s.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===s.AUTH_ERR_MSG||f.status===401)){const n=this.painter.context.gl;s.storeAuthState(n,!1),this._logoControl instanceof Wc&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const c=this.painter.context.gl,p=c.createFramebuffer();function y(v){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,v,0);const T=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,T),T}return c.bindFramebuffer(c.FRAMEBUFFER,p),this._canvasPixelComparison(y(f),n.canvasCopies.map(y),n.timeStamps)}_canvasPixelComparison(f,n,c){let p=c[1]-c[0];const y=f.length/4;for(let v=0;v<n.length;v++){const T=n[v];let S=0;for(let I=0;I<T.length;I+=4)T[I]===f[I]&&T[I+1]===f[I+1]&&T[I+2]===f[I+2]&&T[I+3]===f[I+3]&&(S+=1);p+=(c[v+2]-c[v+1])*(1-S/y)}return p}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),sa(this._canvasContainer),sa(this._controlContainer),sa(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),s.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=s.exported.frame(n=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(n)}))}_preloadTiles(f){const n=this.style?Object.values(this.style._sourceCaches):[];return s.asyncAll(n,(c,p)=>c._preloadTiles(f,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}_setCacheLimits(f,n){s.setCacheLimits(f,n)}get version(){return s.version}},NavigationControl:class{constructor(f){this.options=s.extend({},Wh,f),this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),F("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),F("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:n}):c.resetNorth({},{originalEvent:n}))}),this._compassIcon=F("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const n=f.getZoom(),c=n===f.getMaxZoom(),p=n===f.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Yc(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,n){const c=F("button",f,this._container);return c.type="button",c.addEventListener("click",n),c}_setButtonTitle(f,n){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${n}`);f.setAttribute("aria-label",c),f.firstElementChild&&f.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends s.Evented{constructor(f){super(),this.options=s.extend({geolocation:s.window.navigator.geolocation},Xh,f),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ea(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){this._supportsGeolocation!==void 0?f(this._supportsGeolocation):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(n=>{this._supportsGeolocation=n.state!=="denied",f(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.options.geolocation,f(this._supportsGeolocation))}_isOutOfMapMaxBounds(f){const n=this._map.getMaxBounds(),c=f.coords;return!!n&&(c.longitude<n.getWest()||c.longitude>n.getEast()||c.latitude<n.getSouth()||c.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",f)),this._finish()}}_updateCamera(f){const n=new s.LngLat(f.coords.longitude,f.coords.latitude),c=f.coords.accuracy,p=this._map.getBearing(),y=s.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(c),y,{geolocateSource:!0})}_updateMarker(f){if(f){const n=new s.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,n=s.mercatorZfromAltitude(1,f._center.lat)*f.worldSize,c=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=F("button","mapboxgl-ctrl-geolocate",this._container),F("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=F("div","mapboxgl-user-location"),this._dotElement.appendChild(F("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(F("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new hl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=F("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new hl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))})}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{s.window.addEventListener("ondeviceorientationabsolute"in s.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};s.window.DeviceMotionEvent!==void 0&&typeof s.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),s.window.removeEventListener("deviceorientation",this._onDeviceOrientation),s.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Hc,ScaleControl:class{constructor(f){this.options=s.extend({},Kc,f),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Jc.bind(this)),s.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,n=this._map,c=n._containerHeight/2,p=n._containerWidth/2-f/2,y=n.unproject([p,c]),v=n.unproject([p+f,c]),T=y.distanceTo(v);if(this.options.unit==="imperial"){const S=3.2808*T;S>5280?this._setScale(f,S/5280,"mile"):this._setScale(f,S,"foot")}else this.options.unit==="nautical"?this._setScale(f,T/1852,"nautical-mile"):T>=1e3?this._setScale(f,T/1e3,"kilometer"):this._setScale(f,T,"meter")}_setScale(f,n,c){const p=fl(n),y=p/n;this._map._requestDomTask(()=>{this._container.style.width=f*y+"px",this._container.innerHTML=c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:c}).format(p):`${p}&nbsp;nm`})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof s.window.HTMLElement?this._container=f.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in s.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!s.window.document.fullscreenEnabled&&!s.window.document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=F("button","mapboxgl-ctrl-fullscreen",this._controlContainer);F("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(s.window.document.fullscreenElement||s.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.Evented{constructor(f){super(),this.options=s.extend(Object.create(Ap),f),s.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=s.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(s.window.document.createTextNode(f))}setHTML(f){const n=s.window.document.createDocumentFragment(),c=s.window.document.createElement("body");let p;for(c.innerHTML=f;p=c.firstChild,p;)n.appendChild(p);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=F("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(f),this.options.closeButton){const c=this._closeButton=F("button","mapboxgl-popup-close-button",n);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let n;return this._classList.delete(f)?n=!1:(this._classList.add(f),n=!0),this._updateClassList(),n}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const n=this._map,c=this._container,p=this._pos;if(!n||!c||!p)return"bottom";const y=c.offsetWidth,v=c.offsetHeight,T=p.x<y/2,S=p.x>n.transform.width-y/2;if(p.y+f<v)return T?"top-left":S?"top-right":"top";if(p.y>n.transform.height-v){if(T)return"bottom-left";if(S)return"bottom-right"}return T?"left":S?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),f.className=n.join(" ")}_update(f){const n=this._map,c=this._content;if(!n||!this._lngLat&&!this._trackPointer||!c)return;let p=this._container;if(p||(p=this._container=F("div","mapboxgl-popup",n.getContainer()),this._tip=F("div","mapboxgl-popup-tip",p),p.appendChild(c)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Qc(this._lngLat,this._pos,n.transform)),!this._trackPointer||f){const y=this._pos=this._trackPointer&&f?f:n.project(this._lngLat),v=dl(this.options.offset),T=this._anchor=this._getAnchor(v.y),S=dl(this.options.offset,T),I=y.add(S).round();n._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${oa[T]} translate(${I.x}px,${I.y}px)`)})}if(!this._marker&&n._showingGlobe()){const y=s.isLngLatBehindGlobe(n.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Pp);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:hl,Style:Qi,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.pointGeometry,MercatorCoordinate:s.MercatorCoordinate,FreeCameraOptions:ht,Evented:s.Evented,config:s.config,prewarm:function(){sr().acquire(yt)},clearPrewarmedResources:function(){const f=Nt;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(yt),Nt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(f){s.config.ACCESS_TOKEN=f},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(f){s.config.API_URL=f},get workerCount(){return Pt.workerCount},set workerCount(f){Pt.workerCount=f},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){s.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){s.clearTileCache(f)},workerUrl:"",workerClass:null,setNow:s.exported.setNow,restoreNow:s.exported.restoreNow};return aa});var E=_;return E})})(bx);var kD=bx.exports,Tx={exports:{}};/*! algoliasearch-lite.umd.js | 4.14.2 | © Algolia, inc. | https://github.com/algolia/algoliasearch-client-javascript */(function(i,o){(function(l,h){i.exports=h()})(xx,function(){function l(Fe,He,$e){return He in Fe?Object.defineProperty(Fe,He,{value:$e,enumerable:!0,configurable:!0,writable:!0}):Fe[He]=$e,Fe}function h(Fe,He){var $e=Object.keys(Fe);if(Object.getOwnPropertySymbols){var Ye=Object.getOwnPropertySymbols(Fe);He&&(Ye=Ye.filter(function(dt){return Object.getOwnPropertyDescriptor(Fe,dt).enumerable})),$e.push.apply($e,Ye)}return $e}function _(Fe){for(var He=1;He<arguments.length;He++){var $e=arguments[He]!=null?arguments[He]:{};He%2?h(Object($e),!0).forEach(function(Ye){l(Fe,Ye,$e[Ye])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Fe,Object.getOwnPropertyDescriptors($e)):h(Object($e)).forEach(function(Ye){Object.defineProperty(Fe,Ye,Object.getOwnPropertyDescriptor($e,Ye))})}return Fe}function x(Fe,He){if(Fe==null)return{};var $e,Ye,dt=function(St,lt){if(St==null)return{};var er,mr,br={},Ar=Object.keys(St);for(mr=0;mr<Ar.length;mr++)er=Ar[mr],lt.indexOf(er)>=0||(br[er]=St[er]);return br}(Fe,He);if(Object.getOwnPropertySymbols){var vt=Object.getOwnPropertySymbols(Fe);for(Ye=0;Ye<vt.length;Ye++)$e=vt[Ye],He.indexOf($e)>=0||Object.prototype.propertyIsEnumerable.call(Fe,$e)&&(dt[$e]=Fe[$e])}return dt}function E(Fe,He){return function($e){if(Array.isArray($e))return $e}(Fe)||function($e,Ye){if(Symbol.iterator in Object($e)||Object.prototype.toString.call($e)==="[object Arguments]"){var dt=[],vt=!0,St=!1,lt=void 0;try{for(var er,mr=$e[Symbol.iterator]();!(vt=(er=mr.next()).done)&&(dt.push(er.value),!Ye||dt.length!==Ye);vt=!0);}catch(br){St=!0,lt=br}finally{try{vt||mr.return==null||mr.return()}finally{if(St)throw lt}}return dt}}(Fe,He)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function s(Fe){return function(He){if(Array.isArray(He)){for(var $e=0,Ye=new Array(He.length);$e<He.length;$e++)Ye[$e]=He[$e];return Ye}}(Fe)||function(He){if(Symbol.iterator in Object(He)||Object.prototype.toString.call(He)==="[object Arguments]")return Array.from(He)}(Fe)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function A(Fe){var He,$e="algoliasearch-client-js-".concat(Fe.key),Ye=function(){return He===void 0&&(He=Fe.localStorage||window.localStorage),He},dt=function(){return JSON.parse(Ye().getItem($e)||"{}")};return{get:function(vt,St){var lt=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{miss:function(){return Promise.resolve()}};return Promise.resolve().then(function(){var er=JSON.stringify(vt),mr=dt()[er];return Promise.all([mr||St(),mr!==void 0])}).then(function(er){var mr=E(er,2),br=mr[0],Ar=mr[1];return Promise.all([br,Ar||lt.miss(br)])}).then(function(er){return E(er,1)[0]})},set:function(vt,St){return Promise.resolve().then(function(){var lt=dt();return lt[JSON.stringify(vt)]=St,Ye().setItem($e,JSON.stringify(lt)),St})},delete:function(vt){return Promise.resolve().then(function(){var St=dt();delete St[JSON.stringify(vt)],Ye().setItem($e,JSON.stringify(St))})},clear:function(){return Promise.resolve().then(function(){Ye().removeItem($e)})}}}function M(Fe){var He=s(Fe.caches),$e=He.shift();return $e===void 0?{get:function(Ye,dt){var vt=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{miss:function(){return Promise.resolve()}},St=dt();return St.then(function(lt){return Promise.all([lt,vt.miss(lt)])}).then(function(lt){return E(lt,1)[0]})},set:function(Ye,dt){return Promise.resolve(dt)},delete:function(Ye){return Promise.resolve()},clear:function(){return Promise.resolve()}}:{get:function(Ye,dt){var vt=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{miss:function(){return Promise.resolve()}};return $e.get(Ye,dt,vt).catch(function(){return M({caches:He}).get(Ye,dt,vt)})},set:function(Ye,dt){return $e.set(Ye,dt).catch(function(){return M({caches:He}).set(Ye,dt)})},delete:function(Ye){return $e.delete(Ye).catch(function(){return M({caches:He}).delete(Ye)})},clear:function(){return $e.clear().catch(function(){return M({caches:He}).clear()})}}}function z(){var Fe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{serializable:!0},He={};return{get:function($e,Ye){var dt=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{miss:function(){return Promise.resolve()}},vt=JSON.stringify($e);if(vt in He)return Promise.resolve(Fe.serializable?JSON.parse(He[vt]):He[vt]);var St=Ye(),lt=dt&&dt.miss||function(){return Promise.resolve()};return St.then(function(er){return lt(er)}).then(function(){return St})},set:function($e,Ye){return He[JSON.stringify($e)]=Fe.serializable?JSON.stringify(Ye):Ye,Promise.resolve(Ye)},delete:function($e){return delete He[JSON.stringify($e)],Promise.resolve()},clear:function(){return He={},Promise.resolve()}}}function L(Fe){for(var He=Fe.length-1;He>0;He--){var $e=Math.floor(Math.random()*(He+1)),Ye=Fe[He];Fe[He]=Fe[$e],Fe[$e]=Ye}return Fe}function F(Fe,He){return He&&Object.keys(He).forEach(function($e){Fe[$e]=He[$e](Fe)}),Fe}function j(Fe){for(var He=arguments.length,$e=new Array(He>1?He-1:0),Ye=1;Ye<He;Ye++)$e[Ye-1]=arguments[Ye];var dt=0;return Fe.replace(/%s/g,function(){return encodeURIComponent($e[dt++])})}var H={WithinQueryParameters:0,WithinHeaders:1};function W(Fe,He){var $e=Fe||{},Ye=$e.data||{};return Object.keys($e).forEach(function(dt){["timeout","headers","queryParameters","data","cacheable"].indexOf(dt)===-1&&(Ye[dt]=$e[dt])}),{data:Object.entries(Ye).length>0?Ye:void 0,timeout:$e.timeout||He,headers:$e.headers||{},queryParameters:$e.queryParameters||{},cacheable:$e.cacheable}}var he={Read:1,Write:2,Any:3},ve=1,Ce=2,De=3;function Se(Fe){var He=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ve;return _(_({},Fe),{},{status:He,lastUpdate:Date.now()})}function Ie(Fe){return typeof Fe=="string"?{protocol:"https",url:Fe,accept:he.Any}:{protocol:Fe.protocol||"https",url:Fe.url,accept:Fe.accept||he.Any}}var We="GET",mt="POST";function Te(Fe,He){return Promise.all(He.map(function($e){return Fe.get($e,function(){return Promise.resolve(Se($e))})})).then(function($e){var Ye=$e.filter(function(St){return function(lt){return lt.status===ve||Date.now()-lt.lastUpdate>12e4}(St)}),dt=$e.filter(function(St){return function(lt){return lt.status===De&&Date.now()-lt.lastUpdate<=12e4}(St)}),vt=[].concat(s(Ye),s(dt));return{getTimeout:function(St,lt){return(dt.length===0&&St===0?1:dt.length+3+St)*lt},statelessHosts:vt.length>0?vt.map(function(St){return Ie(St)}):He}})}function Ue(Fe,He,$e,Ye){var dt=[],vt=function($r,Rt){if(!($r.method===We||$r.data===void 0&&Rt.data===void 0)){var ir=Array.isArray($r.data)?$r.data:_(_({},$r.data),Rt.data);return JSON.stringify(ir)}}($e,Ye),St=function($r,Rt){var ir=_(_({},$r.headers),Rt.headers),Pr={};return Object.keys(ir).forEach(function(ti){var ri=ir[ti];Pr[ti.toLowerCase()]=ri}),Pr}(Fe,Ye),lt=$e.method,er=$e.method!==We?{}:_(_({},$e.data),Ye.data),mr=_(_(_({"x-algolia-agent":Fe.userAgent.value},Fe.queryParameters),er),Ye.queryParameters),br=0,Ar=function $r(Rt,ir){var Pr=Rt.pop();if(Pr===void 0)throw{name:"RetryError",message:"Unreachable hosts - your application id may be incorrect. If the error persists, contact support@algolia.com.",transporterStackTrace:Ft(dt)};var ti={data:vt,headers:St,method:lt,url:tt(Pr,$e.path,mr),connectTimeout:ir(br,Fe.timeouts.connect),responseTimeout:ir(br,Ye.timeout)},ri=function(Dr){var or={request:ti,response:Dr,host:Pr,triesLeft:Rt.length};return dt.push(or),or},an={onSuccess:function(Dr){return function(or){try{return JSON.parse(or.content)}catch(jr){throw function(ii,zi){return{name:"DeserializationError",message:ii,response:zi}}(jr.message,or)}}(Dr)},onRetry:function(Dr){var or=ri(Dr);return Dr.isTimedOut&&br++,Promise.all([Fe.logger.info("Retryable failure",zr(or)),Fe.hostsCache.set(Pr,Se(Pr,Dr.isTimedOut?De:Ce))]).then(function(){return $r(Rt,ir)})},onFail:function(Dr){throw ri(Dr),function(or,jr){var ii=or.content,zi=or.status,gn=ii;try{gn=JSON.parse(ii).message}catch{}return function(si,Ni,$o){return{name:"ApiError",message:si,status:Ni,transporterStackTrace:$o}}(gn,zi,jr)}(Dr,Ft(dt))}};return Fe.requester.send(ti).then(function(Dr){return function(or,jr){return function(ii){var zi=ii.status;return ii.isTimedOut||function(gn){var si=gn.isTimedOut,Ni=gn.status;return!si&&~~Ni==0}(ii)||~~(zi/100)!=2&&~~(zi/100)!=4}(or)?jr.onRetry(or):~~(or.status/100)==2?jr.onSuccess(or):jr.onFail(or)}(Dr,an)})};return Te(Fe.hostsCache,He).then(function($r){return Ar(s($r.statelessHosts).reverse(),$r.getTimeout)})}function Xe(Fe){var He={value:"Algolia for JavaScript (".concat(Fe,")"),add:function($e){var Ye="; ".concat($e.segment).concat($e.version!==void 0?" (".concat($e.version,")"):"");return He.value.indexOf(Ye)===-1&&(He.value="".concat(He.value).concat(Ye)),He}};return He}function tt(Fe,He,$e){var Ye=Dt($e),dt="".concat(Fe.protocol,"://").concat(Fe.url,"/").concat(He.charAt(0)==="/"?He.substr(1):He);return Ye.length&&(dt+="?".concat(Ye)),dt}function Dt(Fe){return Object.keys(Fe).map(function(He){return j("%s=%s",He,($e=Fe[He],Object.prototype.toString.call($e)==="[object Object]"||Object.prototype.toString.call($e)==="[object Array]"?JSON.stringify(Fe[He]):Fe[He]));var $e}).join("&")}function Ft(Fe){return Fe.map(function(He){return zr(He)})}function zr(Fe){var He=Fe.request.headers["x-algolia-api-key"]?{"x-algolia-api-key":"*****"}:{};return _(_({},Fe),{},{request:_(_({},Fe.request),{},{headers:_(_({},Fe.request.headers),He)})})}var Kt=function(Fe){var He=Fe.appId,$e=function(dt,vt,St){var lt={"x-algolia-api-key":St,"x-algolia-application-id":vt};return{headers:function(){return dt===H.WithinHeaders?lt:{}},queryParameters:function(){return dt===H.WithinQueryParameters?lt:{}}}}(Fe.authMode!==void 0?Fe.authMode:H.WithinHeaders,He,Fe.apiKey),Ye=function(dt){var vt=dt.hostsCache,St=dt.logger,lt=dt.requester,er=dt.requestsCache,mr=dt.responsesCache,br=dt.timeouts,Ar=dt.userAgent,$r=dt.hosts,Rt=dt.queryParameters,ir={hostsCache:vt,logger:St,requester:lt,requestsCache:er,responsesCache:mr,timeouts:br,userAgent:Ar,headers:dt.headers,queryParameters:Rt,hosts:$r.map(function(Pr){return Ie(Pr)}),read:function(Pr,ti){var ri=W(ti,ir.timeouts.read),an=function(){return Ue(ir,ir.hosts.filter(function(or){return(or.accept&he.Read)!=0}),Pr,ri)};if((ri.cacheable!==void 0?ri.cacheable:Pr.cacheable)!==!0)return an();var Dr={request:Pr,mappedRequestOptions:ri,transporter:{queryParameters:ir.queryParameters,headers:ir.headers}};return ir.responsesCache.get(Dr,function(){return ir.requestsCache.get(Dr,function(){return ir.requestsCache.set(Dr,an()).then(function(or){return Promise.all([ir.requestsCache.delete(Dr),or])},function(or){return Promise.all([ir.requestsCache.delete(Dr),Promise.reject(or)])}).then(function(or){var jr=E(or,2);return jr[0],jr[1]})})},{miss:function(or){return ir.responsesCache.set(Dr,or)}})},write:function(Pr,ti){return Ue(ir,ir.hosts.filter(function(ri){return(ri.accept&he.Write)!=0}),Pr,W(ti,ir.timeouts.write))}};return ir}(_(_({hosts:[{url:"".concat(He,"-dsn.algolia.net"),accept:he.Read},{url:"".concat(He,".algolia.net"),accept:he.Write}].concat(L([{url:"".concat(He,"-1.algolianet.com")},{url:"".concat(He,"-2.algolianet.com")},{url:"".concat(He,"-3.algolianet.com")}]))},Fe),{},{headers:_(_(_({},$e.headers()),{"content-type":"application/x-www-form-urlencoded"}),Fe.headers),queryParameters:_(_({},$e.queryParameters()),Fe.queryParameters)}));return F({transporter:Ye,appId:He,addAlgoliaAgent:function(dt,vt){Ye.userAgent.add({segment:dt,version:vt})},clearCache:function(){return Promise.all([Ye.requestsCache.clear(),Ye.responsesCache.clear()]).then(function(){})}},Fe.methods)},Rr=function(Fe){return function(He,$e){return He.method===We?Fe.transporter.read(He,$e):Fe.transporter.write(He,$e)}},Wr=function(Fe){return function(He){var $e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Ye={transporter:Fe.transporter,appId:Fe.appId,indexName:He};return F(Ye,$e.methods)}},xr=function(Fe){return function(He,$e){var Ye=He.map(function(dt){return _(_({},dt),{},{params:Dt(dt.params||{})})});return Fe.transporter.read({method:mt,path:"1/indexes/*/queries",data:{requests:Ye},cacheable:!0},$e)}},Ht=function(Fe){return function(He,$e){return Promise.all(He.map(function(Ye){var dt=Ye.params,vt=dt.facetName,St=dt.facetQuery,lt=x(dt,["facetName","facetQuery"]);return Wr(Fe)(Ye.indexName,{methods:{searchForFacetValues:hr}}).searchForFacetValues(vt,St,_(_({},$e),lt))}))}},Br=function(Fe){return function(He,$e,Ye){return Fe.transporter.read({method:mt,path:j("1/answers/%s/prediction",Fe.indexName),data:{query:He,queryLanguages:$e},cacheable:!0},Ye)}},wr=function(Fe){return function(He,$e){return Fe.transporter.read({method:mt,path:j("1/indexes/%s/query",Fe.indexName),data:{query:He},cacheable:!0},$e)}},hr=function(Fe){return function(He,$e,Ye){return Fe.transporter.read({method:mt,path:j("1/indexes/%s/facets/%s/query",Fe.indexName,He),data:{facetQuery:$e},cacheable:!0},Ye)}},kr=1,Yr=2,oi=3;function Ci(Fe,He,$e){var Ye,dt={appId:Fe,apiKey:He,timeouts:{connect:1,read:2,write:30},requester:{send:function(vt){return new Promise(function(St){var lt=new XMLHttpRequest;lt.open(vt.method,vt.url,!0),Object.keys(vt.headers).forEach(function(Ar){return lt.setRequestHeader(Ar,vt.headers[Ar])});var er,mr=function(Ar,$r){return setTimeout(function(){lt.abort(),St({status:0,content:$r,isTimedOut:!0})},1e3*Ar)},br=mr(vt.connectTimeout,"Connection timeout");lt.onreadystatechange=function(){lt.readyState>lt.OPENED&&er===void 0&&(clearTimeout(br),er=mr(vt.responseTimeout,"Socket timeout"))},lt.onerror=function(){lt.status===0&&(clearTimeout(br),clearTimeout(er),St({content:lt.responseText||"Network request failed",status:lt.status,isTimedOut:!1}))},lt.onload=function(){clearTimeout(br),clearTimeout(er),St({content:lt.responseText,status:lt.status,isTimedOut:!1})},lt.send(vt.data)})}},logger:(Ye=oi,{debug:function(vt,St){return kr>=Ye&&console.debug(vt,St),Promise.resolve()},info:function(vt,St){return Yr>=Ye&&console.info(vt,St),Promise.resolve()},error:function(vt,St){return console.error(vt,St),Promise.resolve()}}),responsesCache:z(),requestsCache:z({serializable:!1}),hostsCache:M({caches:[A({key:"".concat("4.14.2","-").concat(Fe)}),z()]}),userAgent:Xe("4.14.2").add({segment:"Browser",version:"lite"}),authMode:H.WithinQueryParameters};return Kt(_(_(_({},dt),$e),{},{methods:{search:xr,searchForFacetValues:Ht,multipleQueries:xr,multipleSearchForFacetValues:Ht,customRequest:Rr,initIndex:function(vt){return function(St){return Wr(vt)(St,{methods:{search:wr,searchForFacetValues:hr,findAnswers:Br}})}}}}))}return Ci.version="4.14.2",Ci})})(Tx);var DD=Tx.exports;function PI(i){return typeof i=="object"&&i!==null?A_(Array.isArray(i)?[]:{},i):i}function Ed(i){return typeof i=="function"||Array.isArray(i)||Object.prototype.toString.call(i)==="[object Object]"}function A_(i,o){if(i===o)return i;for(var l in o)if(!(!Object.prototype.hasOwnProperty.call(o,l)||l==="__proto__")){var h=o[l],_=i[l];typeof _!="undefined"&&typeof h=="undefined"||(Ed(_)&&Ed(h)?i[l]=A_(_,h):i[l]=PI(h))}return i}function II(i){Ed(i)||(i={});for(var o=1,l=arguments.length;o<l;o++){var h=arguments[o];Ed(h)&&A_(i,h)}return i}var Sd=II,P_=function(){var o=Array.prototype.slice.call(arguments);return o.reduceRight(function(l,h){return Object.keys(Object(h)).forEach(function(_){h[_]!==void 0&&(l[_]!==void 0&&delete l[_],l[_]=h[_])}),l},{})};function MI(i,o){return i.filter(function(l,h){return o.indexOf(l)>-1&&i.indexOf(l)===h})}var CI=MI,Ad=function(o,l){if(!!Array.isArray(o)){for(var h=0;h<o.length;h++)if(l(o[h]))return o[h]}};function Ex(i){if(typeof i=="number")return i;if(typeof i=="string")return parseFloat(i);if(Array.isArray(i))return i.map(Ex);throw new Error("The value should be a number, a parsable string or an array of those.")}var zI=Ex;function RI(i,o){if(i===null)return{};var l={},h=Object.keys(i),_,x;for(x=0;x<h.length;x++)_=h[x],!(o.indexOf(_)>=0)&&(l[_]=i[_]);return l}var I_=RI;function kI(i){return i&&Object.keys(i).length>0}var M_=kI,DI=function(o){return o===null?!1:/^[a-zA-Z0-9_-]{1,64}$/.test(o)},OI=P_,LI=I_,FI=M_,Pa={addRefinement:function(o,l,h){if(Pa.isRefined(o,l,h))return o;var _=""+h,x=o[l]?o[l].concat(_):[_],E={};return E[l]=x,OI({},E,o)},removeRefinement:function(o,l,h){if(h===void 0)return Pa.clearRefinement(o,function(x,E){return l===E});var _=""+h;return Pa.clearRefinement(o,function(x,E){return l===E&&_===x})},toggleRefinement:function(o,l,h){if(h===void 0)throw new Error("toggleRefinement should be used with a value");return Pa.isRefined(o,l,h)?Pa.removeRefinement(o,l,h):Pa.addRefinement(o,l,h)},clearRefinement:function(o,l,h){if(l===void 0)return FI(o)?{}:o;if(typeof l=="string")return LI(o,[l]);if(typeof l=="function"){var _=!1,x=Object.keys(o).reduce(function(E,s){var A=o[s]||[],M=A.filter(function(z){return!l(z,s,h)});return M.length!==A.length&&(_=!0),E[s]=M,E},{});return _?x:o}},isRefined:function(o,l,h){var _=!!o[l]&&o[l].length>0;if(h===void 0||!_)return _;var x=""+h;return o[l].indexOf(x)!==-1}},BI=Pa,C_=Sd,z_=P_,Sx=CI,Ax=Ad,R_=zI,Px=I_,k_=M_,jI=DI,Jr=BI;function D_(i,o){return Array.isArray(i)&&Array.isArray(o)?i.length===o.length&&i.every(function(l,h){return D_(o[h],l)}):i===o}function NI(i,o){return Ax(i,function(l){return D_(l,o)})}function nn(i){var o=i?nn._parseNumbers(i):{};o.userToken!==void 0&&!jI(o.userToken)&&console.warn("[algoliasearch-helper] The `userToken` parameter is invalid. This can lead to wrong analytics.\n  - Format: [a-zA-Z0-9_-]{1,64}"),this.facets=o.facets||[],this.disjunctiveFacets=o.disjunctiveFacets||[],this.hierarchicalFacets=o.hierarchicalFacets||[],this.facetsRefinements=o.facetsRefinements||{},this.facetsExcludes=o.facetsExcludes||{},this.disjunctiveFacetsRefinements=o.disjunctiveFacetsRefinements||{},this.numericRefinements=o.numericRefinements||{},this.tagRefinements=o.tagRefinements||[],this.hierarchicalFacetsRefinements=o.hierarchicalFacetsRefinements||{};var l=this;Object.keys(o).forEach(function(h){var _=nn.PARAMETERS.indexOf(h)!==-1,x=o[h]!==void 0;!_&&x&&(l[h]=o[h])})}nn.PARAMETERS=Object.keys(new nn);nn._parseNumbers=function(i){if(i instanceof nn)return i;var o={},l=["aroundPrecision","aroundRadius","getRankingInfo","minWordSizefor2Typos","minWordSizefor1Typo","page","maxValuesPerFacet","distinct","minimumAroundRadius","hitsPerPage","minProximity"];if(l.forEach(function(_){var x=i[_];if(typeof x=="string"){var E=parseFloat(x);o[_]=isNaN(E)?x:E}}),Array.isArray(i.insideBoundingBox)&&(o.insideBoundingBox=i.insideBoundingBox.map(function(_){return Array.isArray(_)?_.map(function(x){return parseFloat(x)}):_})),i.numericRefinements){var h={};Object.keys(i.numericRefinements).forEach(function(_){var x=i.numericRefinements[_]||{};h[_]={},Object.keys(x).forEach(function(E){var s=x[E],A=s.map(function(M){return Array.isArray(M)?M.map(function(z){return typeof z=="string"?parseFloat(z):z}):typeof M=="string"?parseFloat(M):M});h[_][E]=A})}),o.numericRefinements=h}return C_({},i,o)};nn.make=function(o){var l=new nn(o),h=o.hierarchicalFacets||[];return h.forEach(function(_){if(_.rootPath){var x=l.getHierarchicalRefinement(_.name);x.length>0&&x[0].indexOf(_.rootPath)!==0&&(l=l.clearRefinements(_.name)),x=l.getHierarchicalRefinement(_.name),x.length===0&&(l=l.toggleHierarchicalFacetRefinement(_.name,_.rootPath))}}),l};nn.validate=function(i,o){var l=o||{};return i.tagFilters&&l.tagRefinements&&l.tagRefinements.length>0?new Error("[Tags] Cannot switch from the managed tag API to the advanced API. It is probably an error, if it is really what you want, you should first clear the tags with clearTags method."):i.tagRefinements.length>0&&l.tagFilters?new Error("[Tags] Cannot switch from the advanced tag API to the managed API. It is probably an error, if it is not, you should first clear the tags with clearTags method."):i.numericFilters&&l.numericRefinements&&k_(l.numericRefinements)?new Error("[Numeric filters] Can't switch from the advanced to the managed API. It is probably an error, if this is really what you want, you have to first clear the numeric filters."):k_(i.numericRefinements)&&l.numericFilters?new Error("[Numeric filters] Can't switch from the managed API to the advanced. It is probably an error, if this is really what you want, you have to first clear the numeric filters."):null};nn.prototype={constructor:nn,clearRefinements:function(o){var l={numericRefinements:this._clearNumericRefinements(o),facetsRefinements:Jr.clearRefinement(this.facetsRefinements,o,"conjunctiveFacet"),facetsExcludes:Jr.clearRefinement(this.facetsExcludes,o,"exclude"),disjunctiveFacetsRefinements:Jr.clearRefinement(this.disjunctiveFacetsRefinements,o,"disjunctiveFacet"),hierarchicalFacetsRefinements:Jr.clearRefinement(this.hierarchicalFacetsRefinements,o,"hierarchicalFacet")};return l.numericRefinements===this.numericRefinements&&l.facetsRefinements===this.facetsRefinements&&l.facetsExcludes===this.facetsExcludes&&l.disjunctiveFacetsRefinements===this.disjunctiveFacetsRefinements&&l.hierarchicalFacetsRefinements===this.hierarchicalFacetsRefinements?this:this.setQueryParameters(l)},clearTags:function(){return this.tagFilters===void 0&&this.tagRefinements.length===0?this:this.setQueryParameters({tagFilters:void 0,tagRefinements:[]})},setIndex:function(o){return o===this.index?this:this.setQueryParameters({index:o})},setQuery:function(o){return o===this.query?this:this.setQueryParameters({query:o})},setPage:function(o){return o===this.page?this:this.setQueryParameters({page:o})},setFacets:function(o){return this.setQueryParameters({facets:o})},setDisjunctiveFacets:function(o){return this.setQueryParameters({disjunctiveFacets:o})},setHitsPerPage:function(o){return this.hitsPerPage===o?this:this.setQueryParameters({hitsPerPage:o})},setTypoTolerance:function(o){return this.typoTolerance===o?this:this.setQueryParameters({typoTolerance:o})},addNumericRefinement:function(i,o,l){var h=R_(l);if(this.isNumericRefined(i,o,h))return this;var _=C_({},this.numericRefinements);return _[i]=C_({},_[i]),_[i][o]?(_[i][o]=_[i][o].slice(),_[i][o].push(h)):_[i][o]=[h],this.setQueryParameters({numericRefinements:_})},getConjunctiveRefinements:function(i){return this.isConjunctiveFacet(i)?this.facetsRefinements[i]||[]:[]},getDisjunctiveRefinements:function(i){return this.isDisjunctiveFacet(i)?this.disjunctiveFacetsRefinements[i]||[]:[]},getHierarchicalRefinement:function(i){return this.hierarchicalFacetsRefinements[i]||[]},getExcludeRefinements:function(i){return this.isConjunctiveFacet(i)?this.facetsExcludes[i]||[]:[]},removeNumericRefinement:function(i,o,l){return l!==void 0?this.isNumericRefined(i,o,l)?this.setQueryParameters({numericRefinements:this._clearNumericRefinements(function(h,_){return _===i&&h.op===o&&D_(h.val,R_(l))})}):this:o!==void 0?this.isNumericRefined(i,o)?this.setQueryParameters({numericRefinements:this._clearNumericRefinements(function(h,_){return _===i&&h.op===o})}):this:this.isNumericRefined(i)?this.setQueryParameters({numericRefinements:this._clearNumericRefinements(function(h,_){return _===i})}):this},getNumericRefinements:function(i){return this.numericRefinements[i]||{}},getNumericRefinement:function(i,o){return this.numericRefinements[i]&&this.numericRefinements[i][o]},_clearNumericRefinements:function(o){if(o===void 0)return k_(this.numericRefinements)?{}:this.numericRefinements;if(typeof o=="string")return Px(this.numericRefinements,[o]);if(typeof o=="function"){var l=!1,h=this.numericRefinements,_=Object.keys(h).reduce(function(x,E){var s=h[E],A={};return s=s||{},Object.keys(s).forEach(function(M){var z=s[M]||[],L=[];z.forEach(function(F){var j=o({val:F,op:M},E,"numeric");j||L.push(F)}),L.length!==z.length&&(l=!0),A[M]=L}),x[E]=A,x},{});return l?_:this.numericRefinements}},addFacet:function(o){return this.isConjunctiveFacet(o)?this:this.setQueryParameters({facets:this.facets.concat([o])})},addDisjunctiveFacet:function(o){return this.isDisjunctiveFacet(o)?this:this.setQueryParameters({disjunctiveFacets:this.disjunctiveFacets.concat([o])})},addHierarchicalFacet:function(o){if(this.isHierarchicalFacet(o.name))throw new Error("Cannot declare two hierarchical facets with the same name: `"+o.name+"`");return this.setQueryParameters({hierarchicalFacets:this.hierarchicalFacets.concat([o])})},addFacetRefinement:function(o,l){if(!this.isConjunctiveFacet(o))throw new Error(o+" is not defined in the facets attribute of the helper configuration");return Jr.isRefined(this.facetsRefinements,o,l)?this:this.setQueryParameters({facetsRefinements:Jr.addRefinement(this.facetsRefinements,o,l)})},addExcludeRefinement:function(o,l){if(!this.isConjunctiveFacet(o))throw new Error(o+" is not defined in the facets attribute of the helper configuration");return Jr.isRefined(this.facetsExcludes,o,l)?this:this.setQueryParameters({facetsExcludes:Jr.addRefinement(this.facetsExcludes,o,l)})},addDisjunctiveFacetRefinement:function(o,l){if(!this.isDisjunctiveFacet(o))throw new Error(o+" is not defined in the disjunctiveFacets attribute of the helper configuration");return Jr.isRefined(this.disjunctiveFacetsRefinements,o,l)?this:this.setQueryParameters({disjunctiveFacetsRefinements:Jr.addRefinement(this.disjunctiveFacetsRefinements,o,l)})},addTagRefinement:function(o){if(this.isTagRefined(o))return this;var l={tagRefinements:this.tagRefinements.concat(o)};return this.setQueryParameters(l)},removeFacet:function(o){return this.isConjunctiveFacet(o)?this.clearRefinements(o).setQueryParameters({facets:this.facets.filter(function(l){return l!==o})}):this},removeDisjunctiveFacet:function(o){return this.isDisjunctiveFacet(o)?this.clearRefinements(o).setQueryParameters({disjunctiveFacets:this.disjunctiveFacets.filter(function(l){return l!==o})}):this},removeHierarchicalFacet:function(o){return this.isHierarchicalFacet(o)?this.clearRefinements(o).setQueryParameters({hierarchicalFacets:this.hierarchicalFacets.filter(function(l){return l.name!==o})}):this},removeFacetRefinement:function(o,l){if(!this.isConjunctiveFacet(o))throw new Error(o+" is not defined in the facets attribute of the helper configuration");return Jr.isRefined(this.facetsRefinements,o,l)?this.setQueryParameters({facetsRefinements:Jr.removeRefinement(this.facetsRefinements,o,l)}):this},removeExcludeRefinement:function(o,l){if(!this.isConjunctiveFacet(o))throw new Error(o+" is not defined in the facets attribute of the helper configuration");return Jr.isRefined(this.facetsExcludes,o,l)?this.setQueryParameters({facetsExcludes:Jr.removeRefinement(this.facetsExcludes,o,l)}):this},removeDisjunctiveFacetRefinement:function(o,l){if(!this.isDisjunctiveFacet(o))throw new Error(o+" is not defined in the disjunctiveFacets attribute of the helper configuration");return Jr.isRefined(this.disjunctiveFacetsRefinements,o,l)?this.setQueryParameters({disjunctiveFacetsRefinements:Jr.removeRefinement(this.disjunctiveFacetsRefinements,o,l)}):this},removeTagRefinement:function(o){if(!this.isTagRefined(o))return this;var l={tagRefinements:this.tagRefinements.filter(function(h){return h!==o})};return this.setQueryParameters(l)},toggleRefinement:function(o,l){return this.toggleFacetRefinement(o,l)},toggleFacetRefinement:function(o,l){if(this.isHierarchicalFacet(o))return this.toggleHierarchicalFacetRefinement(o,l);if(this.isConjunctiveFacet(o))return this.toggleConjunctiveFacetRefinement(o,l);if(this.isDisjunctiveFacet(o))return this.toggleDisjunctiveFacetRefinement(o,l);throw new Error("Cannot refine the undeclared facet "+o+"; it should be added to the helper options facets, disjunctiveFacets or hierarchicalFacets")},toggleConjunctiveFacetRefinement:function(o,l){if(!this.isConjunctiveFacet(o))throw new Error(o+" is not defined in the facets attribute of the helper configuration");return this.setQueryParameters({facetsRefinements:Jr.toggleRefinement(this.facetsRefinements,o,l)})},toggleExcludeFacetRefinement:function(o,l){if(!this.isConjunctiveFacet(o))throw new Error(o+" is not defined in the facets attribute of the helper configuration");return this.setQueryParameters({facetsExcludes:Jr.toggleRefinement(this.facetsExcludes,o,l)})},toggleDisjunctiveFacetRefinement:function(o,l){if(!this.isDisjunctiveFacet(o))throw new Error(o+" is not defined in the disjunctiveFacets attribute of the helper configuration");return this.setQueryParameters({disjunctiveFacetsRefinements:Jr.toggleRefinement(this.disjunctiveFacetsRefinements,o,l)})},toggleHierarchicalFacetRefinement:function(o,l){if(!this.isHierarchicalFacet(o))throw new Error(o+" is not defined in the hierarchicalFacets attribute of the helper configuration");var h=this._getHierarchicalFacetSeparator(this.getHierarchicalFacetByName(o)),_={},x=this.hierarchicalFacetsRefinements[o]!==void 0&&this.hierarchicalFacetsRefinements[o].length>0&&(this.hierarchicalFacetsRefinements[o][0]===l||this.hierarchicalFacetsRefinements[o][0].indexOf(l+h)===0);return x?l.indexOf(h)===-1?_[o]=[]:_[o]=[l.slice(0,l.lastIndexOf(h))]:_[o]=[l],this.setQueryParameters({hierarchicalFacetsRefinements:z_({},_,this.hierarchicalFacetsRefinements)})},addHierarchicalFacetRefinement:function(i,o){if(this.isHierarchicalFacetRefined(i))throw new Error(i+" is already refined.");if(!this.isHierarchicalFacet(i))throw new Error(i+" is not defined in the hierarchicalFacets attribute of the helper configuration.");var l={};return l[i]=[o],this.setQueryParameters({hierarchicalFacetsRefinements:z_({},l,this.hierarchicalFacetsRefinements)})},removeHierarchicalFacetRefinement:function(i){if(!this.isHierarchicalFacetRefined(i))return this;var o={};return o[i]=[],this.setQueryParameters({hierarchicalFacetsRefinements:z_({},o,this.hierarchicalFacetsRefinements)})},toggleTagRefinement:function(o){return this.isTagRefined(o)?this.removeTagRefinement(o):this.addTagRefinement(o)},isDisjunctiveFacet:function(i){return this.disjunctiveFacets.indexOf(i)>-1},isHierarchicalFacet:function(i){return this.getHierarchicalFacetByName(i)!==void 0},isConjunctiveFacet:function(i){return this.facets.indexOf(i)>-1},isFacetRefined:function(o,l){return this.isConjunctiveFacet(o)?Jr.isRefined(this.facetsRefinements,o,l):!1},isExcludeRefined:function(o,l){return this.isConjunctiveFacet(o)?Jr.isRefined(this.facetsExcludes,o,l):!1},isDisjunctiveFacetRefined:function(o,l){return this.isDisjunctiveFacet(o)?Jr.isRefined(this.disjunctiveFacetsRefinements,o,l):!1},isHierarchicalFacetRefined:function(o,l){if(!this.isHierarchicalFacet(o))return!1;var h=this.getHierarchicalRefinement(o);return l?h.indexOf(l)!==-1:h.length>0},isNumericRefined:function(o,l,h){if(h===void 0&&l===void 0)return!!this.numericRefinements[o];var _=this.numericRefinements[o]&&this.numericRefinements[o][l]!==void 0;if(h===void 0||!_)return _;var x=R_(h),E=NI(this.numericRefinements[o][l],x)!==void 0;return _&&E},isTagRefined:function(o){return this.tagRefinements.indexOf(o)!==-1},getRefinedDisjunctiveFacets:function(){var o=this,l=Sx(Object.keys(this.numericRefinements).filter(function(h){return Object.keys(o.numericRefinements[h]).length>0}),this.disjunctiveFacets);return Object.keys(this.disjunctiveFacetsRefinements).filter(function(h){return o.disjunctiveFacetsRefinements[h].length>0}).concat(l).concat(this.getRefinedHierarchicalFacets())},getRefinedHierarchicalFacets:function(){var o=this;return Sx(this.hierarchicalFacets.map(function(l){return l.name}),Object.keys(this.hierarchicalFacetsRefinements).filter(function(l){return o.hierarchicalFacetsRefinements[l].length>0}))},getUnrefinedDisjunctiveFacets:function(){var i=this.getRefinedDisjunctiveFacets();return this.disjunctiveFacets.filter(function(o){return i.indexOf(o)===-1})},managedParameters:["index","facets","disjunctiveFacets","facetsRefinements","hierarchicalFacets","facetsExcludes","disjunctiveFacetsRefinements","numericRefinements","tagRefinements","hierarchicalFacetsRefinements"],getQueryParams:function(){var o=this.managedParameters,l={},h=this;return Object.keys(this).forEach(function(_){var x=h[_];o.indexOf(_)===-1&&x!==void 0&&(l[_]=x)}),l},setQueryParameter:function(o,l){if(this[o]===l)return this;var h={};return h[o]=l,this.setQueryParameters(h)},setQueryParameters:function(o){if(!o)return this;var l=nn.validate(this,o);if(l)throw l;var h=this,_=nn._parseNumbers(o),x=Object.keys(this).reduce(function(s,A){return s[A]=h[A],s},{}),E=Object.keys(_).reduce(function(s,A){var M=s[A]!==void 0,z=_[A]!==void 0;return M&&!z?Px(s,[A]):(z&&(s[A]=_[A]),s)},x);return new this.constructor(E)},resetPage:function(){return this.page===void 0?this:this.setPage(0)},_getHierarchicalFacetSortBy:function(i){return i.sortBy||["isRefined:desc","name:asc"]},_getHierarchicalFacetSeparator:function(i){return i.separator||" > "},_getHierarchicalRootPath:function(i){return i.rootPath||null},_getHierarchicalShowParentLevel:function(i){return typeof i.showParentLevel=="boolean"?i.showParentLevel:!0},getHierarchicalFacetByName:function(i){return Ax(this.hierarchicalFacets,function(o){return o.name===i})},getHierarchicalFacetBreadcrumb:function(i){if(!this.isHierarchicalFacet(i))return[];var o=this.getHierarchicalRefinement(i)[0];if(!o)return[];var l=this._getHierarchicalFacetSeparator(this.getHierarchicalFacetByName(i)),h=o.split(l);return h.map(function(_){return _.trim()})},toString:function(){return JSON.stringify(this,null,2)}};var Ix=nn;function UI(i,o){if(i!==o){var l=i!==void 0,h=i===null,_=o!==void 0,x=o===null;if(!x&&i>o||h&&_||!l)return 1;if(!h&&i<o||x&&l||!_)return-1}return 0}function VI(i,o,l){if(!Array.isArray(i))return[];Array.isArray(l)||(l=[]);var h=i.map(function(_,x){return{criteria:o.map(function(E){return _[E]}),index:x,value:_}});return h.sort(function(x,E){for(var s=-1;++s<x.criteria.length;){var A=UI(x.criteria[s],E.criteria[s]);if(A)return s>=l.length?A:l[s]==="desc"?-A:A}return x.index-E.index}),h.map(function(_){return _.value})}var Mx=VI,$I=function(o){return Array.isArray(o)?o.filter(Boolean):[]},GI=function(o,l){if(!Array.isArray(o))return-1;for(var h=0;h<o.length;h++)if(l(o[h]))return h;return-1},qI=Ad,Cx=function(o,l){var h=(l||[]).map(function(_){return _.split(":")});return o.reduce(function(x,E){var s=E.split(":"),A=qI(h,function(M){return M[0]===s[0]});return s.length>1||!A?(x[0].push(s[0]),x[1].push(s[1]),x):(x[0].push(A[0]),x[1].push(A[1]),x)},[[],[]])};function ZI(i){return typeof i!="string"?i:String(i).replace(/^-/,"\\-")}function HI(i){return typeof i!="string"?i:i.replace(/^\\-/,"-")}var O_={escapeFacetValue:ZI,unescapeFacetValue:HI},WI=eM,XI=Mx,QI=Ad,YI=Cx,zx=O_,KI=zx.escapeFacetValue,JI=zx.unescapeFacetValue;function eM(i){return function(l,h){var _=i.hierarchicalFacets[h],x=i.hierarchicalFacetsRefinements[_.name]&&i.hierarchicalFacetsRefinements[_.name][0]||"",E=i._getHierarchicalFacetSeparator(_),s=i._getHierarchicalRootPath(_),A=i._getHierarchicalShowParentLevel(_),M=YI(i._getHierarchicalFacetSortBy(_)),z=l.every(function(j){return j.exhaustive}),L=tM(M,E,s,A,x),F=l;return s&&(F=l.slice(s.split(E).length)),F.reduce(L,{name:i.hierarchicalFacets[h].name,count:null,isRefined:!0,path:null,escapedValue:null,exhaustive:z,data:null})}}function tM(i,o,l,h,_){return function(E,s,A){var M=E;if(A>0){var z=0;for(M=E;z<A;){var L=M&&Array.isArray(M.data)?M.data:[];M=QI(L,function(j){return j.isRefined}),z++}}if(M){var F=Object.keys(s.data).map(function(j){return[j,s.data[j]]}).filter(function(j){var H=j[0];return rM(H,M.path||l,_,o,l,h)});M.data=XI(F.map(function(j){var H=j[0],W=j[1];return iM(W,H,o,JI(_),s.exhaustive)}),i[0],i[1])}return E}}function rM(i,o,l,h,_,x){return _&&(i.indexOf(_)!==0||_===i)?!1:!_&&i.indexOf(h)===-1||_&&i.split(h).length-_.split(h).length==1||i.indexOf(h)===-1&&l.indexOf(h)===-1||l.indexOf(i)===0||i.indexOf(o+h)===0&&(x||i.indexOf(l)===0)}function iM(i,o,l,h,_){var x=o.split(l);return{name:x[x.length-1].trim(),path:o,escapedValue:KI(o),count:i,isRefined:h===o||h.indexOf(o+l)===0,exhaustive:_,data:null}}var nM=Sd,Pd=P_,Rx=Mx,L_=$I,jn=Ad,qu=GI,oM=Cx,kx=O_,Dx=kx.escapeFacetValue,sM=kx.unescapeFacetValue,aM=WI;function Ox(i){var o={};return i.forEach(function(l,h){o[l]=h}),o}function F_(i,o,l){o&&o[l]&&(i.stats=o[l])}function lM(i,o){return jn(i,function(h){var _=h.attributes||[];return _.indexOf(o)>-1})}function vs(i,o,l){var h=o[0];this._rawResults=o;var _=this;Object.keys(h).forEach(function(z){_[z]=h[z]}),Object.keys(l||{}).forEach(function(z){_[z]=l[z]}),this.processingTimeMS=o.reduce(function(z,L){return L.processingTimeMS===void 0?z:z+L.processingTimeMS},0),this.disjunctiveFacets=[],this.hierarchicalFacets=i.hierarchicalFacets.map(function(){return[]}),this.facets=[];var x=i.getRefinedDisjunctiveFacets(),E=Ox(i.facets),s=Ox(i.disjunctiveFacets),A=1,M=h.facets||{};Object.keys(M).forEach(function(z){var L=M[z],F=lM(i.hierarchicalFacets,z);if(F){var j=F.attributes.indexOf(z),H=qu(i.hierarchicalFacets,function(Ce){return Ce.name===F.name});_.hierarchicalFacets[H][j]={attribute:z,data:L,exhaustive:h.exhaustiveFacetsCount}}else{var W=i.disjunctiveFacets.indexOf(z)!==-1,he=i.facets.indexOf(z)!==-1,ve;W&&(ve=s[z],_.disjunctiveFacets[ve]={name:z,data:L,exhaustive:h.exhaustiveFacetsCount},F_(_.disjunctiveFacets[ve],h.facets_stats,z)),he&&(ve=E[z],_.facets[ve]={name:z,data:L,exhaustive:h.exhaustiveFacetsCount},F_(_.facets[ve],h.facets_stats,z))}}),this.hierarchicalFacets=L_(this.hierarchicalFacets),x.forEach(function(z){var L=o[A],F=L&&L.facets?L.facets:{},j=i.getHierarchicalFacetByName(z);Object.keys(F).forEach(function(H){var W=F[H],he;if(j){he=qu(i.hierarchicalFacets,function(De){return De.name===j.name});var ve=qu(_.hierarchicalFacets[he],function(De){return De.attribute===H});if(ve===-1)return;_.hierarchicalFacets[he][ve].data=nM({},_.hierarchicalFacets[he][ve].data,W)}else{he=s[H];var Ce=h.facets&&h.facets[H]||{};_.disjunctiveFacets[he]={name:H,data:Pd({},W,Ce),exhaustive:L.exhaustiveFacetsCount},F_(_.disjunctiveFacets[he],L.facets_stats,H),i.disjunctiveFacetsRefinements[H]&&i.disjunctiveFacetsRefinements[H].forEach(function(De){!_.disjunctiveFacets[he].data[De]&&i.disjunctiveFacetsRefinements[H].indexOf(sM(De))>-1&&(_.disjunctiveFacets[he].data[De]=0)})}}),A++}),i.getRefinedHierarchicalFacets().forEach(function(z){var L=i.getHierarchicalFacetByName(z),F=i._getHierarchicalFacetSeparator(L),j=i.getHierarchicalRefinement(z);j.length===0||j[0].split(F).length<2||o.slice(A).forEach(function(H){var W=H&&H.facets?H.facets:{};Object.keys(W).forEach(function(he){var ve=W[he],Ce=qu(i.hierarchicalFacets,function(We){return We.name===L.name}),De=qu(_.hierarchicalFacets[Ce],function(We){return We.attribute===he});if(De!==-1){var Se={};if(j.length>0){var Ie=j[0].split(F)[0];Se[Ie]=_.hierarchicalFacets[Ce][De].data[Ie]}_.hierarchicalFacets[Ce][De].data=Pd(Se,ve,_.hierarchicalFacets[Ce][De].data)}}),A++})}),Object.keys(i.facetsExcludes).forEach(function(z){var L=i.facetsExcludes[z],F=E[z];_.facets[F]={name:z,data:h.facets[z],exhaustive:h.exhaustiveFacetsCount},L.forEach(function(j){_.facets[F]=_.facets[F]||{name:z},_.facets[F].data=_.facets[F].data||{},_.facets[F].data[j]=0})}),this.hierarchicalFacets=this.hierarchicalFacets.map(aM(i)),this.facets=L_(this.facets),this.disjunctiveFacets=L_(this.disjunctiveFacets),this._state=i}vs.prototype.getFacetByName=function(i){function o(l){return l.name===i}return jn(this.facets,o)||jn(this.disjunctiveFacets,o)||jn(this.hierarchicalFacets,o)};function cM(i,o){function l(x){return x.name===o}if(i._state.isConjunctiveFacet(o)){var h=jn(i.facets,l);return h?Object.keys(h.data).map(function(x){var E=Dx(x);return{name:x,escapedValue:E,count:h.data[x],isRefined:i._state.isFacetRefined(o,E),isExcluded:i._state.isExcludeRefined(o,x)}}):[]}else if(i._state.isDisjunctiveFacet(o)){var _=jn(i.disjunctiveFacets,l);return _?Object.keys(_.data).map(function(x){var E=Dx(x);return{name:x,escapedValue:E,count:_.data[x],isRefined:i._state.isDisjunctiveFacetRefined(o,E)}}):[]}else if(i._state.isHierarchicalFacet(o))return jn(i.hierarchicalFacets,l)}function Lx(i,o,l,h){if(h=h||0,Array.isArray(o))return i(o,l[h]);if(!o.data||o.data.length===0)return o;var _=o.data.map(function(s){return Lx(i,s,l,h+1)}),x=i(_,l[h]),E=Pd({data:x},o);return E}vs.DEFAULT_SORT=["isRefined:desc","count:desc","name:asc"];function uM(i,o){return o.sort(i)}function hM(i,o){var l=[],h=[],_=o.order||[],x=_.reduce(function(A,M,z){return A[M]=z,A},{});i.forEach(function(A){var M=A.path||A.name;x[M]!==void 0?l[x[M]]=A:h.push(A)}),l=l.filter(function(A){return A});var E=o.sortRemainingBy,s;return E==="hidden"?l:(E==="alpha"?s=[["path","name"],["asc","asc"]]:s=[["count"],["desc"]],l.concat(Rx(h,s[0],s[1])))}function fM(i,o){return i.renderingContent&&i.renderingContent.facetOrdering&&i.renderingContent.facetOrdering.values&&i.renderingContent.facetOrdering.values[o]}vs.prototype.getFacetValues=function(i,o){var l=cM(this,i);if(!!l){var h=Pd({},o,{sortBy:vs.DEFAULT_SORT,facetOrdering:!(o&&o.sortBy)}),_=this,x;if(Array.isArray(l))x=[i];else{var E=_._state.getHierarchicalFacetByName(l.name);x=E.attributes}return Lx(function(s,A){if(h.facetOrdering){var M=fM(_,A);if(Boolean(M))return hM(s,M)}if(Array.isArray(h.sortBy)){var z=oM(h.sortBy,vs.DEFAULT_SORT);return Rx(s,z[0],z[1])}else if(typeof h.sortBy=="function")return uM(h.sortBy,s);throw new Error("options.sortBy is optional but if defined it must be either an array of string (predicates) or a sorting function")},l,x)}};vs.prototype.getFacetStats=function(i){if(this._state.isConjunctiveFacet(i))return Fx(this.facets,i);if(this._state.isDisjunctiveFacet(i))return Fx(this.disjunctiveFacets,i)};function Fx(i,o){var l=jn(i,function(h){return h.name===o});return l&&l.stats}vs.prototype.getRefinements=function(){var i=this._state,o=this,l=[];return Object.keys(i.facetsRefinements).forEach(function(h){i.facetsRefinements[h].forEach(function(_){l.push(B_(i,"facet",h,_,o.facets))})}),Object.keys(i.facetsExcludes).forEach(function(h){i.facetsExcludes[h].forEach(function(_){l.push(B_(i,"exclude",h,_,o.facets))})}),Object.keys(i.disjunctiveFacetsRefinements).forEach(function(h){i.disjunctiveFacetsRefinements[h].forEach(function(_){l.push(B_(i,"disjunctive",h,_,o.disjunctiveFacets))})}),Object.keys(i.hierarchicalFacetsRefinements).forEach(function(h){i.hierarchicalFacetsRefinements[h].forEach(function(_){l.push(dM(i,h,_,o.hierarchicalFacets))})}),Object.keys(i.numericRefinements).forEach(function(h){var _=i.numericRefinements[h];Object.keys(_).forEach(function(x){_[x].forEach(function(E){l.push({type:"numeric",attributeName:h,name:E,numericValue:E,operator:x})})})}),i.tagRefinements.forEach(function(h){l.push({type:"tag",attributeName:"_tags",name:h})}),l};function B_(i,o,l,h,_){var x=jn(_,function(A){return A.name===l}),E=x&&x.data&&x.data[h]?x.data[h]:0,s=x&&x.exhaustive||!1;return{type:o,attributeName:l,name:h,count:E,exhaustive:s}}function dM(i,o,l,h){var _=i.getHierarchicalFacetByName(o),x=i._getHierarchicalFacetSeparator(_),E=l.split(x),s=jn(h,function(F){return F.name===o}),A=E.reduce(function(F,j){var H=F&&jn(F.data,function(W){return W.name===j});return H!==void 0?H:F},s),M=A&&A.count||0,z=A&&A.exhaustive||!1,L=A&&A.path||"";return{type:"hierarchical",attributeName:o,name:L,count:M,exhaustive:z}}var Bx=vs;function ji(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}var j_=ji;ji.prototype._events=void 0;ji.prototype._maxListeners=void 0;ji.defaultMaxListeners=10;ji.prototype.setMaxListeners=function(i){if(!pM(i)||i<0||isNaN(i))throw TypeError("n must be a positive number");return this._maxListeners=i,this};ji.prototype.emit=function(i){var o,l,h,_,x,E;if(this._events||(this._events={}),i==="error"&&(!this._events.error||Zu(this._events.error)&&!this._events.error.length)){if(o=arguments[1],o instanceof Error)throw o;var s=new Error('Uncaught, unspecified "error" event. ('+o+")");throw s.context=o,s}if(l=this._events[i],jx(l))return!1;if(Fo(l))switch(arguments.length){case 1:l.call(this);break;case 2:l.call(this,arguments[1]);break;case 3:l.call(this,arguments[1],arguments[2]);break;default:_=Array.prototype.slice.call(arguments,1),l.apply(this,_)}else if(Zu(l))for(_=Array.prototype.slice.call(arguments,1),E=l.slice(),h=E.length,x=0;x<h;x++)E[x].apply(this,_);return!0};ji.prototype.addListener=function(i,o){var l;if(!Fo(o))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",i,Fo(o.listener)?o.listener:o),this._events[i]?Zu(this._events[i])?this._events[i].push(o):this._events[i]=[this._events[i],o]:this._events[i]=o,Zu(this._events[i])&&!this._events[i].warned&&(jx(this._maxListeners)?l=ji.defaultMaxListeners:l=this._maxListeners,l&&l>0&&this._events[i].length>l&&(this._events[i].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[i].length),typeof console.trace=="function"&&console.trace())),this};ji.prototype.on=ji.prototype.addListener;ji.prototype.once=function(i,o){if(!Fo(o))throw TypeError("listener must be a function");var l=!1;function h(){this.removeListener(i,h),l||(l=!0,o.apply(this,arguments))}return h.listener=o,this.on(i,h),this};ji.prototype.removeListener=function(i,o){var l,h,_,x;if(!Fo(o))throw TypeError("listener must be a function");if(!this._events||!this._events[i])return this;if(l=this._events[i],_=l.length,h=-1,l===o||Fo(l.listener)&&l.listener===o)delete this._events[i],this._events.removeListener&&this.emit("removeListener",i,o);else if(Zu(l)){for(x=_;x-- >0;)if(l[x]===o||l[x].listener&&l[x].listener===o){h=x;break}if(h<0)return this;l.length===1?(l.length=0,delete this._events[i]):l.splice(h,1),this._events.removeListener&&this.emit("removeListener",i,o)}return this};ji.prototype.removeAllListeners=function(i){var o,l;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[i]&&delete this._events[i],this;if(arguments.length===0){for(o in this._events)o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events={},this}if(l=this._events[i],Fo(l))this.removeListener(i,l);else if(l)for(;l.length;)this.removeListener(i,l[l.length-1]);return delete this._events[i],this};ji.prototype.listeners=function(i){var o;return!this._events||!this._events[i]?o=[]:Fo(this._events[i])?o=[this._events[i]]:o=this._events[i].slice(),o};ji.prototype.listenerCount=function(i){if(this._events){var o=this._events[i];if(Fo(o))return 1;if(o)return o.length}return 0};ji.listenerCount=function(i,o){return i.listenerCount(o)};function Fo(i){return typeof i=="function"}function pM(i){return typeof i=="number"}function Zu(i){return typeof i=="object"&&i!==null}function jx(i){return i===void 0}function mM(i,o){i.prototype=Object.create(o.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}})}var Nx=mM,_M=j_,gM=Nx;function Id(i,o){this.main=i,this.fn=o,this.lastResults=null}gM(Id,_M);Id.prototype.detach=function(){this.removeAllListeners(),this.main.detachDerivedHelper(this)};Id.prototype.getModifiedState=function(i){return this.fn(i)};var yM=Id,N_=Sd;function U_(i){return Object.keys(i).sort(function(o,l){return o.localeCompare(l)}).reduce(function(o,l){return o[l]=i[l],o},{})}var _n={_getQueries:function(o,l){var h=[];return h.push({indexName:o,params:_n._getHitsSearchParams(l)}),l.getRefinedDisjunctiveFacets().forEach(function(_){h.push({indexName:o,params:_n._getDisjunctiveFacetSearchParams(l,_)})}),l.getRefinedHierarchicalFacets().forEach(function(_){var x=l.getHierarchicalFacetByName(_),E=l.getHierarchicalRefinement(_),s=l._getHierarchicalFacetSeparator(x);if(E.length>0&&E[0].split(s).length>1){var A=E[0].split(s).slice(0,-1).reduce(function(z,L,F){return z.concat({attribute:x.attributes[F],value:F===0?L:[z[z.length-1].value,L].join(s)})},[]);A.forEach(function(M,z){var L=_n._getDisjunctiveFacetSearchParams(l,M.attribute,z===0);function F(W){return x.attributes.some(function(he){return he===W.split(":")[0]})}var j=(L.facetFilters||[]).reduce(function(W,he){if(Array.isArray(he)){var ve=he.filter(function(Ce){return!F(Ce)});ve.length>0&&W.push(ve)}return typeof he=="string"&&!F(he)&&W.push(he),W},[]),H=A[z-1];z>0?L.facetFilters=j.concat(H.attribute+":"+H.value):L.facetFilters=j.length>0?j:void 0,h.push({indexName:o,params:L})})}}),h},_getHitsSearchParams:function(i){var o=i.facets.concat(i.disjunctiveFacets).concat(_n._getHitsHierarchicalFacetsAttributes(i)),l=_n._getFacetFilters(i),h=_n._getNumericFilters(i),_=_n._getTagFilters(i),x={facets:o.indexOf("*")>-1?["*"]:o,tagFilters:_};return l.length>0&&(x.facetFilters=l),h.length>0&&(x.numericFilters=h),U_(N_({},i.getQueryParams(),x))},_getDisjunctiveFacetSearchParams:function(i,o,l){var h=_n._getFacetFilters(i,o,l),_=_n._getNumericFilters(i,o),x=_n._getTagFilters(i),E={hitsPerPage:0,page:0,analytics:!1,clickAnalytics:!1};x.length>0&&(E.tagFilters=x);var s=i.getHierarchicalFacetByName(o);return s?E.facets=_n._getDisjunctiveHierarchicalFacetAttribute(i,s,l):E.facets=o,_.length>0&&(E.numericFilters=_),h.length>0&&(E.facetFilters=h),U_(N_({},i.getQueryParams(),E))},_getNumericFilters:function(i,o){if(i.numericFilters)return i.numericFilters;var l=[];return Object.keys(i.numericRefinements).forEach(function(h){var _=i.numericRefinements[h]||{};Object.keys(_).forEach(function(x){var E=_[x]||[];o!==h&&E.forEach(function(s){if(Array.isArray(s)){var A=s.map(function(M){return h+x+M});l.push(A)}else l.push(h+x+s)})})}),l},_getTagFilters:function(i){return i.tagFilters?i.tagFilters:i.tagRefinements.join(",")},_getFacetFilters:function(i,o,l){var h=[],_=i.facetsRefinements||{};Object.keys(_).forEach(function(A){var M=_[A]||[];M.forEach(function(z){h.push(A+":"+z)})});var x=i.facetsExcludes||{};Object.keys(x).forEach(function(A){var M=x[A]||[];M.forEach(function(z){h.push(A+":-"+z)})});var E=i.disjunctiveFacetsRefinements||{};Object.keys(E).forEach(function(A){var M=E[A]||[];if(!(A===o||!M||M.length===0)){var z=[];M.forEach(function(L){z.push(A+":"+L)}),h.push(z)}});var s=i.hierarchicalFacetsRefinements||{};return Object.keys(s).forEach(function(A){var M=s[A]||[],z=M[0];if(z!==void 0){var L=i.getHierarchicalFacetByName(A),F=i._getHierarchicalFacetSeparator(L),j=i._getHierarchicalRootPath(L),H,W;if(o===A){if(z.indexOf(F)===-1||!j&&l===!0||j&&j.split(F).length===z.split(F).length)return;j?(W=j.split(F).length-1,z=j):(W=z.split(F).length-2,z=z.slice(0,z.lastIndexOf(F))),H=L.attributes[W]}else W=z.split(F).length-1,H=L.attributes[W];H&&h.push([H+":"+z])}}),h},_getHitsHierarchicalFacetsAttributes:function(i){var o=[];return i.hierarchicalFacets.reduce(function(h,_){var x=i.getHierarchicalRefinement(_.name)[0];if(!x)return h.push(_.attributes[0]),h;var E=i._getHierarchicalFacetSeparator(_),s=x.split(E).length,A=_.attributes.slice(0,s+1);return h.concat(A)},o)},_getDisjunctiveHierarchicalFacetAttribute:function(i,o,l){var h=i._getHierarchicalFacetSeparator(o);if(l===!0){var _=i._getHierarchicalRootPath(o),x=0;return _&&(x=_.split(h).length),[o.attributes[x]]}var E=i.getHierarchicalRefinement(o.name)[0]||"",s=E.split(h).length-1;return o.attributes.slice(0,s+1)},getSearchForFacetQuery:function(i,o,l,h){var _=h.isDisjunctiveFacet(i)?h.clearRefinements(i):h,x={facetQuery:o,facetName:i};return typeof l=="number"&&(x.maxFacetHits=l),U_(N_({},_n._getHitsSearchParams(_),x))}},vM=_n,Ux="3.11.1",V_=Ix,$_=Bx,xM=yM,Xl=vM,bM=j_,wM=Nx,TM=M_,EM=I_,SM=Sd,Vx=Ux,AM=O_.escapeFacetValue;function bt(i,o,l){typeof i.addAlgoliaAgent=="function"&&i.addAlgoliaAgent("JS Helper ("+Vx+")"),this.setClient(i);var h=l||{};h.index=o,this.state=V_.make(h),this.lastResults=null,this._queryId=0,this._lastQueryIdReceived=-1,this.derivedHelpers=[],this._currentNbQueries=0}wM(bt,bM);bt.prototype.search=function(){return this._search({onlyWithDerivedHelpers:!1}),this};bt.prototype.searchOnlyWithDerivedHelpers=function(){return this._search({onlyWithDerivedHelpers:!0}),this};bt.prototype.getQuery=function(){var i=this.state;return Xl._getHitsSearchParams(i)};bt.prototype.searchOnce=function(i,o){var l=i?this.state.setQueryParameters(i):this.state,h=Xl._getQueries(l.index,l),_=this;if(this._currentNbQueries++,this.emit("searchOnce",{state:l}),o){this.client.search(h).then(function(x){_._currentNbQueries--,_._currentNbQueries===0&&_.emit("searchQueueEmpty"),o(null,new $_(l,x.results),l)}).catch(function(x){_._currentNbQueries--,_._currentNbQueries===0&&_.emit("searchQueueEmpty"),o(x,null,l)});return}return this.client.search(h).then(function(x){return _._currentNbQueries--,_._currentNbQueries===0&&_.emit("searchQueueEmpty"),{content:new $_(l,x.results),state:l,_originalResponse:x}},function(x){throw _._currentNbQueries--,_._currentNbQueries===0&&_.emit("searchQueueEmpty"),x})};bt.prototype.findAnswers=function(i){var o=this.state,l=this.derivedHelpers[0];if(!l)return Promise.resolve([]);var h=l.getModifiedState(o),_=SM({attributesForPrediction:i.attributesForPrediction,nbHits:i.nbHits},{params:EM(Xl._getHitsSearchParams(h),["attributesToSnippet","hitsPerPage","restrictSearchableAttributes","snippetEllipsisText"])}),x="search for answers was called, but this client does not have a function client.initIndex(index).findAnswers";if(typeof this.client.initIndex!="function")throw new Error(x);var E=this.client.initIndex(h.index);if(typeof E.findAnswers!="function")throw new Error(x);return E.findAnswers(h.query,i.queryLanguages,_)};bt.prototype.searchForFacetValues=function(i,o,l,h){var _=typeof this.client.searchForFacetValues=="function",x=typeof this.client.initIndex=="function";if(!_&&!x&&typeof this.client.search!="function")throw new Error("search for facet values (searchable) was called, but this client does not have a function client.searchForFacetValues or client.initIndex(index).searchForFacetValues");var E=this.state.setQueryParameters(h||{}),s=E.isDisjunctiveFacet(i),A=Xl.getSearchForFacetQuery(i,o,l,E);this._currentNbQueries++;var M=this,z;return _?z=this.client.searchForFacetValues([{indexName:E.index,params:A}]):x?z=this.client.initIndex(E.index).searchForFacetValues(A):(delete A.facetName,z=this.client.search([{type:"facet",facet:i,indexName:E.index,params:A}]).then(function(F){return F.results[0]})),this.emit("searchForFacetValues",{state:E,facet:i,query:o}),z.then(function(F){return M._currentNbQueries--,M._currentNbQueries===0&&M.emit("searchQueueEmpty"),F=Array.isArray(F)?F[0]:F,F.facetHits.forEach(function(j){j.escapedValue=AM(j.value),j.isRefined=s?E.isDisjunctiveFacetRefined(i,j.escapedValue):E.isFacetRefined(i,j.escapedValue)}),F},function(L){throw M._currentNbQueries--,M._currentNbQueries===0&&M.emit("searchQueueEmpty"),L})};bt.prototype.setQuery=function(i){return this._change({state:this.state.resetPage().setQuery(i),isPageReset:!0}),this};bt.prototype.clearRefinements=function(i){return this._change({state:this.state.resetPage().clearRefinements(i),isPageReset:!0}),this};bt.prototype.clearTags=function(){return this._change({state:this.state.resetPage().clearTags(),isPageReset:!0}),this};bt.prototype.addDisjunctiveFacetRefinement=function(i,o){return this._change({state:this.state.resetPage().addDisjunctiveFacetRefinement(i,o),isPageReset:!0}),this};bt.prototype.addDisjunctiveRefine=function(){return this.addDisjunctiveFacetRefinement.apply(this,arguments)};bt.prototype.addHierarchicalFacetRefinement=function(i,o){return this._change({state:this.state.resetPage().addHierarchicalFacetRefinement(i,o),isPageReset:!0}),this};bt.prototype.addNumericRefinement=function(i,o,l){return this._change({state:this.state.resetPage().addNumericRefinement(i,o,l),isPageReset:!0}),this};bt.prototype.addFacetRefinement=function(i,o){return this._change({state:this.state.resetPage().addFacetRefinement(i,o),isPageReset:!0}),this};bt.prototype.addRefine=function(){return this.addFacetRefinement.apply(this,arguments)};bt.prototype.addFacetExclusion=function(i,o){return this._change({state:this.state.resetPage().addExcludeRefinement(i,o),isPageReset:!0}),this};bt.prototype.addExclude=function(){return this.addFacetExclusion.apply(this,arguments)};bt.prototype.addTag=function(i){return this._change({state:this.state.resetPage().addTagRefinement(i),isPageReset:!0}),this};bt.prototype.removeNumericRefinement=function(i,o,l){return this._change({state:this.state.resetPage().removeNumericRefinement(i,o,l),isPageReset:!0}),this};bt.prototype.removeDisjunctiveFacetRefinement=function(i,o){return this._change({state:this.state.resetPage().removeDisjunctiveFacetRefinement(i,o),isPageReset:!0}),this};bt.prototype.removeDisjunctiveRefine=function(){return this.removeDisjunctiveFacetRefinement.apply(this,arguments)};bt.prototype.removeHierarchicalFacetRefinement=function(i){return this._change({state:this.state.resetPage().removeHierarchicalFacetRefinement(i),isPageReset:!0}),this};bt.prototype.removeFacetRefinement=function(i,o){return this._change({state:this.state.resetPage().removeFacetRefinement(i,o),isPageReset:!0}),this};bt.prototype.removeRefine=function(){return this.removeFacetRefinement.apply(this,arguments)};bt.prototype.removeFacetExclusion=function(i,o){return this._change({state:this.state.resetPage().removeExcludeRefinement(i,o),isPageReset:!0}),this};bt.prototype.removeExclude=function(){return this.removeFacetExclusion.apply(this,arguments)};bt.prototype.removeTag=function(i){return this._change({state:this.state.resetPage().removeTagRefinement(i),isPageReset:!0}),this};bt.prototype.toggleFacetExclusion=function(i,o){return this._change({state:this.state.resetPage().toggleExcludeFacetRefinement(i,o),isPageReset:!0}),this};bt.prototype.toggleExclude=function(){return this.toggleFacetExclusion.apply(this,arguments)};bt.prototype.toggleRefinement=function(i,o){return this.toggleFacetRefinement(i,o)};bt.prototype.toggleFacetRefinement=function(i,o){return this._change({state:this.state.resetPage().toggleFacetRefinement(i,o),isPageReset:!0}),this};bt.prototype.toggleRefine=function(){return this.toggleFacetRefinement.apply(this,arguments)};bt.prototype.toggleTag=function(i){return this._change({state:this.state.resetPage().toggleTagRefinement(i),isPageReset:!0}),this};bt.prototype.nextPage=function(){var i=this.state.page||0;return this.setPage(i+1)};bt.prototype.previousPage=function(){var i=this.state.page||0;return this.setPage(i-1)};function $x(i){if(i<0)throw new Error("Page requested below 0.");return this._change({state:this.state.setPage(i),isPageReset:!1}),this}bt.prototype.setCurrentPage=$x;bt.prototype.setPage=$x;bt.prototype.setIndex=function(i){return this._change({state:this.state.resetPage().setIndex(i),isPageReset:!0}),this};bt.prototype.setQueryParameter=function(i,o){return this._change({state:this.state.resetPage().setQueryParameter(i,o),isPageReset:!0}),this};bt.prototype.setState=function(i){return this._change({state:V_.make(i),isPageReset:!1}),this};bt.prototype.overrideStateWithoutTriggeringChangeEvent=function(i){return this.state=new V_(i),this};bt.prototype.hasRefinements=function(i){return TM(this.state.getNumericRefinements(i))?!0:this.state.isConjunctiveFacet(i)?this.state.isFacetRefined(i):this.state.isDisjunctiveFacet(i)?this.state.isDisjunctiveFacetRefined(i):this.state.isHierarchicalFacet(i)?this.state.isHierarchicalFacetRefined(i):!1};bt.prototype.isExcluded=function(i,o){return this.state.isExcludeRefined(i,o)};bt.prototype.isDisjunctiveRefined=function(i,o){return this.state.isDisjunctiveFacetRefined(i,o)};bt.prototype.hasTag=function(i){return this.state.isTagRefined(i)};bt.prototype.isTagRefined=function(){return this.hasTagRefinements.apply(this,arguments)};bt.prototype.getIndex=function(){return this.state.index};function Gx(){return this.state.page}bt.prototype.getCurrentPage=Gx;bt.prototype.getPage=Gx;bt.prototype.getTags=function(){return this.state.tagRefinements};bt.prototype.getRefinements=function(i){var o=[];if(this.state.isConjunctiveFacet(i)){var l=this.state.getConjunctiveRefinements(i);l.forEach(function(E){o.push({value:E,type:"conjunctive"})});var h=this.state.getExcludeRefinements(i);h.forEach(function(E){o.push({value:E,type:"exclude"})})}else if(this.state.isDisjunctiveFacet(i)){var _=this.state.getDisjunctiveRefinements(i);_.forEach(function(E){o.push({value:E,type:"disjunctive"})})}var x=this.state.getNumericRefinements(i);return Object.keys(x).forEach(function(E){var s=x[E];o.push({value:s,operator:E,type:"numeric"})}),o};bt.prototype.getNumericRefinement=function(i,o){return this.state.getNumericRefinement(i,o)};bt.prototype.getHierarchicalFacetBreadcrumb=function(i){return this.state.getHierarchicalFacetBreadcrumb(i)};bt.prototype._search=function(i){var o=this.state,l=[],h=[];i.onlyWithDerivedHelpers||(h=Xl._getQueries(o.index,o),l.push({state:o,queriesCount:h.length,helper:this}),this.emit("search",{state:o,results:this.lastResults}));var _=this.derivedHelpers.map(function(s){var A=s.getModifiedState(o),M=Xl._getQueries(A.index,A);return l.push({state:A,queriesCount:M.length,helper:s}),s.emit("search",{state:A,results:s.lastResults}),M}),x=Array.prototype.concat.apply(h,_),E=this._queryId++;this._currentNbQueries++;try{this.client.search(x).then(this._dispatchAlgoliaResponse.bind(this,l,E)).catch(this._dispatchAlgoliaError.bind(this,E))}catch(s){this.emit("error",{error:s})}};bt.prototype._dispatchAlgoliaResponse=function(i,o,l){if(!(o<this._lastQueryIdReceived)){this._currentNbQueries-=o-this._lastQueryIdReceived,this._lastQueryIdReceived=o,this._currentNbQueries===0&&this.emit("searchQueueEmpty");var h=l.results.slice();i.forEach(function(_){var x=_.state,E=_.queriesCount,s=_.helper,A=h.splice(0,E),M=s.lastResults=new $_(x,A);s.emit("result",{results:M,state:x})})}};bt.prototype._dispatchAlgoliaError=function(i,o){i<this._lastQueryIdReceived||(this._currentNbQueries-=i-this._lastQueryIdReceived,this._lastQueryIdReceived=i,this.emit("error",{error:o}),this._currentNbQueries===0&&this.emit("searchQueueEmpty"))};bt.prototype.containsRefinement=function(i,o,l,h){return i||o.length!==0||l.length!==0||h.length!==0};bt.prototype._hasDisjunctiveRefinements=function(i){return this.state.disjunctiveRefinements[i]&&this.state.disjunctiveRefinements[i].length>0};bt.prototype._change=function(i){var o=i.state,l=i.isPageReset;o!==this.state&&(this.state=o,this.emit("change",{state:this.state,results:this.lastResults,isPageReset:l}))};bt.prototype.clearCache=function(){return this.client.clearCache&&this.client.clearCache(),this};bt.prototype.setClient=function(i){return this.client===i?this:(typeof i.addAlgoliaAgent=="function"&&i.addAlgoliaAgent("JS Helper ("+Vx+")"),this.client=i,this)};bt.prototype.getClient=function(){return this.client};bt.prototype.derive=function(i){var o=new xM(this,i);return this.derivedHelpers.push(o),o};bt.prototype.detachDerivedHelper=function(i){var o=this.derivedHelpers.indexOf(i);if(o===-1)throw new Error("Derived helper already detached");this.derivedHelpers.splice(o,1)};bt.prototype.hasPendingRequests=function(){return this._currentNbQueries>0};var PM=bt,qx=PM,IM=Ix,MM=Bx;function Hu(i,o,l){return new qx(i,o,l)}Hu.version=Ux;Hu.AlgoliaSearchHelper=qx;Hu.SearchParameters=IM;Hu.SearchResults=MM;var Ql=Hu;function on(){}var Wu=function(o,l){return o};function CM(i){return Object.prototype.toString.call(i).slice(8,-1)}function G_(i,o){if(i===void 0||typeof i!="function")throw new Error("The render function is not valid (received type ".concat(CM(i),`).

`).concat(o))}var zM={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Zx=/[&<>"']/g,RM=RegExp(Zx.source);function kM(i){return i&&RM.test(i)?i.replace(Zx,function(o){return zM[o]}):i}var DM={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Hx=/&(amp|quot|lt|gt|#39);/g,OM=RegExp(Hx.source);function Xu(i){return i&&OM.test(i)?i.replace(Hx,function(o){return DM[o]}):i}function Md(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Md=function(l){return typeof l}:Md=function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},Md(i)}function LM(i){return i===null?i===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(i)}function FM(i){return Md(i)==="object"&&i!==null}function BM(i){if(!FM(i)||LM(i)!=="[object Object]")return!1;if(Object.getPrototypeOf(i)===null)return!0;for(var o=i;Object.getPrototypeOf(o)!==null;)o=Object.getPrototypeOf(o);return Object.getPrototypeOf(i)===o}function q_(){return q_=Object.assign||function(i){for(var o=1;o<arguments.length;o++){var l=arguments[o];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(i[h]=l[h])}return i},q_.apply(this,arguments)}function Wx(i,o){var l=Object.keys(i);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(i);o&&(h=h.filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable})),l.push.apply(l,h)}return l}function Cd(i){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?arguments[o]:{};o%2?Wx(Object(l),!0).forEach(function(h){Xx(i,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(l)):Wx(Object(l)).forEach(function(h){Object.defineProperty(i,h,Object.getOwnPropertyDescriptor(l,h))})}return i}function Xx(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}var zd={highlightPreTag:"__ais-highlight__",highlightPostTag:"__/ais-highlight__"},sn={highlightPreTag:"<mark>",highlightPostTag:"</mark>"};function jM(i){return kM(i).replace(new RegExp(zd.highlightPreTag,"g"),sn.highlightPreTag).replace(new RegExp(zd.highlightPostTag,"g"),sn.highlightPostTag)}function Rd(i){return BM(i)&&typeof i.value!="string"?Object.keys(i).reduce(function(o,l){return Cd(Cd({},o),{},Xx({},l,Rd(i[l])))},{}):Array.isArray(i)?i.map(Rd):Cd(Cd({},i),{},{value:jM(i.value)})}function NM(i){return i.__escaped===void 0&&(i=i.map(function(o){var l=q_({},o);return l._highlightResult&&(l._highlightResult=Rd(l._highlightResult)),l._snippetResult&&(l._snippetResult=Rd(l._snippetResult)),l}),i.__escaped=!0),i}function Qx(i){var o=sn.highlightPreTag,l=sn.highlightPostTag;return i.map(function(h){return h.isHighlighted?o+h.value+l:h.value}).join("")}function Yx(i){return btoa(encodeURIComponent(JSON.stringify(i)))}function Kx(i){return JSON.parse(decodeURIComponent(atob(i)))}function kd(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?kd=function(l){return typeof l}:kd=function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},kd(i)}function UM(i){for(var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:20,l=[],h=0;h<Math.ceil(i.length/o);h++)l.push(i.slice(h*o,(h+1)*o));return l}var Jx=function(o){var l=o.index,h=o.widgetType;o.methodName;var _=o.args,x=o.isSearchStalled;if(_.length===1&&kd(_[0])==="object")return[_[0]];var E=_[0],s=_[1],A=_[2];if(!s)return[];if((E==="click"||E==="conversion")&&!A)return[];var M=Array.isArray(s)?VM(s):[s];if(M.length===0)return[];var z=M[0].__queryID,L=UM(M),F=L.map(function(H){return H.map(function(W){return W.objectID})}),j=L.map(function(H){return H.map(function(W){return W.__position})});return E==="view"?x?[]:L.map(function(H,W){return{insightsMethod:"viewedObjectIDs",widgetType:h,eventType:E,payload:{eventName:A||"Hits Viewed",index:l,objectIDs:F[W]},hits:H}}):E==="click"?L.map(function(H,W){return{insightsMethod:"clickedObjectIDsAfterSearch",widgetType:h,eventType:E,payload:{eventName:A,index:l,queryID:z,objectIDs:F[W],positions:j[W]},hits:H}}):E==="conversion"?L.map(function(H,W){return{insightsMethod:"convertedObjectIDsAfterSearch",widgetType:h,eventType:E,payload:{eventName:A,index:l,queryID:z,objectIDs:F[W]},hits:H}}):[]};function VM(i){return i.slice()}function $M(i){var o=i.instantSearchInstance,l=i.index,h=i.widgetType,_=function(){for(var E=arguments.length,s=new Array(E),A=0;A<E;A++)s[A]=arguments[A];var M=Jx({widgetType:h,index:l,methodName:"sendEvent",args:s,isSearchStalled:o.status==="stalled"});M.forEach(function(z){return o.sendEventToInsights(z)})};return _}function GM(i){var o=i.index,l=i.widgetType,h=function(){for(var x=arguments.length,E=new Array(x),s=0;s<x;s++)E[s]=arguments[s];var A=Jx({widgetType:l,index:o,methodName:"bindEvent",args:E,isSearchStalled:!1});return A.length?"data-insights-event=".concat(Yx(A)):""};return h}function Yl(i){return i.$$type==="ais.index"}function Z_(i,o){var l=i[o.getIndexId()]||{};o.getHelper().setState(o.getWidgetSearchParameters(o.getHelper().state,{uiState:l})),o.getWidgets().filter(Yl).forEach(function(h){return Z_(i,h)})}var qM=Promise.resolve();function Qu(i){var o=null,l=!1,h=function(){for(var x=arguments.length,E=new Array(x),s=0;s<x;s++)E[s]=arguments[s];o===null&&(o=qM.then(function(){if(o=null,l){l=!1;return}i.apply(void 0,E)}))};return h.wait=function(){if(o===null)throw new Error("The deferred function should be called before calling `wait()`");return o},h.cancel=function(){o!==null&&(l=!0)},h}function ZM(i){var o=i.name,l=i.connector,h=l===void 0?!1:l;return["https://www.algolia.com/doc/api-reference/widgets/",o,"/js/",h?"#connector":""].join("")}function Bo(){for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];var h=o.map(function(_){return ZM(_)}).join(", ");return function(_){return[_,"See documentation: ".concat(h)].filter(Boolean).join(`

`)}}function HM(i,o){for(var l,h=0;h<i.length;h++)if(l=i[h],o(l,h,i))return l}function WM(i,o){if(!Array.isArray(i))return-1;for(var l=0;l<i.length;l++)if(o(i[l]))return l;return-1}function XM(i){return i instanceof HTMLElement||Boolean(i)&&i.nodeType>0}function Dd(i){var o=typeof i=="string",l=o?document.querySelector(i):i;if(!XM(l)){var h="Container must be `string` or `HTMLElement`.";throw o&&(h+=" Unable to find ".concat(i)),new Error(h)}return l}function Kl(i){var o=sn.highlightPostTag,l=sn.highlightPreTag,h=i.split(l),_=h.shift(),x=_?[{value:_,isHighlighted:!1}]:[];return h.forEach(function(E){var s=E.split(o);x.push({value:s[0],isHighlighted:!0}),s[1]!==""&&x.push({value:s[1],isHighlighted:!1})}),x}var QM=new RegExp(/\w/i);function YM(i,o){var l,h,_=i[o],x=((l=i[o+1])===null||l===void 0?void 0:l.isHighlighted)||!0,E=((h=i[o-1])===null||h===void 0?void 0:h.isHighlighted)||!0;return!QM.test(Xu(_.value))&&E===x?E:_.isHighlighted}function xs(i,o){var l=Array.isArray(o)?o:o.split(".");return l.reduce(function(h,_){return h&&h[_]},i)}function e1(i,o){var l=Object.keys(i);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(i);o&&(h=h.filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable})),l.push.apply(l,h)}return l}function t1(i){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?arguments[o]:{};o%2?e1(Object(l),!0).forEach(function(h){KM(i,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(l)):e1(Object(l)).forEach(function(h){Object.defineProperty(i,h,Object.getOwnPropertyDescriptor(l,h))})}return i}function KM(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}function JM(i,o,l){return i.map(function(h,_){return t1(t1({},h),{},{__position:l*o+_+1})})}function r1(i,o){var l=Object.keys(i);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(i);o&&(h=h.filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable})),l.push.apply(l,h)}return l}function i1(i){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?arguments[o]:{};o%2?r1(Object(l),!0).forEach(function(h){eC(i,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(l)):r1(Object(l)).forEach(function(h){Object.defineProperty(i,h,Object.getOwnPropertyDescriptor(l,h))})}return i}function eC(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}function tC(i,o){return o?i.map(function(l){return i1(i1({},l),{},{__queryID:o})}):i}function n1(i){return i!==Object(i)}function Yu(i,o){if(i===o)return!0;if(n1(i)||n1(o)||typeof i=="function"||typeof o=="function")return i===o;if(Object.keys(i).length!==Object.keys(o).length)return!1;for(var l=0,h=Object.keys(i);l<h.length;l++){var _=h[l];if(!(_ in o)||!Yu(i[_],o[_]))return!1}return!0}function rC(i){var o=i.button===1;return o||i.altKey||i.ctrlKey||i.metaKey||i.shiftKey}function H_(i){return i.filter(function(o,l,h){return h.indexOf(o)===l})}function o1(i,o){var l=Object.keys(i);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(i);o&&(h=h.filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable})),l.push.apply(l,h)}return l}function fo(i){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?arguments[o]:{};o%2?o1(Object(l),!0).forEach(function(h){iC(i,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(l)):o1(Object(l)).forEach(function(h){Object.defineProperty(i,h,Object.getOwnPropertyDescriptor(l,h))})}return i}function iC(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}function nC(i,o){if(i==null)return{};var l=oC(i,o),h,_;if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(i);for(_=0;_<x.length;_++)h=x[_],!(o.indexOf(h)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,h)||(l[h]=i[h]))}return l}function oC(i,o){if(i==null)return{};var l={},h=Object.keys(i),_,x;for(x=0;x<h.length;x++)_=h[x],!(o.indexOf(_)>=0)&&(l[_]=i[_]);return l}var sC=function(o,l){l.facets,l.disjunctiveFacets,l.facetsRefinements,l.facetsExcludes,l.disjunctiveFacetsRefinements,l.numericRefinements,l.tagRefinements,l.hierarchicalFacets,l.hierarchicalFacetsRefinements,l.ruleContexts;var h=nC(l,["facets","disjunctiveFacets","facetsRefinements","facetsExcludes","disjunctiveFacetsRefinements","numericRefinements","tagRefinements","hierarchicalFacets","hierarchicalFacetsRefinements","ruleContexts"]);return o.setQueryParameters(h)},aC=function(o,l){return l.facets.reduce(function(h,_){return h.addFacet(_)},o)},lC=function(o,l){return l.disjunctiveFacets.reduce(function(h,_){return h.addDisjunctiveFacet(_)},o)},cC=function(o,l){return o.setQueryParameters({hierarchicalFacets:l.hierarchicalFacets.reduce(function(h,_){var x=WM(h,function(s){return s.name===_.name});if(x===-1)return h.concat(_);var E=h.slice();return E.splice(x,1,_),E},o.hierarchicalFacets)})},uC=function(o,l){return l.tagRefinements.reduce(function(h,_){return h.addTagRefinement(_)},o)},hC=function(o,l){return o.setQueryParameters({facetsRefinements:fo(fo({},o.facetsRefinements),l.facetsRefinements)})},fC=function(o,l){return o.setQueryParameters({facetsExcludes:fo(fo({},o.facetsExcludes),l.facetsExcludes)})},dC=function(o,l){return o.setQueryParameters({disjunctiveFacetsRefinements:fo(fo({},o.disjunctiveFacetsRefinements),l.disjunctiveFacetsRefinements)})},pC=function(o,l){return o.setQueryParameters({numericRefinements:fo(fo({},o.numericRefinements),l.numericRefinements)})},mC=function(o,l){return o.setQueryParameters({hierarchicalFacetsRefinements:fo(fo({},o.hierarchicalFacetsRefinements),l.hierarchicalFacetsRefinements)})},_C=function(o,l){var h=H_([].concat(o.ruleContexts).concat(l.ruleContexts).filter(Boolean));return h.length>0?o.setQueryParameters({ruleContexts:h}):o},gC=function(){for(var o=arguments.length,l=new Array(o),h=0;h<o;h++)l[h]=arguments[h];return l.reduce(function(_,x){var E=mC(_,x),s=cC(E,x),A=uC(s,x),M=pC(A,x),z=dC(M,x),L=fC(z,x),F=hC(L,x),j=lC(F,x),H=_C(j,x),W=aC(H,x);return sC(W,x)})};function yC(i){return wC(i)||bC(i)||xC(i)||vC()}function vC(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xC(i,o){if(!!i){if(typeof i=="string")return W_(i,o);var l=Object.prototype.toString.call(i).slice(8,-1);if(l==="Object"&&i.constructor&&(l=i.constructor.name),l==="Map"||l==="Set")return Array.from(i);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return W_(i,o)}}function bC(i){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(i))return Array.from(i)}function wC(i){if(Array.isArray(i))return W_(i)}function W_(i,o){(o==null||o>i.length)&&(o=i.length);for(var l=0,h=new Array(o);l<o;l++)h[l]=i[l];return h}function s1(i){var o=i.start,l=o===void 0?0:o,h=i.end,_=i.step,x=_===void 0?1:_,E=x===0?1:x,s=Math.round((h-l)/E);return yC(Array(s)).map(function(A,M){return l+M*E})}function Ku(i,o,l){var h=o.getHelper();return{uiState:l,helper:h,parent:o,instantSearchInstance:i,state:h.state,renderState:i.renderState,templatesConfig:i.templatesConfig,createURL:o.createURL,scopedResults:[],searchMetadata:{isSearchStalled:i.status==="stalled"},status:i.status,error:i.error}}function a1(i,o){var l=o.getResults();return{helper:o.getHelper(),parent:o,instantSearchInstance:i,results:l,scopedResults:o.getScopedResults(),state:l._state,renderState:i.renderState,templatesConfig:i.templatesConfig,createURL:o.createURL,searchMetadata:{isSearchStalled:i.status==="stalled"},status:i.status,error:i.error}}function TC(i){for(var o=i.getParent(),l=[i.getHelper().state];o!==null;)l=[o.getHelper().state].concat(l),o=o.getParent();return l}function l1(i,o){var l=Object.keys(i);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(i);o&&(h=h.filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable})),l.push.apply(l,h)}return l}function Od(i){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?arguments[o]:{};o%2?l1(Object(l),!0).forEach(function(h){EC(i,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(l)):l1(Object(l)).forEach(function(h){Object.defineProperty(i,h,Object.getOwnPropertyDescriptor(l,h))})}return i}function EC(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}function c1(i){return i.some(function(o){return o.isHighlighted})?i.map(function(o,l){return Od(Od({},o),{},{isHighlighted:!YM(i,l)})}):i.map(function(o){return Od(Od({},o),{},{isHighlighted:!1})})}function jo(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{fallback:function(){}},l=o.fallback;return typeof window=="undefined"?l():i({window})}function Ld(i){return Array.isArray(i)?i:[i]}function u1(i,o){var l=Object.keys(i);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(i);o&&(h=h.filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable})),l.push.apply(l,h)}return l}function bs(i){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?arguments[o]:{};o%2?u1(Object(l),!0).forEach(function(h){Fd(i,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(l)):u1(Object(l)).forEach(function(h){Object.defineProperty(i,h,Object.getOwnPropertyDescriptor(l,h))})}return i}function Fd(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}function h1(i){return IC(i)||PC(i)||AC(i)||SC()}function SC(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function AC(i,o){if(!!i){if(typeof i=="string")return X_(i,o);var l=Object.prototype.toString.call(i).slice(8,-1);if(l==="Object"&&i.constructor&&(l=i.constructor.name),l==="Map"||l==="Set")return Array.from(i);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return X_(i,o)}}function PC(i){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(i))return Array.from(i)}function IC(i){if(Array.isArray(i))return X_(i)}function X_(i,o){(o==null||o>i.length)&&(o=i.length);for(var l=0,h=new Array(o);l<o;l++)h[l]=i[l];return h}function MC(i,o){if(i==null)return{};var l=CC(i,o),h,_;if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(i);for(_=0;_<x.length;_++)h=x[_],!(o.indexOf(h)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,h)||(l[h]=i[h]))}return l}function CC(i,o){if(i==null)return{};var l={},h=Object.keys(i),_,x;for(x=0;x<h.length;x++)_=h[x],!(o.indexOf(_)>=0)&&(l[_]=i[_]);return l}var Ju=Bo({name:"index-widget"});function f1(i,o){var l=o.state,h=o.isPageReset,_=o._uiState;l!==i.state&&(i.state=l,i.emit("change",{state:i.state,results:i.lastResults,isPageReset:h,_uiState:_}))}function Bd(i,o){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return i.reduce(function(h,_){return Yl(_)||!_.getWidgetUiState&&!_.getWidgetState?h:_.getWidgetUiState?_.getWidgetUiState(h,o):_.getWidgetState(h,o)},l)}function jd(i,o){var l=o.initialSearchParameters,h=MC(o,["initialSearchParameters"]);return i.filter(function(_){return!Yl(_)}).reduce(function(_,x){return x.getWidgetSearchParameters?x.getWidgetSearchParameters(_,h):_},l)}function d1(i){var o=i.filter(Yl);o.length!==0&&o.forEach(function(l){var h=l.getHelper();f1(h,{state:h.state.resetPage(),isPageReset:!0}),d1(l.getWidgets())})}function p1(i){var o=i.filter(Yl);return o.reduce(function(l,h){return l.concat.apply(l,[{indexId:h.getIndexId(),results:h.getResults(),helper:h.getHelper()}].concat(h1(p1(h.getWidgets()))))},[])}var zC=function(o){if(o===void 0||o.indexName===void 0)throw new Error(Ju("The `indexName` option is required."));var l=o.indexName,h=o.indexId,_=h===void 0?l:h,x=[],E={},s=null,A=null,M=null,z=null;return{$$type:"ais.index",$$widgetType:"ais.index",getIndexName:function(){return l},getIndexId:function(){return _},getHelper:function(){return M},getResults:function(){return z&&z.lastResults},getScopedResults:function(){var F=this.getParent(),j=F?F.getWidgets():[this];return p1(j)},getParent:function(){return A},createURL:function(F){return s._createURL(Fd({},_,Bd(x,{searchParameters:F,helper:M})))},getWidgets:function(){return x},addWidgets:function(F){var j=this;if(!Array.isArray(F))throw new Error(Ju("The `addWidgets` method expects an array of widgets."));if(F.some(function(H){return typeof H.init!="function"&&typeof H.render!="function"}))throw new Error(Ju("The widget definition expects a `render` and/or an `init` method."));return x=x.concat(F),s&&Boolean(F.length)&&(f1(M,{state:jd(x,{uiState:E,initialSearchParameters:M.state}),_uiState:E}),F.forEach(function(H){if(H.getRenderState){var W=H.getRenderState(s.renderState[j.getIndexId()]||{},Ku(s,j,s._initialUiState));Q_({renderState:W,instantSearchInstance:s,parent:j})}}),F.forEach(function(H){H.init&&H.init(Ku(s,j,s._initialUiState))}),s.scheduleSearch()),this},removeWidgets:function(F){var j=this;if(!Array.isArray(F))throw new Error(Ju("The `removeWidgets` method expects an array of widgets."));if(F.some(function(W){return typeof W.dispose!="function"}))throw new Error(Ju("The widget definition expects a `dispose` method."));if(x=x.filter(function(W){return F.indexOf(W)===-1}),s&&Boolean(F.length)){var H=F.reduce(function(W,he){var ve=he.dispose({helper:M,state:W,parent:j});return ve||W},M.state);E=Bd(x,{searchParameters:H,helper:M}),M.setState(jd(x,{uiState:E,initialSearchParameters:H})),x.length&&s.scheduleSearch()}return this},init:function(F){var j=this,H,W=F.instantSearchInstance,he=F.parent,ve=F.uiState;if(M===null){s=W,A=he,E=ve[_]||{};var Ce=W.mainHelper,De=jd(x,{uiState:E,initialSearchParameters:new Ql.SearchParameters({index:l})});M=Ql({},De.index,De),M.search=function(){return W.onStateChange?(W.onStateChange({uiState:W.mainIndex.getWidgetUiState({}),setUiState:function(mt){return W.setUiState(mt,!1)}}),Ce):Ce.search()},M.searchWithoutTriggeringOnStateChange=function(){return Ce.search()},M.searchForFacetValues=function(We,mt,Te,Ue){var Xe=M.state.setQueryParameters(Ue);return Ce.searchForFacetValues(We,mt,Te,Xe)},z=Ce.derive(function(){return gC.apply(void 0,h1(TC(j)))});var Se=(H=W._initialResults)===null||H===void 0?void 0:H[this.getIndexId()];if(Se){var Ie=new Ql.SearchResults(new Ql.SearchParameters(Se.state),Se.results);z.lastResults=Ie,M.lastResults=Ie}M.on("change",function(We){var mt=We.isPageReset;mt&&d1(x)}),z.on("search",function(){W.scheduleStalledRender()}),z.on("result",function(We){var mt=We.results;W.scheduleRender(),M.lastResults=mt}),x.forEach(function(We){if(We.getRenderState){var mt=We.getRenderState(W.renderState[j.getIndexId()]||{},Ku(W,j,ve));Q_({renderState:mt,instantSearchInstance:W,parent:j})}}),x.forEach(function(We){We.init&&We.init(Ku(W,j,ve))}),M.on("change",function(We){var mt=We.state,Te=We._uiState;E=Bd(x,{searchParameters:mt,helper:M},Te||{}),W.onStateChange||W.onInternalStateChange()}),Se&&W.scheduleRender()}},render:function(F){var j=this,H=F.instantSearchInstance;!this.getResults()||(x.forEach(function(W){if(W.getRenderState){var he=W.getRenderState(H.renderState[j.getIndexId()]||{},a1(H,j));Q_({renderState:he,instantSearchInstance:H,parent:j})}}),x.forEach(function(W){W.render&&W.render(a1(H,j))}))},dispose:function(){var F=this;x.forEach(function(j){j.dispose&&j.dispose({helper:M,state:M.state,parent:F})}),s=null,A=null,M.removeAllListeners(),M=null,z.detach(),z=null},getWidgetUiState:function(F){return x.filter(Yl).reduce(function(j,H){return H.getWidgetUiState(j)},bs(bs({},F),{},Fd({},_,bs(bs({},F[_]),E))))},getWidgetState:function(F){return this.getWidgetUiState(F)},getWidgetSearchParameters:function(F,j){var H=j.uiState;return jd(x,{uiState:H,initialSearchParameters:F})},refreshUiState:function(){E=Bd(x,{searchParameters:this.getHelper().state,helper:this.getHelper()},E)}}},RC=zC;function Q_(i){var o=i.renderState,l=i.instantSearchInstance,h=i.parent,_=h?h.getIndexId():l.mainIndex.getIndexId();l.renderState=bs(bs({},l.renderState),{},Fd({},_,bs(bs({},l.renderState[_]),o)))}var m1="4.48.1",kC="ais",Ia=function(o){return function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=l.descendantName,_=l.modifierName,x=h?"-".concat(h):"",E=_?"--".concat(_):"";return"".concat(kC,"-").concat(o).concat(x).concat(E)}},DC=Ia("Highlight");function _1(i){var o=i.attribute,l=i.highlightedTagName,h=l===void 0?"mark":l,_=i.hit,x=i.cssClasses,E=x===void 0?{}:x,s=xs(_._highlightResult,o),A=s||{},M=A.value,z=M===void 0?"":M,L=DC({descendantName:"highlighted"})+(E.highlighted?" ".concat(E.highlighted):"");return z.replace(new RegExp(sn.highlightPreTag,"g"),"<".concat(h,' class="').concat(L,'">')).replace(new RegExp(sn.highlightPostTag,"g"),"</".concat(h,">"))}var OC=Ia("ReverseHighlight");function g1(i){var o=i.attribute,l=i.highlightedTagName,h=l===void 0?"mark":l,_=i.hit,x=i.cssClasses,E=x===void 0?{}:x,s=xs(_._highlightResult,o),A=s||{},M=A.value,z=M===void 0?"":M,L=OC({descendantName:"highlighted"})+(E.highlighted?" ".concat(E.highlighted):""),F=Qx(c1(Kl(z)));return F.replace(new RegExp(sn.highlightPreTag,"g"),"<".concat(h,' class="').concat(L,'">')).replace(new RegExp(sn.highlightPostTag,"g"),"</".concat(h,">"))}var LC=Ia("Snippet");function y1(i){var o=i.attribute,l=i.highlightedTagName,h=l===void 0?"mark":l,_=i.hit,x=i.cssClasses,E=x===void 0?{}:x,s=xs(_._snippetResult,o),A=s||{},M=A.value,z=M===void 0?"":M,L=LC({descendantName:"highlighted"})+(E.highlighted?" ".concat(E.highlighted):"");return z.replace(new RegExp(sn.highlightPreTag,"g"),"<".concat(h,' class="').concat(L,'">')).replace(new RegExp(sn.highlightPostTag,"g"),"</".concat(h,">"))}var FC=Ia("ReverseSnippet");function v1(i){var o=i.attribute,l=i.highlightedTagName,h=l===void 0?"mark":l,_=i.hit,x=i.cssClasses,E=x===void 0?{}:x,s=xs(_._snippetResult,o),A=s||{},M=A.value,z=M===void 0?"":M,L=FC({descendantName:"highlighted"})+(E.highlighted?" ".concat(E.highlighted):""),F=Qx(c1(Kl(z)));return F.replace(new RegExp(sn.highlightPreTag,"g"),"<".concat(h,' class="').concat(L,'">')).replace(new RegExp(sn.highlightPostTag,"g"),"</".concat(h,">"))}function Nd(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Nd=function(l){return typeof l}:Nd=function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},Nd(i)}function BC(i){var o=i.getAttribute("data-insights-method"),l=i.getAttribute("data-insights-payload");if(typeof l!="string")throw new Error("The insights helper expects `data-insights-payload` to be a base64-encoded JSON string.");try{var h=Kx(l);return{method:o,payload:h}}catch{throw new Error("The insights helper was unable to parse `data-insights-payload`.")}}function jC(i){return i.hasAttribute("data-insights-method")}function NC(i){var o=i.method,l=i.payload;if(Nd(l)!=="object")throw new Error("The insights helper expects the payload to be an object.");var h;try{h=Yx(l)}catch{throw new Error("Could not JSON serialize the payload object.")}return'data-insights-method="'.concat(o,'" data-insights-payload="').concat(h,'"')}function x1(i,o){return NC({method:i,payload:o})}var UC="_ALGOLIA";function VC(i){for(var o="".concat(i,"="),l=document.cookie.split(";"),h=0;h<l.length;h++){for(var _=l[h];_.charAt(0)===" ";)_=_.substring(1);if(_.indexOf(o)===0)return _.substring(o.length,_.length)}}function $C(){return VC(UC)}function GC(){return $C()}function qC(i,o){return i.toLocaleString(o)}function b1(i,o){var l=Object.keys(i);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(i);o&&(h=h.filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable})),l.push.apply(l,h)}return l}function No(i){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?arguments[o]:{};o%2?b1(Object(l),!0).forEach(function(h){ZC(i,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(l)):b1(Object(l)).forEach(function(h){Object.defineProperty(i,h,Object.getOwnPropertyDescriptor(l,h))})}return i}function ZC(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}function HC(i){var o=i.numberLocale;return{formatNumber:function(h,_){return qC(Number(_(h)),o)},highlight:function(h,_){try{var x=JSON.parse(h);return _(_1(No(No({},x),{},{hit:this})))}catch{throw new Error(`
The highlight helper expects a JSON object of the format:
{ "attribute": "name", "highlightedTagName": "mark" }`)}},reverseHighlight:function(h,_){try{var x=JSON.parse(h);return _(g1(No(No({},x),{},{hit:this})))}catch{throw new Error(`
  The reverseHighlight helper expects a JSON object of the format:
  { "attribute": "name", "highlightedTagName": "mark" }`)}},snippet:function(h,_){try{var x=JSON.parse(h);return _(y1(No(No({},x),{},{hit:this})))}catch{throw new Error(`
The snippet helper expects a JSON object of the format:
{ "attribute": "name", "highlightedTagName": "mark" }`)}},reverseSnippet:function(h,_){try{var x=JSON.parse(h);return _(v1(No(No({},x),{},{hit:this})))}catch{throw new Error(`
  The reverseSnippet helper expects a JSON object of the format:
  { "attribute": "name", "highlightedTagName": "mark" }`)}},insights:function(h,_){try{var x=JSON.parse(h),E=x.method,s=x.payload;return _(x1(E,No({objectIDs:[this.objectID]},s)))}catch{throw new Error(`
The insights helper expects a JSON object of the format:
{ "method": "method-name", "payload": { "eventName": "name of the event" } }`)}}}}function w1(i,o){var l=Object.keys(i);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(i);o&&(h=h.filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable})),l.push.apply(l,h)}return l}function Ud(i){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?arguments[o]:{};o%2?w1(Object(l),!0).forEach(function(h){Y_(i,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(l)):w1(Object(l)).forEach(function(h){Object.defineProperty(i,h,Object.getOwnPropertyDescriptor(l,h))})}return i}function Y_(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}function WC(i,o){if(i==null)return{};var l=XC(i,o),h,_;if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(i);for(_=0;_<x.length;_++)h=x[_],!(o.indexOf(h)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,h)||(l[h]=i[h]))}return l}function XC(i,o){if(i==null)return{};var l={},h=Object.keys(i),_,x;for(x=0;x<h.length;x++)_=h[x],!(o.indexOf(_)>=0)&&(l[_]=i[_]);return l}function T1(i){i.configure;var o=WC(i,["configure"]);return o}function QC(){return{stateToRoute:function(o){return Object.keys(o).reduce(function(l,h){return Ud(Ud({},l),{},Y_({},h,T1(o[h])))},{})},routeToState:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.keys(o).reduce(function(l,h){return Ud(Ud({},l),{},Y_({},h,T1(o[h])))},{})}}}var YC=String.prototype.replace,KC=/%20/g,K_={RFC1738:"RFC1738",RFC3986:"RFC3986"},J_={default:K_.RFC3986,formatters:{RFC1738:function(i){return YC.call(i,KC,"+")},RFC3986:function(i){return String(i)}},RFC1738:K_.RFC1738,RFC3986:K_.RFC3986},JC=J_,eg=Object.prototype.hasOwnProperty,Ma=Array.isArray,po=function(){for(var i=[],o=0;o<256;++o)i.push("%"+((o<16?"0":"")+o.toString(16)).toUpperCase());return i}(),ez=function(o){for(;o.length>1;){var l=o.pop(),h=l.obj[l.prop];if(Ma(h)){for(var _=[],x=0;x<h.length;++x)typeof h[x]!="undefined"&&_.push(h[x]);l.obj[l.prop]=_}}},E1=function(o,l){for(var h=l&&l.plainObjects?Object.create(null):{},_=0;_<o.length;++_)typeof o[_]!="undefined"&&(h[_]=o[_]);return h},tz=function i(o,l,h){if(!l)return o;if(typeof l!="object"){if(Ma(o))o.push(l);else if(o&&typeof o=="object")(h&&(h.plainObjects||h.allowPrototypes)||!eg.call(Object.prototype,l))&&(o[l]=!0);else return[o,l];return o}if(!o||typeof o!="object")return[o].concat(l);var _=o;return Ma(o)&&!Ma(l)&&(_=E1(o,h)),Ma(o)&&Ma(l)?(l.forEach(function(x,E){if(eg.call(o,E)){var s=o[E];s&&typeof s=="object"&&x&&typeof x=="object"?o[E]=i(s,x,h):o.push(x)}else o[E]=x}),o):Object.keys(l).reduce(function(x,E){var s=l[E];return eg.call(x,E)?x[E]=i(x[E],s,h):x[E]=s,x},_)},rz=function(o,l){return Object.keys(l).reduce(function(h,_){return h[_]=l[_],h},o)},iz=function(i,o,l){var h=i.replace(/\+/g," ");if(l==="iso-8859-1")return h.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(h)}catch{return h}},nz=function(o,l,h,_,x){if(o.length===0)return o;var E=o;if(typeof o=="symbol"?E=Symbol.prototype.toString.call(o):typeof o!="string"&&(E=String(o)),h==="iso-8859-1")return escape(E).replace(/%u[0-9a-f]{4}/gi,function(z){return"%26%23"+parseInt(z.slice(2),16)+"%3B"});for(var s="",A=0;A<E.length;++A){var M=E.charCodeAt(A);if(M===45||M===46||M===95||M===126||M>=48&&M<=57||M>=65&&M<=90||M>=97&&M<=122||x===JC.RFC1738&&(M===40||M===41)){s+=E.charAt(A);continue}if(M<128){s=s+po[M];continue}if(M<2048){s=s+(po[192|M>>6]+po[128|M&63]);continue}if(M<55296||M>=57344){s=s+(po[224|M>>12]+po[128|M>>6&63]+po[128|M&63]);continue}A+=1,M=65536+((M&1023)<<10|E.charCodeAt(A)&1023),s+=po[240|M>>18]+po[128|M>>12&63]+po[128|M>>6&63]+po[128|M&63]}return s},oz=function(o){for(var l=[{obj:{o},prop:"o"}],h=[],_=0;_<l.length;++_)for(var x=l[_],E=x.obj[x.prop],s=Object.keys(E),A=0;A<s.length;++A){var M=s[A],z=E[M];typeof z=="object"&&z!==null&&h.indexOf(z)===-1&&(l.push({obj:E,prop:M}),h.push(z))}return ez(l),o},sz=function(o){return Object.prototype.toString.call(o)==="[object RegExp]"},az=function(o){return!o||typeof o!="object"?!1:!!(o.constructor&&o.constructor.isBuffer&&o.constructor.isBuffer(o))},lz=function(o,l){return[].concat(o,l)},cz=function(o,l){if(Ma(o)){for(var h=[],_=0;_<o.length;_+=1)h.push(l(o[_]));return h}return l(o)},S1={arrayToObject:E1,assign:rz,combine:lz,compact:oz,decode:iz,encode:nz,isBuffer:az,isRegExp:sz,maybeMap:cz,merge:tz},tg=S1,eh=J_,uz=Object.prototype.hasOwnProperty,A1={brackets:function(o){return o+"[]"},comma:"comma",indices:function(o,l){return o+"["+l+"]"},repeat:function(o){return o}},Ca=Array.isArray,hz=String.prototype.split,fz=Array.prototype.push,P1=function(i,o){fz.apply(i,Ca(o)?o:[o])},dz=Date.prototype.toISOString,I1=eh.default,Ii={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:tg.encode,encodeValuesOnly:!1,format:I1,formatter:eh.formatters[I1],indices:!1,serializeDate:function(o){return dz.call(o)},skipNulls:!1,strictNullHandling:!1},pz=function(o){return typeof o=="string"||typeof o=="number"||typeof o=="boolean"||typeof o=="symbol"||typeof o=="bigint"},mz=function i(o,l,h,_,x,E,s,A,M,z,L,F,j,H){var W=o;if(typeof s=="function"?W=s(l,W):W instanceof Date?W=z(W):h==="comma"&&Ca(W)&&(W=tg.maybeMap(W,function(tt){return tt instanceof Date?z(tt):tt})),W===null){if(_)return E&&!j?E(l,Ii.encoder,H,"key",L):l;W=""}if(pz(W)||tg.isBuffer(W)){if(E){var he=j?l:E(l,Ii.encoder,H,"key",L);if(h==="comma"&&j){for(var ve=hz.call(String(W),","),Ce="",De=0;De<ve.length;++De)Ce+=(De===0?"":",")+F(E(ve[De],Ii.encoder,H,"value",L));return[F(he)+"="+Ce]}return[F(he)+"="+F(E(W,Ii.encoder,H,"value",L))]}return[F(l)+"="+F(String(W))]}var Se=[];if(typeof W=="undefined")return Se;var Ie;if(h==="comma"&&Ca(W))Ie=[{value:W.length>0?W.join(",")||null:void 0}];else if(Ca(s))Ie=s;else{var We=Object.keys(W);Ie=A?We.sort(A):We}for(var mt=0;mt<Ie.length;++mt){var Te=Ie[mt],Ue=typeof Te=="object"&&typeof Te.value!="undefined"?Te.value:W[Te];if(!(x&&Ue===null)){var Xe=Ca(W)?typeof h=="function"?h(l,Te):l:l+(M?"."+Te:"["+Te+"]");P1(Se,i(Ue,Xe,h,_,x,E,s,A,M,z,L,F,j,H))}}return Se},_z=function(o){if(!o)return Ii;if(o.encoder!==null&&typeof o.encoder!="undefined"&&typeof o.encoder!="function")throw new TypeError("Encoder has to be a function.");var l=o.charset||Ii.charset;if(typeof o.charset!="undefined"&&o.charset!=="utf-8"&&o.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var h=eh.default;if(typeof o.format!="undefined"){if(!uz.call(eh.formatters,o.format))throw new TypeError("Unknown format option provided.");h=o.format}var _=eh.formatters[h],x=Ii.filter;return(typeof o.filter=="function"||Ca(o.filter))&&(x=o.filter),{addQueryPrefix:typeof o.addQueryPrefix=="boolean"?o.addQueryPrefix:Ii.addQueryPrefix,allowDots:typeof o.allowDots=="undefined"?Ii.allowDots:!!o.allowDots,charset:l,charsetSentinel:typeof o.charsetSentinel=="boolean"?o.charsetSentinel:Ii.charsetSentinel,delimiter:typeof o.delimiter=="undefined"?Ii.delimiter:o.delimiter,encode:typeof o.encode=="boolean"?o.encode:Ii.encode,encoder:typeof o.encoder=="function"?o.encoder:Ii.encoder,encodeValuesOnly:typeof o.encodeValuesOnly=="boolean"?o.encodeValuesOnly:Ii.encodeValuesOnly,filter:x,format:h,formatter:_,serializeDate:typeof o.serializeDate=="function"?o.serializeDate:Ii.serializeDate,skipNulls:typeof o.skipNulls=="boolean"?o.skipNulls:Ii.skipNulls,sort:typeof o.sort=="function"?o.sort:null,strictNullHandling:typeof o.strictNullHandling=="boolean"?o.strictNullHandling:Ii.strictNullHandling}},gz=function(i,o){var l=i,h=_z(o),_,x;typeof h.filter=="function"?(x=h.filter,l=x("",l)):Ca(h.filter)&&(x=h.filter,_=x);var E=[];if(typeof l!="object"||l===null)return"";var s;o&&o.arrayFormat in A1?s=o.arrayFormat:o&&"indices"in o?s=o.indices?"indices":"repeat":s="indices";var A=A1[s];_||(_=Object.keys(l)),h.sort&&_.sort(h.sort);for(var M=0;M<_.length;++M){var z=_[M];h.skipNulls&&l[z]===null||P1(E,mz(l[z],z,A,h.strictNullHandling,h.skipNulls,h.encode?h.encoder:null,h.filter,h.sort,h.allowDots,h.serializeDate,h.format,h.formatter,h.encodeValuesOnly,h.charset))}var L=E.join(h.delimiter),F=h.addQueryPrefix===!0?"?":"";return h.charsetSentinel&&(h.charset==="iso-8859-1"?F+="utf8=%26%2310003%3B&":F+="utf8=%E2%9C%93&"),L.length>0?F+L:""},Jl=S1,rg=Object.prototype.hasOwnProperty,yz=Array.isArray,Mi={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:Jl.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},vz=function(i){return i.replace(/&#(\d+);/g,function(o,l){return String.fromCharCode(parseInt(l,10))})},M1=function(i,o){return i&&typeof i=="string"&&o.comma&&i.indexOf(",")>-1?i.split(","):i},xz="utf8=%26%2310003%3B",bz="utf8=%E2%9C%93",wz=function(o,l){var h={},_=l.ignoreQueryPrefix?o.replace(/^\?/,""):o,x=l.parameterLimit===1/0?void 0:l.parameterLimit,E=_.split(l.delimiter,x),s=-1,A,M=l.charset;if(l.charsetSentinel)for(A=0;A<E.length;++A)E[A].indexOf("utf8=")===0&&(E[A]===bz?M="utf-8":E[A]===xz&&(M="iso-8859-1"),s=A,A=E.length);for(A=0;A<E.length;++A)if(A!==s){var z=E[A],L=z.indexOf("]="),F=L===-1?z.indexOf("="):L+1,j,H;F===-1?(j=l.decoder(z,Mi.decoder,M,"key"),H=l.strictNullHandling?null:""):(j=l.decoder(z.slice(0,F),Mi.decoder,M,"key"),H=Jl.maybeMap(M1(z.slice(F+1),l),function(W){return l.decoder(W,Mi.decoder,M,"value")})),H&&l.interpretNumericEntities&&M==="iso-8859-1"&&(H=vz(H)),z.indexOf("[]=")>-1&&(H=yz(H)?[H]:H),rg.call(h,j)?h[j]=Jl.combine(h[j],H):h[j]=H}return h},Tz=function(i,o,l,h){for(var _=h?o:M1(o,l),x=i.length-1;x>=0;--x){var E,s=i[x];if(s==="[]"&&l.parseArrays)E=[].concat(_);else{E=l.plainObjects?Object.create(null):{};var A=s.charAt(0)==="["&&s.charAt(s.length-1)==="]"?s.slice(1,-1):s,M=parseInt(A,10);!l.parseArrays&&A===""?E={0:_}:!isNaN(M)&&s!==A&&String(M)===A&&M>=0&&l.parseArrays&&M<=l.arrayLimit?(E=[],E[M]=_):A!=="__proto__"&&(E[A]=_)}_=E}return _},Ez=function(o,l,h,_){if(!!o){var x=h.allowDots?o.replace(/\.([^.[]+)/g,"[$1]"):o,E=/(\[[^[\]]*])/,s=/(\[[^[\]]*])/g,A=h.depth>0&&E.exec(x),M=A?x.slice(0,A.index):x,z=[];if(M){if(!h.plainObjects&&rg.call(Object.prototype,M)&&!h.allowPrototypes)return;z.push(M)}for(var L=0;h.depth>0&&(A=s.exec(x))!==null&&L<h.depth;){if(L+=1,!h.plainObjects&&rg.call(Object.prototype,A[1].slice(1,-1))&&!h.allowPrototypes)return;z.push(A[1])}return A&&z.push("["+x.slice(A.index)+"]"),Tz(z,l,h,_)}},Sz=function(o){if(!o)return Mi;if(o.decoder!==null&&o.decoder!==void 0&&typeof o.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof o.charset!="undefined"&&o.charset!=="utf-8"&&o.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var l=typeof o.charset=="undefined"?Mi.charset:o.charset;return{allowDots:typeof o.allowDots=="undefined"?Mi.allowDots:!!o.allowDots,allowPrototypes:typeof o.allowPrototypes=="boolean"?o.allowPrototypes:Mi.allowPrototypes,arrayLimit:typeof o.arrayLimit=="number"?o.arrayLimit:Mi.arrayLimit,charset:l,charsetSentinel:typeof o.charsetSentinel=="boolean"?o.charsetSentinel:Mi.charsetSentinel,comma:typeof o.comma=="boolean"?o.comma:Mi.comma,decoder:typeof o.decoder=="function"?o.decoder:Mi.decoder,delimiter:typeof o.delimiter=="string"||Jl.isRegExp(o.delimiter)?o.delimiter:Mi.delimiter,depth:typeof o.depth=="number"||o.depth===!1?+o.depth:Mi.depth,ignoreQueryPrefix:o.ignoreQueryPrefix===!0,interpretNumericEntities:typeof o.interpretNumericEntities=="boolean"?o.interpretNumericEntities:Mi.interpretNumericEntities,parameterLimit:typeof o.parameterLimit=="number"?o.parameterLimit:Mi.parameterLimit,parseArrays:o.parseArrays!==!1,plainObjects:typeof o.plainObjects=="boolean"?o.plainObjects:Mi.plainObjects,strictNullHandling:typeof o.strictNullHandling=="boolean"?o.strictNullHandling:Mi.strictNullHandling}},Az=function(i,o){var l=Sz(o);if(i===""||i===null||typeof i=="undefined")return l.plainObjects?Object.create(null):{};for(var h=typeof i=="string"?wz(i,l):i,_=l.plainObjects?Object.create(null):{},x=Object.keys(h),E=0;E<x.length;++E){var s=x[E],A=Ez(s,h[s],l,typeof i=="string");_=Jl.merge(_,A,l)}return Jl.compact(_)},Pz=gz,Iz=Az,Mz=J_,C1={formats:Mz,parse:Iz,stringify:Pz};function Cz(i,o){if(!(i instanceof o))throw new TypeError("Cannot call a class as a function")}function z1(i,o){for(var l=0;l<o.length;l++){var h=o[l];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(i,h.key,h)}}function zz(i,o,l){return o&&z1(i.prototype,o),l&&z1(i,l),i}function Uo(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}var R1=function(o){o&&(window.document.title=o)},Rz=function(){function i(o){var l=this,h=o.windowTitle,_=o.writeDelay,x=_===void 0?400:_,E=o.createURL,s=o.parseURL,A=o.getLocation;Cz(this,i),Uo(this,"windowTitle",void 0),Uo(this,"writeDelay",void 0),Uo(this,"_createURL",void 0),Uo(this,"parseURL",void 0),Uo(this,"getLocation",void 0),Uo(this,"writeTimer",void 0),Uo(this,"inPopState",!1),Uo(this,"isDisposed",!1),Uo(this,"latestAcknowledgedHistory",0),this.windowTitle=h,this.writeTimer=void 0,this.writeDelay=x,this._createURL=E,this.parseURL=s,this.getLocation=A,jo(function(M){var z=M.window,L=l.windowTitle&&l.windowTitle(l.read());R1(L),l.latestAcknowledgedHistory=z.history.length})}return zz(i,[{key:"read",value:function(){return this.parseURL({qsModule:C1,location:this.getLocation()})}},{key:"write",value:function(l){var h=this;jo(function(_){var x=_.window,E=h.createURL(l),s=h.windowTitle&&h.windowTitle(l);h.writeTimer&&clearTimeout(h.writeTimer),h.writeTimer=setTimeout(function(){R1(s),h.shouldWrite(E)&&(x.history.pushState(l,s||"",E),h.latestAcknowledgedHistory=x.history.length),h.inPopState=!1,h.writeTimer=void 0},h.writeDelay)})}},{key:"onUpdate",value:function(l){var h=this;this._onPopState=function(_){h.writeTimer&&(clearTimeout(h.writeTimer),h.writeTimer=void 0),h.inPopState=!0;var x=_.state;l(x||h.read())},jo(function(_){var x=_.window;x.addEventListener("popstate",h._onPopState)})}},{key:"createURL",value:function(l){return this._createURL({qsModule:C1,routeState:l,location:this.getLocation()})}},{key:"dispose",value:function(){var l=this;this.isDisposed=!0,jo(function(h){var _=h.window;l._onPopState&&_.removeEventListener("popstate",l._onPopState)}),this.writeTimer&&clearTimeout(this.writeTimer),this.write({})}},{key:"shouldWrite",value:function(l){var h=this;return jo(function(_){var x=_.window,E=!(h.isDisposed&&h.latestAcknowledgedHistory!==x.history.length);return!h.inPopState&&E&&l!==x.location.href})}}]),i}();function kz(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=i.createURL,l=o===void 0?function(z){var L=z.qsModule,F=z.routeState,j=z.location,H=j.protocol,W=j.hostname,he=j.port,ve=he===void 0?"":he,Ce=j.pathname,De=j.hash,Se=L.stringify(F),Ie=ve===""?"":":".concat(ve);return Se?"".concat(H,"//").concat(W).concat(Ie).concat(Ce,"?").concat(Se).concat(De):"".concat(H,"//").concat(W).concat(Ie).concat(Ce).concat(De)}:o,h=i.parseURL,_=h===void 0?function(z){var L=z.qsModule,F=z.location;return L.parse(F.search.slice(1),{arrayLimit:99})}:h,x=i.writeDelay,E=x===void 0?400:x,s=i.windowTitle,A=i.getLocation,M=A===void 0?function(){return jo(function(z){var L=z.window;return L.location},{fallback:function(){throw new Error("You need to provide `getLocation` to the `history` router in environments where `window` does not exist.")}})}:A;return new Rz({createURL:l,parseURL:_,writeDelay:E,windowTitle:s,getLocation:M})}function k1(i,o){var l=Object.keys(i);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(i);o&&(h=h.filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable})),l.push.apply(l,h)}return l}function Vd(i){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?arguments[o]:{};o%2?k1(Object(l),!0).forEach(function(h){D1(i,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(l)):k1(Object(l)).forEach(function(h){Object.defineProperty(i,h,Object.getOwnPropertyDescriptor(l,h))})}return i}function D1(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}var Dz=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=o.router,h=l===void 0?kz():l,_=o.stateMapping,x=_===void 0?QC():_;return function(E){var s=E.instantSearchInstance;function A(L){var F=Object.keys(L).reduce(function(H,W){return Vd(Vd({},H),{},D1({},W,L[W]))},s.mainIndex.getWidgetUiState({})),j=x.stateToRoute(F);return h.createURL(j)}s._createURL=A;var M=void 0,z=s._initialUiState;return{onStateChange:function(F){var j=F.uiState,H=x.stateToRoute(j);(M===void 0||!Yu(M,H))&&(h.write(H),M=H)},subscribe:function(){s._initialUiState=Vd(Vd({},z),x.routeToState(h.read())),h.onUpdate(function(F){s.setUiState(x.routeToState(F))})},started:function(){},unsubscribe:function(){h.dispose()}}}};function O1(i,o,l){var h=Ku(o,o.mainIndex,o._initialUiState);i.forEach(function(_){var x={};if(_.getWidgetRenderState){var E=_.getWidgetRenderState(h);E&&E.widgetParams&&(x=E.widgetParams)}var s=Object.keys(x).filter(function(A){return x[A]!==void 0});l.widgets.push({type:_.$$type,widgetType:_.$$widgetType,params:s}),_.$$type==="ais.index"&&O1(_.getWidgets(),o,l)})}function Oz(){return jo(function(i){var o,l,h=i.window;return((o=h.navigator)===null||o===void 0||(l=o.userAgent)===null||l===void 0?void 0:l.indexOf("Algolia Crawler"))>-1},{fallback:function(){return!1}})}function Lz(){return function(i){var o=i.instantSearchInstance,l={widgets:[]},h=document.createElement("meta"),_=document.querySelector("head");return h.name="instantsearch:widgets",{onStateChange:function(){},subscribe:function(){setTimeout(function(){var E=o.client;l.ua=E.transporter&&E.transporter.userAgent?E.transporter.userAgent.value:E._ua,O1(o.mainIndex.getWidgets(),o,l),h.content=JSON.stringify(l),_.appendChild(h)},0)},started:function(){},unsubscribe:function(){h.remove()}}}}function $d(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?$d=function(l){return typeof l}:$d=function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},$d(i)}function L1(i,o){var l=Object.keys(i);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(i);o&&(h=h.filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable})),l.push.apply(l,h)}return l}function Fz(i){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?arguments[o]:{};o%2?L1(Object(l),!0).forEach(function(h){qr(i,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(l)):L1(Object(l)).forEach(function(h){Object.defineProperty(i,h,Object.getOwnPropertyDescriptor(l,h))})}return i}function Bz(i,o){if(!(i instanceof o))throw new TypeError("Cannot call a class as a function")}function F1(i,o){for(var l=0;l<o.length;l++){var h=o[l];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(i,h.key,h)}}function jz(i,o,l){return o&&F1(i.prototype,o),l&&F1(i,l),i}function Nz(i,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(o&&o.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),o&&ig(i,o)}function ig(i,o){return ig=Object.setPrototypeOf||function(h,_){return h.__proto__=_,h},ig(i,o)}function Uz(i){var o=$z();return function(){var h=Gd(i),_;if(o){var x=Gd(this).constructor;_=Reflect.construct(h,arguments,x)}else _=h.apply(this,arguments);return Vz(this,_)}}function Vz(i,o){return o&&($d(o)==="object"||typeof o=="function")?o:Vr(i)}function Vr(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function $z(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Gd(i){return Gd=Object.setPrototypeOf?Object.getPrototypeOf:function(l){return l.__proto__||Object.getPrototypeOf(l)},Gd(i)}function qr(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}var Nn=Bo({name:"instantsearch"});function Gz(){return"#"}var qz=function(i){Nz(l,i);var o=Uz(l);function l(h){var _;Bz(this,l),_=o.call(this),qr(Vr(_),"client",void 0),qr(Vr(_),"indexName",void 0),qr(Vr(_),"insightsClient",void 0),qr(Vr(_),"onStateChange",null),qr(Vr(_),"helper",void 0),qr(Vr(_),"mainHelper",void 0),qr(Vr(_),"mainIndex",void 0),qr(Vr(_),"started",void 0),qr(Vr(_),"templatesConfig",void 0),qr(Vr(_),"renderState",{}),qr(Vr(_),"_stalledSearchDelay",void 0),qr(Vr(_),"_searchStalledTimer",void 0),qr(Vr(_),"_initialUiState",void 0),qr(Vr(_),"_initialResults",void 0),qr(Vr(_),"_createURL",void 0),qr(Vr(_),"_searchFunction",void 0),qr(Vr(_),"_mainHelperSearch",void 0),qr(Vr(_),"middleware",[]),qr(Vr(_),"sendEventToInsights",void 0),qr(Vr(_),"status","idle"),qr(Vr(_),"error",void 0),qr(Vr(_),"scheduleSearch",Qu(function(){_.started&&_.mainHelper.search()})),qr(Vr(_),"scheduleRender",Qu(function(){var We=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;_.mainHelper.hasPendingRequests()||(clearTimeout(_._searchStalledTimer),_._searchStalledTimer=null,We&&(_.status="idle",_.error=void 0)),_.mainIndex.render({instantSearchInstance:Vr(_)}),_.emit("render")})),qr(Vr(_),"onInternalStateChange",Qu(function(){var We=_.mainIndex.getWidgetUiState({});_.middleware.forEach(function(mt){var Te=mt.instance;Te.onStateChange({uiState:We})})})),_.setMaxListeners(100);var x=h.indexName,E=x===void 0?null:x,s=h.numberLocale,A=h.initialUiState,M=A===void 0?{}:A,z=h.routing,L=z===void 0?null:z,F=h.searchFunction,j=h.stalledSearchDelay,H=j===void 0?200:j,W=h.searchClient,he=W===void 0?null:W,ve=h.insightsClient,Ce=ve===void 0?null:ve,De=h.onStateChange,Se=De===void 0?null:De;if(E===null)throw new Error(Nn("The `indexName` option is required."));if(he===null)throw new Error(Nn("The `searchClient` option is required."));if(typeof he.search!="function")throw new Error("The `searchClient` must implement a `search` method.\n\nSee: https://www.algolia.com/doc/guides/building-search-ui/going-further/backend-search/in-depth/backend-instantsearch/js/");if(typeof he.addAlgoliaAgent=="function"&&he.addAlgoliaAgent("instantsearch.js (".concat(m1,")")),Ce&&typeof Ce!="function")throw new Error(Nn("The `insightsClient` option should be a function."));if(_.client=he,_.insightsClient=Ce,_.indexName=E,_.helper=null,_.mainHelper=null,_.mainIndex=RC({indexName:E}),_.onStateChange=Se,_.started=!1,_.templatesConfig={helpers:HC({numberLocale:s}),compileOptions:{}},_._stalledSearchDelay=H,_._searchStalledTimer=null,_._createURL=Gz,_._initialUiState=M,_._initialResults=null,F&&(_._searchFunction=F),_.sendEventToInsights=on,L){var Ie=typeof L=="boolean"?void 0:L;_.use(Dz(Ie))}return Oz()&&_.use(Lz()),_}return jz(l,[{key:"_isSearchStalled",get:function(){return this.status==="stalled"}},{key:"use",value:function(){for(var _=this,x=arguments.length,E=new Array(x),s=0;s<x;s++)E[s]=arguments[s];var A=E.map(function(M){var z=Fz({subscribe:on,started:on,unsubscribe:on,onStateChange:on},M({instantSearchInstance:_}));return _.middleware.push({creator:M,instance:z}),z});return this.started&&A.forEach(function(M){M.subscribe(),M.started()}),this}},{key:"unuse",value:function(){for(var _=arguments.length,x=new Array(_),E=0;E<_;E++)x[E]=arguments[E];return this.middleware.filter(function(s){return x.includes(s.creator)}).forEach(function(s){return s.instance.unsubscribe()}),this.middleware=this.middleware.filter(function(s){return!x.includes(s.creator)}),this}},{key:"EXPERIMENTAL_use",value:function(){return this.use.apply(this,arguments)}},{key:"addWidget",value:function(_){return this.addWidgets([_])}},{key:"addWidgets",value:function(_){if(!Array.isArray(_))throw new Error(Nn("The `addWidgets` method expects an array of widgets. Please use `addWidget`."));if(_.some(function(x){return typeof x.init!="function"&&typeof x.render!="function"}))throw new Error(Nn("The widget definition expects a `render` and/or an `init` method."));return this.mainIndex.addWidgets(_),this}},{key:"removeWidget",value:function(_){return this.removeWidgets([_])}},{key:"removeWidgets",value:function(_){if(!Array.isArray(_))throw new Error(Nn("The `removeWidgets` method expects an array of widgets. Please use `removeWidget`."));if(_.some(function(x){return typeof x.dispose!="function"}))throw new Error(Nn("The widget definition expects a `dispose` method."));return this.mainIndex.removeWidgets(_),this}},{key:"start",value:function(){var _=this;if(this.started)throw new Error(Nn("The `start` method has already been called once."));var x=this.mainHelper||Ql(this.client,this.indexName);if(x.search=function(){return _.status="loading",_.emit("render"),x.searchOnlyWithDerivedHelpers()},this._searchFunction){var E={search:function(){return new Promise(on)}};this._mainHelperSearch=x.search.bind(x),x.search=function(){var A=_.mainIndex.getHelper(),M=Ql(E,A.state.index,A.state);return M.once("search",function(z){var L=z.state;A.overrideStateWithoutTriggeringChangeEvent(L),_._mainHelperSearch()}),M.on("change",function(z){var L=z.state;A.setState(L)}),_._searchFunction(M),x}}if(x.on("error",function(A){var M=A.error;if(!(M instanceof Error)){var z=M;M=Object.keys(z).reduce(function(L,F){return L[F]=z[F],L},new Error(z.message))}M.error=M,_.error=M,_.status="error",_.scheduleRender(!1),_.emit("error",M)}),this.mainHelper=x,this.middleware.forEach(function(A){var M=A.instance;M.subscribe()}),this.mainIndex.init({instantSearchInstance:this,parent:null,uiState:this._initialUiState}),this._initialResults){var s=this.scheduleSearch;this.scheduleSearch=Qu(on),Qu(function(){_.scheduleSearch=s})()}else this.mainIndex.getWidgets().length>0&&this.scheduleSearch();this.helper=this.mainIndex.getHelper(),this.started=!0,this.middleware.forEach(function(A){var M=A.instance;M.started()})}},{key:"dispose",value:function(){this.scheduleSearch.cancel(),this.scheduleRender.cancel(),clearTimeout(this._searchStalledTimer),this.removeWidgets(this.mainIndex.getWidgets()),this.mainIndex.dispose(),this.started=!1,this.removeAllListeners(),this.mainHelper.removeAllListeners(),this.mainHelper=null,this.helper=null,this.middleware.forEach(function(_){var x=_.instance;x.unsubscribe()})}},{key:"scheduleStalledRender",value:function(){var _=this;this._searchStalledTimer||(this._searchStalledTimer=setTimeout(function(){_.status="stalled",_.scheduleRender()},this._stalledSearchDelay))}},{key:"setUiState",value:function(_){var x=this,E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!this.mainHelper)throw new Error(Nn("The `start` method needs to be called before `setUiState`."));this.mainIndex.refreshUiState();var s=typeof _=="function"?_(this.mainIndex.getWidgetUiState({})):_;this.onStateChange&&E?this.onStateChange({uiState:s,setUiState:function(M){Z_(typeof M=="function"?M(s):M,x.mainIndex),x.scheduleSearch(),x.onInternalStateChange()}}):(Z_(s,this.mainIndex),this.scheduleSearch(),this.onInternalStateChange())}},{key:"getUiState",value:function(){return this.started&&this.mainIndex.refreshUiState(),this.mainIndex.getWidgetUiState({})}},{key:"createURL",value:function(){var _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this.started)throw new Error(Nn("The `start` method needs to be called before `createURL`."));return this._createURL(_)}},{key:"refresh",value:function(){if(!this.mainHelper)throw new Error(Nn("The `start` method needs to be called before `refresh`."));this.mainHelper.clearCache().search()}}]),l}(j_),Zz=qz;function Hz(i,o){if(i==null)return{};var l=Wz(i,o),h,_;if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(i);for(_=0;_<x.length;_++)h=x[_],!(o.indexOf(h)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,h)||(l[h]=i[h]))}return l}function Wz(i,o){if(i==null)return{};var l={},h=Object.keys(i),_,x;for(x=0;x<h.length;x++)_=h[x],!(o.indexOf(_)>=0)&&(l[_]=i[_]);return l}function B1(i){var o=i||{};o.page;var l=Hz(o,["page"]);return l}var ng="ais.infiniteHits";function Xz(){return{read:function(o){var l=o.state,h=jo(function(x){var E=x.window;return E.sessionStorage});if(!h)return null;try{var _=JSON.parse(h.getItem(ng));return _&&Yu(_.state,B1(l))?_.hits:null}catch(x){if(x instanceof SyntaxError)try{h.removeItem(ng)}catch{}return null}},write:function(o){var l=o.state,h=o.hits,_=jo(function(x){var E=x.window;return E.sessionStorage});if(!!_)try{_.setItem(ng,JSON.stringify({state:B1(l),hits:h}))}catch{}}}}var Un=function(o){return new Zz(o)};Un.version=m1;Un.createInfiniteHitsSessionStorageCache=Wu(Xz,"import { createInfiniteHitsSessionStorageCache } from 'instantsearch.js/es/lib/infiniteHitsCache'");Un.highlight=Wu(_1,"import { highlight } from 'instantsearch.js/es/helpers'");Un.reverseHighlight=Wu(g1,"import { reverseHighlight } from 'instantsearch.js/es/helpers'");Un.snippet=Wu(y1,"import { snippet } from 'instantsearch.js/es/helpers'");Un.reverseSnippet=Wu(v1,"import { reverseSnippet } from 'instantsearch.js/es/helpers'");Un.insights=x1;Un.getInsightsAnonymousUserToken=GC;Object.defineProperty(Un,"widgets",{get:function(){throw new ReferenceError(`"instantsearch.widgets" are not available from the ES build.

To import the widgets:

import { searchBox } from 'instantsearch.js/es/widgets'`)}});Object.defineProperty(Un,"connectors",{get:function(){throw new ReferenceError(`"instantsearch.connectors" are not available from the ES build.

To import the connectors:

import { connectSearchBox } from 'instantsearch.js/es/connectors'`)}});var OD=Un,qd,ei,j1,th,N1,Zd={},U1=[],Qz=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function ws(i,o){for(var l in o)i[l]=o[l];return i}function V1(i){var o=i.parentNode;o&&o.removeChild(i)}function Bt(i,o,l){var h,_,x,E={};for(x in o)x=="key"?h=o[x]:x=="ref"?_=o[x]:E[x]=o[x];if(arguments.length>2&&(E.children=arguments.length>3?qd.call(arguments,2):l),typeof i=="function"&&i.defaultProps!=null)for(x in i.defaultProps)E[x]===void 0&&(E[x]=i.defaultProps[x]);return Hd(i,E,h,_,null)}function Hd(i,o,l,h,_){var x={type:i,props:o,key:l,ref:h,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:_==null?++j1:_};return _==null&&ei.vnode!=null&&ei.vnode(x),x}function Yz(){return{current:null}}function rh(i){return i.children}function ec(i,o){this.props=i,this.context=o}function ih(i,o){if(o==null)return i.__?ih(i.__,i.__.__k.indexOf(i)+1):null;for(var l;o<i.__k.length;o++)if((l=i.__k[o])!=null&&l.__e!=null)return l.__e;return typeof i.type=="function"?ih(i):null}function $1(i){var o,l;if((i=i.__)!=null&&i.__c!=null){for(i.__e=i.__c.base=null,o=0;o<i.__k.length;o++)if((l=i.__k[o])!=null&&l.__e!=null){i.__e=i.__c.base=l.__e;break}return $1(i)}}function G1(i){(!i.__d&&(i.__d=!0)&&th.push(i)&&!Wd.__r++||N1!==ei.debounceRendering)&&((N1=ei.debounceRendering)||setTimeout)(Wd)}function Wd(){for(var i;Wd.__r=th.length;)i=th.sort(function(o,l){return o.__v.__b-l.__v.__b}),th=[],i.some(function(o){var l,h,_,x,E,s;o.__d&&(E=(x=(l=o).__v).__e,(s=l.__P)&&(h=[],(_=ws({},x)).__v=x.__v+1,og(s,x,_,l.__n,s.ownerSVGElement!==void 0,x.__h!=null?[E]:null,h,E==null?ih(x):E,x.__h),Y1(h,x),x.__e!=E&&$1(x)))})}function q1(i,o,l,h,_,x,E,s,A,M){var z,L,F,j,H,W,he,ve=h&&h.__k||U1,Ce=ve.length;for(l.__k=[],z=0;z<o.length;z++)if((j=l.__k[z]=(j=o[z])==null||typeof j=="boolean"?null:typeof j=="string"||typeof j=="number"||typeof j=="bigint"?Hd(null,j,null,null,j):Array.isArray(j)?Hd(rh,{children:j},null,null,null):j.__b>0?Hd(j.type,j.props,j.key,j.ref?j.ref:null,j.__v):j)!=null){if(j.__=l,j.__b=l.__b+1,(F=ve[z])===null||F&&j.key==F.key&&j.type===F.type)ve[z]=void 0;else for(L=0;L<Ce;L++){if((F=ve[L])&&j.key==F.key&&j.type===F.type){ve[L]=void 0;break}F=null}og(i,j,F=F||Zd,_,x,E,s,A,M),H=j.__e,(L=j.ref)&&F.ref!=L&&(he||(he=[]),F.ref&&he.push(F.ref,null,j),he.push(L,j.__c||H,j)),H!=null?(W==null&&(W=H),typeof j.type=="function"&&j.__k===F.__k?j.__d=A=Z1(j,A,i):A=H1(i,j,F,ve,H,A),typeof l.type=="function"&&(l.__d=A)):A&&F.__e==A&&A.parentNode!=i&&(A=ih(F))}for(l.__e=W,z=Ce;z--;)ve[z]!=null&&J1(ve[z],ve[z]);if(he)for(z=0;z<he.length;z++)K1(he[z],he[++z],he[++z])}function Z1(i,o,l){for(var h,_=i.__k,x=0;_&&x<_.length;x++)(h=_[x])&&(h.__=i,o=typeof h.type=="function"?Z1(h,o,l):H1(l,h,h,_,h.__e,o));return o}function H1(i,o,l,h,_,x){var E,s,A;if(o.__d!==void 0)E=o.__d,o.__d=void 0;else if(l==null||_!=x||_.parentNode==null)e:if(x==null||x.parentNode!==i)i.appendChild(_),E=null;else{for(s=x,A=0;(s=s.nextSibling)&&A<h.length;A+=2)if(s==_)break e;i.insertBefore(_,x),E=x}return E!==void 0?E:_.nextSibling}function Kz(i,o,l,h,_){var x;for(x in l)x==="children"||x==="key"||x in o||Xd(i,x,null,l[x],h);for(x in o)_&&typeof o[x]!="function"||x==="children"||x==="key"||x==="value"||x==="checked"||l[x]===o[x]||Xd(i,x,o[x],l[x],h)}function W1(i,o,l){o[0]==="-"?i.setProperty(o,l):i[o]=l==null?"":typeof l!="number"||Qz.test(o)?l:l+"px"}function Xd(i,o,l,h,_){var x;e:if(o==="style")if(typeof l=="string")i.style.cssText=l;else{if(typeof h=="string"&&(i.style.cssText=h=""),h)for(o in h)l&&o in l||W1(i.style,o,"");if(l)for(o in l)h&&l[o]===h[o]||W1(i.style,o,l[o])}else if(o[0]==="o"&&o[1]==="n")x=o!==(o=o.replace(/Capture$/,"")),o=o.toLowerCase()in i?o.toLowerCase().slice(2):o.slice(2),i.l||(i.l={}),i.l[o+x]=l,l?h||i.addEventListener(o,x?Q1:X1,x):i.removeEventListener(o,x?Q1:X1,x);else if(o!=="dangerouslySetInnerHTML"){if(_)o=o.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(o!=="href"&&o!=="list"&&o!=="form"&&o!=="tabIndex"&&o!=="download"&&o in i)try{i[o]=l==null?"":l;break e}catch{}typeof l=="function"||(l==null||l===!1&&o.indexOf("-")==-1?i.removeAttribute(o):i.setAttribute(o,l))}}function X1(i){this.l[i.type+!1](ei.event?ei.event(i):i)}function Q1(i){this.l[i.type+!0](ei.event?ei.event(i):i)}function og(i,o,l,h,_,x,E,s,A){var M,z,L,F,j,H,W,he,ve,Ce,De,Se,Ie,We,mt,Te=o.type;if(o.constructor!==void 0)return null;l.__h!=null&&(A=l.__h,s=o.__e=l.__e,o.__h=null,x=[s]),(M=ei.__b)&&M(o);try{e:if(typeof Te=="function"){if(he=o.props,ve=(M=Te.contextType)&&h[M.__c],Ce=M?ve?ve.props.value:M.__:h,l.__c?W=(z=o.__c=l.__c).__=z.__E:("prototype"in Te&&Te.prototype.render?o.__c=z=new Te(he,Ce):(o.__c=z=new ec(he,Ce),z.constructor=Te,z.render=eR),ve&&ve.sub(z),z.props=he,z.state||(z.state={}),z.context=Ce,z.__n=h,L=z.__d=!0,z.__h=[],z._sb=[]),z.__s==null&&(z.__s=z.state),Te.getDerivedStateFromProps!=null&&(z.__s==z.state&&(z.__s=ws({},z.__s)),ws(z.__s,Te.getDerivedStateFromProps(he,z.__s))),F=z.props,j=z.state,L)Te.getDerivedStateFromProps==null&&z.componentWillMount!=null&&z.componentWillMount(),z.componentDidMount!=null&&z.__h.push(z.componentDidMount);else{if(Te.getDerivedStateFromProps==null&&he!==F&&z.componentWillReceiveProps!=null&&z.componentWillReceiveProps(he,Ce),!z.__e&&z.shouldComponentUpdate!=null&&z.shouldComponentUpdate(he,z.__s,Ce)===!1||o.__v===l.__v){for(z.props=he,z.state=z.__s,o.__v!==l.__v&&(z.__d=!1),z.__v=o,o.__e=l.__e,o.__k=l.__k,o.__k.forEach(function(Ue){Ue&&(Ue.__=o)}),De=0;De<z._sb.length;De++)z.__h.push(z._sb[De]);z._sb=[],z.__h.length&&E.push(z);break e}z.componentWillUpdate!=null&&z.componentWillUpdate(he,z.__s,Ce),z.componentDidUpdate!=null&&z.__h.push(function(){z.componentDidUpdate(F,j,H)})}if(z.context=Ce,z.props=he,z.__v=o,z.__P=i,Se=ei.__r,Ie=0,"prototype"in Te&&Te.prototype.render){for(z.state=z.__s,z.__d=!1,Se&&Se(o),M=z.render(z.props,z.state,z.context),We=0;We<z._sb.length;We++)z.__h.push(z._sb[We]);z._sb=[]}else do z.__d=!1,Se&&Se(o),M=z.render(z.props,z.state,z.context),z.state=z.__s;while(z.__d&&++Ie<25);z.state=z.__s,z.getChildContext!=null&&(h=ws(ws({},h),z.getChildContext())),L||z.getSnapshotBeforeUpdate==null||(H=z.getSnapshotBeforeUpdate(F,j)),mt=M!=null&&M.type===rh&&M.key==null?M.props.children:M,q1(i,Array.isArray(mt)?mt:[mt],o,l,h,_,x,E,s,A),z.base=o.__e,o.__h=null,z.__h.length&&E.push(z),W&&(z.__E=z.__=null),z.__e=!1}else x==null&&o.__v===l.__v?(o.__k=l.__k,o.__e=l.__e):o.__e=Jz(l.__e,o,l,h,_,x,E,A);(M=ei.diffed)&&M(o)}catch(Ue){o.__v=null,(A||x!=null)&&(o.__e=s,o.__h=!!A,x[x.indexOf(s)]=null),ei.__e(Ue,o,l)}}function Y1(i,o){ei.__c&&ei.__c(o,i),i.some(function(l){try{i=l.__h,l.__h=[],i.some(function(h){h.call(l)})}catch(h){ei.__e(h,l.__v)}})}function Jz(i,o,l,h,_,x,E,s){var A,M,z,L=l.props,F=o.props,j=o.type,H=0;if(j==="svg"&&(_=!0),x!=null){for(;H<x.length;H++)if((A=x[H])&&"setAttribute"in A==!!j&&(j?A.localName===j:A.nodeType===3)){i=A,x[H]=null;break}}if(i==null){if(j===null)return document.createTextNode(F);i=_?document.createElementNS("http://www.w3.org/2000/svg",j):document.createElement(j,F.is&&F),x=null,s=!1}if(j===null)L===F||s&&i.data===F||(i.data=F);else{if(x=x&&qd.call(i.childNodes),M=(L=l.props||Zd).dangerouslySetInnerHTML,z=F.dangerouslySetInnerHTML,!s){if(x!=null)for(L={},H=0;H<i.attributes.length;H++)L[i.attributes[H].name]=i.attributes[H].value;(z||M)&&(z&&(M&&z.__html==M.__html||z.__html===i.innerHTML)||(i.innerHTML=z&&z.__html||""))}if(Kz(i,F,L,_,s),z)o.__k=[];else if(H=o.props.children,q1(i,Array.isArray(H)?H:[H],o,l,h,_&&j!=="foreignObject",x,E,x?x[0]:l.__k&&ih(l,0),s),x!=null)for(H=x.length;H--;)x[H]!=null&&V1(x[H]);s||("value"in F&&(H=F.value)!==void 0&&(H!==i.value||j==="progress"&&!H||j==="option"&&H!==L.value)&&Xd(i,"value",H,L.value,!1),"checked"in F&&(H=F.checked)!==void 0&&H!==i.checked&&Xd(i,"checked",H,L.checked,!1))}return i}function K1(i,o,l){try{typeof i=="function"?i(o):i.current=o}catch(h){ei.__e(h,l)}}function J1(i,o,l){var h,_;if(ei.unmount&&ei.unmount(i),(h=i.ref)&&(h.current&&h.current!==i.__e||K1(h,null,o)),(h=i.__c)!=null){if(h.componentWillUnmount)try{h.componentWillUnmount()}catch(x){ei.__e(x,o)}h.base=h.__P=null,i.__c=void 0}if(h=i.__k)for(_=0;_<h.length;_++)h[_]&&J1(h[_],o,l||typeof i.type!="function");l||i.__e==null||V1(i.__e),i.__=i.__e=i.__d=void 0}function eR(i,o,l){return this.constructor(i,l)}function tc(i,o,l){var h,_,x;ei.__&&ei.__(i,o),_=(h=typeof l=="function")?null:l&&l.__k||o.__k,x=[],og(o,i=(!h&&l||o).__k=Bt(rh,null,[i]),_||Zd,Zd,o.ownerSVGElement!==void 0,!h&&l?[l]:_?null:o.firstChild?qd.call(o.childNodes):null,x,!h&&l?l:_?_.__e:o.firstChild,h),Y1(x,i)}qd=U1.slice,ei={__e:function(i,o,l,h){for(var _,x,E;o=o.__;)if((_=o.__c)&&!_.__)try{if((x=_.constructor)&&x.getDerivedStateFromError!=null&&(_.setState(x.getDerivedStateFromError(i)),E=_.__d),_.componentDidCatch!=null&&(_.componentDidCatch(i,h||{}),E=_.__d),E)return _.__E=_}catch(s){i=s}throw i}},j1=0,ec.prototype.setState=function(i,o){var l;l=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=ws({},this.state),typeof i=="function"&&(i=i(ws({},l),this.props)),i&&ws(l,i),i!=null&&this.__v&&(o&&this._sb.push(o),G1(this))},ec.prototype.forceUpdate=function(i){this.__v&&(this.__e=!0,i&&this.__h.push(i),G1(this))},ec.prototype.render=rh,th=[],Wd.__r=0;function Gt(){for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return o.reduce(function(h,_){return Array.isArray(_)?h.concat(_):h.concat([_])},[]).filter(Boolean).join(" ")}function eb(i,o){var l=Object.keys(i);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(i);o&&(h=h.filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable})),l.push.apply(l,h)}return l}function tR(i){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?arguments[o]:{};o%2?eb(Object(l),!0).forEach(function(h){rR(i,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(l)):eb(Object(l)).forEach(function(h){Object.defineProperty(i,h,Object.getOwnPropertyDescriptor(l,h))})}return i}function rR(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}function tb(i){return sR(i)||oR(i)||nR(i)||iR()}function iR(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nR(i,o){if(!!i){if(typeof i=="string")return sg(i,o);var l=Object.prototype.toString.call(i).slice(8,-1);if(l==="Object"&&i.constructor&&(l=i.constructor.name),l==="Map"||l==="Set")return Array.from(i);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return sg(i,o)}}function oR(i){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(i))return Array.from(i)}function sR(i){if(Array.isArray(i))return sg(i)}function sg(i,o){(o==null||o>i.length)&&(o=i.length);for(var l=0,h=new Array(o);l<o;l++)h[l]=i[l];return h}function aR(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=H_([].concat(tb(Object.keys(i||{})),tb(Object.keys(o))));return l.reduce(function(h,_){var x=i?i[_]:void 0,E=o[_],s=E!==void 0&&E!==x;return h.templates[_]=s?E:x,h.useCustomCompileOptions[_]=s,h},{templates:{},useCustomCompileOptions:{}})}function lR(i){var o=i.defaultTemplates,l=i.templates,h=i.templatesConfig,_=aR(o,l);return tR({templatesConfig:h},_)}var rb={};(function(i){(function(o){var l=/\S/,h=/\"/g,_=/\n/g,x=/\r/g,E=/\\/g,s=/\u2028/,A=/\u2029/;o.tags={"#":1,"^":2,"<":3,$:4,"/":5,"!":6,">":7,"=":8,_v:9,"{":10,"&":11,_t:12},o.scan=function(Ue,Xe){var tt=Ue.length,Dt=0,Ft=1,zr=2,Kt=Dt,Rr=null,Wr=null,xr="",Ht=[],Br=!1,wr=0,hr=0,kr="{{",Yr="}}";function oi(){xr.length>0&&(Ht.push({tag:"_t",text:new String(xr)}),xr="")}function Ci(){for(var $e=!0,Ye=hr;Ye<Ht.length;Ye++)if($e=o.tags[Ht[Ye].tag]<o.tags._v||Ht[Ye].tag=="_t"&&Ht[Ye].text.match(l)===null,!$e)return!1;return $e}function Fe($e,Ye){if(oi(),$e&&Ci())for(var dt=hr,vt;dt<Ht.length;dt++)Ht[dt].text&&((vt=Ht[dt+1])&&vt.tag==">"&&(vt.indent=Ht[dt].text.toString()),Ht.splice(dt,1));else Ye||Ht.push({tag:`
`});Br=!1,hr=Ht.length}function He($e,Ye){var dt="="+Yr,vt=$e.indexOf(dt,Ye),St=z($e.substring($e.indexOf("=",Ye)+1,vt)).split(" ");return kr=St[0],Yr=St[St.length-1],vt+dt.length-1}for(Xe&&(Xe=Xe.split(" "),kr=Xe[0],Yr=Xe[1]),wr=0;wr<tt;wr++)Kt==Dt?L(kr,Ue,wr)?(--wr,oi(),Kt=Ft):Ue.charAt(wr)==`
`?Fe(Br):xr+=Ue.charAt(wr):Kt==Ft?(wr+=kr.length-1,Wr=o.tags[Ue.charAt(wr+1)],Rr=Wr?Ue.charAt(wr+1):"_v",Rr=="="?(wr=He(Ue,wr),Kt=Dt):(Wr&&wr++,Kt=zr),Br=wr):L(Yr,Ue,wr)?(Ht.push({tag:Rr,n:z(xr),otag:kr,ctag:Yr,i:Rr=="/"?Br-kr.length:wr+Yr.length}),xr="",wr+=Yr.length-1,Kt=Dt,Rr=="{"&&(Yr=="}}"?wr++:M(Ht[Ht.length-1]))):xr+=Ue.charAt(wr);return Fe(Br,!0),Ht};function M(Te){Te.n.substr(Te.n.length-1)==="}"&&(Te.n=Te.n.substring(0,Te.n.length-1))}function z(Te){return Te.trim?Te.trim():Te.replace(/^\s*|\s*$/g,"")}function L(Te,Ue,Xe){if(Ue.charAt(Xe)!=Te.charAt(0))return!1;for(var tt=1,Dt=Te.length;tt<Dt;tt++)if(Ue.charAt(Xe+tt)!=Te.charAt(tt))return!1;return!0}var F={_t:!0,"\n":!0,$:!0,"/":!0};function j(Te,Ue,Xe,tt){var Dt=[],Ft=null,zr=null,Kt=null;for(zr=Xe[Xe.length-1];Te.length>0;){if(Kt=Te.shift(),zr&&zr.tag=="<"&&!(Kt.tag in F))throw new Error("Illegal content in < super tag.");if(o.tags[Kt.tag]<=o.tags.$||H(Kt,tt))Xe.push(Kt),Kt.nodes=j(Te,Kt.tag,Xe,tt);else if(Kt.tag=="/"){if(Xe.length===0)throw new Error("Closing tag without opener: /"+Kt.n);if(Ft=Xe.pop(),Kt.n!=Ft.n&&!W(Kt.n,Ft.n,tt))throw new Error("Nesting error: "+Ft.n+" vs. "+Kt.n);return Ft.end=Kt.i,Dt}else Kt.tag==`
`&&(Kt.last=Te.length==0||Te[0].tag==`
`);Dt.push(Kt)}if(Xe.length>0)throw new Error("missing closing tag: "+Xe.pop().n);return Dt}function H(Te,Ue){for(var Xe=0,tt=Ue.length;Xe<tt;Xe++)if(Ue[Xe].o==Te.n)return Te.tag="#",!0}function W(Te,Ue,Xe){for(var tt=0,Dt=Xe.length;tt<Dt;tt++)if(Xe[tt].c==Te&&Xe[tt].o==Ue)return!0}function he(Te){var Ue=[];for(var Xe in Te)Ue.push('"'+De(Xe)+'": function(c,p,t,i) {'+Te[Xe]+"}");return"{ "+Ue.join(",")+" }"}function ve(Te){var Ue=[];for(var Xe in Te.partials)Ue.push('"'+De(Xe)+'":{name:"'+De(Te.partials[Xe].name)+'", '+ve(Te.partials[Xe])+"}");return"partials: {"+Ue.join(",")+"}, subs: "+he(Te.subs)}o.stringify=function(Te,Ue,Xe){return"{code: function (c,p,i) { "+o.wrapMain(Te.code)+" },"+ve(Te)+"}"};var Ce=0;o.generate=function(Te,Ue,Xe){Ce=0;var tt={code:"",subs:{},partials:{}};return o.walk(Te,tt),Xe.asString?this.stringify(tt,Ue,Xe):this.makeTemplate(tt,Ue,Xe)},o.wrapMain=function(Te){return'var t=this;t.b(i=i||"");'+Te+"return t.fl();"},o.template=o.Template,o.makeTemplate=function(Te,Ue,Xe){var tt=this.makePartials(Te);return tt.code=new Function("c","p","i",this.wrapMain(Te.code)),new this.template(tt,Ue,this,Xe)},o.makePartials=function(Te){var Ue,Xe={subs:{},partials:Te.partials,name:Te.name};for(Ue in Xe.partials)Xe.partials[Ue]=this.makePartials(Xe.partials[Ue]);for(Ue in Te.subs)Xe.subs[Ue]=new Function("c","p","t","i",Te.subs[Ue]);return Xe};function De(Te){return Te.replace(E,"\\\\").replace(h,'\\"').replace(_,"\\n").replace(x,"\\r").replace(s,"\\u2028").replace(A,"\\u2029")}function Se(Te){return~Te.indexOf(".")?"d":"f"}function Ie(Te,Ue){var Xe="<"+(Ue.prefix||""),tt=Xe+Te.n+Ce++;return Ue.partials[tt]={name:Te.n,partials:{}},Ue.code+='t.b(t.rp("'+De(tt)+'",c,p,"'+(Te.indent||"")+'"));',tt}o.codegen={"#":function(Te,Ue){Ue.code+="if(t.s(t."+Se(Te.n)+'("'+De(Te.n)+'",c,p,1),c,p,0,'+Te.i+","+Te.end+',"'+Te.otag+" "+Te.ctag+'")){t.rs(c,p,function(c,p,t){',o.walk(Te.nodes,Ue),Ue.code+="});c.pop();}"},"^":function(Te,Ue){Ue.code+="if(!t.s(t."+Se(Te.n)+'("'+De(Te.n)+'",c,p,1),c,p,1,0,0,"")){',o.walk(Te.nodes,Ue),Ue.code+="};"},">":Ie,"<":function(Te,Ue){var Xe={partials:{},code:"",subs:{},inPartial:!0};o.walk(Te.nodes,Xe);var tt=Ue.partials[Ie(Te,Ue)];tt.subs=Xe.subs,tt.partials=Xe.partials},$:function(Te,Ue){var Xe={subs:{},code:"",partials:Ue.partials,prefix:Te.n};o.walk(Te.nodes,Xe),Ue.subs[Te.n]=Xe.code,Ue.inPartial||(Ue.code+='t.sub("'+De(Te.n)+'",c,p,i);')},"\n":function(Te,Ue){Ue.code+=mt('"\\n"'+(Te.last?"":" + i"))},_v:function(Te,Ue){Ue.code+="t.b(t.v(t."+Se(Te.n)+'("'+De(Te.n)+'",c,p,0)));'},_t:function(Te,Ue){Ue.code+=mt('"'+De(Te.text)+'"')},"{":We,"&":We};function We(Te,Ue){Ue.code+="t.b(t.t(t."+Se(Te.n)+'("'+De(Te.n)+'",c,p,0)));'}function mt(Te){return"t.b("+Te+");"}o.walk=function(Te,Ue){for(var Xe,tt=0,Dt=Te.length;tt<Dt;tt++)Xe=o.codegen[Te[tt].tag],Xe&&Xe(Te[tt],Ue);return Ue},o.parse=function(Te,Ue,Xe){return Xe=Xe||{},j(Te,"",[],Xe.sectionTags||[])},o.cache={},o.cacheKey=function(Te,Ue){return[Te,!!Ue.asString,!!Ue.disableLambda,Ue.delimiters,!!Ue.modelGet].join("||")},o.compile=function(Te,Ue){Ue=Ue||{};var Xe=o.cacheKey(Te,Ue),tt=this.cache[Xe];if(tt){var Dt=tt.partials;for(var Ft in Dt)delete Dt[Ft].instance;return tt}return tt=this.generate(this.parse(this.scan(Te,Ue.delimiters),Te,Ue),Te,Ue),this.cache[Xe]=tt}})(i)})(rb);var ib={};(function(i){(function(o){o.Template=function(j,H,W,he){j=j||{},this.r=j.code||this.r,this.c=W,this.options=he||{},this.text=H||"",this.partials=j.partials||{},this.subs=j.subs||{},this.buf=""},o.Template.prototype={r:function(j,H,W){return""},v:L,t:z,render:function(H,W,he){return this.ri([H],W||{},he)},ri:function(j,H,W){return this.r(j,H,W)},ep:function(j,H){var W=this.partials[j],he=H[W.name];if(W.instance&&W.base==he)return W.instance;if(typeof he=="string"){if(!this.c)throw new Error("No compiler available.");he=this.c.compile(he,this.options)}if(!he)return null;if(this.partials[j].base=he,W.subs){H.stackText||(H.stackText={});for(key in W.subs)H.stackText[key]||(H.stackText[key]=this.activeSub!==void 0&&H.stackText[this.activeSub]?H.stackText[this.activeSub]:this.text);he=h(he,W.subs,W.partials,this.stackSubs,this.stackPartials,H.stackText)}return this.partials[j].instance=he,he},rp:function(j,H,W,he){var ve=this.ep(j,W);return ve?ve.ri(H,W,he):""},rs:function(j,H,W){var he=j[j.length-1];if(!F(he)){W(j,H,this);return}for(var ve=0;ve<he.length;ve++)j.push(he[ve]),W(j,H,this),j.pop()},s:function(j,H,W,he,ve,Ce,De){var Se;return F(j)&&j.length===0?!1:(typeof j=="function"&&(j=this.ms(j,H,W,he,ve,Ce,De)),Se=!!j,!he&&Se&&H&&H.push(typeof j=="object"?j:H[H.length-1]),Se)},d:function(j,H,W,he){var ve,Ce=j.split("."),De=this.f(Ce[0],H,W,he),Se=this.options.modelGet,Ie=null;if(j==="."&&F(H[H.length-2]))De=H[H.length-1];else for(var We=1;We<Ce.length;We++)ve=l(Ce[We],De,Se),ve!==void 0?(Ie=De,De=ve):De="";return he&&!De?!1:(!he&&typeof De=="function"&&(H.push(Ie),De=this.mv(De,H,W),H.pop()),De)},f:function(j,H,W,he){for(var ve=!1,Ce=null,De=!1,Se=this.options.modelGet,Ie=H.length-1;Ie>=0;Ie--)if(Ce=H[Ie],ve=l(j,Ce,Se),ve!==void 0){De=!0;break}return De?(!he&&typeof ve=="function"&&(ve=this.mv(ve,H,W)),ve):he?!1:""},ls:function(j,H,W,he,ve){var Ce=this.options.delimiters;return this.options.delimiters=ve,this.b(this.ct(z(j.call(H,he)),H,W)),this.options.delimiters=Ce,!1},ct:function(j,H,W){if(this.options.disableLambda)throw new Error("Lambda features disabled.");return this.c.compile(j,this.options).render(H,W)},b:function(j){this.buf+=j},fl:function(){var j=this.buf;return this.buf="",j},ms:function(j,H,W,he,ve,Ce,De){var Se,Ie=H[H.length-1],We=j.call(Ie);return typeof We=="function"?he?!0:(Se=this.activeSub&&this.subsText&&this.subsText[this.activeSub]?this.subsText[this.activeSub]:this.text,this.ls(We,Ie,W,Se.substring(ve,Ce),De)):We},mv:function(j,H,W){var he=H[H.length-1],ve=j.call(he);return typeof ve=="function"?this.ct(z(ve.call(he)),he,W):ve},sub:function(j,H,W,he){var ve=this.subs[j];ve&&(this.activeSub=j,ve(H,W,this,he),this.activeSub=!1)}};function l(j,H,W){var he;return H&&typeof H=="object"&&(H[j]!==void 0?he=H[j]:W&&H.get&&typeof H.get=="function"&&(he=H.get(j))),he}function h(j,H,W,he,ve,Ce){function De(){}De.prototype=j;function Se(){}Se.prototype=j.subs;var Ie,We=new De;We.subs=new Se,We.subsText={},We.buf="",he=he||{},We.stackSubs=he,We.subsText=Ce;for(Ie in H)he[Ie]||(he[Ie]=H[Ie]);for(Ie in he)We.subs[Ie]=he[Ie];ve=ve||{},We.stackPartials=ve;for(Ie in W)ve[Ie]||(ve[Ie]=W[Ie]);for(Ie in ve)We.partials[Ie]=ve[Ie];return We}var _=/&/g,x=/</g,E=/>/g,s=/\'/g,A=/\"/g,M=/[&<>\"\']/;function z(j){return String(j==null?"":j)}function L(j){return j=z(j),M.test(j)?j.replace(_,"&amp;").replace(x,"&lt;").replace(E,"&gt;").replace(s,"&#39;").replace(A,"&quot;"):j}var F=Array.isArray||function(j){return Object.prototype.toString.call(j)==="[object Array]"}})(i)})(ib);var Qd=rb;Qd.Template=ib.Template;Qd.template=Qd.Template;var cR=Qd,nb=cR,ob=function(i,o,l,h){var _;o[0]=0;for(var x=1;x<o.length;x++){var E=o[x++],s=o[x]?(o[0]|=E?1:2,l[o[x++]]):o[++x];E===3?h[0]=s:E===4?h[1]=Object.assign(h[1]||{},s):E===5?(h[1]=h[1]||{})[o[++x]]=s:E===6?h[1][o[++x]]+=s+"":E?(_=i.apply(s,ob(i,s,l,["",null])),h.push(_),s[0]?o[0]|=2:(o[x-2]=0,o[x]=_)):h.push(s)}return h},sb=new Map;function uR(i){var o=sb.get(this);return o||(o=new Map,sb.set(this,o)),(o=ob(this,o.get(i)||(o.set(i,o=function(l){for(var h,_,x=1,E="",s="",A=[0],M=function(F){x===1&&(F||(E=E.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?A.push(0,F,E):x===3&&(F||E)?(A.push(3,F,E),x=2):x===2&&E==="..."&&F?A.push(4,F,0):x===2&&E&&!F?A.push(5,0,!0,E):x>=5&&((E||!F&&x===5)&&(A.push(x,0,E,_),x=6),F&&(A.push(x,F,0,_),x=6)),E=""},z=0;z<l.length;z++){z&&(x===1&&M(),M(z));for(var L=0;L<l[z].length;L++)h=l[z][L],x===1?h==="<"?(M(),A=[A],x=3):E+=h:x===4?E==="--"&&h===">"?(x=1,E=""):E=h+E[0]:s?h===s?s="":E+=h:h==='"'||h==="'"?s=h:h===">"?(M(),x=1):x&&(h==="="?(x=5,_=E,E=""):h==="/"&&(x<5||l[z][L+1]===">")?(M(),x===3&&(A=A[0]),x=A,(A=A[0]).push(2,0,x),x=0):h===" "||h==="	"||h===`
`||h==="\r"?(M(),x=2):E+=h),x===3&&E==="!--"&&(x=4,A=A[0])}return M(),A}(i)),o),arguments,[])).length>1?o:o[0]}var hR=uR.bind(Bt);function ag(){return ag=Object.assign?Object.assign.bind():function(i){for(var o=1;o<arguments.length;o++){var l=arguments[o];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(i[h]=l[h])}return i},ag.apply(this,arguments)}function fR(i,o){if(i==null)return{};var l={},h=Object.keys(i),_,x;for(x=0;x<h.length;x++)_=h[x],!(o.indexOf(_)>=0)&&(l[_]=i[_]);return l}function dR(i,o){if(i==null)return{};var l=fR(i,o),h,_;if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(i);for(_=0;_<x.length;_++)h=x[_],!(o.indexOf(h)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,h)||(l[h]=i[h]))}return l}var pR=["parts","highlightedTagName","nonHighlightedTagName","separator","className","classNames"];function mR(i){var o=i.createElement;return function(h){var _=h.classNames,x=h.children,E=h.highlightedTagName,s=h.isHighlighted,A=h.nonHighlightedTagName,M=s?E:A;return o(M,{className:s?_.highlighted:_.nonHighlighted},x)}}function _R(i){var o=i.createElement,l=i.Fragment,h=mR({createElement:o,Fragment:l});return function(x){var E=x.parts,s=x.highlightedTagName,A=s===void 0?"mark":s,M=x.nonHighlightedTagName,z=M===void 0?"span":M,L=x.separator,F=L===void 0?", ":L,j=x.className,H=x.classNames,W=H===void 0?{}:H,he=dR(x,pR);return o("span",ag({},he,{className:Gt(W.root,j)}),E.map(function(ve,Ce){var De=Ce===E.length-1;return o(l,{key:Ce},ve.map(function(Se,Ie){return o(h,{key:Ie,classNames:W,highlightedTagName:A,nonHighlightedTagName:z,isHighlighted:Se.isHighlighted},Se.value)}),!De&&o("span",{className:W.separator},F))}))}}var Yd=_R({createElement:Bt,Fragment:rh});function lg(){return lg=Object.assign||function(i){for(var o=1;o<arguments.length;o++){var l=arguments[o];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(i[h]=l[h])}return i},lg.apply(this,arguments)}function gR(i,o){if(i==null)return{};var l=yR(i,o),h,_;if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(i);for(_=0;_<x.length;_++)h=x[_],!(o.indexOf(h)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,h)||(l[h]=i[h]))}return l}function yR(i,o){if(i==null)return{};var l={},h=Object.keys(i),_,x;for(x=0;x<h.length;x++)_=h[x],!(o.indexOf(_)>=0)&&(l[_]=i[_]);return l}function vR(i){var o=i.classNames,l=o===void 0?{}:o,h=gR(i,["classNames"]);return Bt(Yd,lg({classNames:{root:Gt("ais-Highlight",l.root),highlighted:Gt("ais-Highlight-highlighted",l.highlighted),nonHighlighted:Gt("ais-Highlight-nonHighlighted",l.nonHighlighted),separator:Gt("ais-Highlight-separator",l.separator)}},h))}function cg(){return cg=Object.assign||function(i){for(var o=1;o<arguments.length;o++){var l=arguments[o];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(i[h]=l[h])}return i},cg.apply(this,arguments)}function xR(i,o){if(i==null)return{};var l=bR(i,o),h,_;if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(i);for(_=0;_<x.length;_++)h=x[_],!(o.indexOf(h)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,h)||(l[h]=i[h]))}return l}function bR(i,o){if(i==null)return{};var l={},h=Object.keys(i),_,x;for(x=0;x<h.length;x++)_=h[x],!(o.indexOf(_)>=0)&&(l[_]=i[_]);return l}function wR(i){var o=i.hit,l=i.attribute,h=i.cssClasses,_=xR(i,["hit","attribute","cssClasses"]),x=xs(o._highlightResult,l)||[],E=Ld(x),s=E.map(function(A){var M=A.value;return Kl(Xu(M||""))});return Bt(vR,cg({},_,{parts:s,classNames:h}))}function ug(){return ug=Object.assign||function(i){for(var o=1;o<arguments.length;o++){var l=arguments[o];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(i[h]=l[h])}return i},ug.apply(this,arguments)}function TR(i,o){if(i==null)return{};var l=ER(i,o),h,_;if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(i);for(_=0;_<x.length;_++)h=x[_],!(o.indexOf(h)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,h)||(l[h]=i[h]))}return l}function ER(i,o){if(i==null)return{};var l={},h=Object.keys(i),_,x;for(x=0;x<h.length;x++)_=h[x],!(o.indexOf(_)>=0)&&(l[_]=i[_]);return l}function SR(i){var o=i.classNames,l=o===void 0?{}:o,h=TR(i,["classNames"]);return Bt(Yd,ug({classNames:{root:Gt("ais-ReverseHighlight",l.root),highlighted:Gt("ais-ReverseHighlight-highlighted",l.highlighted),nonHighlighted:Gt("ais-ReverseHighlight-nonHighlighted",l.nonHighlighted),separator:Gt("ais-ReverseHighlight-separator",l.separator)}},h))}function hg(){return hg=Object.assign||function(i){for(var o=1;o<arguments.length;o++){var l=arguments[o];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(i[h]=l[h])}return i},hg.apply(this,arguments)}function ab(i,o){var l=Object.keys(i);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(i);o&&(h=h.filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable})),l.push.apply(l,h)}return l}function lb(i){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?arguments[o]:{};o%2?ab(Object(l),!0).forEach(function(h){AR(i,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(l)):ab(Object(l)).forEach(function(h){Object.defineProperty(i,h,Object.getOwnPropertyDescriptor(l,h))})}return i}function AR(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}function cb(i,o){if(i==null)return{};var l=PR(i,o),h,_;if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(i);for(_=0;_<x.length;_++)h=x[_],!(o.indexOf(h)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,h)||(l[h]=i[h]))}return l}function PR(i,o){if(i==null)return{};var l={},h=Object.keys(i),_,x;for(x=0;x<h.length;x++)_=h[x],!(o.indexOf(_)>=0)&&(l[_]=i[_]);return l}function IR(i){var o=i.hit,l=i.attribute,h=i.cssClasses,_=cb(i,["hit","attribute","cssClasses"]),x=xs(o._highlightResult,l)||[],E=Ld(x),s=E.map(function(A){var M=A.value;return Kl(Xu(M||"")).map(function(z){var L=z.isHighlighted,F=cb(z,["isHighlighted"]);return lb(lb({},F),{},{isHighlighted:!L})})});return Bt(SR,hg({},_,{parts:s,classNames:h}))}function fg(){return fg=Object.assign||function(i){for(var o=1;o<arguments.length;o++){var l=arguments[o];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(i[h]=l[h])}return i},fg.apply(this,arguments)}function MR(i,o){if(i==null)return{};var l=CR(i,o),h,_;if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(i);for(_=0;_<x.length;_++)h=x[_],!(o.indexOf(h)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,h)||(l[h]=i[h]))}return l}function CR(i,o){if(i==null)return{};var l={},h=Object.keys(i),_,x;for(x=0;x<h.length;x++)_=h[x],!(o.indexOf(_)>=0)&&(l[_]=i[_]);return l}function zR(i){var o=i.classNames,l=o===void 0?{}:o,h=MR(i,["classNames"]);return Bt(Yd,fg({classNames:{root:Gt("ais-ReverseSnippet",l.root),highlighted:Gt("ais-ReverseSnippet-highlighted",l.highlighted),nonHighlighted:Gt("ais-ReverseSnippet-nonHighlighted",l.nonHighlighted),separator:Gt("ais-ReverseSnippet-separator",l.separator)}},h))}function dg(){return dg=Object.assign||function(i){for(var o=1;o<arguments.length;o++){var l=arguments[o];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(i[h]=l[h])}return i},dg.apply(this,arguments)}function ub(i,o){var l=Object.keys(i);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(i);o&&(h=h.filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable})),l.push.apply(l,h)}return l}function hb(i){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?arguments[o]:{};o%2?ub(Object(l),!0).forEach(function(h){RR(i,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(l)):ub(Object(l)).forEach(function(h){Object.defineProperty(i,h,Object.getOwnPropertyDescriptor(l,h))})}return i}function RR(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}function fb(i,o){if(i==null)return{};var l=kR(i,o),h,_;if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(i);for(_=0;_<x.length;_++)h=x[_],!(o.indexOf(h)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,h)||(l[h]=i[h]))}return l}function kR(i,o){if(i==null)return{};var l={},h=Object.keys(i),_,x;for(x=0;x<h.length;x++)_=h[x],!(o.indexOf(_)>=0)&&(l[_]=i[_]);return l}function DR(i){var o=i.hit,l=i.attribute,h=i.cssClasses,_=fb(i,["hit","attribute","cssClasses"]),x=xs(o._snippetResult,l)||[],E=Ld(x),s=E.map(function(A){var M=A.value;return Kl(Xu(M||"")).map(function(z){var L=z.isHighlighted,F=fb(z,["isHighlighted"]);return hb(hb({},F),{},{isHighlighted:!L})})});return Bt(zR,dg({},_,{parts:s,classNames:h}))}function pg(){return pg=Object.assign||function(i){for(var o=1;o<arguments.length;o++){var l=arguments[o];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(i[h]=l[h])}return i},pg.apply(this,arguments)}function OR(i,o){if(i==null)return{};var l=LR(i,o),h,_;if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(i);for(_=0;_<x.length;_++)h=x[_],!(o.indexOf(h)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,h)||(l[h]=i[h]))}return l}function LR(i,o){if(i==null)return{};var l={},h=Object.keys(i),_,x;for(x=0;x<h.length;x++)_=h[x],!(o.indexOf(_)>=0)&&(l[_]=i[_]);return l}function FR(i){var o=i.classNames,l=o===void 0?{}:o,h=OR(i,["classNames"]);return Bt(Yd,pg({classNames:{root:Gt("ais-Snippet",l.root),highlighted:Gt("ais-Snippet-highlighted",l.highlighted),nonHighlighted:Gt("ais-Snippet-nonHighlighted",l.nonHighlighted),separator:Gt("ais-Snippet-separator",l.separator)}},h))}function mg(){return mg=Object.assign||function(i){for(var o=1;o<arguments.length;o++){var l=arguments[o];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(i[h]=l[h])}return i},mg.apply(this,arguments)}function BR(i,o){if(i==null)return{};var l=jR(i,o),h,_;if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(i);for(_=0;_<x.length;_++)h=x[_],!(o.indexOf(h)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,h)||(l[h]=i[h]))}return l}function jR(i,o){if(i==null)return{};var l={},h=Object.keys(i),_,x;for(x=0;x<h.length;x++)_=h[x],!(o.indexOf(_)>=0)&&(l[_]=i[_]);return l}function NR(i){var o=i.hit,l=i.attribute,h=i.cssClasses,_=BR(i,["hit","attribute","cssClasses"]),x=xs(o._snippetResult,l)||[],E=Ld(x),s=E.map(function(A){var M=A.value;return Kl(Xu(M||""))});return Bt(FR,mg({},_,{parts:s,classNames:h}))}function Kd(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Kd=function(l){return typeof l}:Kd=function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},Kd(i)}function db(i,o){var l=Object.keys(i);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(i);o&&(h=h.filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable})),l.push.apply(l,h)}return l}function Jd(i){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?arguments[o]:{};o%2?db(Object(l),!0).forEach(function(h){pb(i,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(l)):db(Object(l)).forEach(function(h){Object.defineProperty(i,h,Object.getOwnPropertyDescriptor(l,h))})}return i}function pb(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}function UR(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0;return Object.keys(i).reduce(function(h,_){return Jd(Jd({},h),{},pb({},_,function(){var x=this;return function(E){var s=function(M){return nb.compile(M,o).render(x)};return i[_].call(l,E,s)}}))},{})}function VR(i){var o=i.templates,l=i.templateKey,h=i.compileOptions,_=i.helpers,x=i.data,E=i.bindEvent,s=i.sendEvent,A=o[l];if(typeof A!="string"&&typeof A!="function")throw new Error("Template must be 'string' or 'function', was '".concat(Kd(A),"' (key: ").concat(l,")"));if(typeof A=="function"){var M=E||{};return M.html=hR,M.sendEvent=s,M.components={Highlight:wR,ReverseHighlight:IR,Snippet:NR,ReverseSnippet:DR},A(x,M)}var z=UR(_,h,x);return nb.compile(A,h).render(Jd(Jd({},x),{},{helpers:z})).replace(/[ \n\r\t\f\xA0]+/g,function(L){return L.replace(/(^|\xA0+)[^\xA0]+/g,"$1 ")}).trim()}function _g(){return _g=Object.assign||function(i){for(var o=1;o<arguments.length;o++){var l=arguments[o];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(i[h]=l[h])}return i},_g.apply(this,arguments)}function nh(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?nh=function(l){return typeof l}:nh=function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},nh(i)}function $R(i,o){if(!(i instanceof o))throw new TypeError("Cannot call a class as a function")}function mb(i,o){for(var l=0;l<o.length;l++){var h=o[l];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(i,h.key,h)}}function GR(i,o,l){return o&&mb(i.prototype,o),l&&mb(i,l),i}function qR(i,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(o&&o.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),o&&gg(i,o)}function gg(i,o){return gg=Object.setPrototypeOf||function(h,_){return h.__proto__=_,h},gg(i,o)}function ZR(i){var o=XR();return function(){var h=ep(i),_;if(o){var x=ep(this).constructor;_=Reflect.construct(h,arguments,x)}else _=h.apply(this,arguments);return HR(this,_)}}function HR(i,o){return o&&(nh(o)==="object"||typeof o=="function")?o:WR(i)}function WR(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function XR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function ep(i){return ep=Object.setPrototypeOf?Object.getPrototypeOf:function(l){return l.__proto__||Object.getPrototypeOf(l)},ep(i)}function QR(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}var YR={data:{},rootTagName:"div",useCustomCompileOptions:{},templates:{},templatesConfig:{}},_b=function(i){qR(l,i);var o=ZR(l);function l(){return $R(this,l),o.apply(this,arguments)}return GR(l,[{key:"shouldComponentUpdate",value:function(_){return!Yu(this.props.data,_.data)||this.props.templateKey!==_.templateKey||!Yu(this.props.rootProps,_.rootProps)}},{key:"render",value:function(){var _=this.props.rootTagName,x=this.props.useCustomCompileOptions[this.props.templateKey],E=x?this.props.templatesConfig.compileOptions:{},s=VR({templates:this.props.templates,templateKey:this.props.templateKey,compileOptions:E,helpers:this.props.templatesConfig.helpers,data:this.props.data,bindEvent:this.props.bindEvent,sendEvent:this.props.sendEvent});return s===null?null:nh(s)==="object"?Bt(_,this.props.rootProps,s):Bt(_,_g({},this.props.rootProps,{dangerouslySetInnerHTML:{__html:s}}))}}]),l}(ec);QR(_b,"defaultProps",YR);var oh=_b;function tp(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?tp=function(l){return typeof l}:tp=function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},tp(i)}function KR(i,o){if(!(i instanceof o))throw new TypeError("Cannot call a class as a function")}function gb(i,o){for(var l=0;l<o.length;l++){var h=o[l];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(i,h.key,h)}}function JR(i,o,l){return o&&gb(i.prototype,o),l&&gb(i,l),i}function ek(i,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(o&&o.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),o&&yg(i,o)}function yg(i,o){return yg=Object.setPrototypeOf||function(h,_){return h.__proto__=_,h},yg(i,o)}function tk(i){var o=ik();return function(){var h=rp(i),_;if(o){var x=rp(this).constructor;_=Reflect.construct(h,arguments,x)}else _=h.apply(this,arguments);return rk(this,_)}}function rk(i,o){return o&&(tp(o)==="object"||typeof o=="function")?o:Ts(i)}function Ts(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function ik(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function rp(i){return rp=Object.setPrototypeOf?Object.getPrototypeOf:function(l){return l.__proto__||Object.getPrototypeOf(l)},rp(i)}function Es(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}var nk={query:"",showSubmit:!0,showReset:!0,showLoadingIndicator:!0,autofocus:!1,searchAsYouType:!0,isSearchStalled:!1,disabled:!1,onChange:on,onSubmit:on,onReset:on,refine:on},yb=function(i){ek(l,i);var o=tk(l);function l(){var h;KR(this,l);for(var _=arguments.length,x=new Array(_),E=0;E<_;E++)x[E]=arguments[E];return h=o.call.apply(o,[this].concat(x)),Es(Ts(h),"state",{query:h.props.query,focused:!1}),Es(Ts(h),"input",Yz()),Es(Ts(h),"onInput",function(s){var A=h.props,M=A.searchAsYouType,z=A.refine,L=A.onChange,F=s.target.value;M&&z(F),h.setState({query:F}),L(s)}),Es(Ts(h),"onSubmit",function(s){var A=h.props,M=A.searchAsYouType,z=A.refine,L=A.onSubmit;return s.preventDefault(),s.stopPropagation(),h.input.current&&h.input.current.blur(),M||z(h.state.query),L(s),!1}),Es(Ts(h),"onReset",function(s){var A=h.props,M=A.refine,z=A.onReset,L="";h.input.current&&h.input.current.focus(),M(L),h.setState({query:L}),z(s)}),Es(Ts(h),"onBlur",function(){h.setState({focused:!1})}),Es(Ts(h),"onFocus",function(){h.setState({focused:!0})}),h}return JR(l,[{key:"resetInput",value:function(){this.setState({query:""})}},{key:"componentWillReceiveProps",value:function(_){!this.state.focused&&_.query!==this.state.query&&this.setState({query:_.query})}},{key:"render",value:function(){var _=this.props,x=_.cssClasses,E=_.placeholder,s=_.autofocus,A=_.showSubmit,M=_.showReset,z=_.showLoadingIndicator,L=_.templates,F=_.isSearchStalled;return Bt("div",{className:x.root},Bt("form",{action:"",role:"search",className:x.form,noValidate:!0,onSubmit:this.onSubmit,onReset:this.onReset},Bt("input",{ref:this.input,value:this.state.query,disabled:this.props.disabled,className:x.input,type:"search",placeholder:E,autoFocus:s,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",maxLength:512,onInput:this.onInput,onBlur:this.onBlur,onFocus:this.onFocus}),Bt(oh,{templateKey:"submit",rootTagName:"button",rootProps:{className:x.submit,type:"submit",title:"Submit the search query.",hidden:!A},templates:L,data:{cssClasses:x}}),Bt(oh,{templateKey:"reset",rootTagName:"button",rootProps:{className:x.reset,type:"reset",title:"Clear the search query.",hidden:!(M&&this.state.query.trim()&&!F)},templates:L,data:{cssClasses:x}}),z&&Bt(oh,{templateKey:"loadingIndicator",rootTagName:"span",rootProps:{className:x.loadingIndicator,hidden:!F},templates:L,data:{cssClasses:x}})))}}]),l}(ec);Es(yb,"defaultProps",nk);var ok=yb;function vb(i,o){var l=Object.keys(i);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(i);o&&(h=h.filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable})),l.push.apply(l,h)}return l}function Ss(i){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?arguments[o]:{};o%2?vb(Object(l),!0).forEach(function(h){xb(i,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(l)):vb(Object(l)).forEach(function(h){Object.defineProperty(i,h,Object.getOwnPropertyDescriptor(l,h))})}return i}function xb(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}var sk=Bo({name:"hits",connector:!0}),ak=function(o){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:on;return G_(o,sk()),function(h){var _=h||{},x=_.escapeHTML,E=x===void 0?!0:x,s=_.transformItems,A=s===void 0?function(L){return L}:s,M,z;return{$$type:"ais.hits",init:function(F){o(Ss(Ss({},this.getWidgetRenderState(F)),{},{instantSearchInstance:F.instantSearchInstance}),!0)},render:function(F){var j=this.getWidgetRenderState(F);o(Ss(Ss({},j),{},{instantSearchInstance:F.instantSearchInstance}),!1),j.sendEvent("view",j.hits)},getRenderState:function(F,j){return Ss(Ss({},F),{},{hits:this.getWidgetRenderState(j)})},getWidgetRenderState:function(F){var j=F.results,H=F.helper,W=F.instantSearchInstance;if(M||(M=$M({instantSearchInstance:W,index:H.getIndex(),widgetType:this.$$type})),z||(z=GM({index:H.getIndex(),widgetType:this.$$type})),!j)return{hits:[],results:void 0,sendEvent:M,bindEvent:z,widgetParams:h};E&&j.hits.length>0&&(j.hits=NM(j.hits));var he=JM(j.hits,j.page,j.hitsPerPage),ve=tC(he,j.queryID),Ce=A(ve,{results:j});return{hits:Ce,results:j,sendEvent:M,bindEvent:z,widgetParams:h}},dispose:function(F){var j=F.state;return l(),E?j.setQueryParameters(Object.keys(zd).reduce(function(H,W){return Ss(Ss({},H),{},xb({},W,void 0))},{})):j},getWidgetSearchParameters:function(F){return E?F.setQueryParameters(zd):F}}}},lk=ak;function bb(i,o){var l=Object.keys(i);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(i);o&&(h=h.filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable})),l.push.apply(l,h)}return l}function wb(i){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?arguments[o]:{};o%2?bb(Object(l),!0).forEach(function(h){ck(i,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(l)):bb(Object(l)).forEach(function(h){Object.defineProperty(i,h,Object.getOwnPropertyDescriptor(l,h))})}return i}function ck(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}function ip(){return ip=Object.assign||function(i){for(var o=1;o<arguments.length;o++){var l=arguments[o];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(i[h]=l[h])}return i},ip.apply(this,arguments)}var uk=function(o){var l=o.results,h=o.hits,_=o.bindEvent,x=o.sendEvent,E=o.cssClasses,s=o.templateProps;return l.hits.length===0?Bt(oh,ip({},s,{templateKey:"empty",rootProps:{className:Gt(E.root,E.emptyRoot)},data:l})):Bt("div",{className:E.root},Bt("ol",{className:E.list},h.map(function(A,M){return Bt(oh,ip({},s,{templateKey:"item",rootTagName:"li",rootProps:{className:E.item},key:A.objectID,data:wb(wb({},A),{},{__hitIndex:M}),bindEvent:_,sendEvent:x}))})))},hk=uk,fk={empty:function(){return"No results"},item:function(o){return JSON.stringify(o,null,2)}},dk=fk;function Tb(i,o){var l=Object.keys(i);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(i);o&&(h=h.filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable})),l.push.apply(l,h)}return l}function np(i){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?arguments[o]:{};o%2?Tb(Object(l),!0).forEach(function(h){pk(i,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(l)):Tb(Object(l)).forEach(function(h){Object.defineProperty(i,h,Object.getOwnPropertyDescriptor(l,h))})}return i}function pk(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}var mk=function(o,l){return l.map(function(h){var _=HM(o,function(x){return x.objectID===h});if(typeof _=="undefined")throw new Error('Could not find objectID "'.concat(h,'" passed to `clickedObjectIDsAfterSearch` in the returned hits. This is necessary to infer the absolute position and the query ID.'));return _})},_k=function(o){var l=H_(o.map(function(_){return _.__queryID}));if(l.length>1)throw new Error("Insights currently allows a single `queryID`. The `objectIDs` provided map to multiple `queryID`s.");var h=l[0];if(typeof h!="string")throw new Error("Could not infer `queryID`. Ensure InstantSearch `clickAnalytics: true` was added with the Configure widget.\n\nSee: https://alg.li/lNiZZ7");return h},gk=function(o){return o.map(function(l){return l.__position})},yk=function(o){var l=o.method,h=o.results,_=o.hits,x=o.objectIDs,E=h.index,s=mk(_,x),A=_k(s);switch(l){case"clickedObjectIDsAfterSearch":{var M=gk(s);return{index:E,queryID:A,objectIDs:x,positions:M}}case"convertedObjectIDsAfterSearch":return{index:E,queryID:A,objectIDs:x};default:throw new Error('Unsupported method passed to insights: "'.concat(l,'".'))}},vk=function(o,l,h){return function(_){for(var x=arguments.length,E=new Array(x>1?x-1:0),s=1;s<x;s++)E[s-1]=arguments[s];var A=E[0];if(!o){var M=Bo({name:"instantsearch"});throw new Error(M("The `insightsClient` option has not been provided to `instantsearch`."))}if(!Array.isArray(A.objectIDs))throw new TypeError("Expected `objectIDs` to be an array.");var z=yk({method:_,results:l,hits:h,objectIDs:A.objectIDs});o(_,np(np({},z),A))}};function xk(i){return function(o,l){return i(function(h,_){var x=h.results,E=h.hits,s=h.instantSearchInstance;if(x&&E&&s){var A=vk(s.insightsClient,x,E);return o(np(np({},h),{},{insights:A}),_)}return o(h,_)},l)}}var Eb=function(o,l,h){for(var _=o;_&&!h(_);){if(_===l)return null;_=_.parentElement}return _},bk=function(o){var l=o.getAttribute("data-insights-event");if(typeof l!="string")throw new Error("The insights middleware expects `data-insights-event` to be a base64-encoded JSON string.");try{return Kx(l)}catch{throw new Error("The insights middleware was unable to parse `data-insights-event`.")}},wk=function(o){function l(h){var _=function(E){if(h.sendEvent){var s=Eb(E.target,E.currentTarget,function(j){return j.hasAttribute("data-insights-event")});if(s){var A=bk(s);A.forEach(function(j){return h.sendEvent(j)})}}var M=Eb(E.target,E.currentTarget,function(j){return jC(j)});if(M){var z=BC(M),L=z.method,F=z.payload;h.insights(L,F)}};return Bt("div",{onClick:_},Bt(o,h))}return l},Tk=wk;function Sb(i,o){var l=Object.keys(i);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(i);o&&(h=h.filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable})),l.push.apply(l,h)}return l}function Ab(i){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?arguments[o]:{};o%2?Sb(Object(l),!0).forEach(function(h){Ek(i,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(l)):Sb(Object(l)).forEach(function(h){Object.defineProperty(i,h,Object.getOwnPropertyDescriptor(l,h))})}return i}function Ek(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}var Sk=Bo({name:"hits"}),op=Ia("Hits"),Ak=Tk(hk),Pk=function(o){var l=o.renderState,h=o.cssClasses,_=o.containerNode,x=o.templates;return function(E,s){var A=E.hits,M=E.results,z=E.instantSearchInstance,L=E.insights,F=E.bindEvent;if(s){l.templateProps=lR({defaultTemplates:dk,templatesConfig:z.templatesConfig,templates:x});return}tc(Bt(Ak,{cssClasses:h,hits:A,results:M,templateProps:l.templateProps,insights:L,sendEvent:function(H){z.sendEventToInsights(H)},bindEvent:F}),_)}},Ik=function(o){var l=o||{},h=l.container,_=l.escapeHTML,x=l.transformItems,E=l.templates,s=E===void 0?{}:E,A=l.cssClasses,M=A===void 0?{}:A;if(!h)throw new Error(Sk("The `container` option is required."));var z=Dd(h),L={root:Gt(op(),M.root),emptyRoot:Gt(op({modifierName:"empty"}),M.emptyRoot),list:Gt(op({descendantName:"list"}),M.list),item:Gt(op({descendantName:"item"}),M.item)},F=Pk({containerNode:z,cssClasses:L,renderState:{},templates:s}),j=xk(lk)(F,function(){return tc(null,z)});return Ab(Ab({},j({escapeHTML:_,transformItems:x})),{},{$$widgetType:"ais.hits"})},LD=Ik;function Mk(i){function o(l){return function(h){rC(h)||(h.preventDefault(),i.setCurrentPage(l))}}return Bt("div",{className:Gt(i.cssClasses.root,i.nbPages<=1&&i.cssClasses.noRefinementRoot)},Bt("ul",{className:i.cssClasses.list},i.showFirst&&Bt(sh,{ariaLabel:"First",className:i.cssClasses.firstPageItem,isDisabled:i.isFirstPage,label:i.templates.first,pageNumber:0,createURL:i.createURL,cssClasses:i.cssClasses,createClickHandler:o}),i.showPrevious&&Bt(sh,{ariaLabel:"Previous",className:i.cssClasses.previousPageItem,isDisabled:i.isFirstPage,label:i.templates.previous,pageNumber:i.currentPage-1,createURL:i.createURL,cssClasses:i.cssClasses,createClickHandler:o}),i.pages.map(function(l){return Bt(sh,{key:l,ariaLabel:"".concat(l+1),className:i.cssClasses.pageItem,isSelected:l===i.currentPage,label:"".concat(l+1),pageNumber:l,createURL:i.createURL,cssClasses:i.cssClasses,createClickHandler:o})}),i.showNext&&Bt(sh,{ariaLabel:"Next",className:i.cssClasses.nextPageItem,isDisabled:i.isLastPage,label:i.templates.next,pageNumber:i.currentPage+1,createURL:i.createURL,cssClasses:i.cssClasses,createClickHandler:o}),i.showLast&&Bt(sh,{ariaLabel:"Last",className:i.cssClasses.lastPageItem,isDisabled:i.isLastPage,label:i.templates.last,pageNumber:i.nbPages-1,createURL:i.createURL,cssClasses:i.cssClasses,createClickHandler:o})))}function sh(i){var o=i.label,l=i.ariaLabel,h=i.pageNumber,_=i.className,x=i.isDisabled,E=x===void 0?!1:x,s=i.isSelected,A=s===void 0?!1:s,M=i.cssClasses,z=i.createURL,L=i.createClickHandler;return Bt("li",{className:Gt(M.item,_,E&&M.disabledItem,A&&M.selectedItem)},E?Bt("span",{className:M.link,dangerouslySetInnerHTML:{__html:o}}):Bt("a",{className:M.link,"aria-label":l,href:z(h),onClick:L(h),dangerouslySetInnerHTML:{__html:o}}))}function Ck(i,o){if(!(i instanceof o))throw new TypeError("Cannot call a class as a function")}function Pb(i,o){for(var l=0;l<o.length;l++){var h=o[l];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(i,h.key,h)}}function zk(i,o,l){return o&&Pb(i.prototype,o),l&&Pb(i,l),i}function vg(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}var Rk=function(){function i(o){Ck(this,i),vg(this,"currentPage",void 0),vg(this,"total",void 0),vg(this,"padding",void 0),this.currentPage=o.currentPage,this.total=o.total,this.padding=o.padding}return zk(i,[{key:"pages",value:function(){var l=this.total,h=this.currentPage,_=this.padding;if(l===0)return[0];var x=this.nbPagesDisplayed(_,l);if(x===l)return s1({end:l});var E=this.calculatePaddingLeft(h,_,l,x),s=x-E,A=h-E,M=h+s;return s1({start:A,end:M})}},{key:"nbPagesDisplayed",value:function(l,h){return Math.min(2*l+1,h)}},{key:"calculatePaddingLeft",value:function(l,h,_,x){return l<=h?l:l>=_-h?x-(_-l):h}},{key:"isLastPage",value:function(){return this.currentPage===this.total-1||this.total===0}},{key:"isFirstPage",value:function(){return this.currentPage===0}}]),i}(),kk=Rk;function Ib(i,o){var l=Object.keys(i);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(i);o&&(h=h.filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable})),l.push.apply(l,h)}return l}function As(i){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?arguments[o]:{};o%2?Ib(Object(l),!0).forEach(function(h){Dk(i,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(l)):Ib(Object(l)).forEach(function(h){Object.defineProperty(i,h,Object.getOwnPropertyDescriptor(l,h))})}return i}function Dk(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}var Ok=Bo({name:"pagination",connector:!0}),Lk=function(o){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:on;return G_(o,Ok()),function(h){var _=h||{},x=_.totalPages,E=_.padding,s=E===void 0?3:E,A=new kk({currentPage:0,total:0,padding:s}),M={};function z(L){var F=L.nbPages;return x!==void 0?Math.min(x,F):F}return{$$type:"ais.pagination",init:function(F){var j=F.instantSearchInstance;o(As(As({},this.getWidgetRenderState(F)),{},{instantSearchInstance:j}),!0)},render:function(F){var j=F.instantSearchInstance;o(As(As({},this.getWidgetRenderState(F)),{},{instantSearchInstance:j}),!1)},dispose:function(F){var j=F.state;return l(),j.setQueryParameter("page",void 0)},getWidgetUiState:function(F,j){var H=j.searchParameters,W=H.page||0;return W?As(As({},F),{},{page:W+1}):F},getWidgetSearchParameters:function(F,j){var H=j.uiState,W=H.page?H.page-1:0;return F.setQueryParameter("page",W)},getWidgetRenderState:function(F){var j=F.results,H=F.helper,W=F.state,he=F.createURL;M.refine||(M.refine=function(De){H.setPage(De),H.search()}),M.createURL||(M.createURL=function(De){return function(Se){return he(De.setPage(Se))}});var ve=W.page||0,Ce=z(j||{nbPages:0});return A.currentPage=ve,A.total=Ce,{createURL:M.createURL(W),refine:M.refine,canRefine:Ce>1,currentRefinement:ve,nbHits:(j==null?void 0:j.nbHits)||0,nbPages:Ce,pages:j?A.pages():[],isFirstPage:A.isFirstPage(),isLastPage:A.isLastPage(),widgetParams:h}},getRenderState:function(F,j){return As(As({},F),{},{pagination:this.getWidgetRenderState(j)})}}}},Fk=Lk;function Mb(i,o){var l=Object.keys(i);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(i);o&&(h=h.filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable})),l.push.apply(l,h)}return l}function sp(i){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?arguments[o]:{};o%2?Mb(Object(l),!0).forEach(function(h){Bk(i,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(l)):Mb(Object(l)).forEach(function(h){Object.defineProperty(i,h,Object.getOwnPropertyDescriptor(l,h))})}return i}function Bk(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}var En=Ia("Pagination"),jk=Bo({name:"pagination"}),Nk={previous:"\u2039",next:"\u203A",first:"\xAB",last:"\xBB"},Uk=function(o){var l=o.containerNode,h=o.cssClasses,_=o.templates,x=o.showFirst,E=o.showLast,s=o.showPrevious,A=o.showNext,M=o.scrollToNode;return function(z,L){var F=z.createURL,j=z.currentRefinement,H=z.nbPages,W=z.pages,he=z.isFirstPage,ve=z.isLastPage,Ce=z.refine;if(!L){var De=function(Ie){Ce(Ie),M!==!1&&M.scrollIntoView()};tc(Bt(Mk,{createURL:F,cssClasses:h,currentPage:j,templates:_,nbPages:H,pages:W,isFirstPage:he,isLastPage:ve,setCurrentPage:De,showFirst:x,showLast:E,showPrevious:s,showNext:A}),l)}}},Vk=function(o){var l=o||{},h=l.container,_=l.templates,x=_===void 0?{}:_,E=l.cssClasses,s=E===void 0?{}:E,A=l.totalPages,M=l.padding,z=l.showFirst,L=z===void 0?!0:z,F=l.showLast,j=F===void 0?!0:F,H=l.showPrevious,W=H===void 0?!0:H,he=l.showNext,ve=he===void 0?!0:he,Ce=l.scrollTo,De=Ce===void 0?"body":Ce;if(!h)throw new Error(jk("The `container` option is required."));var Se=Dd(h),Ie=De===!0?"body":De,We=Ie!==!1?Dd(Ie):!1,mt={root:Gt(En(),s.root),noRefinementRoot:Gt(En({modifierName:"noRefinement"}),s.noRefinementRoot),list:Gt(En({descendantName:"list"}),s.list),item:Gt(En({descendantName:"item"}),s.item),firstPageItem:Gt(En({descendantName:"item",modifierName:"firstPage"}),s.firstPageItem),lastPageItem:Gt(En({descendantName:"item",modifierName:"lastPage"}),s.lastPageItem),previousPageItem:Gt(En({descendantName:"item",modifierName:"previousPage"}),s.previousPageItem),nextPageItem:Gt(En({descendantName:"item",modifierName:"nextPage"}),s.nextPageItem),pageItem:Gt(En({descendantName:"item",modifierName:"page"}),s.pageItem),selectedItem:Gt(En({descendantName:"item",modifierName:"selected"}),s.selectedItem),disabledItem:Gt(En({descendantName:"item",modifierName:"disabled"}),s.disabledItem),link:Gt(En({descendantName:"link"}),s.link)},Te=sp(sp({},Nk),x),Ue=Uk({containerNode:Se,cssClasses:mt,templates:Te,showFirst:L,showLast:j,showPrevious:W,showNext:ve,scrollToNode:We}),Xe=Fk(Ue,function(){return tc(null,Se)});return sp(sp({},Xe({totalPages:A,padding:M})),{},{$$widgetType:"ais.pagination"})},FD=Vk,$k=Bt("path",{d:"M8.114 10L.944 2.83 0 1.885 1.886 0l.943.943L10 8.113l7.17-7.17.944-.943L20 1.886l-.943.943-7.17 7.17 7.17 7.17.943.944L18.114 20l-.943-.943-7.17-7.17-7.17 7.17-.944.943L0 18.114l.943-.943L8.113 10z"}),Gk=Bt("path",{d:"M26.804 29.01c-2.832 2.34-6.465 3.746-10.426 3.746C7.333 32.756 0 25.424 0 16.378 0 7.333 7.333 0 16.378 0c9.046 0 16.378 7.333 16.378 16.378 0 3.96-1.406 7.594-3.746 10.426l10.534 10.534c.607.607.61 1.59-.004 2.202-.61.61-1.597.61-2.202.004L26.804 29.01zm-10.426.627c7.323 0 13.26-5.936 13.26-13.26 0-7.32-5.937-13.257-13.26-13.257C9.056 3.12 3.12 9.056 3.12 16.378c0 7.323 5.936 13.26 13.258 13.26z"}),qk=Bt("g",{fill:"none",fillRule:"evenodd"},Bt("g",{transform:"translate(1 1)",strokeWidth:"2"},Bt("circle",{strokeOpacity:".5",cx:"18",cy:"18",r:"18"}),Bt("path",{d:"M36 18c0-9.94-8.06-18-18-18"},Bt("animateTransform",{attributeName:"transform",type:"rotate",from:"0 18 18",to:"360 18 18",dur:"1s",repeatCount:"indefinite"})))),Zk={reset:function(o){var l=o.cssClasses;return Bt("svg",{className:l.resetIcon,viewBox:"0 0 20 20",width:"10",height:"10"},$k)},submit:function(o){var l=o.cssClasses;return Bt("svg",{className:l.submitIcon,width:"10",height:"10",viewBox:"0 0 40 40"},Gk)},loadingIndicator:function(o){var l=o.cssClasses;return Bt("svg",{className:l.loadingIcon,width:"16",height:"16",viewBox:"0 0 38 38",stroke:"#444"},qk)}},Hk=Zk;function Cb(i,o){var l=Object.keys(i);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(i);o&&(h=h.filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable})),l.push.apply(l,h)}return l}function Ps(i){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?arguments[o]:{};o%2?Cb(Object(l),!0).forEach(function(h){Wk(i,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(l)):Cb(Object(l)).forEach(function(h){Object.defineProperty(i,h,Object.getOwnPropertyDescriptor(l,h))})}return i}function Wk(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}var Xk=Bo({name:"search-box",connector:!0}),Qk=function(o,l){return l(o)},Yk=function(o){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:on;return G_(o,Xk()),function(h){var _=h||{},x=_.queryHook,E=x===void 0?Qk:x,s,A;return{$$type:"ais.searchBox",init:function(z){var L=z.instantSearchInstance;o(Ps(Ps({},this.getWidgetRenderState(z)),{},{instantSearchInstance:L}),!0)},render:function(z){var L=z.instantSearchInstance;o(Ps(Ps({},this.getWidgetRenderState(z)),{},{instantSearchInstance:L}),!1)},dispose:function(z){var L=z.state;return l(),L.setQueryParameter("query",void 0)},getRenderState:function(z,L){return Ps(Ps({},z),{},{searchBox:this.getWidgetRenderState(L)})},getWidgetRenderState:function(z){var L=z.helper,F=z.searchMetadata,j=z.state;return s||(s=function(W){E(W,function(he){return L.setQuery(he).search()})},A=function(){L.setQuery("").search()}),{query:j.query||"",refine:s,clear:A,widgetParams:h,isSearchStalled:F.isSearchStalled}},getWidgetUiState:function(z,L){var F=L.searchParameters,j=F.query||"";return j===""||z&&z.query===j?z:Ps(Ps({},z),{},{query:j})},getWidgetSearchParameters:function(z,L){var F=L.uiState;return z.setQueryParameter("query",F.query||"")}}}},Kk=Yk;function zb(i,o){var l=Object.keys(i);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(i);o&&(h=h.filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable})),l.push.apply(l,h)}return l}function ap(i){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?arguments[o]:{};o%2?zb(Object(l),!0).forEach(function(h){Jk(i,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(l)):zb(Object(l)).forEach(function(h){Object.defineProperty(i,h,Object.getOwnPropertyDescriptor(l,h))})}return i}function Jk(i,o,l){return o in i?Object.defineProperty(i,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[o]=l,i}var eD=Bo({name:"search-box"}),Vo=Ia("SearchBox"),tD=function(o){var l=o.containerNode,h=o.cssClasses,_=o.placeholder,x=o.templates,E=o.autofocus,s=o.searchAsYouType,A=o.showReset,M=o.showSubmit,z=o.showLoadingIndicator;return function(L){var F=L.refine,j=L.query,H=L.isSearchStalled;tc(Bt(ok,{query:j,placeholder:_,autofocus:E,refine:F,searchAsYouType:s,templates:x,showSubmit:M,showReset:A,showLoadingIndicator:z,isSearchStalled:H,cssClasses:h}),l)}},rD=function(o){var l=o||{},h=l.container,_=l.placeholder,x=_===void 0?"":_,E=l.cssClasses,s=E===void 0?{}:E,A=l.autofocus,M=A===void 0?!1:A,z=l.searchAsYouType,L=z===void 0?!0:z,F=l.showReset,j=F===void 0?!0:F,H=l.showSubmit,W=H===void 0?!0:H,he=l.showLoadingIndicator,ve=he===void 0?!0:he,Ce=l.queryHook,De=l.templates,Se=De===void 0?{}:De;if(!h)throw new Error(eD("The `container` option is required."));var Ie=Dd(h),We={root:Gt(Vo(),s.root),form:Gt(Vo({descendantName:"form"}),s.form),input:Gt(Vo({descendantName:"input"}),s.input),submit:Gt(Vo({descendantName:"submit"}),s.submit),submitIcon:Gt(Vo({descendantName:"submitIcon"}),s.submitIcon),reset:Gt(Vo({descendantName:"reset"}),s.reset),resetIcon:Gt(Vo({descendantName:"resetIcon"}),s.resetIcon),loadingIndicator:Gt(Vo({descendantName:"loadingIndicator"}),s.loadingIndicator),loadingIcon:Gt(Vo({descendantName:"loadingIcon"}),s.loadingIcon)},mt=ap(ap({},Hk),Se),Te=tD({containerNode:Ie,cssClasses:We,placeholder:x,templates:mt,autofocus:M,searchAsYouType:L,showReset:j,showSubmit:W,showLoadingIndicator:ve}),Ue=Kk(Te,function(){return tc(null,Ie)});return ap(ap({},Ue({queryHook:Ce})),{},{$$widgetType:"ais.searchBox"})},BD=rD;export{s0 as $,dD as A,fD as B,Rl as C,id as D,jf as E,Uf as F,Vf as G,Nf as H,Ol as I,bi as J,Lm as K,i0 as L,Wf as M,sD as N,kl as O,vD as P,ed as Q,_D as R,Zm as S,TD as T,mD as U,bD as V,xD as W,lD as X,oD as Y,cD as Z,NE as _,Fm as a,uD as a0,md as a1,HT as a2,AD as a3,SD as a4,MD as a5,zD as a6,RD as a7,PD as a8,CD as a9,ID as aa,tI as ab,hD as ac,nD as ad,gD as ae,wD as af,ED as ag,kD as ah,iD as ai,yD as aj,aD as ak,DD as al,OD as am,BD as an,FD as ao,LD as ap,RC as aq,Ll as b,Xf as c,Ai as d,zu as e,rn as f,ao as g,n0 as h,qm as i,gT as j,Ou as k,Zf as l,lo as m,Gm as n,Hf as o,jl as p,Vm as q,$m as r,Ff as s,qf as t,Fl as u,Pi as v,Nl as w,Bl as x,pi as y,pD as z};
